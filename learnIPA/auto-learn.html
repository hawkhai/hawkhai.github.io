<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è‹±è¯­éŸ³æ ‡è‡ªåŠ¨å­¦ä¹  - å¼€è½¦ä¸“ç”¨ç‰ˆ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: white;
            overflow: hidden;
        }

        .container {
            width: 100%;
            max-width: 800px;
            text-align: center;
            padding: 20px;
        }

        .header {
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }

        .header p {
            font-size: 1rem;
            opacity: 0.8;
        }

        .main-display {
            background: rgba(255,255,255,0.1);
            border-radius: 20px;
            padding: 60px 40px;
            margin-bottom: 40px;
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255,255,255,0.2);
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
            min-height: 300px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .phonetic-symbol {
            font-size: 8rem;
            font-weight: bold;
            margin-bottom: 20px;
            font-family: "Times New Roman", serif;
            text-shadow: 3px 3px 6px rgba(0,0,0,0.5);
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .phonetic-info {
            font-size: 1.5rem;
            margin-bottom: 15px;
            opacity: 0.9;
        }

        .progress-info {
            font-size: 1.2rem;
            opacity: 0.7;
            margin-bottom: 10px;
        }

        .repeat-counter {
            font-size: 2rem;
            color: #3498db;
            font-weight: bold;
            margin-top: 10px;
        }

        .controls {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .control-btn {
            background: rgba(255,255,255,0.2);
            border: 2px solid rgba(255,255,255,0.3);
            color: white;
            padding: 15px 25px;
            border-radius: 50px;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(5px);
            min-width: 120px;
        }

        .control-btn:hover {
            background: rgba(255,255,255,0.3);
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        }

        .control-btn:active {
            transform: translateY(0);
        }

        .control-btn.active {
            background: #3498db;
            border-color: #3498db;
        }

        .status-bar {
            background: rgba(0,0,0,0.3);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: rgba(255,255,255,0.2);
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 10px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #3498db, #2ecc71);
            border-radius: 4px;
            transition: width 0.3s ease;
            width: 0%;
        }

        .category-indicator {
            font-size: 1.1rem;
            margin-bottom: 5px;
            color: #ecf0f1;
        }

        .speed-control {
            margin-top: 20px;
        }

        .speed-control label {
            display: block;
            margin-bottom: 10px;
            font-size: 1rem;
        }

        .speed-slider {
            width: 200px;
            height: 6px;
            background: rgba(255,255,255,0.2);
            border-radius: 3px;
            outline: none;
            -webkit-appearance: none;
            appearance: none;
        }

        .speed-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            background: #3498db;
            border-radius: 50%;
            cursor: pointer;
        }

        .speed-slider::-moz-range-thumb {
            width: 20px;
            height: 20px;
            background: #3498db;
            border-radius: 50%;
            cursor: pointer;
            border: none;
        }

        /* ç§»åŠ¨ç«¯ä¼˜åŒ– */
        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }

            .header h1 {
                font-size: 1.5rem;
            }

            .main-display {
                padding: 40px 20px;
                min-height: 250px;
            }

            .phonetic-symbol {
                font-size: 6rem;
            }

            .phonetic-info {
                font-size: 1.2rem;
            }

            .progress-info {
                font-size: 1rem;
            }

            .repeat-counter {
                font-size: 1.5rem;
            }

            .controls {
                gap: 15px;
            }

            .control-btn {
                padding: 12px 20px;
                font-size: 1rem;
                min-width: 100px;
            }
        }

        @media (max-width: 480px) {
            .phonetic-symbol {
                font-size: 5rem;
            }

            .main-display {
                padding: 30px 15px;
            }

            .control-btn {
                padding: 10px 15px;
                font-size: 0.9rem;
                min-width: 80px;
            }

            .speed-slider {
                width: 150px;
            }
        }

        /* æ¨ªå±æ¨¡å¼ä¼˜åŒ– */
        @media (orientation: landscape) and (max-height: 500px) {
            .header {
                margin-bottom: 15px;
            }

            .header h1 {
                font-size: 1.3rem;
            }

            .main-display {
                padding: 30px 20px;
                min-height: 200px;
            }

            .phonetic-symbol {
                font-size: 4rem;
            }

            .controls {
                margin-bottom: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸš— è‹±è¯­éŸ³æ ‡è‡ªåŠ¨å­¦ä¹ </h1>
            <p>å¼€è½¦ä¸“ç”¨ç‰ˆ â€¢ è‡ªåŠ¨æ’­æ”¾ â€¢ å¤§å­—ä½“æ˜¾ç¤º</p>
        </div>

        <div class="status-bar">
            <div class="category-indicator" id="categoryIndicator">è‡ªåŠ¨æ’­æ”¾æ¨¡å¼</div>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            <div class="progress-info" id="progressInfo">é¡µé¢åŠ è½½å®Œæˆåè‡ªåŠ¨å¼€å§‹æ’­æ”¾</div>
        </div>

        <div class="main-display">
            <div class="phonetic-symbol" id="phoneticSymbol">ğŸµ</div>
            <div class="phonetic-info" id="phoneticInfo">å³å°†è‡ªåŠ¨å¼€å§‹å­¦ä¹  ...</div>
            <div class="repeat-counter" id="repeatCounter">å‡†å¤‡ä¸­</div>
        </div>

        <div class="controls">
            <button class="control-btn" id="startBtn" onclick="startAutoPlay()">â–¶ï¸ å¼€å§‹</button>
            <button class="control-btn" id="pauseBtn" onclick="pauseAutoPlay()">â¸ï¸ æš‚åœ</button>
            <button class="control-btn" id="stopBtn" onclick="stopAutoPlay()">â¹ï¸ åœæ­¢</button>
            <button class="control-btn" id="nextBtn" onclick="nextPhonetic()">â­ï¸ ä¸‹ä¸€ä¸ª</button>
            <button class="control-btn" id="resetBtn" onclick="resetProgress()">ğŸ”„ é‡ç½®</button>
        </div>

        <div class="speed-control">
            <label for="speedSlider">æ’­æ”¾é€Ÿåº¦ : <span id="speedValue">æ­£å¸¸</span></label>
            <input type="range" id="speedSlider" class="speed-slider" min="0.5" max="2" step="0.1" value="1" onchange="updateSpeed()">
        </div>
    </div>

    <script>
        // éŸ³æ ‡æ•°æ®
        const phoneticData = [
            // é•¿å…ƒéŸ³
            { symbol: 'iË', example: 'see', category: ' é•¿å…ƒéŸ³ ', type: 'vowel' },
            { symbol: 'ÉœË', example: 'bird', category: ' é•¿å…ƒéŸ³ ', type: 'vowel' },
            { symbol: 'É‘Ë', example: 'car', category: ' é•¿å…ƒéŸ³ ', type: 'vowel' },
            { symbol: 'É”Ë', example: 'door', category: ' é•¿å…ƒéŸ³ ', type: 'vowel' },
            { symbol: 'uË', example: 'food', category: ' é•¿å…ƒéŸ³ ', type: 'vowel' },

            // çŸ­å…ƒéŸ³
            { symbol: 'Éª', example: 'sit', category: ' çŸ­å…ƒéŸ³ ', type: 'vowel' },
            { symbol: 'e', example: 'bed', category: ' çŸ­å…ƒéŸ³ ', type: 'vowel' },
            { symbol: 'Ã¦', example: 'cat', category: ' çŸ­å…ƒéŸ³ ', type: 'vowel' },
            { symbol: 'É™', example: 'about', category: ' çŸ­å…ƒéŸ³ ', type: 'vowel' },
            { symbol: 'ÊŒ', example: 'cup', category: ' çŸ­å…ƒéŸ³ ', type: 'vowel' },
            { symbol: 'É’', example: 'hot', category: ' çŸ­å…ƒéŸ³ ', type: 'vowel' },
            { symbol: 'ÊŠ', example: 'book', category: ' çŸ­å…ƒéŸ³ ', type: 'vowel' },

            // åŒå…ƒéŸ³
            { symbol: 'eÉª', example: 'day', category: ' åŒå…ƒéŸ³ ', type: 'vowel' },
            { symbol: 'aÉª', example: 'my', category: ' åŒå…ƒéŸ³ ', type: 'vowel' },
            { symbol: 'É”Éª', example: 'boy', category: ' åŒå…ƒéŸ³ ', type: 'vowel' },
            { symbol: 'É™ÊŠ', example: 'go', category: ' åŒå…ƒéŸ³ ', type: 'vowel' },
            { symbol: 'aÊŠ', example: 'now', category: ' åŒå…ƒéŸ³ ', type: 'vowel' },
            { symbol: 'ÉªÉ™', example: 'ear', category: ' åŒå…ƒéŸ³ ', type: 'vowel' },
            { symbol: 'eÉ™', example: 'air', category: ' åŒå…ƒéŸ³ ', type: 'vowel' },
            { symbol: 'ÊŠÉ™', example: 'tour', category: ' åŒå…ƒéŸ³ ', type: 'vowel' },

            // æ¸…è¾…éŸ³
            { symbol: 'p', example: 'pen', category: ' æ¸…è¾…éŸ³ ', type: 'consonant' },
            { symbol: 't', example: 'tea', category: ' æ¸…è¾…éŸ³ ', type: 'consonant' },
            { symbol: 'k', example: 'key', category: ' æ¸…è¾…éŸ³ ', type: 'consonant' },
            { symbol: 'f', example: 'fish', category: ' æ¸…è¾…éŸ³ ', type: 'consonant' },
            { symbol: 'Î¸', example: 'think', category: ' æ¸…è¾…éŸ³ ', type: 'consonant' },
            { symbol: 's', example: 'sun', category: ' æ¸…è¾…éŸ³ ', type: 'consonant' },
            { symbol: 'âˆ«', example: 'ship', category: ' æ¸…è¾…éŸ³ ', type: 'consonant' },
            { symbol: 'h', example: 'hat', category: ' æ¸…è¾…éŸ³ ', type: 'consonant' },
            { symbol: 'tâˆ«', example: 'chair', category: ' æ¸…è¾…éŸ³ ', type: 'consonant' },
            { symbol: 'ts', example: 'cats', category: ' æ¸…è¾…éŸ³ ', type: 'consonant' },
            { symbol: 'tr', example: 'tree', category: ' æ¸…è¾…éŸ³ ', type: 'consonant' },

            // æµŠè¾…éŸ³
            { symbol: 'b', example: 'book', category: ' æµŠè¾…éŸ³ ', type: 'consonant' },
            { symbol: 'd', example: 'dog', category: ' æµŠè¾…éŸ³ ', type: 'consonant' },
            { symbol: 'g', example: 'go', category: ' æµŠè¾…éŸ³ ', type: 'consonant' },
            { symbol: 'v', example: 'very', category: ' æµŠè¾…éŸ³ ', type: 'consonant' },
            { symbol: 'Ã°', example: 'this', category: ' æµŠè¾…éŸ³ ', type: 'consonant' },
            { symbol: 'z', example: 'zoo', category: ' æµŠè¾…éŸ³ ', type: 'consonant' },
            { symbol: 'Ê’', example: 'vision', category: ' æµŠè¾…éŸ³ ', type: 'consonant' },
            { symbol: 'r', example: 'red', category: ' æµŠè¾…éŸ³ ', type: 'consonant' },
            { symbol: 'dÊ’', example: 'jump', category: ' æµŠè¾…éŸ³ ', type: 'consonant' },
            { symbol: 'dz', example: 'beds', category: ' æµŠè¾…éŸ³ ', type: 'consonant' },
            { symbol: 'dr', example: 'dream', category: ' æµŠè¾…éŸ³ ', type: 'consonant' },
            { symbol: 'm', example: 'man', category: ' æµŠè¾…éŸ³ ', type: 'consonant' },
            { symbol: 'n', example: 'no', category: ' æµŠè¾…éŸ³ ', type: 'consonant' },
            { symbol: 'Å‹', example: 'sing', category: ' æµŠè¾…éŸ³ ', type: 'consonant' },
            { symbol: 'l', example: 'love', category: ' æµŠè¾…éŸ³ ', type: 'consonant' },
            { symbol: 'j', example: 'yes', category: ' æµŠè¾…éŸ³ ', type: 'consonant' },
            { symbol: 'w', example: 'water', category: ' æµŠè¾…éŸ³ ', type: 'consonant' },

            // å­—æ¯å‘éŸ³
            { symbol: 'ks', example: ' å­—æ¯ X', category: ' å­—æ¯å‘éŸ³ ', type: 'letter' }
        ];

        // å…¨å±€å˜é‡
        let currentIndex = 0;
        let currentRepeat = 0;
        let isPlaying = false;
        let isPaused = false;
        let playSpeed = 1;
        let autoPlayTimer = null;
        let audioQueue = [];
        let currentAudio = null;
        let hasRestoredProgress = false;

        // DOM å…ƒç´ 
        const phoneticSymbol = document.getElementById('phoneticSymbol');
        const phoneticInfo = document.getElementById('phoneticInfo');
        const repeatCounter = document.getElementById('repeatCounter');
        const progressInfo = document.getElementById('progressInfo');
        const progressFill = document.getElementById('progressFill');
        const categoryIndicator = document.getElementById('categoryIndicator');
        const startBtn = document.getElementById('startBtn');
        const pauseBtn = document.getElementById('pauseBtn');
        const stopBtn = document.getElementById('stopBtn');
        const nextBtn = document.getElementById('nextBtn');

        // æœ¬åœ°å­˜å‚¨é”®å
        const STORAGE_KEY = 'phonetic_learning_progress';

        

        // ä¿å­˜å­¦ä¹ è¿›åº¦åˆ°æœ¬åœ°å­˜å‚¨
        function saveProgress() {
            const progress = {
                currentIndex: currentIndex,
                currentRepeat: currentRepeat,
                timestamp: new Date().toISOString(),
                totalPhonetics: phoneticData.length
            };
            localStorage.setItem(STORAGE_KEY, JSON.stringify(progress));
            console.log('è¿›åº¦å·²ä¿å­˜:', progress);
        }

        // ä»æœ¬åœ°å­˜å‚¨åŠ è½½å­¦ä¹ è¿›åº¦
        function loadProgress() {
            try {
                const saved = localStorage.getItem(STORAGE_KEY);
                if (saved) {
                    const progress = JSON.parse(saved);
                    // éªŒè¯æ•°æ®æœ‰æ•ˆæ€§
                    if (progress.currentIndex >= 0 && progress.currentIndex < phoneticData.length &&
                        progress.currentRepeat >= 0 && progress.currentRepeat < 4) {
                        currentIndex = progress.currentIndex;
                        currentRepeat = progress.currentRepeat;
                        hasRestoredProgress = true;
                        console.log('è¿›åº¦å·²æ¢å¤:', progress);
                        return true;
                    }
                }
            } catch (error) {
                console.log('åŠ è½½è¿›åº¦å¤±è´¥:', error);
            }
            return false;
        }

        // æ¸…é™¤ä¿å­˜çš„è¿›åº¦
        function clearProgress() {
            localStorage.removeItem(STORAGE_KEY);
            console.log('è¿›åº¦å·²æ¸…é™¤');
        }

        // æ›´æ–°æ˜¾ç¤º
        function updateDisplay() {
            const current = phoneticData[currentIndex];
            phoneticSymbol.textContent = current.symbol;
            phoneticInfo.textContent = `${current.example} (${current.category})`;
            repeatCounter.textContent = `${currentRepeat + 1}/4`;

            const totalProgress = ((currentIndex * 4 + currentRepeat) / (phoneticData.length * 4)) * 100;
            progressFill.style.width = totalProgress + '%';

            const resumeText = hasRestoredProgress ? ' (ä»ä¸Šæ¬¡æ–­ç‚¹ç»§ç»­)' : '';
            progressInfo.textContent = `ç¬¬ ${currentIndex + 1}/${phoneticData.length} ä¸ªéŸ³æ ‡ â€¢ ç¬¬ ${currentRepeat + 1}/4 é${resumeText}`;
            categoryIndicator.textContent = `${current.category} â€¢ ${current.type === 'vowel' ? 'å…ƒéŸ³' : current.type === 'consonant' ? 'è¾…éŸ³' : 'å­—æ¯'}`;
        }

        // æ’­æ”¾éŸ³é¢‘
        function playCurrentPhonetic() {
            if (!isPlaying || isPaused) return;

            const current = phoneticData[currentIndex];
            
            // ä½¿ç”¨æ–°çš„éŸ³æ ‡æ’­æ”¾å™¨
            if (window.phoneticPlayer) {
                window.phoneticPlayer.playPhonetic(current.symbol, current.symbol, () => {
                    // æ’­æ”¾å®Œæˆåçš„å›è°ƒ
                    if (!isPlaying || isPaused) return;
                    
                    currentRepeat++;
                    if (currentRepeat >= 4) {
                        nextPhonetic();
                    } else {
                        // 0.3ç§’é—´éš”åæ’­æ”¾ä¸‹ä¸€é
                        setTimeout(() => {
                            if (!isPlaying || isPaused) return;
                            playCurrentPhonetic();
                        }, 300);
                    }
                });
                return;
            }

            // å¤‡ç”¨æ’­æ”¾æ–¹å¼ï¼ˆå¦‚æœ phoneticPlayer ä¸å¯ç”¨ï¼‰
            console.warn('phoneticPlayer ä¸å¯ç”¨ï¼Œè¯·ç¡®ä¿ phonetic-player.js å·²æ­£ç¡®åŠ è½½');
        }

        // å¼€å§‹è‡ªåŠ¨æ’­æ”¾
        function startAutoPlay() {
            if (isPaused) {
                isPaused = false;
                startBtn.textContent = 'â–¶ï¸ å¼€å§‹ ';
                pauseBtn.classList.add('active');
                startBtn.classList.remove('active');
                playCurrentPhonetic();
                return;
            }

            isPlaying = true;
            isPaused = false;
            
            // å¦‚æœä¸æ˜¯ä»æš‚åœæ¢å¤ï¼Œå°è¯•åŠ è½½ä¿å­˜çš„è¿›åº¦
            if (!hasRestoredProgress) {
                const progressLoaded = loadProgress();
                if (!progressLoaded) {
                    currentIndex = 0;
                    currentRepeat = 0;
                }
            }

            startBtn.classList.add('active');
            pauseBtn.classList.remove('active');

            updateDisplay();
            playCurrentPhonetic();
        }

        // æš‚åœæ’­æ”¾
        function pauseAutoPlay() {
            if (!isPlaying) return;

            isPaused = !isPaused;

            if (isPaused) {
                pauseBtn.classList.add('active');
                startBtn.classList.remove('active');
                startBtn.textContent = 'â–¶ï¸ ç»§ç»­ ';

                // åœæ­¢éŸ³æ ‡æ’­æ”¾å™¨
                if (window.phoneticPlayer) {
                    window.phoneticPlayer.stopAllAudio();
                }
                
                if (currentAudio) {
                    currentAudio.pause();
                }
                
                // æš‚åœæ—¶ä¿å­˜è¿›åº¦
                saveProgress();
            } else {
                pauseBtn.classList.remove('active');
                startBtn.classList.add('active');
                startBtn.textContent = 'â–¶ï¸ å¼€å§‹ ';
                playCurrentPhonetic();
            }
        }

        // åœæ­¢æ’­æ”¾
        function stopAutoPlay() {
            // åœæ­¢å‰ä¿å­˜å½“å‰è¿›åº¦
            if (isPlaying) {
                saveProgress();
            }
            
            isPlaying = false;
            isPaused = false;

            // åœæ­¢éŸ³æ ‡æ’­æ”¾å™¨
            if (window.phoneticPlayer) {
                window.phoneticPlayer.stopAllAudio();
            }

            if (currentAudio) {
                currentAudio.pause();
                currentAudio = null;
            }

            startBtn.classList.remove('active');
            pauseBtn.classList.remove('active');
            startBtn.textContent = 'â–¶ï¸ å¼€å§‹ ';

            phoneticSymbol.textContent = 'ğŸµ';
            phoneticInfo.textContent = ' è‡ªåŠ¨æ’­æ”¾å·²åœæ­¢ ';
            repeatCounter.textContent = ' å·²åœæ­¢ ';
            progressInfo.textContent = ' ç‚¹å‡»å¼€å§‹æŒ‰é’®ä»ä¸Šæ¬¡æ–­ç‚¹ç»§ç»­æ’­æ”¾ ';
            progressFill.style.width = '0%';
            categoryIndicator.textContent = ' æ’­æ”¾å·²åœæ­¢ ';
        }

        // ä¸‹ä¸€ä¸ªéŸ³æ ‡
        function nextPhonetic() {
            if (!isPlaying) return;

            // åœæ­¢å½“å‰æ’­æ”¾
            if (window.phoneticPlayer) {
                window.phoneticPlayer.stopAllAudio();
            }

            if (currentAudio) {
                currentAudio.pause();
            }

            currentRepeat = 0;
            currentIndex++;

            if (currentIndex >= phoneticData.length) {
                // æ‰€æœ‰éŸ³æ ‡æ’­æ”¾å®Œæˆ
                clearProgress(); // å®Œæˆåæ¸…é™¤è¿›åº¦
                stopAutoPlay();
                showCompletionMessage();
                return;
            }

            // ä¿å­˜å½“å‰è¿›åº¦
            saveProgress();
            updateDisplay();
            
            if (!isPaused) {
                // 0.3ç§’é—´éš”åæ’­æ”¾ä¸‹ä¸€ä¸ªéŸ³æ ‡
                setTimeout(() => {
                    if (!isPlaying || isPaused) return;
                    playCurrentPhonetic();
                }, 300);
            }
        }

        // é‡ç½®è¿›åº¦
        function resetProgress() {
            // åœæ­¢å½“å‰æ’­æ”¾
            if (isPlaying) {
                stopAutoPlay();
            }
            
            // æ¸…é™¤ä¿å­˜çš„è¿›åº¦
            clearProgress();
            
            // é‡ç½®æ‰€æœ‰çŠ¶æ€
            currentIndex = 0;
            currentRepeat = 0;
            hasRestoredProgress = false;
            
            // æ›´æ–°æ˜¾ç¤º
            phoneticSymbol.textContent = 'ğŸµ';
            phoneticInfo.textContent = ' è¿›åº¦å·²é‡ç½®ï¼Œå°†ä»ç¬¬ä¸€ä¸ªéŸ³æ ‡å¼€å§‹ ';
            repeatCounter.textContent = ' å·²é‡ç½® ';
            progressInfo.textContent = ' ç‚¹å‡»å¼€å§‹æŒ‰é’®ä»å¤´å¼€å§‹æ’­æ”¾ ';
            progressFill.style.width = '0%';
            categoryIndicator.textContent = ' è¿›åº¦å·²é‡ç½® ';
            
            console.log('å­¦ä¹ è¿›åº¦å·²é‡ç½®');
        }

        // æ›´æ–°æ’­æ”¾é€Ÿåº¦
        function updateSpeed() {
            const slider = document.getElementById('speedSlider');
            const speedValue = document.getElementById('speedValue');

            playSpeed = parseFloat(slider.value);

            const speedText = {
                0.5: ' å¾ˆæ…¢ ',
                0.6: ' æ…¢ ',
                0.7: ' è¾ƒæ…¢ ',
                0.8: ' ç¨æ…¢ ',
                0.9: ' ç•¥æ…¢ ',
                1.0: ' æ­£å¸¸ ',
                1.1: ' ç•¥å¿« ',
                1.2: ' ç¨å¿« ',
                1.3: ' è¾ƒå¿« ',
                1.4: ' å¿« ',
                1.5: ' å¾ˆå¿« ',
                1.6: ' è¶…å¿« ',
                1.7: ' æå¿« ',
                1.8: ' é£å¿« ',
                1.9: ' é—ªç”µ ',
                2.0: ' å…‰é€Ÿ '
            };

            speedValue.textContent = speedText[playSpeed.toFixed(1)] || `${playSpeed.toFixed(1)}x`;

            if (currentAudio) {
                currentAudio.playbackRate = playSpeed;
            }
        }

        // æ˜¾ç¤ºå®Œæˆæ¶ˆæ¯
        function showCompletionMessage() {
            phoneticSymbol.textContent = 'ğŸ‰';
            phoneticInfo.textContent = ' æ­å–œï¼æ‰€æœ‰éŸ³æ ‡å­¦ä¹ å®Œæˆ ';
            repeatCounter.textContent = ' å®Œæˆ ';
            progressInfo.textContent = ' æ‰€æœ‰ 48 ä¸ªéŸ³æ ‡å·²å­¦ä¹ å®Œæˆï¼Œæ¯ä¸ªé‡å¤ 4 é ';
            categoryIndicator.textContent = ' å­¦ä¹ å®Œæˆ â€¢ å¯ä»¥é‡æ–°å¼€å§‹ ';
        }

        // é”®ç›˜å¿«æ·é”®
        document.addEventListener('keydown', function(event) {
            switch(event.code) {
                case 'Space':
                    event.preventDefault();
                    if (isPlaying && !isPaused) {
                        pauseAutoPlay();
                    } else {
                        startAutoPlay();
                    }
                    break;
                case 'Escape':
                    stopAutoPlay();
                    break;
                case 'ArrowRight':
                    nextPhonetic();
                    break;
                case 'KeyR':
                    if (event.ctrlKey || event.metaKey) {
                        event.preventDefault();
                        resetProgress();
                    }
                    break;
            }
        });

        // é˜²æ­¢å±å¹•ä¼‘çœ ï¼ˆå°è¯•ä¿æŒæ´»è·ƒçŠ¶æ€ï¼‰
        let wakeLock = null;

        async function requestWakeLock() {
            try {
                if ('wakeLock' in navigator) {
                    wakeLock = await navigator.wakeLock.request('screen');
                    console.log(' å±å¹•ä¿æŒå”¤é†’ ');
                }
            } catch (err) {
                console.log(' æ— æ³•ä¿æŒå±å¹•å”¤é†’ :', err);
            }
        }

        // é¡µé¢å¯è§æ€§å˜åŒ–å¤„ç†
        document.addEventListener('visibilitychange', () => {
            if (document.visibilityState === 'hidden') {
                // é¡µé¢å¤±å»ç„¦ç‚¹ï¼Œåœæ­¢æ’­æ”¾
                stopAutoPlay();
            } else if (document.visibilityState === 'visible') {
                // é¡µé¢è·å¾—ç„¦ç‚¹ï¼Œè‡ªåŠ¨å¼€å§‹æ’­æ”¾å’Œè¯·æ±‚å”¤é†’é”
                if (!isPlaying) {
                    setTimeout(() => {
                        startAutoPlay();
                    }, 500); // å»¶è¿Ÿ 500ms å¼€å§‹æ’­æ”¾
                }
                if (wakeLock !== null) {
                    requestWakeLock();
                }
            }
        });

        // é¡µé¢å¸è½½æ—¶åœæ­¢æ’­æ”¾
        window.addEventListener('beforeunload', () => {
            stopAutoPlay();
        });

        // çª—å£å¤±å»ç„¦ç‚¹æ—¶åœæ­¢æ’­æ”¾
        window.addEventListener('blur', () => {
            stopAutoPlay();
        });

        // çª—å£è·å¾—ç„¦ç‚¹æ—¶å¼€å§‹æ’­æ”¾
        window.addEventListener('focus', () => {
            if (!isPlaying && document.visibilityState === 'visible') {
                setTimeout(() => {
                    startAutoPlay();
                }, 300);
            }
        });

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            updateSpeed();
            requestWakeLock();
            
            // å°è¯•åŠ è½½ä¿å­˜çš„è¿›åº¦
            const progressLoaded = loadProgress();
            if (progressLoaded) {
                updateDisplay();
                phoneticInfo.textContent = ' æ£€æµ‹åˆ°ä¸Šæ¬¡å­¦ä¹ è¿›åº¦ï¼Œç‚¹å‡»å¼€å§‹ç»§ç»­å­¦ä¹  ';
                progressInfo.textContent = ' å°†ä»ä¸Šæ¬¡æ–­ç‚¹ç»§ç»­æ’­æ”¾ ';
                categoryIndicator.textContent = ' å·²æ¢å¤ä¸Šæ¬¡è¿›åº¦ ';
            }

            // é¡µé¢åŠ è½½å®Œæˆåè‡ªåŠ¨å¼€å§‹æ’­æ”¾
            setTimeout(() => {
                startAutoPlay();
            }, 1000); // å»¶è¿Ÿ 1 ç§’å¼€å§‹æ’­æ”¾ï¼Œç¡®ä¿é¡µé¢å®Œå…¨åŠ è½½
        });
    </script>
    <!-- å¼•å…¥ä¼˜åŒ–åçš„éŸ³æ ‡æ’­æ”¾å™¨ -->
    <script src="./phonetic-player.js"></script>
</body>
</html>
