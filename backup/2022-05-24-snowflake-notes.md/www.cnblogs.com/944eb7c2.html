<html lang="zh-cn" style="--olcb-folder-code-block-max-height:80vh;"><head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="referrer" content="origin-when-cross-origin">
    <meta name="description" content="Shellcode 定义 是一段可注入的指令（opcode），可以在被攻击的程序内运行。 特点 短小精悍，灵活多变，独立存在，无需任何文件格式的包装，因为shellcode直接操作寄存器和函数，所以o">
    <meta property="og:description" content="Shellcode 定义 是一段可注入的指令（opcode），可以在被攻击的程序内运行。 特点 短小精悍，灵活多变，独立存在，无需任何文件格式的包装，因为shellcode直接操作寄存器和函数，所以o">
    <meta http-equiv="Cache-Control" content="no-transform">
    <meta http-equiv="Cache-Control" content="no-siteapp">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Window中的shellcode编写框架（入门篇） - Thresh｜ - 博客园</title>
    <link id="favicon" rel="shortcut icon" href="//common.cnblogs.com/favicon.svg" type="image/svg+xml">
    
    <style>#home :not(.cnblogs_code):not(.cnblogs_Highlighter)>pre:not([highlighted]):not([class*="brush:"]) code:not(.hljs), :not(.cnblogs_code):not(.cnblogs_Highlighter)>pre:not([highlighted]):not([class*="brush:"]) code:not(.hljs) {background: rgb(245, 245, 245);
        padding: 12px;
        border: 1px solid rgb(204, 204, 204);
        border-radius: 3px;
        border-color: transparent;
        color: rgb(68, 68, 68);
        font-family: "Courier New", sans-serif;
        font-size: 12px</style><link rel="stylesheet" href="/css/blog-common.min.css?v=x0sCXgfRZH24nF9pqBIDTBIzbO5BqnCcmdVV58d1xnI">
    
        <link id="highlighter-theme-cnblogs" type="text/css" rel="stylesheet" href="/css/hljs/cnblogs.css?v=5J1NDtbnnIr2Rc2SdhEMlMxD4l9Eydj88B31E7_NhS4">
    <link type="text/css" rel="stylesheet" href="https://www.cnblogs.com/thresh/custom.css?v=+yTP7hhpxATMV5qSKYMeiky4GS0=">
    <link id="mobile-style" media="only screen and (max-width: 767px)" type="text/css" rel="stylesheet" href="/skins/SimpleMemory/bundle-simplememory-mobile-pure.min.css?v=u5eXNRVe5tkW_ELT0Hzi-kKbey06zaqLqiANlcMEPvw">
    
    <link type="application/rss+xml" rel="alternate" href="https://www.cnblogs.com/thresh/rss">
    <link type="application/rsd+xml" rel="EditURI" href="https://www.cnblogs.com/thresh/rsd.xml">
    <link type="application/wlwmanifest+xml" rel="wlwmanifest" href="https://www.cnblogs.com/thresh/wlwmanifest.xml">
    <script type="text/javascript" async="" src="https://www.google-analytics.com/analytics.js"></script><script type="text/javascript" src="https://common.cnblogs.com/script/encoder.js"></script><script>
        var currentBlogId = 522523;
        var currentBlogApp = 'thresh';
        var isLogined = false;
        var isBlogOwner = false;
        var skinName = 'SimpleMemory';
        var visitorUserId = '';
        var hasCustomScript = true;
        try {
            if (hasCustomScript && document.referrer && document.referrer.indexOf('baidu.com') >= 0) {
                Object.defineProperty(document, 'referrer', { value: '' });
                Object.defineProperty(Document.prototype, 'referrer', { get: function(){ return ''; } });
            }
        } catch(error) { }
        window.cb_enable_mathjax = false;
        window.mathEngine = 0;
        window.codeHighlightEngine = 1;
        window.enableCodeLineNumber = false;
        window.codeHighlightTheme = 'cnblogs';
        window.darkModeCodeHighlightTheme = 'vs2015';
        window.isDarkCodeHighlightTheme = false;
        window.isDarkModeCodeHighlightThemeDark = true;
        window.isDisableCodeHighlighter = false;
        window.enableCodeThemeTypeFollowSystem = false;
    </script>
        <script>
            var currentPostDateAdded = '2020-03-31 23:41';
        </script>
    <script src="https://common.cnblogs.com/scripts/jquery-2.2.0.min.js"></script>
    <script src="/js/blog-common.min.js?v=CJqpEcB2VzA38UjNF1IXe3fHW_bnz9JDDOND4We0ej8"></script><style>.medium-zoom-overlay {
  position: fixed;
  top: 0;
  right: 0;
  bottom: 0;
  left: 0;
  opacity: 0;
  transition: opacity 300ms;
  will-change: opacity;
}

.medium-zoom--opened .medium-zoom-overlay {
  cursor: pointer;
  cursor: zoom-out;
  opacity: 1;
}

.medium-zoom-image {
  cursor: pointer;
  cursor: zoom-in;
  /*
    The `transition` is marked as "!important" for the animation to happen
    even though it's overriden by another inline `transition` style attribute.

    This is problematic with frameworks that generate inline styles on their
    images (e.g. Gatsby).

    See https://github.com/francoischalifour/medium-zoom/issues/110
   */
  transition: transform 300ms cubic-bezier(0.2, 0, 0.2, 1) !important;
}

.medium-zoom-image--hidden {
  visibility: hidden;
}

.medium-zoom-image--opened {
  position: relative;
  cursor: pointer;
  cursor: zoom-out;
  will-change: transform;
}
</style><script id="hljs-script" src="https://common.cnblogs.com/highlight/11.4.0/highlight.min.js" type="text/javascript" async=""></script>
    
<meta http-equiv="origin-trial" content="AzoawhTRDevLR66Y6MROu167EDncFPBvcKOaQispTo9ouEt5LvcBjnRFqiAByRT+2cDHG1Yj4dXwpLeIhc98/gIAAACFeyJvcmlnaW4iOiJodHRwczovL2RvdWJsZWNsaWNrLm5ldDo0NDMiLCJmZWF0dXJlIjoiUHJpdmFjeVNhbmRib3hBZHNBUElzIiwiZXhwaXJ5IjoxNjYxMjk5MTk5LCJpc1N1YmRvbWFpbiI6dHJ1ZSwiaXNUaGlyZFBhcnR5Ijp0cnVlfQ=="><meta http-equiv="origin-trial" content="A6+nc62kbJgC46ypOwRsNW6RkDn2x7tgRh0wp7jb3DtFF7oEhu1hhm4rdZHZ6zXvnKZLlYcBlQUImC4d3kKihAcAAACLeyJvcmlnaW4iOiJodHRwczovL2dvb2dsZXN5bmRpY2F0aW9uLmNvbTo0NDMiLCJmZWF0dXJlIjoiUHJpdmFjeVNhbmRib3hBZHNBUElzIiwiZXhwaXJ5IjoxNjYxMjk5MTk5LCJpc1N1YmRvbWFpbiI6dHJ1ZSwiaXNUaGlyZFBhcnR5Ijp0cnVlfQ=="><meta http-equiv="origin-trial" content="A/9La288e7MDEU2ifusFnMg1C2Ij6uoa/Z/ylwJIXSsWfK37oESIPbxbt4IU86OGqDEPnNVruUiMjfKo65H/CQwAAACLeyJvcmlnaW4iOiJodHRwczovL2dvb2dsZXRhZ3NlcnZpY2VzLmNvbTo0NDMiLCJmZWF0dXJlIjoiUHJpdmFjeVNhbmRib3hBZHNBUElzIiwiZXhwaXJ5IjoxNjYxMjk5MTk5LCJpc1N1YmRvbWFpbiI6dHJ1ZSwiaXNUaGlyZFBhcnR5Ijp0cnVlfQ=="><script src="https://securepubads.g.doubleclick.net/gpt/pubads_impl_2022080201.js" async=""></script><link rel="preload" href="https://adservice.google.com/adsid/integrator.js?domain=www.cnblogs.com" as="script"><script type="text/javascript" src="https://adservice.google.com/adsid/integrator.js?domain=www.cnblogs.com"></script><script src="https://cdn.jsdelivr.net/gh/BNDong/Cnblogs-Theme-SimpleMemory@master/src/script/jquery.mousewheel.min.js"></script><script type="text/javascript" charset="utf-8" async="" data-requirecontext="_" data-requiremodule="snapSvg" src="https://cdn.jsdelivr.net/gh/BNDong/Cnblogs-Theme-SimpleMemory@v1.3.0/src/script/snap.svg-min.js"></script><script type="text/javascript" charset="utf-8" async="" data-requirecontext="_" data-requiremodule="tools" src="https://cdn.jsdelivr.net/gh/BNDong/Cnblogs-Theme-SimpleMemory@v1.3.0/src/script/tools.min.js"></script><script type="text/javascript" charset="utf-8" async="" data-requirecontext="_" data-requiremodule="src/script/css.min" src="https://cdn.jsdelivr.net/gh/BNDong/Cnblogs-Theme-SimpleMemory@v1.3.0/src/script/css.min.js"></script><link type="text/css" rel="stylesheet" href="https://cdn.jsdelivr.net/gh/BNDong/Cnblogs-Theme-SimpleMemory@v1.3.0/src/style/optiscroll.min.css"><link type="text/css" rel="stylesheet" href="https://cdn.jsdelivr.net/gh/BNDong/Cnblogs-Theme-SimpleMemory@v1.3.0/src/style/menu_bubble.min.css"><script type="text/javascript" charset="utf-8" async="" data-requirecontext="_" data-requiremodule="classie" src="https://cdn.jsdelivr.net/gh/BNDong/Cnblogs-Theme-SimpleMemory@v1.3.0/src/script/classie.min.js"></script><script type="text/javascript" charset="utf-8" async="" data-requirecontext="_" data-requiremodule="optiscroll_ToProgress_rotate" src="https://cdn.jsdelivr.net/gh/BNDong/Cnblogs-Theme-SimpleMemory@v1.3.0/src/script/optiscroll_ToProgress_rotate.min.js"></script><script type="text/javascript" charset="utf-8" async="" data-requirecontext="_" data-requiremodule="main4" src="https://cdn.jsdelivr.net/gh/BNDong/Cnblogs-Theme-SimpleMemory@v1.3.0/src/script/main4.min.js"></script><link type="text/css" rel="stylesheet" href="//at.alicdn.com/t/font_543384_ib4j0dbdod.css"><link type="text/css" rel="stylesheet" href="https://cdn.jsdelivr.net/gh/BNDong/Cnblogs-Theme-SimpleMemory@v1.3.0/src/style/google-fonts.min.css"><script type="text/javascript" charset="utf-8" async="" data-requirecontext="_" data-requiremodule="base" src="https://cdn.jsdelivr.net/gh/BNDong/Cnblogs-Theme-SimpleMemory@v1.3.0/src/script/base.min.js"></script><link href="https://cdn.jsdelivr.net/gh/BNDong/Cnblogs-Theme-SimpleMemory@v1.3.0/src/style/jquery.mCustomScrollbar.min.css" rel="stylesheet" type="text/css"><link rel="shortcut icon" href="https://pic.cnblogs.com/avatar/1721319/20200322004208.png"><script type="text/javascript" charset="utf-8" async="" data-requirecontext="_" data-requiremodule="TweenMax_MyTween" src="https://cdn.jsdelivr.net/gh/BNDong/Cnblogs-Theme-SimpleMemory@v1.3.0/src/script/TweenMax_MyTween.min.js"></script><script type="text/javascript" charset="utf-8" async="" data-requirecontext="_" data-requiremodule="clipboard" src="https://cdn.jsdelivr.net/gh/BNDong/Cnblogs-Theme-SimpleMemory@v1.3.0/src/script/clipboard.min.js"></script><script type="text/javascript" charset="utf-8" async="" data-requirecontext="_" data-requiremodule="articleStatement" src="https://cdn.jsdelivr.net/gh/BNDong/Cnblogs-Theme-SimpleMemory@v1.3.0/src/script/articleStatement.min.js"></script><script type="text/javascript" charset="utf-8" async="" data-requirecontext="_" data-requiremodule="RibbonsEffect" src="https://cdn.jsdelivr.net/gh/BNDong/Cnblogs-Theme-SimpleMemory@v1.3.0/src/script/RibbonsEffect.min.js"></script><link type="text/css" rel="stylesheet" href="https://cdn.jsdelivr.net/gh/BNDong/Cnblogs-Theme-SimpleMemory@v1.3.0/src/style/jquery.fancybox.min.css"><script type="text/javascript" charset="utf-8" async="" data-requirecontext="_" data-requiremodule="title" src="https://cdn.jsdelivr.net/gh/BNDong/Cnblogs-Theme-SimpleMemory@v1.3.0/src/script/articleTitle.min.js"></script><script type="text/javascript" charset="utf-8" async="" data-requirecontext="_" data-requiremodule="bootstrap" src="https://cdn.jsdelivr.net/gh/BNDong/Cnblogs-Theme-SimpleMemory@v1.3.0/src/script/bootstrap.min.js"></script><link type="text/css" rel="stylesheet" href="https://cdn.jsdelivr.net/gh/BNDong/Cnblogs-Theme-SimpleMemory@v1.3.0/src/style/marvin.nav2.min.css"></head>
<body class="skin-simplememory no-navbar" style="overflow: auto;"><div id="dayNightSwitch" class="generalWrapper">    <div class="onOff daySwitch">        <div class="star star1"></div>        <div class="star star2"></div>        <div class="star star3"></div>        <div class="star star4"></div>        <div class="star star5"></div>        <div class="star sky"></div>        <div class="sunMoon">            <div class="crater crater1"></div>            <div class="crater crater2"></div>            <div class="crater crater3"></div>            <div class="cloud part1"></div>            <div class="cloud part2"></div>        </div>    </div></div>
<a name="top" style="display: none;"></a>
<div id="top_nav" class="navbar forpc navbar-custom">
    <nav id="nav_main" class="navbar-main">
        <ul id="nav_left" class="navbar-list navbar-left">
            <li class="navbar-branding">
                <a href="https://www.cnblogs.com/" title="开发者的网上家园" role="banner">
                    <img src="/images/logo.svg?v=R9M0WmLAIPVydmdzE2keuvnjl-bPR7_35oHqtiBzGsM" alt="博客园Logo">
                </a>
            </li>
            <li>
                <a href="/" onclick="countClicks('skin-navbar-sitehome')">首页</a>
            </li>
            <li>
                <a href="https://news.cnblogs.com/" onclick="countClicks('nav', 'skin-navbar-news')">新闻</a>
            </li>
            <li>
                <a href="https://q.cnblogs.com/" onclick="countClicks('nav', 'skin-navbar-q')">博问</a>
            </li>
            <li>
                <a id="nav_brandzone" href="https://brands.cnblogs.com/" onclick="countClicks('nav', 'skin-navbar-brands')">专区</a>
            </li>
            <li>
                <a href="https://ing.cnblogs.com/" onclick="countClicks('nav', 'skin-navbar-ing')">闪存</a>
            </li>
            <li>
                <a href="https://edu.cnblogs.com/" onclick="countClicks('nav', 'skin-navbar-edu')">班级</a>
            </li>
        </ul>
        <ul id="nav_right" class="navbar-list navbar-right">
            <li>
                <form id="zzk_search" class="navbar-search" action="https://zzk.cnblogs.com/s" method="get" role="search">
                    <input name="w" id="zzk_search_input" placeholder="代码改变世界" type="search" tabindex="3">
                    <button type="submit" id="zzk_search_button">
                        <img src="/images/aggsite/search.svg" alt="搜索">
                    </button>
                </form>
            </li>
            <li id="navbar_login_status" class="navbar-list">
                <a class="navbar-user-info navbar-blog" href="https://i.cnblogs.com/EditPosts.aspx?opt=1" alt="写随笔" title="写随笔" style="display: none;">
                    <img id="new_post_icon" class="navbar-icon" src="/images/aggsite/newpost.svg" alt="写随笔">
                </a>
                <a id="navblog-myblog-icon" class="navbar-user-info navbar-blog" href="https://passport.cnblogs.com/GetBlogApplyStatus.aspx" alt="我的博客" title="我的博客" style="display: none;">
                    <img id="myblog_icon" class="navbar-icon" src="/images/aggsite/myblog.svg" alt="我的博客">
                </a>
                <a class="navbar-user-info navbar-message navbar-icon-wrapper" href="https://msg.cnblogs.com/" alt="短消息" title="短消息" style="display: none;">
                    <img id="msg_icon" class="navbar-icon" src="/images/aggsite/message.svg?v=J0WS2P2iPgaIVgXxcAhliw4AFZIpaTWxtdoNAv9eiCA" alt="短消息">
                    <span id="msg_count" style="display: none"></span>
                </a>
                <a id="navbar_lite_mode_indicator" data-current-page="blog" style="display: none" href="javascript:void(0)" alt="简洁模式" title="简洁模式启用，您在访问他人博客时会使用简洁款皮肤展示">
                    <img class="navbar-icon" src="/images/aggsite/lite-mode-on.svg" alt="简洁模式">
                </a>
                <div id="user_info" class="navbar-user-info dropdown" style="display: none;">
                    <a class="dropdown-button" href="https://home.cnblogs.com/">
                        <img id="user_icon" class="navbar-avatar" src="/images/aggsite/avatar-default.svg" alt="用户头像">
                    </a>
                    <div class="dropdown-menu">
                        <a id="navblog-myblog-text" href="https://passport.cnblogs.com/GetBlogApplyStatus.aspx">我的博客</a>
                        <a href="https://home.cnblogs.com/">我的园子</a>
                        <a href="https://account.cnblogs.com/settings/account">账号设置</a>
                        <a href="javascript:void(0)" id="navbar_lite_mode_toggle" title="简洁模式会使用简洁款皮肤显示所有博客">
    简洁模式 <img id="navbar_lite_mode_on" src="/images/lite-mode-check.svg" class="hide"><span id="navbar_lite_mode_spinner" class="hide">...</span>
</a>
                        <a href="javascript:void(0)" onclick="account.logout();">退出登录</a>
                    </div>
                </div>
                <a class="navbar-anonymous" href="https://account.cnblogs.com/signup" style="display: inline;">注册</a>
                <a class="navbar-anonymous" href="javascript:void(0);" onclick="account.login()" style="display: inline;">登录</a>
            </li>
        </ul>
    </nav>
</div>



<!--done-->
<div id="home" style="margin-top: 40vh;">
<div id="header">
	<div id="blogTitle">
        <a id="lnkBlogLogo" href="https://www.cnblogs.com/thresh/"><img id="blogLogo" src="/skins/custom/images/logo.gif" alt="返回主页"></a>		
		
<!--done-->
<h1><a id="Header1_HeaderTitle" class="headermaintitle HeaderMainTitle" href="https://www.cnblogs.com/thresh/">Thresh｜的博客</a>
</h1>
<h2></h2>




		
	</div><!--end: blogTitle 博客的标题和副标题 -->
	<div id="navigator">
		
<ul id="navList">
<li><a id="blog_nav_sitehome" class="menu" href="https://www.cnblogs.com/">
博客园</a>
</li>
<li>
<a id="blog_nav_myhome" class="menu" href="https://www.cnblogs.com/thresh/">
首页</a>
</li>
<li>

<a id="blog_nav_newpost" class="menu" href="https://i.cnblogs.com/EditPosts.aspx?opt=1">
新随笔</a>
</li>
<li>
<a id="blog_nav_contact" class="menu" href="https://msg.cnblogs.com/send/Thresh%EF%BD%9C">
联系</a></li>
<li>
<a id="blog_nav_rss" class="menu" href="javascript:void(0)" data-rss="https://www.cnblogs.com/thresh/rss/">
订阅</a>
<!--<partial name="./Shared/_XmlLink.cshtml" model="Model" /></li>--></li>
<li>
<a id="blog_nav_admin" class="menu" href="https://i.cnblogs.com/">
管理</a>
</li>
</ul>


		<div class="blogStats">
			<span id="stats_post_count">随笔 - 59&nbsp; </span>
<span id="stats_article_count">文章 - 0&nbsp; </span>
<span id="stats-comment_count">评论 - 48&nbsp; </span>
<span id="stats-total-view-count">阅读 - 
<span title="总阅读数: 75413">
75413</span></span>

		</div><!--end: blogStats -->
	</div><!--end: navigator 博客导航栏 -->
</div><!--end: header 头部 -->
<div id="main">
	<div id="mainContent">
	<div class="forFlow">
		<div id="post_detail">
    <!--done-->
    <div id="topics">
        <div class="post">
            <h1 class="postTitle">
                
<a id="cb_post_title_url" class="postTitle2 vertical-middle post-del-title" href="https://www.cnblogs.com/thresh/p/12609659.html">
    <span role="heading" aria-level="2">Window中的shellcode编写框架（入门篇）</span>
    
</a><button class="cnblogs-toc-button" title="显示目录导航" aria-expanded="false"></button>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body blogpost-body-html">
<h2>Shellcode<button class="cnblogs-toc-button" title="显示目录导航" aria-expanded="false"></button></h2>
<ul>
<li>定义</li>
</ul>
<p>　　是一段可注入的指令（opcode），可以在被攻击的程序内运行。</p>
<ul>
<li>特点</li>
</ul>
<p>　　短小精悍，灵活多变，独立存在，无需任何文件格式的包装，因为shellcode直接操作寄存器和函数，所以opcode必须是16进制形式。因此也不能用高级语言编写shellcode。在内存中运行，无需运行在固定的宿主进程上。</p>
<ul>
<li>Shellcode的利用原理</li>
</ul>
<p>　　将shellcode注入缓冲区，然后欺骗目标程序执行它。而将shellcode注入缓冲区最常用的方法是利用目标系统上的缓冲区溢出漏洞。</p>
<h2>Shellcode生成方法<button class="cnblogs-toc-button" title="显示目录导航" aria-expanded="false"></button></h2>
<ul>
<li>编程语言编写：汇编语言，C语言</li>
<li>shellcode生成器</li>
</ul>
<h2>Shellcode编写原则<button class="cnblogs-toc-button" title="显示目录导航" aria-expanded="false"></button></h2>
<ul>
<li>&nbsp;杜绝双引号字符串的直接使用</li>
</ul>
<p>　　　　关闭VS自动优化没有使用到的变量</p>
<p>　　　　自定义函数入口</p>
<ul>
<li>&nbsp; 动态获取函数的地址</li>
</ul>
<p>　　　　GetProAddress 从dll中获取函数的地址</p>
<p>　　　　参数1：调用dll的句柄，参数2：函数名</p>
<p>　　　　Bug：error C2760: 语法错误: 意外的令牌“标识符”，预期的令牌为“类型说明符”</p>
<p>　　　　打开项目工程-&gt; 属性 -&gt; c/c++ --&gt; 语言 -&gt; 符合模式 修改成否即可 如果这样设置将无法使用c函数。</p>
<p>　　　　这个比较关键，否则使用printf就直接崩溃或者是编译报错</p>
<p>　　　　最佳方案是：修改平台工具集</p>
<ul>
<li>通过获得Kernel32基址来获取GetProcAddres基址</li>
<li>避免全局变量的使用</li>
</ul>
<p>　　　　因为vs会将全局变量编译在其他区段中 结果就是一个绝对的地址不能使用static定义变量（变量放到内部函数使用）</p>
<ul>
<li>&nbsp;确保已加载使用API的动态链接库</li>
</ul>
<h2>编写shellcode前的准备<button class="cnblogs-toc-button" title="显示目录导航" aria-expanded="false"></button></h2>
<ul>
<li>修改程序入口点:链接器-高级。作用：去除自动生成的多余的exe代码</li>
<li>关闭缓冲区安全检查，属性-&gt;C/C++ -&gt;代码生成-&gt;安全检查禁用</li>
<li>设置工程兼容window XP :代码生成 -&gt;运行库 选择 debug MTD&nbsp; release MT</li>
<li>清除资源:链接器-&gt;调试-&gt;清单文件</li>
<li>关闭调试功能</li>
</ul>
<p>如下：</p>
<p>&nbsp;</p>
<p>属性-&gt;常规-&gt;平台工具集 选择xp版本</p>
<p>&nbsp;<a data-fancybox="gallery" href="https://img2020.cnblogs.com/blog/1721319/202003/1721319-20200331225751481-1984312204.png"><img src="https://img2020.cnblogs.com/blog/1721319/202003/1721319-20200331225751481-1984312204.png" alt=""></a></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>C/C++-&gt;代码生成-&gt;运行库选择MT</p>
<p>安全检查禁用</p>
<p>&nbsp;<a data-fancybox="gallery" href="https://img2020.cnblogs.com/blog/1721319/202003/1721319-20200331225820583-1310649675.png"><img src="https://img2020.cnblogs.com/blog/1721319/202003/1721319-20200331225820583-1310649675.png" alt=""></a></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>链接器-&gt;高级-&gt;入口点修改为EntryMain</p>
<p>&nbsp;<a data-fancybox="gallery" href="https://img2020.cnblogs.com/blog/1721319/202003/1721319-20200331225828895-1224649754.png"><img src="https://img2020.cnblogs.com/blog/1721319/202003/1721319-20200331225828895-1224649754.png" alt=""></a></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<h2>函数动态链接调用<button class="cnblogs-toc-button" title="显示目录导航" aria-expanded="false"></button></h2>
<p>　　在编写shellcode时，所有用到的函数都需要动态调用，通过LoadLibrary函数加载动态链接库，GetProAddress获取动态链接库中函数的地址。所以获取到GetProAddress和LoadLibrary地址时非常重要的。通过GetProAddress和LoadLibrary，可以获取到已加载的动态链接库的地址。</p>
<p>&nbsp;</p>
<p>动态获取Kernel32.dll基址和GetProAddress 地址</p>
<p>　　在正常情况下，我们不知道LoadLibraryA的地址，所以不能直接使用该函数。GetProAddress是动态链接库Kernel32.dll中的函数。每个进程内部加载都会加载Kernel32.dll，获取到加载Kernel32.dll地址就可以获取到GetProAddress函数的地址。通过汇编内嵌获取到Kernel32的基址。获取到GetProAddress地址后，就可以获取到所有需要的函数的地址。</p>
<p>&nbsp;</p>
<p>pE文件运行时加载的链接库</p>
<p>&nbsp;<a data-fancybox="gallery" href="https://img2020.cnblogs.com/blog/1721319/202003/1721319-20200331225957989-1171032628.png"><img src="https://img2020.cnblogs.com/blog/1721319/202003/1721319-20200331225957989-1171032628.png" alt=""></a></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>代码如下：</p>
<div class="cnblogs_code">
<pre style="font-family: &quot;Ubuntu Mono&quot;, monospace !important; font-size: 14px !important; background-color: rgb(246, 248, 250); overflow-x: auto;"><code-pre class="code-pre" id="pre-aTEYaB"><code-line class="line-numbers-rows"></code-line>#include &lt;windows.h&gt;<span style="color: rgba(0, 0, 0, 1)">
<code-line class="line-numbers-rows"></code-line>#include </span>&lt;stdio.h&gt;
<code-line class="line-numbers-rows"></code-line>
<code-line class="line-numbers-rows"></code-line><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)">内嵌汇编获取Kernel32的地址</span>
<code-line class="line-numbers-rows"></code-line><span style="color: rgba(0, 0, 0, 1)">__declspec(naked) DWORD getKernel32()
<code-line class="line-numbers-rows"></code-line>{
<code-line class="line-numbers-rows"></code-line>    __asm
<code-line class="line-numbers-rows"></code-line>    {
<code-line class="line-numbers-rows"></code-line>        mov eax,fs:[30h]
<code-line class="line-numbers-rows"></code-line>        mov eax,[eax</span>+<span style="color: rgba(0, 0, 0, 1)">0ch]
<code-line class="line-numbers-rows"></code-line>        mov eax,[eax</span>+<span style="color: rgba(0, 0, 0, 1)">14h]
<code-line class="line-numbers-rows"></code-line>        mov eax,[eax]
<code-line class="line-numbers-rows"></code-line>        mov eax,[eax]
<code-line class="line-numbers-rows"></code-line>        mov eax,[eax</span>+<span style="color: rgba(0, 0, 0, 1)">10h]
<code-line class="line-numbers-rows"></code-line>        ret
<code-line class="line-numbers-rows"></code-line>    }
<code-line class="line-numbers-rows"></code-line>}
<code-line class="line-numbers-rows"></code-line>
<code-line class="line-numbers-rows"></code-line></span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)">通过kernel32基址获取GetProcAddress的地址</span>
<code-line class="line-numbers-rows"></code-line><span style="color: rgba(0, 0, 0, 1)">FARPROC _GetProcAddress(HMODULE hModuleBase) 
<code-line class="line-numbers-rows"></code-line>{
<code-line class="line-numbers-rows"></code-line>    PIMAGE_DOS_HEADER lpDosHeader </span>=<span style="color: rgba(0, 0, 0, 1)"> (PIMAGE_DOS_HEADER)hModuleBase;
<code-line class="line-numbers-rows"></code-line>    PIMAGE_NT_HEADERS32 lpNtHeader </span>= (PIMAGE_NT_HEADERS)((DWORD)hModuleBase + lpDosHeader-&gt;<span style="color: rgba(0, 0, 0, 1)">e_lfanew);
<code-line class="line-numbers-rows"></code-line>    </span><span style="color: rgba(0, 0, 255, 1)">if</span> (!lpNtHeader-&gt;<span style="color: rgba(0, 0, 0, 1)">OptionalHeader.DataDirectory[IMAGE_DIRECTORY_ENTRY_EXPORT].Size){
<code-line class="line-numbers-rows"></code-line>        </span><span style="color: rgba(0, 0, 255, 1)">return</span><span style="color: rgba(0, 0, 0, 1)"> NULL;
<code-line class="line-numbers-rows"></code-line>    }
<code-line class="line-numbers-rows"></code-line>    </span><span style="color: rgba(0, 0, 255, 1)">if</span> (!lpNtHeader-&gt;<span style="color: rgba(0, 0, 0, 1)">OptionalHeader.DataDirectory[IMAGE_DIRECTORY_ENTRY_EXPORT].VirtualAddress) {
<code-line class="line-numbers-rows"></code-line>        </span><span style="color: rgba(0, 0, 255, 1)">return</span><span style="color: rgba(0, 0, 0, 1)"> NULL;
<code-line class="line-numbers-rows"></code-line>    }
<code-line class="line-numbers-rows"></code-line>    PIMAGE_EXPORT_DIRECTORY lpExports </span>= (PIMAGE_EXPORT_DIRECTORY)((DWORD)hModuleBase + (DWORD)lpNtHeader-&gt;<span style="color: rgba(0, 0, 0, 1)">OptionalHeader.DataDirectory[IMAGE_DIRECTORY_ENTRY_EXPORT].VirtualAddress);
<code-line class="line-numbers-rows"></code-line>    PDWORD lpdwFunName </span>= (PDWORD)((DWORD)hModuleBase + (DWORD)lpExports-&gt;<span style="color: rgba(0, 0, 0, 1)">AddressOfNames);
<code-line class="line-numbers-rows"></code-line>    PWORD lpword </span>= (PWORD)((DWORD)hModuleBase + (DWORD)lpExports-&gt;<span style="color: rgba(0, 0, 0, 1)">AddressOfNameOrdinals);
<code-line class="line-numbers-rows"></code-line>    PDWORD lpdwFunAddr </span>= (PDWORD)((DWORD)hModuleBase + (DWORD)lpExports-&gt;<span style="color: rgba(0, 0, 0, 1)">AddressOfFunctions);
<code-line class="line-numbers-rows"></code-line>
<code-line class="line-numbers-rows"></code-line>    DWORD dwLoop </span>= <span style="color: rgba(128, 0, 128, 1)">0</span><span style="color: rgba(0, 0, 0, 1)">;
<code-line class="line-numbers-rows"></code-line>    FARPROC pRet </span>=<span style="color: rgba(0, 0, 0, 1)"> NULL;
<code-line class="line-numbers-rows"></code-line>    </span><span style="color: rgba(0, 0, 255, 1)">for</span> (; dwLoop &lt;= lpExports-&gt;NumberOfNames - <span style="color: rgba(128, 0, 128, 1)">1</span>; dwLoop++<span style="color: rgba(0, 0, 0, 1)">) {
<code-line class="line-numbers-rows"></code-line>        </span><span style="color: rgba(0, 0, 255, 1)">char</span>* pFunName = (<span style="color: rgba(0, 0, 255, 1)">char</span>*)(lpdwFunName[dwLoop] +<span style="color: rgba(0, 0, 0, 1)"> (DWORD)hModuleBase);
<code-line class="line-numbers-rows"></code-line>
<code-line class="line-numbers-rows"></code-line>        </span><span style="color: rgba(0, 0, 255, 1)">if</span> (pFunName[<span style="color: rgba(128, 0, 128, 1)">0</span>] == <span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">G</span><span style="color: rgba(128, 0, 0, 1)">'</span>&amp;&amp;<span style="color: rgba(0, 0, 0, 1)">
<code-line class="line-numbers-rows"></code-line>            pFunName[</span><span style="color: rgba(128, 0, 128, 1)">1</span>] == <span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">e</span><span style="color: rgba(128, 0, 0, 1)">'</span>&amp;&amp;<span style="color: rgba(0, 0, 0, 1)">
<code-line class="line-numbers-rows"></code-line>            pFunName[</span><span style="color: rgba(128, 0, 128, 1)">2</span>] == <span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">t</span><span style="color: rgba(128, 0, 0, 1)">'</span>&amp;&amp;<span style="color: rgba(0, 0, 0, 1)">
<code-line class="line-numbers-rows"></code-line>            pFunName[</span><span style="color: rgba(128, 0, 128, 1)">3</span>] == <span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">P</span><span style="color: rgba(128, 0, 0, 1)">'</span>&amp;&amp;<span style="color: rgba(0, 0, 0, 1)">
<code-line class="line-numbers-rows"></code-line>            pFunName[</span><span style="color: rgba(128, 0, 128, 1)">4</span>] == <span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">r</span><span style="color: rgba(128, 0, 0, 1)">'</span>&amp;&amp;<span style="color: rgba(0, 0, 0, 1)">
<code-line class="line-numbers-rows"></code-line>            pFunName[</span><span style="color: rgba(128, 0, 128, 1)">5</span>] == <span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">o</span><span style="color: rgba(128, 0, 0, 1)">'</span>&amp;&amp;<span style="color: rgba(0, 0, 0, 1)">
<code-line class="line-numbers-rows"></code-line>            pFunName[</span><span style="color: rgba(128, 0, 128, 1)">6</span>] == <span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">c</span><span style="color: rgba(128, 0, 0, 1)">'</span>&amp;&amp;<span style="color: rgba(0, 0, 0, 1)">
<code-line class="line-numbers-rows"></code-line>            pFunName[</span><span style="color: rgba(128, 0, 128, 1)">7</span>] == <span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">A</span><span style="color: rgba(128, 0, 0, 1)">'</span>&amp;&amp;<span style="color: rgba(0, 0, 0, 1)">
<code-line class="line-numbers-rows"></code-line>            pFunName[</span><span style="color: rgba(128, 0, 128, 1)">8</span>] == <span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">d</span><span style="color: rgba(128, 0, 0, 1)">'</span>&amp;&amp;<span style="color: rgba(0, 0, 0, 1)">
<code-line class="line-numbers-rows"></code-line>            pFunName[</span><span style="color: rgba(128, 0, 128, 1)">9</span>] == <span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">d</span><span style="color: rgba(128, 0, 0, 1)">'</span>&amp;&amp;<span style="color: rgba(0, 0, 0, 1)">
<code-line class="line-numbers-rows"></code-line>            pFunName[</span><span style="color: rgba(128, 0, 128, 1)">10</span>] == <span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">r</span><span style="color: rgba(128, 0, 0, 1)">'</span>&amp;&amp;<span style="color: rgba(0, 0, 0, 1)">
<code-line class="line-numbers-rows"></code-line>            pFunName[</span><span style="color: rgba(128, 0, 128, 1)">11</span>] == <span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">e</span><span style="color: rgba(128, 0, 0, 1)">'</span>&amp;&amp;<span style="color: rgba(0, 0, 0, 1)">
<code-line class="line-numbers-rows"></code-line>            pFunName[</span><span style="color: rgba(128, 0, 128, 1)">12</span>] == <span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">s</span><span style="color: rgba(128, 0, 0, 1)">'</span>&amp;&amp;<span style="color: rgba(0, 0, 0, 1)">
<code-line class="line-numbers-rows"></code-line>            pFunName[</span><span style="color: rgba(128, 0, 128, 1)">13</span>] == <span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">s</span><span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(0, 0, 0, 1)">)
<code-line class="line-numbers-rows"></code-line>        {
<code-line class="line-numbers-rows"></code-line>            pRet </span>= (FARPROC)(lpdwFunAddr[lpword[dwLoop]] +<span style="color: rgba(0, 0, 0, 1)"> (DWORD)hModuleBase);
<code-line class="line-numbers-rows"></code-line>            </span><span style="color: rgba(0, 0, 255, 1)">break</span><span style="color: rgba(0, 0, 0, 1)">;
<code-line class="line-numbers-rows"></code-line>        }
<code-line class="line-numbers-rows"></code-line>    }
<code-line class="line-numbers-rows"></code-line>    </span><span style="color: rgba(0, 0, 255, 1)">return</span><span style="color: rgba(0, 0, 0, 1)"> pRet;
<code-line class="line-numbers-rows"></code-line>}
<code-line class="line-numbers-rows"></code-line>
<code-line class="line-numbers-rows"></code-line></span><span style="color: rgba(0, 0, 255, 1)">int</span><span style="color: rgba(0, 0, 0, 1)"> main()
<code-line class="line-numbers-rows"></code-line>{
<code-line class="line-numbers-rows"></code-line>    </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)">kernel32.dll 基址的动态获取</span>
<code-line class="line-numbers-rows"></code-line>    HMODULE hLoadLibrary = LoadLibraryA(<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">kernel32.dll</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">);
<code-line class="line-numbers-rows"></code-line>    </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)">使用内嵌汇编来获取基址</span>
<code-line class="line-numbers-rows"></code-line>    HMODULE _hLoadLibrary =<span style="color: rgba(0, 0, 0, 1)"> (HMODULE)getKernel32();
<code-line class="line-numbers-rows"></code-line>    </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)">效果是一样的</span>
<code-line class="line-numbers-rows"></code-line>    printf(<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">LoadLibraryA动态获取的地址: 0x%x\n</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">, hLoadLibrary);
<code-line class="line-numbers-rows"></code-line>    printf(</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">内嵌汇编获取的地址: 0x%x\n</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">, _hLoadLibrary);
<code-line class="line-numbers-rows"></code-line>
<code-line class="line-numbers-rows"></code-line>    </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)">声明定义，先转到到原函数定义，然后重新定义</span>
<code-line class="line-numbers-rows"></code-line>    typedef FARPROC(WINAPI *<span style="color: rgba(0, 0, 0, 1)">FN_GetProcAddress)(
<code-line class="line-numbers-rows"></code-line>            _In_ HMODULE hModule,
<code-line class="line-numbers-rows"></code-line>            _In_ LPCSTR lpProcName
<code-line class="line-numbers-rows"></code-line>        );
<code-line class="line-numbers-rows"></code-line>
<code-line class="line-numbers-rows"></code-line>    FN_GetProcAddress fn_GetProcAddress;
<code-line class="line-numbers-rows"></code-line>    fn_GetProcAddress </span>=<span style="color: rgba(0, 0, 0, 1)"> (FN_GetProcAddress)_GetProcAddress(_hLoadLibrary);
<code-line class="line-numbers-rows"></code-line>
<code-line class="line-numbers-rows"></code-line>    printf(</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">动态获取GetProcAddress地址: 0x%x\n</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">,fn_GetProcAddress);
<code-line class="line-numbers-rows"></code-line>    printf(</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">内置函数获取: 0x%x\n</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">,GetProcAddress);
<code-line class="line-numbers-rows"></code-line>}</span></code-pre></pre>
</div>
<p>&nbsp;</p>
<p>可以看到，动态获取的地址和系统函数获取的是一致的</p>
<p><a data-fancybox="gallery" href="https://img2020.cnblogs.com/blog/1721319/202003/1721319-20200331230115984-1630368719.png"><img src="https://img2020.cnblogs.com/blog/1721319/202003/1721319-20200331230115984-1630368719.png" alt=""></a></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<h2>Shellcode框架（一）<button class="cnblogs-toc-button" title="显示目录导航" aria-expanded="false"></button></h2>
<p>引用前面kernel32.dll和GetProcaddress的获取地址。对于每一个要引用的函数，通过查看定义来声明定义函数，通过GetProcaddress动态获取地址。</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>具体代码如下：</p>
<p>原C代码：</p>
<div class="cnblogs_code">
<pre style="font-family: &quot;Ubuntu Mono&quot;, monospace !important; font-size: 14px !important; background-color: rgb(246, 248, 250); overflow-x: auto;"><code-pre class="code-pre" id="pre-aGhfK3"><code-line class="line-numbers-rows"></code-line>#include &lt;windows.h&gt;<span style="color: rgba(0, 0, 0, 1)">
<code-line class="line-numbers-rows"></code-line>#include </span>&lt;stdio.h&gt;<span style="color: rgba(0, 0, 0, 1)">
<code-line class="line-numbers-rows"></code-line>#include </span>&lt;windows.h&gt;
<code-line class="line-numbers-rows"></code-line><span style="color: rgba(0, 0, 255, 1)">int</span><span style="color: rgba(0, 0, 0, 1)"> EntryMain()
<code-line class="line-numbers-rows"></code-line>{
<code-line class="line-numbers-rows"></code-line>CreateFileA(“</span><span style="color: rgba(128, 0, 128, 1)">1</span>.txt”, GENERIC_WRITE, <span style="color: rgba(128, 0, 128, 1)">0</span>, NULL, CREATE_ALWAYS, <span style="color: rgba(128, 0, 128, 1)">0</span><span style="color: rgba(0, 0, 0, 1)">, NULL);
<code-line class="line-numbers-rows"></code-line>MessageBoxA(NULL, “hello world”, tip, MB_OK);
<code-line class="line-numbers-rows"></code-line></span><span style="color: rgba(0, 0, 255, 1)">return</span> <span style="color: rgba(128, 0, 128, 1)">0</span><span style="color: rgba(0, 0, 0, 1)">;
<code-line class="line-numbers-rows"></code-line>}</span></code-pre></pre>
</div>
<p>Shellcode编写：</p>
<div class="cnblogs_code">
<pre style="font-family: &quot;Ubuntu Mono&quot;, monospace !important; font-size: 14px !important; background-color: rgb(246, 248, 250); overflow-x: auto;"><code-pre class="code-pre" id="pre-Z3kczR"><code-line class="line-numbers-rows"></code-line>#include &lt;windows.h&gt;<span style="color: rgba(0, 0, 0, 1)">
<code-line class="line-numbers-rows"></code-line>#include </span>&lt;stdio.h&gt;<span style="color: rgba(0, 0, 0, 1)">
<code-line class="line-numbers-rows"></code-line>
<code-line class="line-numbers-rows"></code-line>FARPROC  getProcAddress(HMODULE hModuleBase);
<code-line class="line-numbers-rows"></code-line>DWORD getKernel32();
<code-line class="line-numbers-rows"></code-line>
<code-line class="line-numbers-rows"></code-line></span><span style="color: rgba(0, 0, 255, 1)">int</span><span style="color: rgba(0, 0, 0, 1)"> EntryMain()
<code-line class="line-numbers-rows"></code-line>{
<code-line class="line-numbers-rows"></code-line>    </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)">声明定义GetProcAddress</span>
<code-line class="line-numbers-rows"></code-line>    typedef FARPROC(WINAPI *<span style="color: rgba(0, 0, 0, 1)">FN_GetProcAddress)(
<code-line class="line-numbers-rows"></code-line>        _In_ HMODULE hModule,
<code-line class="line-numbers-rows"></code-line>        _In_ LPCSTR lpProcName
<code-line class="line-numbers-rows"></code-line>        );
<code-line class="line-numbers-rows"></code-line>
<code-line class="line-numbers-rows"></code-line>    </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)">获取GetProcAddress真实地址</span>
<code-line class="line-numbers-rows"></code-line>    FN_GetProcAddress fn_GetProcAddress =<span style="color: rgba(0, 0, 0, 1)"> (FN_GetProcAddress)getProcAddress((HMODULE)getKernel32());
<code-line class="line-numbers-rows"></code-line>
<code-line class="line-numbers-rows"></code-line>
<code-line class="line-numbers-rows"></code-line>    </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)">声明定义CreateFileA</span>
<code-line class="line-numbers-rows"></code-line>    typedef HANDLE(WINAPI *<span style="color: rgba(0, 0, 0, 1)">FN_CreateFileA)(
<code-line class="line-numbers-rows"></code-line>            __in     LPCSTR lpFileName,
<code-line class="line-numbers-rows"></code-line>            __in     DWORD dwDesiredAccess,
<code-line class="line-numbers-rows"></code-line>            __in     DWORD dwShareMode,
<code-line class="line-numbers-rows"></code-line>            __in_opt LPSECURITY_ATTRIBUTES lpSecurityAttributes,
<code-line class="line-numbers-rows"></code-line>            __in     DWORD dwCreationDisposition,
<code-line class="line-numbers-rows"></code-line>            __in     DWORD dwFlagsAndAttributes,
<code-line class="line-numbers-rows"></code-line>            __in_opt HANDLE hTemplateFile
<code-line class="line-numbers-rows"></code-line>        );
<code-line class="line-numbers-rows"></code-line>    </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)">将来的替换，地址全部动态获取
<code-line class="line-numbers-rows"></code-line>    </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)">FN_CreateFileA fn_CreateFileA = (FN_CreateFileA)GetProcAddress(LoadLibrary("kernel32.dll"), "CreateFileA");
<code-line class="line-numbers-rows"></code-line>    </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)">带引号的字符串打散处理</span>
<code-line class="line-numbers-rows"></code-line>    <span style="color: rgba(0, 0, 255, 1)">char</span> xyCreateFile[] = { <span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">C</span><span style="color: rgba(128, 0, 0, 1)">'</span>,<span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">r</span><span style="color: rgba(128, 0, 0, 1)">'</span>,<span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">e</span><span style="color: rgba(128, 0, 0, 1)">'</span>,<span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">a</span><span style="color: rgba(128, 0, 0, 1)">'</span>,<span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">t</span><span style="color: rgba(128, 0, 0, 1)">'</span>,<span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">e</span><span style="color: rgba(128, 0, 0, 1)">'</span>,<span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">F</span><span style="color: rgba(128, 0, 0, 1)">'</span>,<span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">i</span><span style="color: rgba(128, 0, 0, 1)">'</span>,<span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">l</span><span style="color: rgba(128, 0, 0, 1)">'</span>,<span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">e</span><span style="color: rgba(128, 0, 0, 1)">'</span>,<span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">A</span><span style="color: rgba(128, 0, 0, 1)">'</span>,<span style="color: rgba(128, 0, 128, 1)">0</span><span style="color: rgba(0, 0, 0, 1)"> };
<code-line class="line-numbers-rows"></code-line>    </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)">动态获取CreateFile的地址</span>
<code-line class="line-numbers-rows"></code-line>    FN_CreateFileA fn_CreateFileA =<span style="color: rgba(0, 0, 0, 1)"> (FN_CreateFileA)fn_GetProcAddress((HMODULE)getKernel32(), xyCreateFile);
<code-line class="line-numbers-rows"></code-line>    </span><span style="color: rgba(0, 0, 255, 1)">char</span> xyNewFile[] = { <span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">1</span><span style="color: rgba(128, 0, 0, 1)">'</span>,<span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">.</span><span style="color: rgba(128, 0, 0, 1)">'</span>,<span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">t</span><span style="color: rgba(128, 0, 0, 1)">'</span>,<span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">x</span><span style="color: rgba(128, 0, 0, 1)">'</span>,<span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">t</span><span style="color: rgba(128, 0, 0, 1)">'</span>,<span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">\0</span><span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(0, 0, 0, 1)">};
<code-line class="line-numbers-rows"></code-line>    fn_CreateFileA(xyNewFile, GENERIC_WRITE, </span><span style="color: rgba(128, 0, 128, 1)">0</span>, NULL, CREATE_ALWAYS, <span style="color: rgba(128, 0, 128, 1)">0</span><span style="color: rgba(0, 0, 0, 1)">, NULL);
<code-line class="line-numbers-rows"></code-line>
<code-line class="line-numbers-rows"></code-line>
<code-line class="line-numbers-rows"></code-line>    </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)">定义LoadLibraryA</span>
<code-line class="line-numbers-rows"></code-line>    typedef HMODULE(WINAPI *<span style="color: rgba(0, 0, 0, 1)">FN_LoadLibraryA)(
<code-line class="line-numbers-rows"></code-line>            __in LPCSTR lpLibFileName
<code-line class="line-numbers-rows"></code-line>        );
<code-line class="line-numbers-rows"></code-line>    </span><span style="color: rgba(0, 0, 255, 1)">char</span> xyLoadLibraryA[] = { <span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">L</span><span style="color: rgba(128, 0, 0, 1)">'</span>,<span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">o</span><span style="color: rgba(128, 0, 0, 1)">'</span>,<span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">a</span><span style="color: rgba(128, 0, 0, 1)">'</span>,<span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">d</span><span style="color: rgba(128, 0, 0, 1)">'</span>,<span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">L</span><span style="color: rgba(128, 0, 0, 1)">'</span>,<span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">i</span><span style="color: rgba(128, 0, 0, 1)">'</span>,<span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">b</span><span style="color: rgba(128, 0, 0, 1)">'</span>,<span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">r</span><span style="color: rgba(128, 0, 0, 1)">'</span>,<span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">a</span><span style="color: rgba(128, 0, 0, 1)">'</span>,<span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">r</span><span style="color: rgba(128, 0, 0, 1)">'</span>,<span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">y</span><span style="color: rgba(128, 0, 0, 1)">'</span>,<span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">A</span><span style="color: rgba(128, 0, 0, 1)">'</span>,<span style="color: rgba(128, 0, 128, 1)">0</span><span style="color: rgba(0, 0, 0, 1)">};
<code-line class="line-numbers-rows"></code-line>    </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)">动态获取LoadLibraryA的地址</span>
<code-line class="line-numbers-rows"></code-line>    FN_LoadLibraryA fn_LoadLibraryA =<span style="color: rgba(0, 0, 0, 1)"> (FN_LoadLibraryA)fn_GetProcAddress((HMODULE)getKernel32(), xyLoadLibraryA);
<code-line class="line-numbers-rows"></code-line>
<code-line class="line-numbers-rows"></code-line>
<code-line class="line-numbers-rows"></code-line>    </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)">定义MessageBoxA</span>
<code-line class="line-numbers-rows"></code-line>    typedef <span style="color: rgba(0, 0, 255, 1)">int</span> (WINAPI *<span style="color: rgba(0, 0, 0, 1)">FN_MessageBoxA)(
<code-line class="line-numbers-rows"></code-line>            __in_opt HWND hWnd,
<code-line class="line-numbers-rows"></code-line>            __in_opt LPCSTR lpText,
<code-line class="line-numbers-rows"></code-line>            __in_opt LPCSTR lpCaption,
<code-line class="line-numbers-rows"></code-line>            __in UINT uType);
<code-line class="line-numbers-rows"></code-line>
<code-line class="line-numbers-rows"></code-line>            </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)">原来的：MessageBoxA(NULL, "Hello world", "tip", MB_OK);</span>
<code-line class="line-numbers-rows"></code-line>            <span style="color: rgba(0, 0, 255, 1)">char</span> xy_user32[] = { <span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">u</span><span style="color: rgba(128, 0, 0, 1)">'</span>,<span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">s</span><span style="color: rgba(128, 0, 0, 1)">'</span>,<span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">e</span><span style="color: rgba(128, 0, 0, 1)">'</span>,<span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">r</span><span style="color: rgba(128, 0, 0, 1)">'</span>,<span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">3</span><span style="color: rgba(128, 0, 0, 1)">'</span>,<span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">2</span><span style="color: rgba(128, 0, 0, 1)">'</span>,<span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">.</span><span style="color: rgba(128, 0, 0, 1)">'</span>,<span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">d</span><span style="color: rgba(128, 0, 0, 1)">'</span>,<span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">l</span><span style="color: rgba(128, 0, 0, 1)">'</span>,<span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">l</span><span style="color: rgba(128, 0, 0, 1)">'</span>,<span style="color: rgba(128, 0, 128, 1)">0</span><span style="color: rgba(0, 0, 0, 1)"> };
<code-line class="line-numbers-rows"></code-line>            </span><span style="color: rgba(0, 0, 255, 1)">char</span> xy_MessageBoxA[] = { <span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">M</span><span style="color: rgba(128, 0, 0, 1)">'</span>,<span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">e</span><span style="color: rgba(128, 0, 0, 1)">'</span>,<span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">s</span><span style="color: rgba(128, 0, 0, 1)">'</span>,<span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">s</span><span style="color: rgba(128, 0, 0, 1)">'</span>,<span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">a</span><span style="color: rgba(128, 0, 0, 1)">'</span>,<span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">g</span><span style="color: rgba(128, 0, 0, 1)">'</span>,<span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">e</span><span style="color: rgba(128, 0, 0, 1)">'</span>,<span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">B</span><span style="color: rgba(128, 0, 0, 1)">'</span>,<span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">o</span><span style="color: rgba(128, 0, 0, 1)">'</span>,<span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">x</span><span style="color: rgba(128, 0, 0, 1)">'</span>,<span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">A</span><span style="color: rgba(128, 0, 0, 1)">'</span>,<span style="color: rgba(128, 0, 128, 1)">0</span><span style="color: rgba(0, 0, 0, 1)"> };
<code-line class="line-numbers-rows"></code-line>            FN_MessageBoxA fn_MessageBoxA </span>=<span style="color: rgba(0, 0, 0, 1)"> (FN_MessageBoxA)fn_GetProcAddress(fn_LoadLibraryA(xy_user32), xy_MessageBoxA);
<code-line class="line-numbers-rows"></code-line>            </span><span style="color: rgba(0, 0, 255, 1)">char</span> xy_Hello[] = { <span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">H</span><span style="color: rgba(128, 0, 0, 1)">'</span>,<span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">e</span><span style="color: rgba(128, 0, 0, 1)">'</span>,<span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">l</span><span style="color: rgba(128, 0, 0, 1)">'</span>,<span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">l</span><span style="color: rgba(128, 0, 0, 1)">'</span>,<span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">o</span><span style="color: rgba(128, 0, 0, 1)">'</span>,<span style="color: rgba(128, 0, 0, 1)">'</span> <span style="color: rgba(128, 0, 0, 1)">'</span>,<span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">w</span><span style="color: rgba(128, 0, 0, 1)">'</span>,<span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">o</span><span style="color: rgba(128, 0, 0, 1)">'</span>,<span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">r</span><span style="color: rgba(128, 0, 0, 1)">'</span>,<span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">l</span><span style="color: rgba(128, 0, 0, 1)">'</span>,<span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">d</span><span style="color: rgba(128, 0, 0, 1)">'</span>,<span style="color: rgba(128, 0, 128, 1)">0</span><span style="color: rgba(0, 0, 0, 1)"> };
<code-line class="line-numbers-rows"></code-line>            </span><span style="color: rgba(0, 0, 255, 1)">char</span> xy_tip[] = { <span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">t</span><span style="color: rgba(128, 0, 0, 1)">'</span>,<span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">i</span><span style="color: rgba(128, 0, 0, 1)">'</span>,<span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">p</span><span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(0, 0, 0, 1)"> };
<code-line class="line-numbers-rows"></code-line>            fn_MessageBoxA(NULL, xy_Hello, xy_tip, MB_OK);
<code-line class="line-numbers-rows"></code-line>            </span><span style="color: rgba(0, 0, 255, 1)">return</span> <span style="color: rgba(128, 0, 128, 1)">0</span><span style="color: rgba(0, 0, 0, 1)">;
<code-line class="line-numbers-rows"></code-line>}
<code-line class="line-numbers-rows"></code-line>
<code-line class="line-numbers-rows"></code-line></span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)">内嵌汇编获取Kernel32的地址</span>
<code-line class="line-numbers-rows"></code-line><span style="color: rgba(0, 0, 0, 1)">__declspec(naked) DWORD getKernel32()
<code-line class="line-numbers-rows"></code-line>{
<code-line class="line-numbers-rows"></code-line>    __asm
<code-line class="line-numbers-rows"></code-line>    {
<code-line class="line-numbers-rows"></code-line>        mov eax, fs:[30h]
<code-line class="line-numbers-rows"></code-line>        mov eax, [eax </span>+<span style="color: rgba(0, 0, 0, 1)"> 0ch]
<code-line class="line-numbers-rows"></code-line>        mov eax, [eax </span>+<span style="color: rgba(0, 0, 0, 1)"> 14h]
<code-line class="line-numbers-rows"></code-line>        mov eax, [eax]
<code-line class="line-numbers-rows"></code-line>        mov eax, [eax]
<code-line class="line-numbers-rows"></code-line>        mov eax, [eax </span>+<span style="color: rgba(0, 0, 0, 1)"> 10h]
<code-line class="line-numbers-rows"></code-line>        ret
<code-line class="line-numbers-rows"></code-line>    }
<code-line class="line-numbers-rows"></code-line>}
<code-line class="line-numbers-rows"></code-line>
<code-line class="line-numbers-rows"></code-line></span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)">获取GetProcAddress的地址</span>
<code-line class="line-numbers-rows"></code-line><span style="color: rgba(0, 0, 0, 1)">FARPROC getProcAddress(HMODULE hModuleBase)
<code-line class="line-numbers-rows"></code-line>{
<code-line class="line-numbers-rows"></code-line>    PIMAGE_DOS_HEADER lpDosHeader </span>=<span style="color: rgba(0, 0, 0, 1)"> (PIMAGE_DOS_HEADER)hModuleBase;
<code-line class="line-numbers-rows"></code-line>    PIMAGE_NT_HEADERS32 lpNtHeader </span>= (PIMAGE_NT_HEADERS)((DWORD)hModuleBase + lpDosHeader-&gt;<span style="color: rgba(0, 0, 0, 1)">e_lfanew);
<code-line class="line-numbers-rows"></code-line>    </span><span style="color: rgba(0, 0, 255, 1)">if</span> (!lpNtHeader-&gt;<span style="color: rgba(0, 0, 0, 1)">OptionalHeader.DataDirectory[IMAGE_DIRECTORY_ENTRY_EXPORT].Size) {
<code-line class="line-numbers-rows"></code-line>        </span><span style="color: rgba(0, 0, 255, 1)">return</span><span style="color: rgba(0, 0, 0, 1)"> NULL;
<code-line class="line-numbers-rows"></code-line>    }
<code-line class="line-numbers-rows"></code-line>    </span><span style="color: rgba(0, 0, 255, 1)">if</span> (!lpNtHeader-&gt;<span style="color: rgba(0, 0, 0, 1)">OptionalHeader.DataDirectory[IMAGE_DIRECTORY_ENTRY_EXPORT].VirtualAddress) {
<code-line class="line-numbers-rows"></code-line>        </span><span style="color: rgba(0, 0, 255, 1)">return</span><span style="color: rgba(0, 0, 0, 1)"> NULL;
<code-line class="line-numbers-rows"></code-line>    }
<code-line class="line-numbers-rows"></code-line>    PIMAGE_EXPORT_DIRECTORY lpExports </span>= (PIMAGE_EXPORT_DIRECTORY)((DWORD)hModuleBase + (DWORD)lpNtHeader-&gt;<span style="color: rgba(0, 0, 0, 1)">OptionalHeader.DataDirectory[IMAGE_DIRECTORY_ENTRY_EXPORT].VirtualAddress);
<code-line class="line-numbers-rows"></code-line>    PDWORD lpdwFunName </span>= (PDWORD)((DWORD)hModuleBase + (DWORD)lpExports-&gt;<span style="color: rgba(0, 0, 0, 1)">AddressOfNames);
<code-line class="line-numbers-rows"></code-line>    PWORD lpword </span>= (PWORD)((DWORD)hModuleBase + (DWORD)lpExports-&gt;<span style="color: rgba(0, 0, 0, 1)">AddressOfNameOrdinals);
<code-line class="line-numbers-rows"></code-line>    PDWORD lpdwFunAddr </span>= (PDWORD)((DWORD)hModuleBase + (DWORD)lpExports-&gt;<span style="color: rgba(0, 0, 0, 1)">AddressOfFunctions);
<code-line class="line-numbers-rows"></code-line>
<code-line class="line-numbers-rows"></code-line>    DWORD dwLoop </span>= <span style="color: rgba(128, 0, 128, 1)">0</span><span style="color: rgba(0, 0, 0, 1)">;
<code-line class="line-numbers-rows"></code-line>    FARPROC pRet </span>=<span style="color: rgba(0, 0, 0, 1)"> NULL;
<code-line class="line-numbers-rows"></code-line>    </span><span style="color: rgba(0, 0, 255, 1)">for</span> (; dwLoop &lt;= lpExports-&gt;NumberOfNames - <span style="color: rgba(128, 0, 128, 1)">1</span>; dwLoop++<span style="color: rgba(0, 0, 0, 1)">) {
<code-line class="line-numbers-rows"></code-line>        </span><span style="color: rgba(0, 0, 255, 1)">char</span>* pFunName = (<span style="color: rgba(0, 0, 255, 1)">char</span>*)(lpdwFunName[dwLoop] +<span style="color: rgba(0, 0, 0, 1)"> (DWORD)hModuleBase);
<code-line class="line-numbers-rows"></code-line>
<code-line class="line-numbers-rows"></code-line>        </span><span style="color: rgba(0, 0, 255, 1)">if</span> (pFunName[<span style="color: rgba(128, 0, 128, 1)">0</span>] == <span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">G</span><span style="color: rgba(128, 0, 0, 1)">'</span>&amp;&amp;<span style="color: rgba(0, 0, 0, 1)">
<code-line class="line-numbers-rows"></code-line>            pFunName[</span><span style="color: rgba(128, 0, 128, 1)">1</span>] == <span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">e</span><span style="color: rgba(128, 0, 0, 1)">'</span>&amp;&amp;<span style="color: rgba(0, 0, 0, 1)">
<code-line class="line-numbers-rows"></code-line>            pFunName[</span><span style="color: rgba(128, 0, 128, 1)">2</span>] == <span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">t</span><span style="color: rgba(128, 0, 0, 1)">'</span>&amp;&amp;<span style="color: rgba(0, 0, 0, 1)">
<code-line class="line-numbers-rows"></code-line>            pFunName[</span><span style="color: rgba(128, 0, 128, 1)">3</span>] == <span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">P</span><span style="color: rgba(128, 0, 0, 1)">'</span>&amp;&amp;<span style="color: rgba(0, 0, 0, 1)">
<code-line class="line-numbers-rows"></code-line>            pFunName[</span><span style="color: rgba(128, 0, 128, 1)">4</span>] == <span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">r</span><span style="color: rgba(128, 0, 0, 1)">'</span>&amp;&amp;<span style="color: rgba(0, 0, 0, 1)">
<code-line class="line-numbers-rows"></code-line>            pFunName[</span><span style="color: rgba(128, 0, 128, 1)">5</span>] == <span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">o</span><span style="color: rgba(128, 0, 0, 1)">'</span>&amp;&amp;<span style="color: rgba(0, 0, 0, 1)">
<code-line class="line-numbers-rows"></code-line>            pFunName[</span><span style="color: rgba(128, 0, 128, 1)">6</span>] == <span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">c</span><span style="color: rgba(128, 0, 0, 1)">'</span>&amp;&amp;<span style="color: rgba(0, 0, 0, 1)">
<code-line class="line-numbers-rows"></code-line>            pFunName[</span><span style="color: rgba(128, 0, 128, 1)">7</span>] == <span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">A</span><span style="color: rgba(128, 0, 0, 1)">'</span>&amp;&amp;<span style="color: rgba(0, 0, 0, 1)">
<code-line class="line-numbers-rows"></code-line>            pFunName[</span><span style="color: rgba(128, 0, 128, 1)">8</span>] == <span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">d</span><span style="color: rgba(128, 0, 0, 1)">'</span>&amp;&amp;<span style="color: rgba(0, 0, 0, 1)">
<code-line class="line-numbers-rows"></code-line>            pFunName[</span><span style="color: rgba(128, 0, 128, 1)">9</span>] == <span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">d</span><span style="color: rgba(128, 0, 0, 1)">'</span>&amp;&amp;<span style="color: rgba(0, 0, 0, 1)">
<code-line class="line-numbers-rows"></code-line>            pFunName[</span><span style="color: rgba(128, 0, 128, 1)">10</span>] == <span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">r</span><span style="color: rgba(128, 0, 0, 1)">'</span>&amp;&amp;<span style="color: rgba(0, 0, 0, 1)">
<code-line class="line-numbers-rows"></code-line>            pFunName[</span><span style="color: rgba(128, 0, 128, 1)">11</span>] == <span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">e</span><span style="color: rgba(128, 0, 0, 1)">'</span>&amp;&amp;<span style="color: rgba(0, 0, 0, 1)">
<code-line class="line-numbers-rows"></code-line>            pFunName[</span><span style="color: rgba(128, 0, 128, 1)">12</span>] == <span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">s</span><span style="color: rgba(128, 0, 0, 1)">'</span>&amp;&amp;<span style="color: rgba(0, 0, 0, 1)">
<code-line class="line-numbers-rows"></code-line>            pFunName[</span><span style="color: rgba(128, 0, 128, 1)">13</span>] == <span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">s</span><span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(0, 0, 0, 1)">)
<code-line class="line-numbers-rows"></code-line>        {
<code-line class="line-numbers-rows"></code-line>            pRet </span>= (FARPROC)(lpdwFunAddr[lpword[dwLoop]] +<span style="color: rgba(0, 0, 0, 1)"> (DWORD)hModuleBase);
<code-line class="line-numbers-rows"></code-line>            </span><span style="color: rgba(0, 0, 255, 1)">break</span><span style="color: rgba(0, 0, 0, 1)">;
<code-line class="line-numbers-rows"></code-line>        }
<code-line class="line-numbers-rows"></code-line>    }
<code-line class="line-numbers-rows"></code-line>    </span><span style="color: rgba(0, 0, 255, 1)">return</span><span style="color: rgba(0, 0, 0, 1)"> pRet;
<code-line class="line-numbers-rows"></code-line>}</span></code-pre></pre>
</div>
<p>　　结果：运行exe文件创建了1.txt文件，并出现弹框。</p>
<p>　<a data-fancybox="gallery" href="https://img2020.cnblogs.com/blog/1721319/202003/1721319-20200331231029404-72712910.png"><img src="https://img2020.cnblogs.com/blog/1721319/202003/1721319-20200331231029404-72712910.png" alt=""></a></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<h2>函数生成的位置规律<button class="cnblogs-toc-button" title="显示目录导航" aria-expanded="false"></button></h2>
<ol>
<li>单文件函数生成的位置规律</li>
</ol>
<p>　　规律：单文件函数的生成规律，与函数实现的先后顺序有关，而与函数的定义顺序无关。</p>
<p>　　例如：</p>
<p>&nbsp;</p>
<div class="cnblogs_code">
<pre style="font-family: &quot;Ubuntu Mono&quot;, monospace !important; font-size: 14px !important; background-color: rgb(246, 248, 250); overflow-x: auto;"><code-pre class="code-pre" id="pre-HGwS88"><code-line class="line-numbers-rows"></code-line>#include&lt;windows.h&gt;<span style="color: rgba(0, 0, 0, 1)">
<code-line class="line-numbers-rows"></code-line>#include</span>&lt;stdio.h&gt;
<code-line class="line-numbers-rows"></code-line>
<code-line class="line-numbers-rows"></code-line><span style="color: rgba(0, 0, 255, 1)">int</span> FuncA(<span style="color: rgba(0, 0, 255, 1)">int</span> a, <span style="color: rgba(0, 0, 255, 1)">int</span><span style="color: rgba(0, 0, 0, 1)"> b)
<code-line class="line-numbers-rows"></code-line>{
<code-line class="line-numbers-rows"></code-line>    puts(</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">AAAA</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">);
<code-line class="line-numbers-rows"></code-line>    </span><span style="color: rgba(0, 0, 255, 1)">return</span> a +<span style="color: rgba(0, 0, 0, 1)"> b;
<code-line class="line-numbers-rows"></code-line>}
<code-line class="line-numbers-rows"></code-line>
<code-line class="line-numbers-rows"></code-line></span><span style="color: rgba(0, 0, 255, 1)">int</span> FuncB(<span style="color: rgba(0, 0, 255, 1)">int</span> a, <span style="color: rgba(0, 0, 255, 1)">int</span><span style="color: rgba(0, 0, 0, 1)"> b)
<code-line class="line-numbers-rows"></code-line>{
<code-line class="line-numbers-rows"></code-line>    puts(</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">BBB</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">);
<code-line class="line-numbers-rows"></code-line>    </span><span style="color: rgba(0, 0, 255, 1)">return</span> a +<span style="color: rgba(0, 0, 0, 1)"> b;
<code-line class="line-numbers-rows"></code-line>}
<code-line class="line-numbers-rows"></code-line></span><span style="color: rgba(0, 0, 255, 1)">int</span><span style="color: rgba(0, 0, 0, 1)"> main()
<code-line class="line-numbers-rows"></code-line>{
<code-line class="line-numbers-rows"></code-line>    FuncA(</span><span style="color: rgba(128, 0, 128, 1)">1</span>, <span style="color: rgba(128, 0, 128, 1)">2</span><span style="color: rgba(0, 0, 0, 1)">);
<code-line class="line-numbers-rows"></code-line>    FuncB(</span><span style="color: rgba(128, 0, 128, 1)">2</span>, <span style="color: rgba(128, 0, 128, 1)">3</span><span style="color: rgba(0, 0, 0, 1)">);
<code-line class="line-numbers-rows"></code-line>    </span><span style="color: rgba(0, 0, 255, 1)">return</span> <span style="color: rgba(128, 0, 128, 1)">0</span><span style="color: rgba(0, 0, 0, 1)">;
<code-line class="line-numbers-rows"></code-line>}</span></code-pre></pre>
</div>
<p>&nbsp;</p>
<p>　　结果：在IDA中看到生成的exe文件中的函数顺序为FuncA,FuncB,main,与函数实现的先后顺序有关。通过函数的位置，可以得到两个函数之间的空间大小。</p>
<p>　　2.多文件函数生成的位置规律</p>
<p>　　　　规律：与包含文件的位置无关，与实际调用的顺序有关</p>
<div class="cnblogs_code">
<pre style="font-family: &quot;Ubuntu Mono&quot;, monospace !important; font-size: 14px !important; background-color: rgb(246, 248, 250); overflow-x: auto;"><code-pre class="code-pre" id="pre-8BXNCG"><code-line class="line-numbers-rows"></code-line>  <span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)">A.h</span><span style="color: rgba(0, 0, 0, 1)">
<code-line class="line-numbers-rows"></code-line>#include</span>&lt;stdio.h&gt;
<code-line class="line-numbers-rows"></code-line><span style="color: rgba(0, 0, 255, 1)">void</span><span style="color: rgba(0, 0, 0, 1)"> A()
<code-line class="line-numbers-rows"></code-line>{
<code-line class="line-numbers-rows"></code-line>　　puts(</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">AAA</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">)；
<code-line class="line-numbers-rows"></code-line>}
<code-line class="line-numbers-rows"></code-line>
<code-line class="line-numbers-rows"></code-line></span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)">B.h</span><span style="color: rgba(0, 0, 0, 1)">
<code-line class="line-numbers-rows"></code-line>#include</span>&lt;stdio.h&gt;
<code-line class="line-numbers-rows"></code-line><span style="color: rgba(0, 0, 255, 1)">void</span><span style="color: rgba(0, 0, 0, 1)"> B()
<code-line class="line-numbers-rows"></code-line>{
<code-line class="line-numbers-rows"></code-line>　　puts(</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">BBB</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">)；
<code-line class="line-numbers-rows"></code-line>}
<code-line class="line-numbers-rows"></code-line>
<code-line class="line-numbers-rows"></code-line></span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)">main</span><span style="color: rgba(0, 0, 0, 1)">
<code-line class="line-numbers-rows"></code-line>#include</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">A.h</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">
<code-line class="line-numbers-rows"></code-line>#include</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">B.h</span><span style="color: rgba(128, 0, 0, 1)">"</span>
<code-line class="line-numbers-rows"></code-line><span style="color: rgba(0, 0, 255, 1)">int</span><span style="color: rgba(0, 0, 0, 1)"> main()
<code-line class="line-numbers-rows"></code-line>
<code-line class="line-numbers-rows"></code-line>{ <br>　 A();
<code-line class="line-numbers-rows"></code-line>  B();
<code-line class="line-numbers-rows"></code-line></span><span style="color: rgba(0, 0, 255, 1)">  return</span> <span style="color: rgba(128, 0, 128, 1)">0</span><span style="color: rgba(0, 0, 0, 1)">;
<code-line class="line-numbers-rows"></code-line>}</span></code-pre></pre>
</div>
<p>&nbsp;</p>
<p>　　结果：</p>
<p>&nbsp;　　<a data-fancybox="gallery" href="https://img2020.cnblogs.com/blog/1721319/202003/1721319-20200331230844018-1995164818.png"><img src="https://img2020.cnblogs.com/blog/1721319/202003/1721319-20200331230844018-1995164818.png" alt=""></a></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>　　工程下的后缀名为vcxproj文件</p>
<p>　　&nbsp;<a data-fancybox="gallery" href="https://img2020.cnblogs.com/blog/1721319/202003/1721319-20200331230853411-1559824835.png"><img src="https://img2020.cnblogs.com/blog/1721319/202003/1721319-20200331230853411-1559824835.png" alt=""></a></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>　　修改顺序</p>
<p>　　&nbsp;<a data-fancybox="gallery" href="https://img2020.cnblogs.com/blog/1721319/202003/1721319-20200331230901010-1051177212.png"><img src="https://img2020.cnblogs.com/blog/1721319/202003/1721319-20200331230901010-1051177212.png" alt=""></a></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>　　可以看到生成的顺序发生了改变</p>
<p>　　<a data-fancybox="gallery" href="https://img2020.cnblogs.com/blog/1721319/202003/1721319-20200331230949500-1853777578.png"><img src="https://img2020.cnblogs.com/blog/1721319/202003/1721319-20200331230949500-1853777578.png" alt=""></a></p>
<h2>Shellcode框架（二）<button class="cnblogs-toc-button" title="显示目录导航" aria-expanded="false"></button></h2>
<p>　　Shellcode代码执行过程</p>
<p>　　ShellcodeStart-&gt; ShellcodeEntry-&gt; ShellcodeEnd</p>
<p>&nbsp;　　工程文件:</p>
<p>　　api.h文件：存放定义的的函数</p>
<p>　　header.h文件：存放定义的功能函数</p>
<p>　　0.entry.cpp文件：shellcode的入口点</p>
<p>　　a.start.cpp文件：shellcode执行（实现逻辑功能）</p>
<p>　　b.work.cpp文件：存放具体功能实现</p>
<p>　　z.end.cpp文件：shellcode结束</p>
<p>&nbsp;</p>
<p>　　a.start.cpp文件和b.work.cpp文件分别管理逻辑功能和具体实现，更方便管理。</p>
<p>　　生成的文件顺序：</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;　　<a data-fancybox="gallery" href="https://img2020.cnblogs.com/blog/1721319/202003/1721319-20200331231310818-1979354346.png"><img src="https://img2020.cnblogs.com/blog/1721319/202003/1721319-20200331231310818-1979354346.png" alt=""></a></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;　　代码：</p>
<p>　　api.h</p>
<div class="cnblogs_code">
<pre style="font-family: &quot;Ubuntu Mono&quot;, monospace !important; font-size: 14px !important; background-color: rgb(246, 248, 250); overflow-x: auto;"><code-pre class="code-pre" id="pre-XWAXd2"><code-line class="line-numbers-rows"></code-line><span style="color: rgba(0, 0, 255, 1)">#pragma</span> once<span style="color: rgba(0, 0, 0, 1)">
<code-line class="line-numbers-rows"></code-line>
<code-line class="line-numbers-rows"></code-line>#include</span>&lt;windows.h&gt;
<code-line class="line-numbers-rows"></code-line>
<code-line class="line-numbers-rows"></code-line><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)">声明定义GetProcAddress</span>
<code-line class="line-numbers-rows"></code-line>typedef FARPROC(WINAPI *<span style="color: rgba(0, 0, 0, 1)">FN_GetProcAddress)(
<code-line class="line-numbers-rows"></code-line>    _In_ HMODULE hModule,
<code-line class="line-numbers-rows"></code-line>    _In_ LPCSTR lpProcName
<code-line class="line-numbers-rows"></code-line>    );
<code-line class="line-numbers-rows"></code-line></span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)">定义LoadLibraryA</span>
<code-line class="line-numbers-rows"></code-line>typedef HMODULE(WINAPI *<span style="color: rgba(0, 0, 0, 1)">FN_LoadLibraryA)(
<code-line class="line-numbers-rows"></code-line>    __in LPCSTR lpLibFileName
<code-line class="line-numbers-rows"></code-line>    );
<code-line class="line-numbers-rows"></code-line>
<code-line class="line-numbers-rows"></code-line></span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)">定义MessageBoxA</span>
<code-line class="line-numbers-rows"></code-line>typedef <span style="color: rgba(0, 0, 255, 1)">int</span> (WINAPI *<span style="color: rgba(0, 0, 0, 1)">FN_MessageBoxA)(
<code-line class="line-numbers-rows"></code-line>    __in_opt HWND hWnd,
<code-line class="line-numbers-rows"></code-line>    __in_opt LPCSTR lpText,
<code-line class="line-numbers-rows"></code-line>    __in_opt LPCSTR lpCaption,
<code-line class="line-numbers-rows"></code-line>    __in UINT uType);
<code-line class="line-numbers-rows"></code-line>
<code-line class="line-numbers-rows"></code-line></span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)">定义CreateFileA</span>
<code-line class="line-numbers-rows"></code-line>typedef HANDLE(WINAPI *<span style="color: rgba(0, 0, 0, 1)">FN_CreateFileA)(
<code-line class="line-numbers-rows"></code-line>    __in     LPCSTR lpFileName,
<code-line class="line-numbers-rows"></code-line>    __in     DWORD dwDesiredAccess,
<code-line class="line-numbers-rows"></code-line>    __in     DWORD dwShareMode,
<code-line class="line-numbers-rows"></code-line>    __in_opt LPSECURITY_ATTRIBUTES lpSecurityAttributes,
<code-line class="line-numbers-rows"></code-line>    __in     DWORD dwCreationDisposition,
<code-line class="line-numbers-rows"></code-line>    __in     DWORD dwFlagsAndAttributes,
<code-line class="line-numbers-rows"></code-line>    __in_opt HANDLE hTemplateFile
<code-line class="line-numbers-rows"></code-line>    );
<code-line class="line-numbers-rows"></code-line>
<code-line class="line-numbers-rows"></code-line></span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)">定义一个指针</span>
<code-line class="line-numbers-rows"></code-line>typedef <span style="color: rgba(0, 0, 255, 1)">struct</span><span style="color: rgba(0, 0, 0, 1)"> _FUNCTIONS
<code-line class="line-numbers-rows"></code-line>{
<code-line class="line-numbers-rows"></code-line>    FN_GetProcAddress fn_GetProcAddress;
<code-line class="line-numbers-rows"></code-line>    FN_LoadLibraryA fn_LoadLibraryA;
<code-line class="line-numbers-rows"></code-line>    FN_MessageBoxA fn_MessageBoxA;
<code-line class="line-numbers-rows"></code-line>    FN_CreateFileA fn_CreateFileA;
<code-line class="line-numbers-rows"></code-line>}FUNCTIONS,</span>*PFUNCTIONS;</code-pre></pre>
</div>
<p>　　header.h</p>
<div class="cnblogs_code">
<pre style="font-family: &quot;Ubuntu Mono&quot;, monospace !important; font-size: 14px !important; background-color: rgb(246, 248, 250); overflow-x: auto;"><code-pre class="code-pre" id="pre-ahNN2s"><code-line class="line-numbers-rows"></code-line><span style="color: rgba(0, 0, 255, 1)">#pragma</span> once<span style="color: rgba(0, 0, 0, 1)">
<code-line class="line-numbers-rows"></code-line>#include</span>&lt;windows.h&gt;<span style="color: rgba(0, 0, 0, 1)">
<code-line class="line-numbers-rows"></code-line>#include</span>&lt;stdio.h&gt;<span style="color: rgba(0, 0, 0, 1)">
<code-line class="line-numbers-rows"></code-line>#include</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">api.h</span><span style="color: rgba(128, 0, 0, 1)">"</span>
<code-line class="line-numbers-rows"></code-line><span style="color: rgba(0, 0, 255, 1)">void</span><span style="color: rgba(0, 0, 0, 1)"> ShellcodeStart();
<code-line class="line-numbers-rows"></code-line></span><span style="color: rgba(0, 0, 255, 1)">void</span><span style="color: rgba(0, 0, 0, 1)"> ShellcodeEntry();
<code-line class="line-numbers-rows"></code-line></span><span style="color: rgba(0, 0, 255, 1)">void</span><span style="color: rgba(0, 0, 0, 1)"> ShellcodeEnd();
<code-line class="line-numbers-rows"></code-line></span><span style="color: rgba(0, 0, 255, 1)">void</span><span style="color: rgba(0, 0, 0, 1)"> CreateShellcode();
<code-line class="line-numbers-rows"></code-line></span><span style="color: rgba(0, 0, 255, 1)">void</span><span style="color: rgba(0, 0, 0, 1)"> InitFunctions(PFUNCTIONS pFn);
<code-line class="line-numbers-rows"></code-line></span><span style="color: rgba(0, 0, 255, 1)">void</span> CreateConfigFile(PFUNCTIONS pFn);</code-pre></pre>
</div>
<p>　　</p>
<p>　　0.entry.cpp</p>
<p>　　</p>
<div class="cnblogs_code">
<pre style="font-family: &quot;Ubuntu Mono&quot;, monospace !important; font-size: 14px !important; background-color: rgb(246, 248, 250); overflow-x: auto;"><code-pre class="code-pre" id="pre-YsZEWZ"><code-line class="line-numbers-rows"></code-line>#include <span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">header.h</span><span style="color: rgba(128, 0, 0, 1)">"</span>
<code-line class="line-numbers-rows"></code-line><span style="color: rgba(0, 0, 255, 1)">int</span><span style="color: rgba(0, 0, 0, 1)"> EntryMain()
<code-line class="line-numbers-rows"></code-line>{
<code-line class="line-numbers-rows"></code-line>    CreateShellcode();
<code-line class="line-numbers-rows"></code-line>
<code-line class="line-numbers-rows"></code-line>    </span><span style="color: rgba(0, 0, 255, 1)">return</span> <span style="color: rgba(128, 0, 128, 1)">0</span><span style="color: rgba(0, 0, 0, 1)">;
<code-line class="line-numbers-rows"></code-line>}
<code-line class="line-numbers-rows"></code-line>
<code-line class="line-numbers-rows"></code-line></span><span style="color: rgba(0, 0, 255, 1)">void</span><span style="color: rgba(0, 0, 0, 1)"> CreateShellcode() 
<code-line class="line-numbers-rows"></code-line>{
<code-line class="line-numbers-rows"></code-line>
<code-line class="line-numbers-rows"></code-line>    HMODULE hMsvcrt </span>= LoadLibraryA(<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">msvcrt.dll</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">);
<code-line class="line-numbers-rows"></code-line>    </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)">定义printf</span>
<code-line class="line-numbers-rows"></code-line>    typedef <span style="color: rgba(0, 0, 255, 1)">int</span> (__CRTDECL *<span style="color: rgba(0, 0, 0, 1)">FN_printf)(
<code-line class="line-numbers-rows"></code-line>        _In_z_ _Printf_format_string_ </span><span style="color: rgba(0, 0, 255, 1)">char</span> <span style="color: rgba(0, 0, 255, 1)">const</span>* <span style="color: rgba(0, 0, 255, 1)">const</span><span style="color: rgba(0, 0, 0, 1)"> _Format,
<code-line class="line-numbers-rows"></code-line>        ...);
<code-line class="line-numbers-rows"></code-line>    FN_printf fn_printf </span>= (FN_printf)GetProcAddress(hMsvcrt,<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">printf</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">);
<code-line class="line-numbers-rows"></code-line>
<code-line class="line-numbers-rows"></code-line>    HANDLE hBin </span>= CreateFileA(<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">sh.bin</span><span style="color: rgba(128, 0, 0, 1)">"</span>, GENERIC_ALL, <span style="color: rgba(128, 0, 128, 1)">0</span>, NULL, CREATE_ALWAYS, <span style="color: rgba(128, 0, 128, 1)">0</span><span style="color: rgba(0, 0, 0, 1)">, NULL);
<code-line class="line-numbers-rows"></code-line>
<code-line class="line-numbers-rows"></code-line>    </span><span style="color: rgba(0, 0, 255, 1)">if</span> (hBin ==<span style="color: rgba(0, 0, 0, 1)"> INVALID_HANDLE_VALUE)
<code-line class="line-numbers-rows"></code-line>    {
<code-line class="line-numbers-rows"></code-line>
<code-line class="line-numbers-rows"></code-line>        </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)">这里不能使用printf函数，因为修改了函数入口，找不到printf的地址，所有需要动态调用printf函数
<code-line class="line-numbers-rows"></code-line>        </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)">printf("create file error:%d\n", GetLastError());</span>
<code-line class="line-numbers-rows"></code-line>        fn_printf(<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">create file error:%d\n</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">, GetLastError());
<code-line class="line-numbers-rows"></code-line>        </span><span style="color: rgba(0, 0, 255, 1)">return</span><span style="color: rgba(0, 0, 0, 1)"> ;
<code-line class="line-numbers-rows"></code-line>    }
<code-line class="line-numbers-rows"></code-line>    DWORD dwSize </span>= (DWORD)ShellcodeEnd -<span style="color: rgba(0, 0, 0, 1)"> (DWORD)ShellcodeStart;
<code-line class="line-numbers-rows"></code-line>    DWORD dwWrite;
<code-line class="line-numbers-rows"></code-line>    WriteFile(hBin, ShellcodeStart, dwSize, </span>&amp;<span style="color: rgba(0, 0, 0, 1)">dwWrite, NULL);
<code-line class="line-numbers-rows"></code-line>    CloseHandle(hBin);
<code-line class="line-numbers-rows"></code-line>
<code-line class="line-numbers-rows"></code-line>}</span></code-pre></pre>
</div>
<p>　a.start.cpp文件</p>
<div class="cnblogs_code">
<pre style="font-family: &quot;Ubuntu Mono&quot;, monospace !important; font-size: 14px !important; background-color: rgb(246, 248, 250); overflow-x: auto;"><code-pre class="code-pre" id="pre-yhCAde"><code-line class="line-numbers-rows"></code-line>#include <span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">header.h</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">
<code-line class="line-numbers-rows"></code-line>#include </span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">api.h</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">
<code-line class="line-numbers-rows"></code-line>__declspec(naked) </span><span style="color: rgba(0, 0, 255, 1)">void</span><span style="color: rgba(0, 0, 0, 1)"> ShellcodeStart()
<code-line class="line-numbers-rows"></code-line>{
<code-line class="line-numbers-rows"></code-line>    __asm 
<code-line class="line-numbers-rows"></code-line>    {
<code-line class="line-numbers-rows"></code-line>        jmp ShellcodeEntry
<code-line class="line-numbers-rows"></code-line>    }
<code-line class="line-numbers-rows"></code-line>}
<code-line class="line-numbers-rows"></code-line></span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)">内嵌汇编获取Kernel32的地址</span>
<code-line class="line-numbers-rows"></code-line><span style="color: rgba(0, 0, 0, 1)">__declspec(naked) DWORD getKernel32()
<code-line class="line-numbers-rows"></code-line>{
<code-line class="line-numbers-rows"></code-line>    __asm
<code-line class="line-numbers-rows"></code-line>    {
<code-line class="line-numbers-rows"></code-line>        mov eax, fs:[30h];
<code-line class="line-numbers-rows"></code-line>        test eax, eax;
<code-line class="line-numbers-rows"></code-line>        js finished;
<code-line class="line-numbers-rows"></code-line>        mov eax, [eax </span>+<span style="color: rgba(0, 0, 0, 1)"> 0ch];
<code-line class="line-numbers-rows"></code-line>        mov eax, [eax </span>+<span style="color: rgba(0, 0, 0, 1)"> 14h];
<code-line class="line-numbers-rows"></code-line>        mov eax, [eax];
<code-line class="line-numbers-rows"></code-line>        mov eax, [eax]
<code-line class="line-numbers-rows"></code-line>        mov eax, [eax </span>+<span style="color: rgba(0, 0, 0, 1)"> 10h]
<code-line class="line-numbers-rows"></code-line>    finished:
<code-line class="line-numbers-rows"></code-line>        ret
<code-line class="line-numbers-rows"></code-line>    }
<code-line class="line-numbers-rows"></code-line>}
<code-line class="line-numbers-rows"></code-line>
<code-line class="line-numbers-rows"></code-line></span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)">获取GetProcAddress的地址</span>
<code-line class="line-numbers-rows"></code-line><span style="color: rgba(0, 0, 0, 1)">FARPROC getProcAddress(HMODULE hModuleBase)
<code-line class="line-numbers-rows"></code-line>{
<code-line class="line-numbers-rows"></code-line>    PIMAGE_DOS_HEADER lpDosHeader </span>=<span style="color: rgba(0, 0, 0, 1)"> (PIMAGE_DOS_HEADER)hModuleBase;
<code-line class="line-numbers-rows"></code-line>    PIMAGE_NT_HEADERS32 lpNtHeader </span>= (PIMAGE_NT_HEADERS)((DWORD)hModuleBase + lpDosHeader-&gt;<span style="color: rgba(0, 0, 0, 1)">e_lfanew);
<code-line class="line-numbers-rows"></code-line>    </span><span style="color: rgba(0, 0, 255, 1)">if</span> (!lpNtHeader-&gt;<span style="color: rgba(0, 0, 0, 1)">OptionalHeader.DataDirectory[IMAGE_DIRECTORY_ENTRY_EXPORT].Size) {
<code-line class="line-numbers-rows"></code-line>        </span><span style="color: rgba(0, 0, 255, 1)">return</span><span style="color: rgba(0, 0, 0, 1)"> NULL;
<code-line class="line-numbers-rows"></code-line>    }
<code-line class="line-numbers-rows"></code-line>    </span><span style="color: rgba(0, 0, 255, 1)">if</span> (!lpNtHeader-&gt;<span style="color: rgba(0, 0, 0, 1)">OptionalHeader.DataDirectory[IMAGE_DIRECTORY_ENTRY_EXPORT].VirtualAddress) {
<code-line class="line-numbers-rows"></code-line>        </span><span style="color: rgba(0, 0, 255, 1)">return</span><span style="color: rgba(0, 0, 0, 1)"> NULL;
<code-line class="line-numbers-rows"></code-line>    }
<code-line class="line-numbers-rows"></code-line>    PIMAGE_EXPORT_DIRECTORY lpExports </span>= (PIMAGE_EXPORT_DIRECTORY)((DWORD)hModuleBase + (DWORD)lpNtHeader-&gt;<span style="color: rgba(0, 0, 0, 1)">OptionalHeader.DataDirectory[IMAGE_DIRECTORY_ENTRY_EXPORT].VirtualAddress);
<code-line class="line-numbers-rows"></code-line>    PDWORD lpdwFunName </span>= (PDWORD)((DWORD)hModuleBase + (DWORD)lpExports-&gt;<span style="color: rgba(0, 0, 0, 1)">AddressOfNames);
<code-line class="line-numbers-rows"></code-line>    PWORD lpword </span>= (PWORD)((DWORD)hModuleBase + (DWORD)lpExports-&gt;<span style="color: rgba(0, 0, 0, 1)">AddressOfNameOrdinals);
<code-line class="line-numbers-rows"></code-line>    PDWORD lpdwFunAddr </span>= (PDWORD)((DWORD)hModuleBase + (DWORD)lpExports-&gt;<span style="color: rgba(0, 0, 0, 1)">AddressOfFunctions);
<code-line class="line-numbers-rows"></code-line>
<code-line class="line-numbers-rows"></code-line>    DWORD dwLoop </span>= <span style="color: rgba(128, 0, 128, 1)">0</span><span style="color: rgba(0, 0, 0, 1)">;
<code-line class="line-numbers-rows"></code-line>    FARPROC pRet </span>=<span style="color: rgba(0, 0, 0, 1)"> NULL;
<code-line class="line-numbers-rows"></code-line>    </span><span style="color: rgba(0, 0, 255, 1)">for</span> (; dwLoop &lt;= lpExports-&gt;NumberOfNames - <span style="color: rgba(128, 0, 128, 1)">1</span>; dwLoop++<span style="color: rgba(0, 0, 0, 1)">) {
<code-line class="line-numbers-rows"></code-line>        </span><span style="color: rgba(0, 0, 255, 1)">char</span>* pFunName = (<span style="color: rgba(0, 0, 255, 1)">char</span>*)(lpdwFunName[dwLoop] +<span style="color: rgba(0, 0, 0, 1)"> (DWORD)hModuleBase);
<code-line class="line-numbers-rows"></code-line>
<code-line class="line-numbers-rows"></code-line>
<code-line class="line-numbers-rows"></code-line>        </span><span style="color: rgba(0, 0, 255, 1)">if</span> (pFunName[<span style="color: rgba(128, 0, 128, 1)">0</span>] == <span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">G</span><span style="color: rgba(128, 0, 0, 1)">'</span>&amp;&amp;<span style="color: rgba(0, 0, 0, 1)">
<code-line class="line-numbers-rows"></code-line>            pFunName[</span><span style="color: rgba(128, 0, 128, 1)">1</span>] == <span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">e</span><span style="color: rgba(128, 0, 0, 1)">'</span>&amp;&amp;<span style="color: rgba(0, 0, 0, 1)">
<code-line class="line-numbers-rows"></code-line>            pFunName[</span><span style="color: rgba(128, 0, 128, 1)">2</span>] == <span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">t</span><span style="color: rgba(128, 0, 0, 1)">'</span>&amp;&amp;<span style="color: rgba(0, 0, 0, 1)">
<code-line class="line-numbers-rows"></code-line>            pFunName[</span><span style="color: rgba(128, 0, 128, 1)">3</span>] == <span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">P</span><span style="color: rgba(128, 0, 0, 1)">'</span>&amp;&amp;<span style="color: rgba(0, 0, 0, 1)">
<code-line class="line-numbers-rows"></code-line>            pFunName[</span><span style="color: rgba(128, 0, 128, 1)">4</span>] == <span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">r</span><span style="color: rgba(128, 0, 0, 1)">'</span>&amp;&amp;<span style="color: rgba(0, 0, 0, 1)">
<code-line class="line-numbers-rows"></code-line>            pFunName[</span><span style="color: rgba(128, 0, 128, 1)">5</span>] == <span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">o</span><span style="color: rgba(128, 0, 0, 1)">'</span>&amp;&amp;<span style="color: rgba(0, 0, 0, 1)">
<code-line class="line-numbers-rows"></code-line>            pFunName[</span><span style="color: rgba(128, 0, 128, 1)">6</span>] == <span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">c</span><span style="color: rgba(128, 0, 0, 1)">'</span>&amp;&amp;<span style="color: rgba(0, 0, 0, 1)">
<code-line class="line-numbers-rows"></code-line>            pFunName[</span><span style="color: rgba(128, 0, 128, 1)">7</span>] == <span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">A</span><span style="color: rgba(128, 0, 0, 1)">'</span>&amp;&amp;<span style="color: rgba(0, 0, 0, 1)">
<code-line class="line-numbers-rows"></code-line>            pFunName[</span><span style="color: rgba(128, 0, 128, 1)">8</span>] == <span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">d</span><span style="color: rgba(128, 0, 0, 1)">'</span>&amp;&amp;<span style="color: rgba(0, 0, 0, 1)">
<code-line class="line-numbers-rows"></code-line>            pFunName[</span><span style="color: rgba(128, 0, 128, 1)">9</span>] == <span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">d</span><span style="color: rgba(128, 0, 0, 1)">'</span>&amp;&amp;<span style="color: rgba(0, 0, 0, 1)">
<code-line class="line-numbers-rows"></code-line>            pFunName[</span><span style="color: rgba(128, 0, 128, 1)">10</span>] == <span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">r</span><span style="color: rgba(128, 0, 0, 1)">'</span>&amp;&amp;<span style="color: rgba(0, 0, 0, 1)">
<code-line class="line-numbers-rows"></code-line>            pFunName[</span><span style="color: rgba(128, 0, 128, 1)">11</span>] == <span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">e</span><span style="color: rgba(128, 0, 0, 1)">'</span>&amp;&amp;<span style="color: rgba(0, 0, 0, 1)">
<code-line class="line-numbers-rows"></code-line>            pFunName[</span><span style="color: rgba(128, 0, 128, 1)">12</span>] == <span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">s</span><span style="color: rgba(128, 0, 0, 1)">'</span>&amp;&amp;<span style="color: rgba(0, 0, 0, 1)">
<code-line class="line-numbers-rows"></code-line>            pFunName[</span><span style="color: rgba(128, 0, 128, 1)">13</span>] == <span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">s</span><span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(0, 0, 0, 1)">)
<code-line class="line-numbers-rows"></code-line>        {
<code-line class="line-numbers-rows"></code-line>            pRet </span>= (FARPROC)(lpdwFunAddr[lpword[dwLoop]] +<span style="color: rgba(0, 0, 0, 1)"> (DWORD)hModuleBase);
<code-line class="line-numbers-rows"></code-line>            </span><span style="color: rgba(0, 0, 255, 1)">break</span><span style="color: rgba(0, 0, 0, 1)">;
<code-line class="line-numbers-rows"></code-line>        }
<code-line class="line-numbers-rows"></code-line>    }
<code-line class="line-numbers-rows"></code-line>    </span><span style="color: rgba(0, 0, 255, 1)">return</span><span style="color: rgba(0, 0, 0, 1)"> pRet;
<code-line class="line-numbers-rows"></code-line>}
<code-line class="line-numbers-rows"></code-line></span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)">动态调用地址</span>
<code-line class="line-numbers-rows"></code-line><span style="color: rgba(0, 0, 255, 1)">void</span><span style="color: rgba(0, 0, 0, 1)"> InitFunctions(PFUNCTIONS pFn) 
<code-line class="line-numbers-rows"></code-line>{
<code-line class="line-numbers-rows"></code-line>    </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)">获取GetProcAddress真实地址</span>
<code-line class="line-numbers-rows"></code-line>    pFn-&gt;fn_GetProcAddress =<span style="color: rgba(0, 0, 0, 1)"> (FN_GetProcAddress)getProcAddress((HMODULE)getKernel32());
<code-line class="line-numbers-rows"></code-line>    </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)">动态获取LoadLibraryA的地址</span>
<code-line class="line-numbers-rows"></code-line>    <span style="color: rgba(0, 0, 255, 1)">char</span> xyLoadLibraryA[] = { <span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">L</span><span style="color: rgba(128, 0, 0, 1)">'</span>,<span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">o</span><span style="color: rgba(128, 0, 0, 1)">'</span>,<span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">a</span><span style="color: rgba(128, 0, 0, 1)">'</span>,<span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">d</span><span style="color: rgba(128, 0, 0, 1)">'</span>,<span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">L</span><span style="color: rgba(128, 0, 0, 1)">'</span>,<span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">i</span><span style="color: rgba(128, 0, 0, 1)">'</span>,<span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">b</span><span style="color: rgba(128, 0, 0, 1)">'</span>,<span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">r</span><span style="color: rgba(128, 0, 0, 1)">'</span>,<span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">a</span><span style="color: rgba(128, 0, 0, 1)">'</span>,<span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">r</span><span style="color: rgba(128, 0, 0, 1)">'</span>,<span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">y</span><span style="color: rgba(128, 0, 0, 1)">'</span>,<span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">A</span><span style="color: rgba(128, 0, 0, 1)">'</span>,<span style="color: rgba(128, 0, 128, 1)">0</span><span style="color: rgba(0, 0, 0, 1)"> };
<code-line class="line-numbers-rows"></code-line>    pFn</span>-&gt;fn_LoadLibraryA = (FN_LoadLibraryA)pFn-&gt;<span style="color: rgba(0, 0, 0, 1)">fn_GetProcAddress((HMODULE)getKernel32(), xyLoadLibraryA);
<code-line class="line-numbers-rows"></code-line>    
<code-line class="line-numbers-rows"></code-line>    </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)">动态获取MessageBoxA的地址</span>
<code-line class="line-numbers-rows"></code-line>    <span style="color: rgba(0, 0, 255, 1)">char</span> xy_user32[] = { <span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">u</span><span style="color: rgba(128, 0, 0, 1)">'</span>,<span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">s</span><span style="color: rgba(128, 0, 0, 1)">'</span>,<span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">e</span><span style="color: rgba(128, 0, 0, 1)">'</span>,<span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">r</span><span style="color: rgba(128, 0, 0, 1)">'</span>,<span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">3</span><span style="color: rgba(128, 0, 0, 1)">'</span>,<span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">2</span><span style="color: rgba(128, 0, 0, 1)">'</span>,<span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">.</span><span style="color: rgba(128, 0, 0, 1)">'</span>,<span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">d</span><span style="color: rgba(128, 0, 0, 1)">'</span>,<span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">l</span><span style="color: rgba(128, 0, 0, 1)">'</span>,<span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">l</span><span style="color: rgba(128, 0, 0, 1)">'</span>,<span style="color: rgba(128, 0, 128, 1)">0</span><span style="color: rgba(0, 0, 0, 1)"> };
<code-line class="line-numbers-rows"></code-line>    </span><span style="color: rgba(0, 0, 255, 1)">char</span> xy_MessageBoxA[] = { <span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">M</span><span style="color: rgba(128, 0, 0, 1)">'</span>,<span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">e</span><span style="color: rgba(128, 0, 0, 1)">'</span>,<span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">s</span><span style="color: rgba(128, 0, 0, 1)">'</span>,<span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">s</span><span style="color: rgba(128, 0, 0, 1)">'</span>,<span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">a</span><span style="color: rgba(128, 0, 0, 1)">'</span>,<span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">g</span><span style="color: rgba(128, 0, 0, 1)">'</span>,<span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">e</span><span style="color: rgba(128, 0, 0, 1)">'</span>,<span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">B</span><span style="color: rgba(128, 0, 0, 1)">'</span>,<span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">o</span><span style="color: rgba(128, 0, 0, 1)">'</span>,<span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">x</span><span style="color: rgba(128, 0, 0, 1)">'</span>,<span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">A</span><span style="color: rgba(128, 0, 0, 1)">'</span>,<span style="color: rgba(128, 0, 128, 1)">0</span><span style="color: rgba(0, 0, 0, 1)"> };
<code-line class="line-numbers-rows"></code-line>    pFn</span>-&gt;fn_MessageBoxA = (FN_MessageBoxA)pFn-&gt;fn_GetProcAddress(pFn-&gt;<span style="color: rgba(0, 0, 0, 1)">fn_LoadLibraryA(xy_user32), xy_MessageBoxA);
<code-line class="line-numbers-rows"></code-line>
<code-line class="line-numbers-rows"></code-line>    </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)">动态获取CreateFile的地址</span>
<code-line class="line-numbers-rows"></code-line>    <span style="color: rgba(0, 0, 255, 1)">char</span> xyCreateFile[] = { <span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">C</span><span style="color: rgba(128, 0, 0, 1)">'</span>,<span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">r</span><span style="color: rgba(128, 0, 0, 1)">'</span>,<span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">e</span><span style="color: rgba(128, 0, 0, 1)">'</span>,<span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">a</span><span style="color: rgba(128, 0, 0, 1)">'</span>,<span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">t</span><span style="color: rgba(128, 0, 0, 1)">'</span>,<span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">F</span><span style="color: rgba(128, 0, 0, 1)">'</span>,<span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">i</span><span style="color: rgba(128, 0, 0, 1)">'</span>,<span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">l</span><span style="color: rgba(128, 0, 0, 1)">'</span>,<span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">e</span><span style="color: rgba(128, 0, 0, 1)">'</span>,<span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">A</span><span style="color: rgba(128, 0, 0, 1)">'</span>,<span style="color: rgba(128, 0, 128, 1)">0</span><span style="color: rgba(0, 0, 0, 1)"> };
<code-line class="line-numbers-rows"></code-line>    pFn</span>-&gt;fn_CreateFileA = (FN_CreateFileA)pFn-&gt;<span style="color: rgba(0, 0, 0, 1)">fn_GetProcAddress((HMODULE)getKernel32(), xyCreateFile);
<code-line class="line-numbers-rows"></code-line>
<code-line class="line-numbers-rows"></code-line>}
<code-line class="line-numbers-rows"></code-line></span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)">入口点</span>
<code-line class="line-numbers-rows"></code-line><span style="color: rgba(0, 0, 255, 1)">void</span><span style="color: rgba(0, 0, 0, 1)"> ShellcodeEntry()
<code-line class="line-numbers-rows"></code-line>{
<code-line class="line-numbers-rows"></code-line>    </span><span style="color: rgba(0, 0, 255, 1)">char</span> xy_Hello[] = { <span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">H</span><span style="color: rgba(128, 0, 0, 1)">'</span>,<span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">e</span><span style="color: rgba(128, 0, 0, 1)">'</span>,<span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">l</span><span style="color: rgba(128, 0, 0, 1)">'</span>,<span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">l</span><span style="color: rgba(128, 0, 0, 1)">'</span>,<span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">o</span><span style="color: rgba(128, 0, 0, 1)">'</span>,<span style="color: rgba(128, 0, 0, 1)">'</span> <span style="color: rgba(128, 0, 0, 1)">'</span>,<span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">w</span><span style="color: rgba(128, 0, 0, 1)">'</span>,<span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">o</span><span style="color: rgba(128, 0, 0, 1)">'</span>,<span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">r</span><span style="color: rgba(128, 0, 0, 1)">'</span>,<span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">l</span><span style="color: rgba(128, 0, 0, 1)">'</span>,<span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">d</span><span style="color: rgba(128, 0, 0, 1)">'</span>,<span style="color: rgba(128, 0, 128, 1)">0</span><span style="color: rgba(0, 0, 0, 1)"> };
<code-line class="line-numbers-rows"></code-line>    </span><span style="color: rgba(0, 0, 255, 1)">char</span> xy_tip[] = { <span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">t</span><span style="color: rgba(128, 0, 0, 1)">'</span>,<span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">i</span><span style="color: rgba(128, 0, 0, 1)">'</span>,<span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">p</span><span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(0, 0, 0, 1)"> };
<code-line class="line-numbers-rows"></code-line>    FUNCTIONS fn;
<code-line class="line-numbers-rows"></code-line>    InitFunctions(</span>&amp;<span style="color: rgba(0, 0, 0, 1)">fn);
<code-line class="line-numbers-rows"></code-line>    CreateConfigFile(</span>&amp;<span style="color: rgba(0, 0, 0, 1)">fn);
<code-line class="line-numbers-rows"></code-line>}</span></code-pre></pre>
</div>
<p>　　b.work.cpp</p>
<div class="cnblogs_code">
<pre style="font-family: &quot;Ubuntu Mono&quot;, monospace !important; font-size: 14px !important; background-color: rgb(246, 248, 250); overflow-x: auto;"><code-pre class="code-pre" id="pre-2PQtrS"><code-line class="line-numbers-rows"></code-line>#include<span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">api.h</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">
<code-line class="line-numbers-rows"></code-line>#include</span>&lt;stdio.h&gt;
<code-line class="line-numbers-rows"></code-line><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)">存放功能</span>
<code-line class="line-numbers-rows"></code-line><span style="color: rgba(0, 0, 255, 1)">void</span><span style="color: rgba(0, 0, 0, 1)"> CreateConfigFile(PFUNCTIONS pFn)
<code-line class="line-numbers-rows"></code-line>{
<code-line class="line-numbers-rows"></code-line>    </span><span style="color: rgba(0, 0, 255, 1)">char</span> xyNewFile[] = { <span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">1</span><span style="color: rgba(128, 0, 0, 1)">'</span>,<span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">.</span><span style="color: rgba(128, 0, 0, 1)">'</span>,<span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">t</span><span style="color: rgba(128, 0, 0, 1)">'</span>,<span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">x</span><span style="color: rgba(128, 0, 0, 1)">'</span>,<span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">t</span><span style="color: rgba(128, 0, 0, 1)">'</span>,<span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(128, 0, 0, 1)">\0</span><span style="color: rgba(128, 0, 0, 1)">'</span><span style="color: rgba(0, 0, 0, 1)"> };
<code-line class="line-numbers-rows"></code-line>    pFn</span>-&gt;fn_CreateFileA(xyNewFile, GENERIC_WRITE, <span style="color: rgba(128, 0, 128, 1)">0</span>, NULL, CREATE_ALWAYS, <span style="color: rgba(128, 0, 128, 1)">0</span><span style="color: rgba(0, 0, 0, 1)">, NULL);
<code-line class="line-numbers-rows"></code-line>}</span></code-pre></pre>
</div>
<p>　　z.end.cpp</p>
<div class="cnblogs_code">
<pre style="font-family: &quot;Ubuntu Mono&quot;, monospace !important; font-size: 14px !important; background-color: rgb(246, 248, 250); overflow-x: auto;"><code-pre class="code-pre" id="pre-RiwY4T"><code-line class="line-numbers-rows"></code-line>#include <span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">header.h</span><span style="color: rgba(128, 0, 0, 1)">"</span>
<code-line class="line-numbers-rows"></code-line><span style="color: rgba(0, 0, 255, 1)">void</span><span style="color: rgba(0, 0, 0, 1)"> ShellcodeEnd()
<code-line class="line-numbers-rows"></code-line>{
<code-line class="line-numbers-rows"></code-line>
<code-line class="line-numbers-rows"></code-line>}</span></code-pre></pre>
</div>
<h2>Shellcode加载器<button class="cnblogs-toc-button" title="显示目录导航" aria-expanded="false"></button></h2>
<p>用来运行提取出来的shellcode代码，保存在sh.bin文件，将sb.bin文件拖入加载器，即可执行。</p>
<div class="cnblogs_code">
<pre style="font-family: &quot;Ubuntu Mono&quot;, monospace !important; font-size: 14px !important; background-color: rgb(246, 248, 250); overflow-x: auto;"><code-pre class="code-pre" id="pre-WZDQn2"><code-line class="line-numbers-rows"></code-line>#include&lt;stdio.h&gt;<span style="color: rgba(0, 0, 0, 1)">
<code-line class="line-numbers-rows"></code-line>#include</span>&lt;windows.h&gt;
<code-line class="line-numbers-rows"></code-line><span style="color: rgba(0, 0, 255, 1)">int</span> main(<span style="color: rgba(0, 0, 255, 1)">int</span> argc,<span style="color: rgba(0, 0, 255, 1)">char</span>*<span style="color: rgba(0, 0, 0, 1)"> argv[])
<code-line class="line-numbers-rows"></code-line>{
<code-line class="line-numbers-rows"></code-line>    </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)">打开文件</span>
<code-line class="line-numbers-rows"></code-line>    HANDLE hFile = CreateFileA(argv[<span style="color: rgba(128, 0, 128, 1)">1</span>], GENERIC_READ, <span style="color: rgba(128, 0, 128, 1)">0</span>, NULL, OPEN_ALWAYS, <span style="color: rgba(128, 0, 128, 1)">0</span><span style="color: rgba(0, 0, 0, 1)">, NULL);
<code-line class="line-numbers-rows"></code-line>    </span><span style="color: rgba(0, 0, 255, 1)">if</span> (hFile ==<span style="color: rgba(0, 0, 0, 1)"> INVALID_HANDLE_VALUE)
<code-line class="line-numbers-rows"></code-line>    {
<code-line class="line-numbers-rows"></code-line>        printf(</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">Oen file error:%d\n</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">, GetLastError);
<code-line class="line-numbers-rows"></code-line>        </span><span style="color: rgba(0, 0, 255, 1)">return</span> -<span style="color: rgba(128, 0, 128, 1)">1</span><span style="color: rgba(0, 0, 0, 1)">;
<code-line class="line-numbers-rows"></code-line>    }
<code-line class="line-numbers-rows"></code-line>    DWORD dwSize;
<code-line class="line-numbers-rows"></code-line>    dwSize </span>=<span style="color: rgba(0, 0, 0, 1)"> GetFileSize(hFile, NULL);
<code-line class="line-numbers-rows"></code-line>
<code-line class="line-numbers-rows"></code-line>    LPVOID lpAddress </span>=<span style="color: rgba(0, 0, 0, 1)"> VirtualAlloc(NULL, dwSize, MEM_COMMIT, PAGE_EXECUTE_READWRITE);
<code-line class="line-numbers-rows"></code-line>    </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)">内存分配是否成功</span>
<code-line class="line-numbers-rows"></code-line>    <span style="color: rgba(0, 0, 255, 1)">if</span> (lpAddress ==<span style="color: rgba(0, 0, 0, 1)">NULL)
<code-line class="line-numbers-rows"></code-line>    {
<code-line class="line-numbers-rows"></code-line>        printf(</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">VirtualAlloc error:%d\n</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">, GetLastError);
<code-line class="line-numbers-rows"></code-line>        CloseHandle(hFile);
<code-line class="line-numbers-rows"></code-line>        </span><span style="color: rgba(0, 0, 255, 1)">return</span> -<span style="color: rgba(128, 0, 128, 1)">1</span><span style="color: rgba(0, 0, 0, 1)">;
<code-line class="line-numbers-rows"></code-line>    }
<code-line class="line-numbers-rows"></code-line>
<code-line class="line-numbers-rows"></code-line>    DWORD dwRead;
<code-line class="line-numbers-rows"></code-line>    ReadFile(hFile,lpAddress,dwSize,</span>&amp;dwRead, <span style="color: rgba(128, 0, 128, 1)">0</span><span style="color: rgba(0, 0, 0, 1)">);
<code-line class="line-numbers-rows"></code-line>
<code-line class="line-numbers-rows"></code-line>    </span><span style="color: rgba(0, 128, 0, 1)">//</span><span style="color: rgba(0, 128, 0, 1)">内嵌汇编</span>
<code-line class="line-numbers-rows"></code-line><span style="color: rgba(0, 0, 0, 1)">    __asm 
<code-line class="line-numbers-rows"></code-line>    {
<code-line class="line-numbers-rows"></code-line>        call lpAddress
<code-line class="line-numbers-rows"></code-line>    }
<code-line class="line-numbers-rows"></code-line>    _flushall();
<code-line class="line-numbers-rows"></code-line>    system(</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(128, 0, 0, 1)">pause</span><span style="color: rgba(128, 0, 0, 1)">"</span><span style="color: rgba(0, 0, 0, 1)">);
<code-line class="line-numbers-rows"></code-line>    </span><span style="color: rgba(0, 0, 255, 1)">return</span> <span style="color: rgba(128, 0, 128, 1)">0</span><span style="color: rgba(0, 0, 0, 1)">;
<code-line class="line-numbers-rows"></code-line>}</span></code-pre></pre>
</div>
<p>&nbsp;</p>
</div>
<div class="clear"></div>
<div id="blog_post_info_block" role="contentinfo"><div id="BlogPostCategory">
    分类: 
            <a href="https://www.cnblogs.com/thresh/category/1686162.html" target="_blank">信息安全</a></div>


    <div id="blog_post_info">
<div id="green_channel">
        <a href="javascript:void(0);" id="green_channel_digg" onclick="DiggIt(12609659,cb_blogId,1);green_channel_success(this,'谢谢推荐！');">好文要顶</a>
        <a id="green_channel_follow" onclick="follow('fdaef897-dc68-4f0d-d547-08d6f398bad3');" href="javascript:void(0);">关注我</a>
    <a id="green_channel_favorite" onclick="AddToWz(cb_entryId);return false;" href="javascript:void(0);">收藏该文</a>
    <a id="green_channel_weibo" href="javascript:void(0);" title="分享至新浪微博" onclick="ShareToTsina()"><img src="https://common.cnblogs.com/images/icon_weibo_24.png" alt=""></a>
    <a id="green_channel_wechat" href="javascript:void(0);" title="分享至微信" onclick="shareOnWechat()"><img src="https://common.cnblogs.com/images/wechat.png" alt=""></a>
</div>
<div id="author_profile">
    <div id="author_profile_info" class="author_profile_info">
            <a href="https://home.cnblogs.com/u/thresh/" target="_blank"><img src="https://pic.cnblogs.com/face/1721319/20200322004208.png" class="author_avatar" alt=""></a>
        <div id="author_profile_detail" class="author_profile_info">
            <a href="https://home.cnblogs.com/u/thresh/">Thresh｜</a><br>
            <a href="https://home.cnblogs.com/u/thresh/followers/">粉丝 - <span class="follower-count">32</span></a>
            <a href="https://home.cnblogs.com/u/thresh/followees/">关注 - <span class="following-count">33</span></a><br>
        </div>
    </div>
    <div class="clear"></div>
    <div id="author_profile_honor"></div>
    <div id="author_profile_follow" class="follow-tip">
                <a href="javascript:void(0);" onclick="follow('fdaef897-dc68-4f0d-d547-08d6f398bad3');return false;">+加关注</a>
    </div>
</div>
<div id="div_digg">
    <div class="diggit" onclick="votePost(12609659,'Digg')">
        <span class="diggnum" id="digg_count">2</span>
    </div>
    <div class="buryit" onclick="votePost(12609659,'Bury')">
        <span class="burynum" id="bury_count">0</span>
    </div>
    <div class="clear"></div>
    <div class="diggword" id="digg_tips">
    </div>
</div>

<script type="text/javascript">
    currentDiggType = 0;
</script></div>
    <div class="clear"></div>
    <div id="post_next_prev">

    <a href="https://www.cnblogs.com/thresh/p/12601444.html" class="p_n_p_prefix">« </a> 上一篇：    <a href="https://www.cnblogs.com/thresh/p/12601444.html" data-featured-image="" title="发布于 2020-03-30 21:39">GoogleHacking语法</a>
    <br>
    <a href="https://www.cnblogs.com/thresh/p/12612670.html" class="p_n_p_prefix">» </a> 下一篇：    <a href="https://www.cnblogs.com/thresh/p/12612670.html" data-featured-image="" title="发布于 2020-04-01 15:01">WebStrom部署项目到远程服务器</a>

</div>
</div>
            </div>
            <div class="postDesc" style="display: block;">posted @ 
<span id="post-date">2020-03-31 23:41</span>&nbsp;
<a href="https://www.cnblogs.com/thresh/">Thresh｜</a>&nbsp;
阅读(<span id="post_view_count">2488</span>)&nbsp;
评论(<span id="post_comment_count">1</span>)&nbsp;
<a href="https://i.cnblogs.com/EditPosts.aspx?postid=12609659" rel="nofollow">编辑</a>&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(12609659);return false;">收藏</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '12609659', targetLink: 'https://www.cnblogs.com/thresh/p/12609659.html', title: 'Window中的shellcode编写框架（入门篇）' })">举报</a></div>
        </div>
	    
	    
    </div><!--end: topics 文章、评论容器-->
</div>

<script>
    var cb_entryId = 12609659, cb_entryCreatedDate = '2020-03-31 23:41', cb_postType = 1, cb_postTitle = 'Window中的shellcode编写框架（入门篇）';
    var allowComments = true, cb_blogId = 522523, cb_blogApp = 'thresh', cb_blogUserGuid = 'fdaef897-dc68-4f0d-d547-08d6f398bad3';
    mermaidRender.render()
    markdown_highlight()
    zoomManager.apply("#cnblogs_post_body img:not(.code_img_closed):not(.code_img_opened)");
    updatePostStats(
            [cb_entryId],
            function(id, count) { $("#post_view_count").text(count) },
            function(id, count) { $("#post_comment_count").text(count) })
</script>
<a id="!comments"></a>
<div id="blog-comments-placeholder"></div>
<div id="comment_form" class="commentform">
    <a name="commentform"></a>
    <div id="divCommentShow"></div>
    <div id="comment_nav"><span id="span_refresh_tips"></span><a href="javascript:void(0);" onclick="return RefreshCommentList();" id="lnk_RefreshComments" runat="server" clientidmode="Static">刷新评论</a><a href="#" onclick="return RefreshPage();">刷新页面</a><a href="#top">返回顶部</a></div>
    <div id="comment_form_container" style="visibility: visible;"><div class="login_tips">
    登录后才能查看或发表评论，立即 <a rel="nofollow" href="javascript:void(0);" class="underline" onclick="return account.login('!comments');">登录</a> 或者
    <a href="https://www.cnblogs.com/">逛逛</a> 博客园首页
</div>
</div>
    <div class="ad_text_commentbox" id="ad_text_under_commentbox"></div>
        <div id="cnblogs_ch"><a href="https://curl.qcloud.com/k19RDMHo" target="_blank" onclick="gtag('event', 'click', {'event_category': 'ad', 'event_label': 'T2-腾讯云'})">【推荐】腾讯云多款云产品1折起，买云服务器送免费机器</a><br><a href="https://brands.cnblogs.com/specdd" target="_blank" onclick="gtag('event', 'click', {'event_category': 'ad', 'event_label': 'T2-SpecDD专区'})">【推荐】下一步，敏捷！云可达科技 SpecDD 敏捷开发专区</a><br></div>
    <div id="opt_under_post"></div>
    <div id="cnblogs_c1" class="under-post-card" style="display: block;">
            <div id="div-gpt-ad-1592365906576-0" style="width: 300px; height: 250px; display: none;" data-google-query-id="CPqpvOTdt_kCFVJtvQodXOwOwA"><div id="google_ads_iframe_/1090369/C1_0__container__" style="border: 0pt none; width: 300px; height: 0px;"></div></div>
    </div>
    <div id="under_post_card1"><div class="under-post-card">
<b>编辑推荐：</b>
<br>

· <a href="https://www.cnblogs.com/chanshuyi/p/head-first-of-cdn.html" target="_blank">一文带你弄懂 CDN 技术的原理</a>
    <br>
· <a href="https://www.cnblogs.com/coco1s/p/16549752.html" target="_blank">妙用 CSS 构建花式透视背景效果</a>
    <br>
· <a href="https://www.cnblogs.com/zhanggaoxing/p/16554114.html" target="_blank">.NET IoT 入门指南：基于 GPS 的 NTP 时间同步服务器</a>
    <br>
· <a href="https://www.cnblogs.com/artech/p/inside-asp-net-core-6-31x.html" target="_blank">ASP.NET Core 6框架揭秘实例演示[31]：路由高阶用法</a>
    <br>
· <a href="https://www.cnblogs.com/dragonir/p/16545805.html" target="_blank">使用前端技术实现静态图片局部流动效果</a>
    <br>
</div></div>
        <div id="cnblogs_c2" class="under-post-card" style="display: block;">
            <a href="http://www.grqsh.com/zcloud.html" rel="nofollow" target="_blank" onclick="countCreativeClicks('C2-格瑞趋势-SQL专家云');countCreativeClicks('格瑞趋势-SQL专家云-term-')">
                <img src="https://img2022.cnblogs.com/blog/35695/202208/35695-20220808183239921-1095997467.jpg" alt="" onload="countCreativeImpressions('C2-格瑞趋势-SQL专家云');countCreativeImpressions('格瑞趋势-SQL专家云-term-')">
            </a>
        </div>
    <div id="under_post_card2"><div class="itnews under-post-card">
    <b>最新新闻</b>：
    <br>
 ·          <a href="//news.cnblogs.com/n/726114/" target="_blank">中科院老科学家上热搜：自称蜗居13㎡筒子楼20年</a>
        <br>
 ·          <a href="//news.cnblogs.com/n/726113/" target="_blank">900页论文证明旋转的黑洞不会爆炸，丘成桐：广义相对论重大突破</a>
        <br>
 ·          <a href="//news.cnblogs.com/n/726110/" target="_blank">一碗海峡对岸的「山西刀削面」，把百度地图搞崩了！</a>
        <br>
 ·          <a href="//news.cnblogs.com/n/726112/" target="_blank">无需精子卵子子宫体外培育老鼠胚胎，Cell论文作者这番话让网友们炸了</a>
        <br>
 ·          <a href="//news.cnblogs.com/n/726111/" target="_blank">GPT-3+DALL·E，60秒内搞定游戏设定和原型动画！网友：这游戏想玩</a>
        <br>
    » <a href="https://news.cnblogs.com/" title="IT 新闻" target="_blank">更多新闻...</a>
</div></div>
    <div id="HistoryToday" class="under-post-card"></div>
    <script type="text/javascript">
        var commentManager = new blogCommentManager();
        commentManager.renderComments(0);
        fixPostBody();

            window.tocManager.displayDisableTocTips = false;
            window.tocManager.generateToc();
            
                setTimeout(function() { countViews(cb_blogId, cb_entryId); }, 50);
            
            deliverT2();
            deliverC1C2();
            loadNewsAndKb();
            
                LoadPostCategoriesTags(cb_blogId, cb_entryId);
            
            LoadPostInfoBlock(cb_blogId, cb_entryId, cb_blogApp, cb_blogUserGuid);
            GetPrevNextPost(cb_entryId, cb_blogId, cb_entryCreatedDate, cb_postType);
            loadOptUnderPost();
            GetHistoryToday(cb_blogId, cb_blogApp, cb_entryCreatedDate);
                </script>
</div>

	</div><!--end: forFlow -->
	</div><!--end: mainContent 主体内容容器-->
	<div id="sideBar">
		<div id="sideBarMain">
			<div id="sidebar_news" class="newsItem"><!--done-->
<h3 class="catListTitle">公告</h3>

<div id="blog-news"><div class="container">    <div class="menu-wrap optiscroll is-enabled" id="menuWrap" style="display:none"><div class=" optiscroll-content" style="right: -16px; bottom: -16px;">        <nav class="menu">            <!-- 个人简介 -->            <div class="introduce-box">                <div class="introduce-head">                    <div class="introduce-via" id="menuBlogAvatar"><img src="https://pic.cnblogs.com/avatar/1721319/20200322004208.png"></div>                </div>                <div id="introduce"></div>            </div>            <!-- 导航 -->            <div class="nav-title"></div>            <div class="icon-list">                <ul id="m-nav-list">                <li><a href="https://www.cnblogs.com/thresh/" target="_self">首页</a></li><li><a href="https://msg.cnblogs.com/send/thresh" target="_blank">联系</a></li><li><a href="https://www.cnblogs.com/thresh/rss" target="_blank">订阅</a></li><li><a href="https://i.cnblogs.com/" target="_blank">管理</a></li></ul>            </div>            <!-- 日历 -->            <span id="calendar-box"></span>            <!-- 找找看 -->            <div class="m-list-title"><span>找找看</span></div>            <div class="m-icon-list" id="sb-sidebarSearchBox"></div>            <!-- 积分与排名 -->            <div class="m-list-title"><span>积分排名<span class="iconfont icon-select m-list-title-select"></span></span></div>            <div class="m-icon-list" id="sb-sidebarScorerank"></div>            <!-- 最新随笔 -->            <div class="m-list-title"><span>最新随笔<span class="iconfont icon-select m-list-title-select"></span></span></div>            <div class="m-icon-list" id="sb-sidebarRecentposts"></div>            <!-- 我的标签 -->            <div class="m-list-title"><span>我的标签<span class="iconfont icon-select m-list-title-select"></span></span></div>            <div class="m-icon-list" id="sb-toptags"></div>            <!-- 随笔分类 -->            <div class="m-list-title"><span>随笔分类<span class="iconfont icon-select m-list-title-select"></span></span></div>            <div class="m-icon-list" id="sb-classify"></div>            <!-- 文章分类 -->            <div class="m-list-title"><span>文章分类<span class="iconfont icon-select m-list-title-select"></span></span></div>            <div class="m-icon-list" id="sb-ArticleCategory"></div>            <!-- 阅读排行 -->            <div class="m-list-title"><span>阅读排行<span class="iconfont icon-select m-list-title-select"></span></span></div>            <div class="m-icon-list" id="sb-topview"></div>            <!-- 推荐排行 -->            <div class="m-list-title"><span>推荐排行<span class="iconfont icon-select m-list-title-select"></span></span></div>            <div class="m-icon-list" id="sb-topDiggPosts"></div>            <!-- 最新评论 -->            <div class="m-list-title"><span>最新评论<span class="iconfont icon-select m-list-title-select"></span></span></div>            <div class="m-icon-list" id="sb-recentComments"></div>            <!-- 文章档案 -->            <div class="m-list-title"><span>文章档案<span class="iconfont icon-select m-list-title-select"></span></span></div>            <div class="m-icon-list" id="sb-articlearchive"></div>            <!-- 随笔档案 -->            <div class="m-list-title"><span>随笔档案<span class="iconfont icon-select m-list-title-select"></span></span></div>            <div class="m-icon-list" id="sb-record"></div>            <!-- 自定义列表 -->            <span id="menuCustomList"></span>        </nav>        <button class="close-button" id="close-button">Close Menu</button>        <div class="morph-shape" id="morph-shape" data-morph-open="M-7.312,0H15c0,0,66,113.339,66,399.5C81,664.006,15,800,15,800H-7.312V0z;M-7.312,0H100c0,0,0,113.839,0,400c0,264.506,0,400,0,400H-7.312V0z">            <svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 100 800" preserveAspectRatio="none">                <path d="M-7.312,0H0c0,0,0,113.839,0,400c0,264.506,0,400,0,400h-7.312V0z"></path>            <desc>Created with Snap</desc><defs></defs></svg>        </div>    </div><div class="optiscroll-v"><b class="optiscroll-vtrack"></b></div><div class="optiscroll-h"><b class="optiscroll-htrack"></b></div></div>    <button class="menu-button" id="open-button">MENU</button>    <div class="content-wrap" id="content-wrap"></div><!-- /content-wrap --></div><div class="main-header" style="height: 40vh; background: url(&quot;https://cdn.jsdelivr.net/gh/BNDong/Cnblogs-Theme-SimpleMemory@master/img/webp/nothome_top_bg.webp&quot;) center center / cover no-repeat rgb(34, 34, 34);">    <canvas id="notHomeTopCanvas"></canvas>    <div class="vertical">        <div class="main-header-content inner" style="max-width: 100vw;">            <h1 class="page-title" id="homeTopTitle" style="display: none;">Thresh|</h1>            <h2 class="page-description" id="hitokoto"></h2>            <h3 class="page-author" id="hitokotoAuthor"></h3>            <h1 class="sb-title" id="sbTitle">
    Window中的shellcode编写框架（入门篇）
    
</h1>            <p class="article-info" id="articleInfo"><p class="article-info-text"><span class="postMeta"><i class="iconfont icon-time1"></i>发表于 2020-03-31 23:41<i class="iconfont icon-browse"></i>阅读次数：2488<i class="iconfont icon-interactive"></i>评论次数：1</span></p></p>        </div>    </div>    <a class="scroll-down" href="javascript:void(0);" data-offset="-45" style="display: none;">        <span class="hidden">Scroll Down</span>        <i class="scroll-down-icon iconfont icon-fanhui"></i>    </a></div><div id="loading" style="display: none;"></div><div id="bottomProgressBar"><div id="top-progress-bar" style="position: relative; top: 0px; left: 0px; right: 0px; background-color: rgb(119, 182, 255); height: 2px; width: 0%; transition: width 0.2s ease 0s, opacity 0.6s ease 0s;"></div></div><div id="rightMenu"></div>
    <script type="text/javascript">window['__document_write_ajax_callbacks__']['4']();</script><script type="text/javascript">window['__document_write_ajax_callbacks__']['1']();</script>
<script type="text/javascript">window['__document_write_ajax_callbacks__']['5']();</script><script type="text/javascript">window['__document_write_ajax_callbacks__']['6']();</script><script>window['__document_write_ajax_callbacks__']['2']();</script>

    <div id="profile_block">
        昵称：
        <a href="https://home.cnblogs.com/u/thresh/">
            Thresh｜
        </a>
        <br>
        园龄：
        <a href="https://home.cnblogs.com/u/thresh/" title="入园时间：2019-06-20">
            3年1个月
        </a>
        <br>
        粉丝：
        <a class="follower-count" href="https://home.cnblogs.com/u/thresh/followers/">
            32
        </a>
        <br>
        关注：
        <a class="folowing-count" href="https://home.cnblogs.com/u/thresh/followees/">
            33
        </a>
        <div id="p_b_follow" class="follow-tip">
<a href="javascript:void(0)" onclick="follow('fdaef897-dc68-4f0d-d547-08d6f398bad3')">+加关注</a></div>
        <script type="text/javascript">window['__document_write_ajax_callbacks__']['7']();</script><script>window['__document_write_ajax_callbacks__']['3']();</script>
    </div>
</div>

</div>
<div id="sidebar_c3"></div>
			<div id="blog-calendar" style="">

<table id="blogCalendar" class="Cal" cellspacing="0" cellpadding="0" title="Calendar" border="0">
    <tbody>
        <tr>
            <td colspan="7">
                <table class="CalTitle" cellspacing="0" border="0">
                    <tbody>
                        <tr>
                            <td class="CalNextPrev">
                                <a href="javascript:void(0);" onclick="loadBlogCalendar('2022/07/09'); return false;">&lt;</a>
                            </td>
                            <td align="center">2022年8月</td>
                            <td align="right" class="CalNextPrev">
                                <a href="javascript:void(0);" onclick="loadBlogCalendar('2022/09/09'); return false;">&gt;</a>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </td>
        </tr>
    <tr>
        <th class="CalDayHeader" align="center" abbr="日" scope="col">日</th>
        <th class="CalDayHeader" align="center" abbr="一" scope="col">一</th>
        <th class="CalDayHeader" align="center" abbr="二" scope="col">二</th>
        <th class="CalDayHeader" align="center" abbr="三" scope="col">三</th>
        <th class="CalDayHeader" align="center" abbr="四" scope="col">四</th>
        <th class="CalDayHeader" align="center" abbr="五" scope="col">五</th>
        <th class="CalDayHeader" align="center" abbr="六" scope="col">六</th>
    </tr>
            <tr>
                            <td class="CalOtherMonthDay" align="center">31</td>
                        <td class="" align="center">
                            1
                        </td>
                        <td class="" align="center">
                            2
                        </td>
                        <td class="" align="center">
                            3
                        </td>
                        <td class="" align="center">
                            4
                        </td>
                        <td class="" align="center">
                            5
                        </td>
                    <td class="CalWeekendDay" align="center">
                        6
                    </td>
            </tr>
                <tr>
                        <td class="CalWeekendDay" align="center">
                            7
                        </td>
                            <td class="" align="center">
                                8
                            </td>
                            <td class="CalTodayDay" align="center">
                                9
                            </td>
                            <td class="" align="center">
                                10
                            </td>
                            <td class="" align="center">
                                11
                            </td>
                            <td class="" align="center">
                                12
                            </td>
                        <td class="CalWeekendDay" align="center">
                            13
                        </td>
                </tr>
                <tr>
                        <td class="CalWeekendDay" align="center">
                            14
                        </td>
                            <td class="" align="center">
                                15
                            </td>
                            <td class="" align="center">
                                16
                            </td>
                            <td class="" align="center">
                                17
                            </td>
                            <td class="" align="center">
                                18
                            </td>
                            <td class="" align="center">
                                19
                            </td>
                        <td class="CalWeekendDay" align="center">
                            20
                        </td>
                </tr>
                <tr>
                        <td class="CalWeekendDay" align="center">
                            21
                        </td>
                            <td class="" align="center">
                                22
                            </td>
                            <td class="" align="center">
                                23
                            </td>
                            <td class="" align="center">
                                24
                            </td>
                            <td class="" align="center">
                                25
                            </td>
                            <td class="" align="center">
                                26
                            </td>
                        <td class="CalWeekendDay" align="center">
                            27
                        </td>
                </tr>
                <tr>
                        <td class="CalWeekendDay" align="center">
                            28
                        </td>
                            <td class="" align="center">
                                29
                            </td>
                            <td class="" align="center">
                                30
                            </td>
                            <td class="" align="center">
                                31
                            </td>
                            <td class="CalOtherMonthDay" align="center">
                                1
                            </td>
                            <td class="CalOtherMonthDay" align="center">
                                2
                            </td>
                        <td class="CalOtherMonthDay" align="center">
                            3
                        </td>
                </tr>
                <tr>
                        <td class="CalOtherMonthDay" align="center">
                            4
                        </td>
                            <td class="CalOtherMonthDay" align="center">
                                5
                            </td>
                            <td class="CalOtherMonthDay" align="center">
                                6
                            </td>
                            <td class="CalOtherMonthDay" align="center">
                                7
                            </td>
                            <td class="CalOtherMonthDay" align="center">
                                8
                            </td>
                            <td class="CalOtherMonthDay" align="center">
                                9
                            </td>
                        <td class="CalOtherMonthDay" align="center">
                            10
                        </td>
                </tr>
    </tbody>
</table></div><script>loadBlogDefaultCalendar();</script>			
			<div id="leftcontentcontainer">
				<div id="blog-sidecolumn"><!-- 搜索 -->
<div id="sidebar_search" class="sidebar-block">
    <div id="sidebar_search" class="mySearch">
        <h3 class="catListTitle">搜索</h3>
        <div id="sidebar_search_box">
            <div id="widget_my_zzk" class="div_my_zzk">
                <input type="text" id="q" onkeydown="return zzk_go_enter(event);" class="input_my_zzk">&nbsp;<input onclick="zzk_go()" type="button" value="找找看" id="btnZzk" class="btn_my_zzk">
            </div>
            <div id="widget_my_google" class="div_my_zzk">
                <input type="text" name="google_q" id="google_q" onkeydown="return google_go_enter(event);" class="input_my_zzk">&nbsp;<input onclick="google_go()" type="button" value="谷歌搜索" class="btn_my_zzk">
            </div>
        </div>
    </div>
</div>

<!-- 常用链接 -->
<div id="sidebar_shortcut" class="sidebar-block"><div class="catListLink">
<h3 class="catListTitle">
常用链接
</h3>
<ul>
    <li><a href="https://www.cnblogs.com/thresh/p/" title="我的博客的随笔列表">我的随笔</a></li>
<li><a href="https://www.cnblogs.com/thresh/MyComments.html" title="我的发表过的评论列表">我的评论</a></li>
<li><a href="https://www.cnblogs.com/thresh/OtherPosts.html" title="我评论过的随笔列表">我的参与</a></li>
<li><a href="https://www.cnblogs.com/thresh/comments" title="我的博客的评论列表">最新评论</a></li>
<li><a href="https://www.cnblogs.com/thresh/tag/" title="我的博客的标签列表">我的标签</a></li>

</ul>
</div>

</div>

<!-- 最新随笔 -->
<div id="sidebar_recentposts" class="sidebar-block"><div class="catListEssay">
<h3 class="catListTitle">最新随笔</h3>
    <ul>
                <li>
                    
<a href="https://www.cnblogs.com/thresh/p/15250411.html">1.OWASP 2021</a>

                </li>
                <li>
                    
<a href="https://www.cnblogs.com/thresh/p/14949405.html">2.Snort3安装和配置</a>

                </li>
                <li>
                    
<a href="https://www.cnblogs.com/thresh/p/13904704.html">3.关于WordPress的简单分析</a>

                </li>
                <li>
                    
<a href="https://www.cnblogs.com/thresh/p/13743219.html">4.DeDeCMS-v5.7-漏洞分析</a>

                </li>
                <li>
                    
<a href="https://www.cnblogs.com/thresh/p/13743159.html">5.DVWA靶场</a>

                </li>
                <li>
                    
<a href="https://www.cnblogs.com/thresh/p/13743138.html">6.ThinkPHP漏洞复现</a>

                </li>
                <li>
                    
<a href="https://www.cnblogs.com/thresh/p/13743098.html">7.Fastadmin前台Getshell漏洞分析</a>

                </li>
                <li>
                    
<a href="https://www.cnblogs.com/thresh/p/13743081.html">8.Yii反序列化漏洞分析</a>

                </li>
                <li>
                    
<a href="https://www.cnblogs.com/thresh/p/13427455.html">9.OWASP TOP10</a>

                </li>
                <li>
                    
<a href="https://www.cnblogs.com/thresh/p/13420318.html">10.负载均衡</a>

                </li>
    </ul>
</div>

</div>

<!-- 我的标签 -->
<div id="sidebar_toptags" class="sidebar-block"><div class="catListTag">
<h3 class="catListTitle">我的标签</h3>
<ul>
        <li>
            <a href="https://www.cnblogs.com/thresh/tag/Web/">Web<span class="tag-count">(1)</span></a>
        </li>
    

</ul>
</div>

</div>

<!-- 积分与排名 -->


<!-- 随笔分类、随笔档案、文章分类、新闻分类、相册、链接 -->
<div id="sidebar_categories">

    <div id="sidebar_postcategory" class="catListPostCategory sidebar-block">
        <h3 class="catListTitle">
            
    <a class="sidebar-card-title-a" href="https://www.cnblogs.com/thresh/categories">随笔分类</a>



        </h3>

        <ul>

                <li data-category-list-item-visible="true" style="display: block">
                    
<a href="https://www.cnblogs.com/thresh/category/1684999.html" class="category-item-link" rel="" target="">ASP.NET(1)</a>
 
                </li>                
                <li data-category-list-item-visible="true" style="display: block">
                    
<a href="https://www.cnblogs.com/thresh/category/1767509.html" class="category-item-link" rel="" target="">python爬虫(29)</a>
 
                </li>                
                <li data-category-list-item-visible="true" style="display: block">
                    
<a href="https://www.cnblogs.com/thresh/category/1810493.html" class="category-item-link" rel="" target="">Web安全(3)</a>
 
                </li>                
                <li data-category-list-item-visible="true" style="display: block">
                    
<a href="https://www.cnblogs.com/thresh/category/1855705.html" class="category-item-link" rel="" target="">操作系统(1)</a>
 
                </li>                
                <li data-category-list-item-visible="true" style="display: block">
                    
<a href="https://www.cnblogs.com/thresh/category/1855707.html" class="category-item-link" rel="" target="">恶意文件分析(1)</a>
 
                </li>                
                <li data-category-list-item-visible="true" style="display: block">
                    
<a href="https://www.cnblogs.com/thresh/category/1855704.html" class="category-item-link" rel="" target="">漏洞分析(4)</a>
 
                </li>                
                <li data-category-list-item-visible="true" style="display: block">
                    
<a href="https://www.cnblogs.com/thresh/category/1686162.html" class="category-item-link" rel="" target="">信息安全(11)</a>
 
                </li>                
                <li data-category-list-item-visible="true" style="display: block">
                    
<a href="https://www.cnblogs.com/thresh/category/1685000.html" class="category-item-link" rel="" target="">疑难杂症(3)</a>
 
                </li>                
            
        </ul>


    </div>    
    <div id="sidebar_postarchive" class="catListPostArchive sidebar-block">
        <h3 class="catListTitle">
            
随笔档案


        </h3>

        <ul>

                <li data-category-list-item-visible="true" style="display: block">
                    
<a href="https://www.cnblogs.com/thresh/archive/2021/11.html" class="category-item-link" rel="" target="">2021年11月(1)</a>
 
                </li>                
                <li data-category-list-item-visible="true" style="display: block">
                    
<a href="https://www.cnblogs.com/thresh/archive/2021/06.html" class="category-item-link" rel="" target="">2021年6月(1)</a>
 
                </li>                
                <li data-category-list-item-visible="true" style="display: block">
                    
<a href="https://www.cnblogs.com/thresh/archive/2020/10.html" class="category-item-link" rel="" target="">2020年10月(1)</a>
 
                </li>                
                <li data-category-list-item-visible="true" style="display: block">
                    
<a href="https://www.cnblogs.com/thresh/archive/2020/09.html" class="category-item-link" rel="" target="">2020年9月(5)</a>
 
                </li>                
                <li data-category-list-item-visible="true" style="display: block">
                    
<a href="https://www.cnblogs.com/thresh/archive/2020/08.html" class="category-item-link" rel="" target="">2020年8月(2)</a>
 
                </li>                
                <li data-category-list-item-visible="true" style="display: block">
                    
<a href="https://www.cnblogs.com/thresh/archive/2020/07.html" class="category-item-link" rel="" target="">2020年7月(24)</a>
 
                </li>                
                <li data-category-list-item-visible="true" style="display: block">
                    
<a href="https://www.cnblogs.com/thresh/archive/2020/05.html" class="category-item-link" rel="" target="">2020年5月(17)</a>
 
                </li>                
                <li data-category-list-item-visible="true" style="display: block">
                    
<a href="https://www.cnblogs.com/thresh/archive/2020/04.html" class="category-item-link" rel="" target="">2020年4月(2)</a>
 
                </li>                
                <li data-category-list-item-visible="true" style="display: block">
                    
<a href="https://www.cnblogs.com/thresh/archive/2020/03.html" class="category-item-link" rel="" target="">2020年3月(2)</a>
 
                </li>                
                <li data-category-list-item-visible="true" style="display: block">
                    
<a href="https://www.cnblogs.com/thresh/archive/2019/12.html" class="category-item-link" rel="" target="">2019年12月(1)</a>
 
                </li>                
                <li data-category-list-item-visible="true" style="display: block">
                    
<a href="https://www.cnblogs.com/thresh/archive/2019/11.html" class="category-item-link" rel="" target="">2019年11月(2)</a>
 
                </li>                
                <li data-category-list-item-visible="true" style="display: block">
                    
<a href="https://www.cnblogs.com/thresh/archive/2019/10.html" class="category-item-link" rel="" target="">2019年10月(1)</a>
 
                </li>                
            
        </ul>


    </div>    
</div>

<!-- 最新评论 -->
<!-- 阅读排行榜 -->
<div id="sidebar_topviewedposts" class="sidebar-block"><div class="catListView">
    <h3 class="catListTitle">
        <a href="https://www.cnblogs.com/thresh/most-viewed" class="sidebar-card-title-a">
    阅读排行榜
</a>

    </h3>
    <div id="TopViewPostsBlock">
        <ul style="word-break:break-all">
                    <li>
                        <a href="https://www.cnblogs.com/thresh/p/12019466.html">
                            1. 入侵检测系统Snort的安装、配置与测试(17891)
                        </a>
                    </li>
                    <li>
                        <a href="https://www.cnblogs.com/thresh/p/12883822.html">
                            2. 2020年4月蓝桥杯模拟赛题-python(7651)
                        </a>
                    </li>
                    <li>
                        <a href="https://www.cnblogs.com/thresh/p/11780350.html">
                            3. 实现ARP欺骗(6897)
                        </a>
                    </li>
                    <li>
                        <a href="https://www.cnblogs.com/thresh/p/13743219.html">
                            4. DeDeCMS-v5.7-漏洞分析(6423)
                        </a>
                    </li>
                    <li>
                        <a href="https://www.cnblogs.com/thresh/p/13743081.html">
                            5. Yii反序列化漏洞分析(5011)
                        </a>
                    </li>
        </ul>
    </div>
</div></div>

<!-- 评论排行榜 -->
<div id="sidebar_topcommentedposts" class="sidebar-block"><div class="catListFeedback">
    <h3 class="catListTitle">
        <a href="https://www.cnblogs.com/thresh/most-commented" class="sidebar-card-title-a">评论排行榜</a>

    </h3>
    <div id="TopFeedbackPostsBlock">
        <ul style="word-break:break-all">
                    <li>
                        <a href="https://www.cnblogs.com/thresh/p/12019466.html">
                            1. 入侵检测系统Snort的安装、配置与测试(40)
                        </a>
                    </li>
                    <li>
                        <a href="https://www.cnblogs.com/thresh/p/14949405.html">
                            2. Snort3安装和配置(3)
                        </a>
                    </li>
                    <li>
                        <a href="https://www.cnblogs.com/thresh/p/13743081.html">
                            3. Yii反序列化漏洞分析(3)
                        </a>
                    </li>
                    <li>
                        <a href="https://www.cnblogs.com/thresh/p/12609659.html">
                            4. Window中的shellcode编写框架（入门篇）(1)
                        </a>
                    </li>
                    <li>
                        <a href="https://www.cnblogs.com/thresh/p/11641030.html">
                            5. 关于ASP.NETMVC入门学习（一）(1)
                        </a>
                    </li>
        </ul>
    </div>
</div></div>

<!-- 推荐排行榜 -->
<div id="sidebar_topdiggedposts" class="sidebar-block">
<div id="topdigg_posts_wrap">
    <div class="catListView">
        <h3 class="catListTitle">
            <a href="https://www.cnblogs.com/thresh/most-liked" class="sidebar-card-title-a">推荐排行榜</a>

        </h3>
        <div id="TopDiggPostsBlock">
            <ul style="word-break: break-all">
                        <li>
                            <a href="https://www.cnblogs.com/thresh/p/12019466.html">
                                1. 入侵检测系统Snort的安装、配置与测试(6)
                            </a>
                        </li>
                        <li>
                            <a href="https://www.cnblogs.com/thresh/p/12883822.html">
                                2. 2020年4月蓝桥杯模拟赛题-python(4)
                            </a>
                        </li>
                        <li>
                            <a href="https://www.cnblogs.com/thresh/p/11780350.html">
                                3. 实现ARP欺骗(3)
                            </a>
                        </li>
                        <li>
                            <a href="https://www.cnblogs.com/thresh/p/13743081.html">
                                4. Yii反序列化漏洞分析(2)
                            </a>
                        </li>
                        <li>
                            <a href="https://www.cnblogs.com/thresh/p/12609659.html">
                                5. Window中的shellcode编写框架（入门篇）(2)
                            </a>
                        </li>
            </ul>
        </div>
    </div>
</div></div><div id="sidebar_recentcomments" class="sidebar-block"><div class="catListComment">
<h3 class="catListTitle"><a href="https://www.cnblogs.com/thresh/comments" class="sidebar-card-title-a">最新评论</a></h3>
    <div class="RecentCommentBlock">
        <ul>
                <li class="recent_comment_title"><a href="https://www.cnblogs.com/thresh/p/12019466.html">1. Re:入侵检测系统Snort的安装、配置与测试</a></li>
                <li class="recent_comment_body">@Thresh｜ 啊好吧，谢谢大佬！！...</li>
                <li class="recent_comment_author">--檀少少</li>
                <li class="recent_comment_title"><a href="https://www.cnblogs.com/thresh/p/12019466.html">2. Re:入侵检测系统Snort的安装、配置与测试</a></li>
                <li class="recent_comment_body">@檀少少 正常来说，启用ARP的那个插件就行了...</li>
                <li class="recent_comment_author">--Thresh｜</li>
                <li class="recent_comment_title"><a href="https://www.cnblogs.com/thresh/p/12019466.html">3. Re:入侵检测系统Snort的安装、配置与测试</a></li>
                <li class="recent_comment_body">@Thresh｜ 不加的话倒是没报错了，但是什么也检测不出来，可以请教一下大佬的local.rules里面有配置什么相关规则吗？...</li>
                <li class="recent_comment_author">--檀少少</li>
                <li class="recent_comment_title"><a href="https://www.cnblogs.com/thresh/p/12019466.html">4. Re:入侵检测系统Snort的安装、配置与测试</a></li>
                <li class="recent_comment_body">@厌男症晚期 建议检查一下数据库配置...</li>
                <li class="recent_comment_author">--Thresh｜</li>
                <li class="recent_comment_title"><a href="https://www.cnblogs.com/thresh/p/12019466.html">5. Re:入侵检测系统Snort的安装、配置与测试</a></li>
                <li class="recent_comment_body">@檀少少 你不加这个告警语句试试...</li>
                <li class="recent_comment_author">--Thresh｜</li>
        </ul>
    </div>
</div>

</div>


</div>
                    <script>loadBlogSideColumn();</script>
			</div>			
		</div><!--end: sideBarMain -->
	</div><!--end: sideBar 侧边栏容器 -->
	<div class="clear"></div>
	</div><!--end: main -->
	<div class="clear"></div>
	<div id="footer"><footer><footer-background><figure class="clouds"></figure><figure class="background"></figure><figure class="foreground"></figure></footer-background></footer><div class="footer-box"><div><span id="blogRunTimeSpan"></span><span class="my-face">ღゝ◡╹)ノ♡</span></div><div id="blogrollInfo"></div><div>
		
Copyright © 2022 Thresh｜
Powered by .NET 6 on Kubernetes



	</div><div id="cnzzInfo"></div><div id="themeInfo">Theme version: <a href="https://github.com/BNDong/Cnblogs-Theme-SimpleMemory/tree/v1.3.0" target="_blank" style="color: #888;text-decoration: underline;">v1.3.0</a> / Loading theme version: <a href="https://github.com/BNDong/Cnblogs-Theme-SimpleMemory/tree/v1.3.0" target="_blank" style="color: #888;text-decoration: underline;">v1.3.0</a></div></div></div><!--end: footer -->
</div><!--end: home 自定义的最大容器 -->



<div id="page_end_html">

<link rel="stylesheet" href="https://blog-static.cnblogs.com/files/nightrainlemon/APlayer.min.css">
<script src="https://blog-static.cnblogs.com/files/nightrainlemon/APlayer.min.js"></script>
<script src="https://blog-static.cnblogs.com/files/nightrainlemon/Meting.min.js"></script>

<div id="aplayer" class="aplayer aplayer-withlist aplayer-arrow aplayer-fixed aplayer-narrow" data-id="5296613552" data-server="netease" data-type="playlist" data-fixed="true" data-listfolded="true" data-order="random" data-theme="#F58EA8">
<div class="aplayer-list aplayer-list-hide" style="max-height: 250px">
    <ol style="max-height: 250px">
        
<li>
    <span class="aplayer-list-cur" style="background-color: #F58EA8;"></span>
    <span class="aplayer-list-index">1</span>
    <span class="aplayer-list-title">River Flows In You</span>
    <span class="aplayer-list-author">Martin Ermen</span>
</li>

<li class="aplayer-list-light">
    <span class="aplayer-list-cur" style="background-color: #F58EA8;"></span>
    <span class="aplayer-list-index">2</span>
    <span class="aplayer-list-title">城南花已开</span>
    <span class="aplayer-list-author">三亩地</span>
</li>

<li>
    <span class="aplayer-list-cur" style="background-color: #F58EA8;"></span>
    <span class="aplayer-list-index">3</span>
    <span class="aplayer-list-title">所念皆星河</span>
    <span class="aplayer-list-author">CMJ</span>
</li>

<li>
    <span class="aplayer-list-cur" style="background-color: #F58EA8;"></span>
    <span class="aplayer-list-index">4</span>
    <span class="aplayer-list-title">Windy&nbsp;Hill</span>
    <span class="aplayer-list-author">羽肿</span>
</li>

<li>
    <span class="aplayer-list-cur" style="background-color: #F58EA8;"></span>
    <span class="aplayer-list-index">5</span>
    <span class="aplayer-list-title">My Soul</span>
    <span class="aplayer-list-author">July</span>
</li>

<li>
    <span class="aplayer-list-cur" style="background-color: #F58EA8;"></span>
    <span class="aplayer-list-index">6</span>
    <span class="aplayer-list-title">满目星河</span>
    <span class="aplayer-list-author">CMJ</span>
</li>

    </ol>
</div>
<div class="aplayer-body">
    <div class="aplayer-pic" style="background-image: url(&quot;https://api.i-meto.com/meting/api?server=netease&amp;type=pic&amp;id=109951162885959979&amp;auth=5a99f4e4015ad488f1894e4c572b126cc926826a&quot;);background-color: #F58EA8;">
        <div class="aplayer-button aplayer-play"><svg xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="0 0 16 31"><path d="M15.552 15.168q0.448 0.32 0.448 0.832 0 0.448-0.448 0.768l-13.696 8.512q-0.768 0.512-1.312 0.192t-0.544-1.28v-16.448q0-0.96 0.544-1.28t1.312 0.192z"></path></svg></div>
    </div>
    <div class="aplayer-info" style="display: block;">
        <div class="aplayer-music">
            <span class="aplayer-title">城南花已开</span>
            <span class="aplayer-author"> - 三亩地</span>
        </div>
        <div class="aplayer-controller">
            <div class="aplayer-bar-wrap">
                <div class="aplayer-bar">
                    <div class="aplayer-loaded" style="width: 74.7953%;"></div>
                    <div class="aplayer-played" style="width: 0; background: #F58EA8;">
                        <span class="aplayer-thumb" style="background: #F58EA8;">
                            <span class="aplayer-loading-icon"><svg xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="0 0 32 32"><path d="M4 16c0-6.6 5.4-12 12-12s12 5.4 12 12c0 1.2-0.8 2-2 2s-2-0.8-2-2c0-4.4-3.6-8-8-8s-8 3.6-8 8 3.6 8 8 8c1.2 0 2 0.8 2 2s-0.8 2-2 2c-6.6 0-12-5.4-12-12z"></path></svg></span>
                        </span>
                    </div>
                </div>
            </div>
            <div class="aplayer-time aplayer-time-narrow">
                <span class="aplayer-time-inner">
                    <span class="aplayer-ptime">00:00</span> / <span class="aplayer-dtime">04:31</span>
                </span>
                <span class="aplayer-icon aplayer-icon-back">
                    <svg xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="0 0 32 32"><path d="M25.468 6.947c-0.326-0.172-0.724-0.151-1.030 0.057l-6.438 4.38v-3.553c0-0.371-0.205-0.71-0.532-0.884-0.326-0.172-0.724-0.151-1.030 0.057l-12 8.164c-0.274 0.186-0.438 0.496-0.438 0.827s0.164 0.641 0.438 0.827l12 8.168c0.169 0.115 0.365 0.174 0.562 0.174 0.16 0 0.321-0.038 0.468-0.116 0.327-0.173 0.532-0.514 0.532-0.884v-3.556l6.438 4.382c0.169 0.115 0.365 0.174 0.562 0.174 0.16 0 0.321-0.038 0.468-0.116 0.327-0.173 0.532-0.514 0.532-0.884v-16.333c0-0.371-0.205-0.71-0.532-0.884z"></path></svg>
                </span>
                <span class="aplayer-icon aplayer-icon-play">
                    <svg xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="0 0 16 31"><path d="M15.552 15.168q0.448 0.32 0.448 0.832 0 0.448-0.448 0.768l-13.696 8.512q-0.768 0.512-1.312 0.192t-0.544-1.28v-16.448q0-0.96 0.544-1.28t1.312 0.192z"></path></svg>
                </span>
                <span class="aplayer-icon aplayer-icon-forward">
                    <svg xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="0 0 32 32"><path d="M25.468 6.947c-0.326-0.172-0.724-0.151-1.030 0.057l-6.438 4.38v-3.553c0-0.371-0.205-0.71-0.532-0.884-0.326-0.172-0.724-0.151-1.030 0.057l-12 8.164c-0.274 0.186-0.438 0.496-0.438 0.827s0.164 0.641 0.438 0.827l12 8.168c0.169 0.115 0.365 0.174 0.562 0.174 0.16 0 0.321-0.038 0.468-0.116 0.327-0.173 0.532-0.514 0.532-0.884v-3.556l6.438 4.382c0.169 0.115 0.365 0.174 0.562 0.174 0.16 0 0.321-0.038 0.468-0.116 0.327-0.173 0.532-0.514 0.532-0.884v-16.333c0-0.371-0.205-0.71-0.532-0.884z"></path></svg>
                </span>
                <div class="aplayer-volume-wrap">
                    <button type="button" class="aplayer-icon aplayer-icon-volume-down"><svg xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="0 0 28 32"><path d="M13.728 6.272v19.456q0 0.448-0.352 0.8t-0.8 0.32-0.8-0.32l-5.952-5.952h-4.672q-0.48 0-0.8-0.352t-0.352-0.8v-6.848q0-0.48 0.352-0.8t0.8-0.352h4.672l5.952-5.952q0.32-0.32 0.8-0.32t0.8 0.32 0.352 0.8zM20.576 16q0 1.344-0.768 2.528t-2.016 1.664q-0.16 0.096-0.448 0.096-0.448 0-0.8-0.32t-0.32-0.832q0-0.384 0.192-0.64t0.544-0.448 0.608-0.384 0.512-0.64 0.192-1.024-0.192-1.024-0.512-0.64-0.608-0.384-0.544-0.448-0.192-0.64q0-0.48 0.32-0.832t0.8-0.32q0.288 0 0.448 0.096 1.248 0.48 2.016 1.664t0.768 2.528z"></path></svg></button>
                    <div class="aplayer-volume-bar-wrap">
                        <div class="aplayer-volume-bar">
                            <div class="aplayer-volume" style="height: 70%; background: rgb(245, 142, 168);"></div>
                        </div>
                    </div>
                </div>
                <button type="button" class="aplayer-icon aplayer-icon-order">
                    <svg xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="0 0 32 32"><path d="M22.667 4l7 6-7 6 7 6-7 6v-4h-3.653l-3.76-3.76 2.827-2.827 2.587 2.587h2v-8h-2l-12 12h-6v-4h4.347l12-12h3.653v-4zM2.667 8h6l3.76 3.76-2.827 2.827-2.587-2.587h-4.347v-4z"></path></svg>
                </button>
                <button type="button" class="aplayer-icon aplayer-icon-loop">
                    <svg xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="0 0 29 32"><path d="M9.333 9.333h13.333v4l5.333-5.333-5.333-5.333v4h-16v8h2.667v-5.333zM22.667 22.667h-13.333v-4l-5.333 5.333 5.333 5.333v-4h16v-8h-2.667v5.333z"></path></svg>
                </button>
                <button type="button" class="aplayer-icon aplayer-icon-menu">
                    <svg xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="0 0 22 32"><path d="M20.8 14.4q0.704 0 1.152 0.48t0.448 1.12-0.48 1.12-1.12 0.48h-19.2q-0.64 0-1.12-0.48t-0.48-1.12 0.448-1.12 1.152-0.48h19.2zM1.6 11.2q-0.64 0-1.12-0.48t-0.48-1.12 0.448-1.12 1.152-0.48h19.2q0.704 0 1.152 0.48t0.448 1.12-0.48 1.12-1.12 0.48h-19.2zM20.8 20.8q0.704 0 1.152 0.48t0.448 1.12-0.48 1.12-1.12 0.48h-19.2q-0.64 0-1.12-0.48t-0.48-1.12 0.448-1.12 1.152-0.48h19.2z"></path></svg>
                </button>
                <button type="button" class="aplayer-icon aplayer-icon-lrc">
                    <svg xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="0 0 32 32"><path d="M26.667 5.333h-21.333c-0 0-0.001 0-0.001 0-1.472 0-2.666 1.194-2.666 2.666 0 0 0 0.001 0 0.001v-0 16c0 0 0 0.001 0 0.001 0 1.472 1.194 2.666 2.666 2.666 0 0 0.001 0 0.001 0h21.333c0 0 0.001 0 0.001 0 1.472 0 2.666-1.194 2.666-2.666 0-0 0-0.001 0-0.001v0-16c0-0 0-0.001 0-0.001 0-1.472-1.194-2.666-2.666-2.666-0 0-0.001 0-0.001 0h0zM5.333 16h5.333v2.667h-5.333v-2.667zM18.667 24h-13.333v-2.667h13.333v2.667zM26.667 24h-5.333v-2.667h5.333v2.667zM26.667 18.667h-13.333v-2.667h13.333v2.667z"></path></svg>
                </button>
            </div>
        </div>
    </div>
    <div class="aplayer-notice"></div>
    <div class="aplayer-miniswitcher"><button class="aplayer-icon"><svg xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="0 0 32 32"><path d="M22 16l-10.105-10.6-1.895 1.987 8.211 8.613-8.211 8.612 1.895 1.988 8.211-8.613z"></path></svg></button></div>
</div>
<div class="aplayer-lrc">
    <div class="aplayer-lrc-contents" style="transform: translateY(0); -webkit-transform: translateY(0);">
    <p class="aplayer-lrc-current">作曲 : 三亩地</p>

    <p>纯音乐，请欣赏</p>
</div>
</div>
</div>


<script type="text/javascript">
/* 鼠标特效 */
var a_idx = 0;
jQuery(document).ready(function($) {
    $("body").click(function(e) {
        var a = new Array("❤富强❤","❤民主❤","❤文明❤","❤和谐❤","❤自由❤","❤平等❤","❤公正❤","❤法治❤","❤爱国❤","❤敬业❤","❤诚信❤","❤友善❤");
        var $i = $("<span></span>").text(a[a_idx]);
        a_idx = (a_idx + 1) % a.length;
        var x = e.pageX,
        y = e.pageY;
        $i.css({
            "z-index": 999999999999999999999999999999999999999999999999999999999999999999999,
            "top": y - 20,
            "left": x,
            "position": "absolute",
            "font-weight": "bold",
            "color": "rgb("+~~(255*Math.random())+","+~~(255*Math.random())+","+~~(255*Math.random())+")"
        });
        $("body").append($i);
        $i.animate({
            "top": y - 180,
            "opacity": 0
        },
        1500,
        function() {
            $i.remove();
        });
    });
});
</script>











</div>

<input type="hidden" id="antiforgery_token" value="CfDJ8EOBBtWq0dNFoDS-ZHPSe53VbApiBk2cKEQuJBZw0-y7fCRs_s1hcJYJM1iuTWT0KJ7hmWpvqZ38HiZCOBT58nwO6eUI130nqkM3QqnEa3MQt4fPsi3drZKVok2xuddFMs7x0aBbohwklYxl8Q3aTqE">
<script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-476124-1"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    var kv = getGACustom();
    if (kv) {
        gtag('set', kv);
    }
    gtag('config', 'UA-476124-1');
</script>
<script defer="" src="https://hm.baidu.com/hm.js?866c9be12d4a814454792b1fd0fed295"></script>

<script type="text/javascript">
    window.cnblogsConfig = {
        GhVersions    : 'v1.3.0', // 版本
        blogUser      : "Thresh|", // 用户名
        blogAvatar    : "https://pic.cnblogs.com/avatar/1721319/20200322004208.png", // 用户头像
        blogStartDate : "2019-06-20", // 入园时间，年-月-日。入园时间查看方法：鼠标停留园龄时间上，会显示入园时间
         homeTopImg    : [
        
            "https://images.cnblogs.com/cnblogs_com/thresh/1677045/o_200905053955%E9%9B%B7%E5%A7%86.jpg",
            "https://images.cnblogs.com/cnblogs_com/thresh/1677045/o_2005180219362b-3.jpg",
            "https://images.cnblogs.com/cnblogs_com/thresh/1677045/o_200322053849IMG_3412.jpg",
            "https://images.cnblogs.com/cnblogs_com/thresh/1677045/o_200518022247home_top_bg.jpg",
        ],
        webpageIcon: "https://pic.cnblogs.com/avatar/1721319/20200322004208.png",
    }
</script><script type="text/javascript">getFollowStatus('fdaef897-dc68-4f0d-d547-08d6f398bad3');</script><iframe src="https://7be83d2c538f78231e1496ef4f3b3b15.safeframe.googlesyndication.com/safeframe/1-0-38/html/container.html" style="visibility: hidden; display: none;"></iframe><iframe src="https://www.google.com/recaptcha/api2/aframe" width="0" height="0" style="display: none;"></iframe></body></html>