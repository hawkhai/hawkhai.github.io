<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml" lang="zh-cn"><head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="referrer" content="origin-when-crossorigin" />
    <meta name="description" content="记录使用 cmake 时的常见需求和解决办法。 0. 推荐使用至少3.15版本的cmake 1. 用于执行CMake的.bat脚本 使用.bat脚本调用cmake，可以指定比较复杂的cmake.exe" />
    <meta property="og:description" content="记录使用 cmake 时的常见需求和解决办法。 0. 推荐使用至少3.15版本的cmake 1. 用于执行CMake的.bat脚本 使用.bat脚本调用cmake，可以指定比较复杂的cmake.exe" />
    <meta http-equiv="Cache-Control" content="no-transform" />
    <meta http-equiv="Cache-Control" content="no-siteapp" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title>cmake 备忘录 - ChrisZZ - 博客园</title>
    <link id="favicon" rel="shortcut icon" href="//common.cnblogs.com/favicon.svg" type="image/svg+xml" />
    
    <style>:not(.cnblogs_code):not(.cnblogs_Highlighter)&gt;pre:not([class*="language-"]):not([highlighted]):not(.hljs):not([class*="brush:"]) {
        background: rgb(43, 43, 43);
        padding: 6.5px;
        border: 0px none rgb(248, 248, 242);
        border-radius: 0px;
        border-color: transparent;
        color: rgb(248, 248, 242);
        font-family: monospace;
    }:not(.cnblogs_code):not(.cnblogs_Highlighter)&gt;pre:not([highlighted]):not([class*="brush:"]) code:not(.hljs) {
            background: rgb(43, 43, 43) !important;
            border-color: transparent !important;
        }</style><link rel="stylesheet" href="/css/blog-common.min.css?v=5hM-3_wvH6PqtSEv_spqLegP-p5ewW4MjHPc5XUl0LI" />
    <link id="MainCss" rel="stylesheet" href="/skins/imetro_hd/bundle-imetro_hd.min.css?v=-2zGtoLawDrIwNaRq6izrGAhi3NYvKhiE0WgWKL8paM" />
    <link id="highlighter-theme-a11y-dark" type="text/css" rel="stylesheet" href="/css/hljs/a11y-dark.css?v=fbvAJH55N-EwxyAdBtpvhzZFbKDHk_WaJ3Rtne4t1aU" />
    
    <link id="mobile-style" media="only screen and (max-width: 767px)" type="text/css" rel="stylesheet" href="/skins/imetro_hd/bundle-imetro_hd-mobile.min.css?v=C7gaCPGVeoTBuxbVeqr1iPsKLy8-yz__K8QiKFOMB2w" />
    
    <link type="application/rss+xml" rel="alternate" href="https://www.cnblogs.com/zjutzz/rss" />
    <link type="application/rsd+xml" rel="EditURI" href="https://www.cnblogs.com/zjutzz/rsd.xml" />
    <link type="application/wlwmanifest+xml" rel="wlwmanifest" href="https://www.cnblogs.com/zjutzz/wlwmanifest.xml" />
    <script type="text/javascript" async="" src="https://www.google-analytics.com/analytics.js"></script><script>
        var currentBlogId = 141691;
        var currentBlogApp = 'zjutzz';
        var cb_enable_mathjax = true;
        var isLogined = false;
        var isBlogOwner = false;
        var skinName = 'iMetro_HD';
        var visitorUserId = '';
        var hasCustomScript = false;
        try {
            if (hasCustomScript &amp;&amp; document.referrer &amp;&amp; document.referrer.indexOf('baidu.com') &gt;= 0) {
                Object.defineProperty(document, 'referrer', { value: '' });
                Object.defineProperty(Document.prototype, 'referrer', { get: function(){ return ''; } });
            }
        } catch(error) { }
        window.codeHighlightEngine = 1;
        window.enableCodeLineNumber = true;
        window.codeHighlightTheme = 'a11y-dark';
    </script>
        <script>
            var currentPostDateAdded = '2020-07-19 16:50';
        </script>
    <script src="https://common.cnblogs.com/scripts/jquery-2.2.0.min.js"></script>
    <script src="/js/blog-common.min.js?v=6y4ap5bMZh5QALlakkDFkuNMrIRiy4lnEHysS0Mpbt0"></script><style type="text/css">.medium-zoom-overlay{position:fixed;top:0;right:0;bottom:0;left:0;opacity:0;transition:opacity .3s;will-change:opacity}.medium-zoom--opened .medium-zoom-overlay{cursor:pointer;cursor:zoom-out;opacity:1}.medium-zoom-image{cursor:pointer;cursor:zoom-in;transition:transform .3s cubic-bezier(.2,0,.2,1)!important}.medium-zoom-image--hidden{visibility:hidden}.medium-zoom-image--opened{position:relative;cursor:pointer;cursor:zoom-out;will-change:transform}</style><script id="hljs-script" async="" data-loaded="true" src="https://common.cnblogs.com/highlight/11.4.0/highlight.min.js"></script>
    <script type="text/x-mathjax-config;executed=true">
        MathJax.Hub.Config({
        tex2jax: { inlineMath: [['$','$'], ['\\(','\\)']], processClass: 'math', processEscapes: true },
        TeX: {
        equationNumbers: { autoNumber: ['AMS'], useLabelIds: true },
        extensions: ['extpfeil.js', 'mediawiki-texvc.js'],
        Macros: {bm: "\\boldsymbol"}
        },
        'HTML-CSS': { linebreaks: { automatic: true } },
        SVG: { linebreaks: { automatic: true } }
        });
    </script>
    <script src="https://mathjax.cnblogs.com/2_7_5/MathJax.js?config=TeX-AMS-MML_HTMLorMML&amp;v=20200504"></script>
    
<script id="hljs-line-numbers" async="" data-loaded="true" src="https://common.cnblogs.com/scripts/highlightjs-line-numbers.min.js"></script><style type="text/css">.MathJax_Hover_Frame {border-radius: .25em; -webkit-border-radius: .25em; -moz-border-radius: .25em; -khtml-border-radius: .25em; box-shadow: 0px 0px 15px #83A; -webkit-box-shadow: 0px 0px 15px #83A; -moz-box-shadow: 0px 0px 15px #83A; -khtml-box-shadow: 0px 0px 15px #83A; border: 1px solid #A6D ! important; display: inline-block; position: absolute}
.MathJax_Menu_Button .MathJax_Hover_Arrow {position: absolute; cursor: pointer; display: inline-block; border: 2px solid #AAA; border-radius: 4px; -webkit-border-radius: 4px; -moz-border-radius: 4px; -khtml-border-radius: 4px; font-family: 'Courier New',Courier; font-size: 9px; color: #F0F0F0}
.MathJax_Menu_Button .MathJax_Hover_Arrow span {display: block; background-color: #AAA; border: 1px solid; border-radius: 3px; line-height: 0; padding: 4px}
.MathJax_Hover_Arrow:hover {color: white!important; border: 2px solid #CCC!important}
.MathJax_Hover_Arrow:hover span {background-color: #CCC!important}
</style><style type="text/css">#MathJax_About {position: fixed; left: 50%; width: auto; text-align: center; border: 3px outset; padding: 1em 2em; background-color: #DDDDDD; color: black; cursor: default; font-family: message-box; font-size: 120%; font-style: normal; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; z-index: 201; border-radius: 15px; -webkit-border-radius: 15px; -moz-border-radius: 15px; -khtml-border-radius: 15px; box-shadow: 0px 10px 20px #808080; -webkit-box-shadow: 0px 10px 20px #808080; -moz-box-shadow: 0px 10px 20px #808080; -khtml-box-shadow: 0px 10px 20px #808080; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
#MathJax_About.MathJax_MousePost {outline: none}
.MathJax_Menu {position: absolute; background-color: white; color: black; width: auto; padding: 2px; border: 1px solid #CCCCCC; margin: 0; cursor: default; font: menu; text-align: left; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; z-index: 201; box-shadow: 0px 10px 20px #808080; -webkit-box-shadow: 0px 10px 20px #808080; -moz-box-shadow: 0px 10px 20px #808080; -khtml-box-shadow: 0px 10px 20px #808080; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
.MathJax_MenuItem {padding: 2px 2em; background: transparent}
.MathJax_MenuArrow {position: absolute; right: .5em; padding-top: .25em; color: #666666; font-size: .75em}
.MathJax_MenuActive .MathJax_MenuArrow {color: white}
.MathJax_MenuArrow.RTL {left: .5em; right: auto}
.MathJax_MenuCheck {position: absolute; left: .7em}
.MathJax_MenuCheck.RTL {right: .7em; left: auto}
.MathJax_MenuRadioCheck {position: absolute; left: 1em}
.MathJax_MenuRadioCheck.RTL {right: 1em; left: auto}
.MathJax_MenuLabel {padding: 2px 2em 4px 1.33em; font-style: italic}
.MathJax_MenuRule {border-top: 1px solid #CCCCCC; margin: 4px 1px 0px}
.MathJax_MenuDisabled {color: GrayText}
.MathJax_MenuActive {background-color: Highlight; color: HighlightText}
.MathJax_MenuDisabled:focus, .MathJax_MenuLabel:focus {background-color: #E8E8E8}
.MathJax_ContextMenu:focus {outline: none}
.MathJax_ContextMenu .MathJax_MenuItem:focus {outline: none}
#MathJax_AboutClose {top: .2em; right: .2em}
.MathJax_Menu .MathJax_MenuClose {top: -10px; left: -10px}
.MathJax_MenuClose {position: absolute; cursor: pointer; display: inline-block; border: 2px solid #AAA; border-radius: 18px; -webkit-border-radius: 18px; -moz-border-radius: 18px; -khtml-border-radius: 18px; font-family: 'Courier New',Courier; font-size: 24px; color: #F0F0F0}
.MathJax_MenuClose span {display: block; background-color: #AAA; border: 1.5px solid; border-radius: 18px; -webkit-border-radius: 18px; -moz-border-radius: 18px; -khtml-border-radius: 18px; line-height: 0; padding: 8px 0 6px}
.MathJax_MenuClose:hover {color: white!important; border: 2px solid #CCC!important}
.MathJax_MenuClose:hover span {background-color: #CCC!important}
.MathJax_MenuClose:hover:focus {outline: none}
</style><style type="text/css">.MathJax_Preview .MJXf-math {color: inherit!important}
</style><style type="text/css">.MJX_Assistive_MathML {position: absolute!important; top: 0; left: 0; clip: rect(1px, 1px, 1px, 1px); padding: 1px 0 0 0!important; border: 0!important; height: 1px!important; width: 1px!important; overflow: hidden!important; display: block!important; -webkit-touch-callout: none; -webkit-user-select: none; -khtml-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none}
.MJX_Assistive_MathML.MJX_Assistive_MathML_Block {width: 100%!important}
</style><style type="text/css">#MathJax_Zoom {position: absolute; background-color: #F0F0F0; overflow: auto; display: block; z-index: 301; padding: .5em; border: 1px solid black; margin: 0; font-weight: normal; font-style: normal; text-align: left; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; -webkit-box-sizing: content-box; -moz-box-sizing: content-box; box-sizing: content-box; box-shadow: 5px 5px 15px #AAAAAA; -webkit-box-shadow: 5px 5px 15px #AAAAAA; -moz-box-shadow: 5px 5px 15px #AAAAAA; -khtml-box-shadow: 5px 5px 15px #AAAAAA; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
#MathJax_ZoomOverlay {position: absolute; left: 0; top: 0; z-index: 300; display: inline-block; width: 100%; height: 100%; border: 0; padding: 0; margin: 0; background-color: white; opacity: 0; filter: alpha(opacity=0)}
#MathJax_ZoomFrame {position: relative; display: inline-block; height: 0; width: 0}
#MathJax_ZoomEventTrap {position: absolute; left: 0; top: 0; z-index: 302; display: inline-block; border: 0; padding: 0; margin: 0; background-color: white; opacity: 0; filter: alpha(opacity=0)}
</style><style type="text/css">.MathJax_Preview {color: #888}
#MathJax_Message {position: fixed; left: 1em; bottom: 1.5em; background-color: #E6E6E6; border: 1px solid #959595; margin: 0px; padding: 2px 8px; z-index: 102; color: black; font-size: 80%; width: auto; white-space: nowrap}
#MathJax_MSIE_Frame {position: absolute; top: 0; left: 0; width: 0px; z-index: 101; border: 0px; margin: 0px; padding: 0px}
.MathJax_Error {color: #CC0000; font-style: italic}
</style><style type="text/css">.hljs-ln{border-collapse:collapse}.hljs-ln td{padding:0}.hljs-ln-n:before{content:attr(data-line-number)}</style><script id="hljs-language-batch" async="" data-loaded="error" src="https://common.cnblogs.com/highlight/11.4.0/languages/batch.min.js"></script><style type="text/css">.MJXp-script {font-size: .8em}
.MJXp-right {-webkit-transform-origin: right; -moz-transform-origin: right; -ms-transform-origin: right; -o-transform-origin: right; transform-origin: right}
.MJXp-bold {font-weight: bold}
.MJXp-italic {font-style: italic}
.MJXp-scr {font-family: MathJax_Script,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-frak {font-family: MathJax_Fraktur,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-sf {font-family: MathJax_SansSerif,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-cal {font-family: MathJax_Caligraphic,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-mono {font-family: MathJax_Typewriter,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-largeop {font-size: 150%}
.MJXp-largeop.MJXp-int {vertical-align: -.2em}
.MJXp-math {display: inline-block; line-height: 1.2; text-indent: 0; font-family: 'Times New Roman',Times,STIXGeneral,serif; white-space: nowrap; border-collapse: collapse}
.MJXp-display {display: block; text-align: center; margin: 1em 0}
.MJXp-math span {display: inline-block}
.MJXp-box {display: block!important; text-align: center}
.MJXp-box:after {content: " "}
.MJXp-rule {display: block!important; margin-top: .1em}
.MJXp-char {display: block!important}
.MJXp-mo {margin: 0 .15em}
.MJXp-mfrac {margin: 0 .125em; vertical-align: .25em}
.MJXp-denom {display: inline-table!important; width: 100%}
.MJXp-denom &gt; * {display: table-row!important}
.MJXp-surd {vertical-align: top}
.MJXp-surd &gt; * {display: block!important}
.MJXp-script-box &gt; *  {display: table!important; height: 50%}
.MJXp-script-box &gt; * &gt; * {display: table-cell!important; vertical-align: top}
.MJXp-script-box &gt; *:last-child &gt; * {vertical-align: bottom}
.MJXp-script-box &gt; * &gt; * &gt; * {display: block!important}
.MJXp-mphantom {visibility: hidden}
.MJXp-munderover, .MJXp-munder {display: inline-table!important}
.MJXp-over {display: inline-block!important; text-align: center}
.MJXp-over &gt; * {display: block!important}
.MJXp-munderover &gt; *, .MJXp-munder &gt; * {display: table-row!important}
.MJXp-mtable {vertical-align: .25em; margin: 0 .125em}
.MJXp-mtable &gt; * {display: inline-table!important; vertical-align: middle}
.MJXp-mtr {display: table-row!important}
.MJXp-mtd {display: table-cell!important; text-align: center; padding: .5em 0 0 .5em}
.MJXp-mtr &gt; .MJXp-mtd:first-child {padding-left: 0}
.MJXp-mtr:first-child &gt; .MJXp-mtd {padding-top: 0}
.MJXp-mlabeledtr {display: table-row!important}
.MJXp-mlabeledtr &gt; .MJXp-mtd:first-child {padding-left: 0}
.MJXp-mlabeledtr:first-child &gt; .MJXp-mtd {padding-top: 0}
.MJXp-merror {background-color: #FFFF88; color: #CC0000; border: 1px solid #CC0000; padding: 1px 3px; font-style: normal; font-size: 90%}
.MJXp-scale0 {-webkit-transform: scaleX(.0); -moz-transform: scaleX(.0); -ms-transform: scaleX(.0); -o-transform: scaleX(.0); transform: scaleX(.0)}
.MJXp-scale1 {-webkit-transform: scaleX(.1); -moz-transform: scaleX(.1); -ms-transform: scaleX(.1); -o-transform: scaleX(.1); transform: scaleX(.1)}
.MJXp-scale2 {-webkit-transform: scaleX(.2); -moz-transform: scaleX(.2); -ms-transform: scaleX(.2); -o-transform: scaleX(.2); transform: scaleX(.2)}
.MJXp-scale3 {-webkit-transform: scaleX(.3); -moz-transform: scaleX(.3); -ms-transform: scaleX(.3); -o-transform: scaleX(.3); transform: scaleX(.3)}
.MJXp-scale4 {-webkit-transform: scaleX(.4); -moz-transform: scaleX(.4); -ms-transform: scaleX(.4); -o-transform: scaleX(.4); transform: scaleX(.4)}
.MJXp-scale5 {-webkit-transform: scaleX(.5); -moz-transform: scaleX(.5); -ms-transform: scaleX(.5); -o-transform: scaleX(.5); transform: scaleX(.5)}
.MJXp-scale6 {-webkit-transform: scaleX(.6); -moz-transform: scaleX(.6); -ms-transform: scaleX(.6); -o-transform: scaleX(.6); transform: scaleX(.6)}
.MJXp-scale7 {-webkit-transform: scaleX(.7); -moz-transform: scaleX(.7); -ms-transform: scaleX(.7); -o-transform: scaleX(.7); transform: scaleX(.7)}
.MJXp-scale8 {-webkit-transform: scaleX(.8); -moz-transform: scaleX(.8); -ms-transform: scaleX(.8); -o-transform: scaleX(.8); transform: scaleX(.8)}
.MJXp-scale9 {-webkit-transform: scaleX(.9); -moz-transform: scaleX(.9); -ms-transform: scaleX(.9); -o-transform: scaleX(.9); transform: scaleX(.9)}
.MathJax_PHTML .noError {vertical-align: ; font-size: 90%; text-align: left; color: black; padding: 1px 3px; border: 1px solid}
</style><script id="hljs-language-groovy" async="" data-loaded="true" src="https://common.cnblogs.com/highlight/11.4.0/languages/groovy.min.js"></script><script id="hljs-language-asm" async="" data-loaded="error" src="https://common.cnblogs.com/highlight/11.4.0/languages/asm.min.js"></script><meta http-equiv="origin-trial" content="AxujKG9INjsZ8/gUq8+dTruNvk7RjZQ1oFhhgQbcTJKDnZfbzSTE81wvC2Hzaf3TW4avA76LTZEMdiedF1vIbA4AAABueyJvcmlnaW4iOiJodHRwczovL2ltYXNkay5nb29nbGVhcGlzLmNvbTo0NDMiLCJmZWF0dXJlIjoiVHJ1c3RUb2tlbnMiLCJleHBpcnkiOjE2NTI3NzQ0MDAsImlzVGhpcmRQYXJ0eSI6dHJ1ZX0=" /><meta http-equiv="origin-trial" content="Azuce85ORtSnWe1MZDTv68qpaW3iHyfL9YbLRy0cwcCZwVnePnOmkUJlG8HGikmOwhZU22dElCcfrfX2HhrBPAkAAAB7eyJvcmlnaW4iOiJodHRwczovL2RvdWJsZWNsaWNrLm5ldDo0NDMiLCJmZWF0dXJlIjoiVHJ1c3RUb2tlbnMiLCJleHBpcnkiOjE2NTI3NzQ0MDAsImlzU3ViZG9tYWluIjp0cnVlLCJpc1RoaXJkUGFydHkiOnRydWV9" /><meta http-equiv="origin-trial" content="A16nvcdeoOAqrJcmjLRpl1I6f3McDD8EfofAYTt/P/H4/AWwB99nxiPp6kA0fXoiZav908Z8etuL16laFPUdfQsAAACBeyJvcmlnaW4iOiJodHRwczovL2dvb2dsZXRhZ3NlcnZpY2VzLmNvbTo0NDMiLCJmZWF0dXJlIjoiVHJ1c3RUb2tlbnMiLCJleHBpcnkiOjE2NTI3NzQ0MDAsImlzU3ViZG9tYWluIjp0cnVlLCJpc1RoaXJkUGFydHkiOnRydWV9" /><meta http-equiv="origin-trial" content="AxBHdr0J44vFBQtZUqX9sjiqf5yWZ/OcHRcRMN3H9TH+t90V/j3ENW6C8+igBZFXMJ7G3Pr8Dd13632aLng42wgAAACBeyJvcmlnaW4iOiJodHRwczovL2dvb2dsZXN5bmRpY2F0aW9uLmNvbTo0NDMiLCJmZWF0dXJlIjoiVHJ1c3RUb2tlbnMiLCJleHBpcnkiOjE2NTI3NzQ0MDAsImlzU3ViZG9tYWluIjp0cnVlLCJpc1RoaXJkUGFydHkiOnRydWV9" /><meta http-equiv="origin-trial" content="A88BWHFjcawUfKU3lIejLoryXoyjooBXLgWmGh+hNcqMK44cugvsI5YZbNarYvi3roc1fYbHA1AVbhAtuHZflgEAAAB2eyJvcmlnaW4iOiJodHRwczovL2dvb2dsZS5jb206NDQzIiwiZmVhdHVyZSI6IlRydXN0VG9rZW5zIiwiZXhwaXJ5IjoxNjUyNzc0NDAwLCJpc1N1YmRvbWFpbiI6dHJ1ZSwiaXNUaGlyZFBhcnR5Ijp0cnVlfQ==" /><meta http-equiv="origin-trial" content="A8FHS1NmdCwGqD9DwOicnHHY+y27kdWfxKa0YHSGDfv0CSpDKRHTQdQmZVPDUdaFWUsxdgVxlwAd6o+dhJykPA0AAACWeyJvcmlnaW4iOiJodHRwczovL2RvdWJsZWNsaWNrLm5ldDo0NDMiLCJmZWF0dXJlIjoiQ29udmVyc2lvbk1lYXN1cmVtZW50IiwiZXhwaXJ5IjoxNjQzMTU1MTk5LCJpc1N1YmRvbWFpbiI6dHJ1ZSwiaXNUaGlyZFBhcnR5Ijp0cnVlLCJ1c2FnZSI6InN1YnNldCJ9" /><meta http-equiv="origin-trial" content="A8zdXi6dr1hwXEUjQrYiyYQGlU3557y5QWDnN0Lwgj9ePt66XMEvNkVWOEOWPd7TP9sBQ25X0Q15Lr1Nn4oGFQkAAACceyJvcmlnaW4iOiJodHRwczovL2dvb2dsZXN5bmRpY2F0aW9uLmNvbTo0NDMiLCJmZWF0dXJlIjoiQ29udmVyc2lvbk1lYXN1cmVtZW50IiwiZXhwaXJ5IjoxNjQzMTU1MTk5LCJpc1N1YmRvbWFpbiI6dHJ1ZSwiaXNUaGlyZFBhcnR5Ijp0cnVlLCJ1c2FnZSI6InN1YnNldCJ9" /><meta http-equiv="origin-trial" content="A4/Htern2udN9w3yJK9QgWQxQFruxOXsXL7cW60DyCl0EZFGCSme/J33Q/WzF7bBkVvhEWDlcBiUyZaim5CpFQwAAACceyJvcmlnaW4iOiJodHRwczovL2dvb2dsZXRhZ3NlcnZpY2VzLmNvbTo0NDMiLCJmZWF0dXJlIjoiQ29udmVyc2lvbk1lYXN1cmVtZW50IiwiZXhwaXJ5IjoxNjQzMTU1MTk5LCJpc1N1YmRvbWFpbiI6dHJ1ZSwiaXNUaGlyZFBhcnR5Ijp0cnVlLCJ1c2FnZSI6InN1YnNldCJ9" /><script src="https://securepubads.g.doubleclick.net/gpt/pubads_impl_2022041101.js?cb=31067066" async=""></script><style type="text/css">.MathJax_Display {text-align: center; margin: 1em 0em; position: relative; display: block!important; text-indent: 0; max-width: none; max-height: none; min-width: 0; min-height: 0; width: 100%}
.MathJax .merror {background-color: #FFFF88; color: #CC0000; border: 1px solid #CC0000; padding: 1px 3px; font-style: normal; font-size: 90%}
.MathJax .MJX-monospace {font-family: monospace}
.MathJax .MJX-sans-serif {font-family: sans-serif}
#MathJax_Tooltip {background-color: InfoBackground; color: InfoText; border: 1px solid black; box-shadow: 2px 2px 5px #AAAAAA; -webkit-box-shadow: 2px 2px 5px #AAAAAA; -moz-box-shadow: 2px 2px 5px #AAAAAA; -khtml-box-shadow: 2px 2px 5px #AAAAAA; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true'); padding: 3px 4px; z-index: 401; position: absolute; left: 0; top: 0; width: auto; height: auto; display: none}
.MathJax {display: inline; font-style: normal; font-weight: normal; line-height: normal; font-size: 100%; font-size-adjust: none; text-indent: 0; text-align: left; text-transform: none; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; direction: ltr; max-width: none; max-height: none; min-width: 0; min-height: 0; border: 0; padding: 0; margin: 0}
.MathJax:focus, body :focus .MathJax {display: inline-table}
.MathJax.MathJax_FullWidth {text-align: center; display: table-cell!important; width: 10000em!important}
.MathJax img, .MathJax nobr, .MathJax a {border: 0; padding: 0; margin: 0; max-width: none; max-height: none; min-width: 0; min-height: 0; vertical-align: 0; line-height: normal; text-decoration: none}
img.MathJax_strut {border: 0!important; padding: 0!important; margin: 0!important; vertical-align: 0!important}
.MathJax span {display: inline; position: static; border: 0; padding: 0; margin: 0; vertical-align: 0; line-height: normal; text-decoration: none; box-sizing: content-box}
.MathJax nobr {white-space: nowrap!important}
.MathJax img {display: inline!important; float: none!important}
.MathJax * {transition: none; -webkit-transition: none; -moz-transition: none; -ms-transition: none; -o-transition: none}
.MathJax_Processing {visibility: hidden; position: fixed; width: 0; height: 0; overflow: hidden}
.MathJax_Processed {display: none!important}
.MathJax_test {font-style: normal; font-weight: normal; font-size: 100%; font-size-adjust: none; text-indent: 0; text-transform: none; letter-spacing: normal; word-spacing: normal; overflow: hidden; height: 1px}
.MathJax_test.mjx-test-display {display: table!important}
.MathJax_test.mjx-test-inline {display: inline!important; margin-right: -1px}
.MathJax_test.mjx-test-default {display: block!important; clear: both}
.MathJax_ex_box {display: inline-block!important; position: absolute; overflow: hidden; min-height: 0; max-height: none; padding: 0; border: 0; margin: 0; width: 1px; height: 60ex}
.MathJax_em_box {display: inline-block!important; position: absolute; overflow: hidden; min-height: 0; max-height: none; padding: 0; border: 0; margin: 0; width: 1px; height: 60em}
.mjx-test-inline .MathJax_left_box {display: inline-block; width: 0; float: left}
.mjx-test-inline .MathJax_right_box {display: inline-block; width: 0; float: right}
.mjx-test-display .MathJax_right_box {display: table-cell!important; width: 10000em!important; min-width: 0; max-width: none; padding: 0; border: 0; margin: 0}
.MathJax .MathJax_HitBox {cursor: text; background: white; opacity: 0; filter: alpha(opacity=0)}
.MathJax .MathJax_HitBox * {filter: none; opacity: 1; background: transparent}
#MathJax_Tooltip * {filter: none; opacity: 1; background: transparent}
@font-face {font-family: MathJax_Main; src: url('https://mathjax.cnblogs.com/2_7_5/fonts/HTML-CSS/TeX/woff/MathJax_Main-Regular.woff?V=2.7.5') format('woff'), url('https://mathjax.cnblogs.com/2_7_5/fonts/HTML-CSS/TeX/otf/MathJax_Main-Regular.otf?V=2.7.5') format('opentype')}
@font-face {font-family: MathJax_Main-bold; src: url('https://mathjax.cnblogs.com/2_7_5/fonts/HTML-CSS/TeX/woff/MathJax_Main-Bold.woff?V=2.7.5') format('woff'), url('https://mathjax.cnblogs.com/2_7_5/fonts/HTML-CSS/TeX/otf/MathJax_Main-Bold.otf?V=2.7.5') format('opentype')}
@font-face {font-family: MathJax_Main-italic; src: url('https://mathjax.cnblogs.com/2_7_5/fonts/HTML-CSS/TeX/woff/MathJax_Main-Italic.woff?V=2.7.5') format('woff'), url('https://mathjax.cnblogs.com/2_7_5/fonts/HTML-CSS/TeX/otf/MathJax_Main-Italic.otf?V=2.7.5') format('opentype')}
@font-face {font-family: MathJax_Math-italic; src: url('https://mathjax.cnblogs.com/2_7_5/fonts/HTML-CSS/TeX/woff/MathJax_Math-Italic.woff?V=2.7.5') format('woff'), url('https://mathjax.cnblogs.com/2_7_5/fonts/HTML-CSS/TeX/otf/MathJax_Math-Italic.otf?V=2.7.5') format('opentype')}
@font-face {font-family: MathJax_Caligraphic; src: url('https://mathjax.cnblogs.com/2_7_5/fonts/HTML-CSS/TeX/woff/MathJax_Caligraphic-Regular.woff?V=2.7.5') format('woff'), url('https://mathjax.cnblogs.com/2_7_5/fonts/HTML-CSS/TeX/otf/MathJax_Caligraphic-Regular.otf?V=2.7.5') format('opentype')}
@font-face {font-family: MathJax_Size1; src: url('https://mathjax.cnblogs.com/2_7_5/fonts/HTML-CSS/TeX/woff/MathJax_Size1-Regular.woff?V=2.7.5') format('woff'), url('https://mathjax.cnblogs.com/2_7_5/fonts/HTML-CSS/TeX/otf/MathJax_Size1-Regular.otf?V=2.7.5') format('opentype')}
@font-face {font-family: MathJax_Size2; src: url('https://mathjax.cnblogs.com/2_7_5/fonts/HTML-CSS/TeX/woff/MathJax_Size2-Regular.woff?V=2.7.5') format('woff'), url('https://mathjax.cnblogs.com/2_7_5/fonts/HTML-CSS/TeX/otf/MathJax_Size2-Regular.otf?V=2.7.5') format('opentype')}
@font-face {font-family: MathJax_Size3; src: url('https://mathjax.cnblogs.com/2_7_5/fonts/HTML-CSS/TeX/woff/MathJax_Size3-Regular.woff?V=2.7.5') format('woff'), url('https://mathjax.cnblogs.com/2_7_5/fonts/HTML-CSS/TeX/otf/MathJax_Size3-Regular.otf?V=2.7.5') format('opentype')}
@font-face {font-family: MathJax_Size4; src: url('https://mathjax.cnblogs.com/2_7_5/fonts/HTML-CSS/TeX/woff/MathJax_Size4-Regular.woff?V=2.7.5') format('woff'), url('https://mathjax.cnblogs.com/2_7_5/fonts/HTML-CSS/TeX/otf/MathJax_Size4-Regular.otf?V=2.7.5') format('opentype')}
.MathJax .noError {vertical-align: ; font-size: 90%; text-align: left; color: black; padding: 1px 3px; border: 1px solid}
</style><link rel="preload" href="https://adservice.google.com/adsid/integrator.js?domain=www.cnblogs.com" as="script" /><script type="text/javascript" src="https://adservice.google.com/adsid/integrator.js?domain=www.cnblogs.com"></script><style type="text/css">@font-face {font-family: MathJax_AMS; src: url('https://mathjax.cnblogs.com/2_7_5/fonts/HTML-CSS/TeX/woff/MathJax_AMS-Regular.woff?V=2.7.5') format('woff'), url('https://mathjax.cnblogs.com/2_7_5/fonts/HTML-CSS/TeX/otf/MathJax_AMS-Regular.otf?V=2.7.5') format('opentype')}
</style></head>
<body class="skin-imetro_hd has-navbar hljs-engine"><div style="visibility: hidden; overflow: hidden; position: absolute; top: 0px; height: 1px; width: auto; padding: 0px; border: 0px; margin: 0px; text-align: left; text-indent: 0px; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal;"><div id="MathJax_Hidden"></div></div><div id="MathJax_Message" style="display: none;"></div>
    <a name="top"></a>
    <div id="top_nav" class="navbar forpc">
        <nav id="nav_main" class="navbar-main">
            <ul id="nav_left" class="navbar-list navbar-left">
                <li class="navbar-branding">
                    <a href="https://www.cnblogs.com/" title="开发者的网上家园" role="banner">
                            <img src="/images/logo.svg?v=R9M0WmLAIPVydmdzE2keuvnjl-bPR7_35oHqtiBzGsM" alt="博客园Logo" />
                    </a>
                </li>
                <li><a href="/" onclick="countClicks('skin-navbar-sitehome')">首页</a></li>
                <li><a href="https://news.cnblogs.com/" onclick="countClicks('nav', 'skin-navbar-news')">新闻</a></li>
                <li><a href="https://q.cnblogs.com/" onclick="countClicks('nav', 'skin-navbar-q')">博问</a></li>
                <li><a id="nav_brandzone" href="https://brands.cnblogs.com/huawei" onclick="countClicks('nav', 'skin-navbar-brands')">专区</a></li>
                <li><a href="https://ing.cnblogs.com/" onclick="countClicks('nav', 'skin-navbar-ing')">闪存</a></li>
                <li><a href="https://edu.cnblogs.com/" onclick="countClicks('nav', 'skin-navbar-edu')">班级</a></li>
            </ul>
            <ul id="nav_right" class="navbar-list navbar-right">
                <li>
                    <form id="zzk_search" class="navbar-search" action="https://zzk.cnblogs.com/s" method="get" role="search">
                        <input name="w" id="zzk_search_input" placeholder="代码改变世界" type="search" tabindex="3" />
                        <button type="submit" id="zzk_search_button">
                            <img src="/images/aggsite/search.svg" alt="搜索" />
                        </button>
                    </form>
                </li>
                <li id="navbar_login_status" class="navbar-list">
                    <a class="navbar-user-info navbar-blog" href="https://i.cnblogs.com/EditPosts.aspx?opt=1" alt="写随笔" title="写随笔" style="display: none;">
                        <img id="new_post_icon" class="navbar-icon" src="/images/aggsite/newpost.svg" alt="写随笔" />
                    </a>
                    <a id="navblog-myblog-icon" class="navbar-user-info navbar-blog" href="https://passport.cnblogs.com/GetBlogApplyStatus.aspx" alt="我的博客" title="我的博客" style="display: none;">
                        <img id="myblog_icon" class="navbar-icon" src="/images/aggsite/myblog.svg" alt="我的博客" />
                    </a>
                    <a class="navbar-user-info navbar-message navbar-icon-wrapper" href="https://msg.cnblogs.com/" alt="短消息" title="短消息" style="display: none;">
                        <img id="msg_icon" class="navbar-icon" src="/images/aggsite/message.svg?v=J0WS2P2iPgaIVgXxcAhliw4AFZIpaTWxtdoNAv9eiCA" alt="短消息" />
                        <span id="msg_count" style="display: none"></span>
                    </a>
                    <a id="navbar_lite_mode_indicator" data-current-page="blog" style="display: none" href="javascript:void(0)" alt="简洁模式" title="简洁模式启用，您在访问他人博客时会使用简洁款皮肤展示">
                        <img class="navbar-icon" src="/images/aggsite/lite-mode-on.svg" alt="简洁模式" />
                    </a>
                    <div id="user_info" class="navbar-user-info dropdown" style="display: none;">
                        <a class="dropdown-button" href="https://home.cnblogs.com/">
                            <img id="user_icon" class="navbar-avatar" src="/images/aggsite/avatar-default.svg" alt="用户头像" />
                        </a>
                        <div class="dropdown-menu">
                            <a id="navblog-myblog-text" href="https://passport.cnblogs.com/GetBlogApplyStatus.aspx">我的博客</a>
                            <a href="https://home.cnblogs.com/">我的园子</a>
                            <a href="https://account.cnblogs.com/settings/account">账号设置</a>
                            <a href="javascript:void(0)" id="navbar_lite_mode_toggle" title="简洁模式会使用简洁款皮肤显示所有博客">
    简洁模式 <img id="navbar_lite_mode_on" src="/images/lite-mode-check.svg" class="hide" /><span id="navbar_lite_mode_spinner" class="hide">...</span>
</a>
                            <a href="javascript:void(0)" onclick="account.logout();">退出登录</a>
                        </div>
                    </div>
                    <a class="navbar-anonymous" href="https://account.cnblogs.com/signup" style="display: inline;">注册</a>
                    <a class="navbar-anonymous" href="javascript:void(0);" onclick="account.login()" style="display: inline;">登录</a>
                </li>
            </ul>
        </nav>
    </div>

    
    <!--done-->
<div id="home">
<div id="header">
	<div id="blogTitle">
        <a id="lnkBlogLogo" href="https://www.cnblogs.com/zjutzz/"><img id="blogLogo" src="/skins/custom/images/logo.gif" alt="返回主页" /></a>		
		
<!--done-->
<h1><a id="Header1_HeaderTitle" class="headermaintitle HeaderMainTitle" href="https://www.cnblogs.com/zjutzz/"></a>
</h1>
<h2>你内心的平庸就是你失去追求卓越信念的那个瞬间</h2>




		
	</div><!--end: blogTitle 博客的标题和副标题 -->
	<div id="navigator">
		
<ul id="navList">
<li><a id="blog_nav_sitehome" class="menu" href="https://www.cnblogs.com/">
博客园</a>
</li>
<li>
<a id="blog_nav_myhome" class="menu" href="https://www.cnblogs.com/zjutzz/">
首页</a>
</li>
<li>

<a id="blog_nav_newpost" class="menu" href="https://i.cnblogs.com/EditPosts.aspx?opt=1">
新随笔</a>
</li>
<li>
<a id="blog_nav_contact" class="menu" href="https://msg.cnblogs.com/send/ChrisZZ">
联系</a></li>
<li>

<!--<partial name="./Shared/_XmlLink.cshtml" model="Model" /></li>--></li>
<li>
<a id="blog_nav_admin" class="menu" href="https://i.cnblogs.com/">
管理</a>
</li>
</ul>


		<div class="blogStats">
			<span id="stats_post_count">随笔 - 527  </span>
<span id="stats_article_count">文章 - 1  </span>
<span id="stats-comment_count">评论 - 196  </span>
<span id="stats-total-view-count">阅读 - 
<span title="总阅读数: 1282397">
128万</span></span>

		</div><!--end: blogStats -->
	</div><!--end: navigator 博客导航栏 -->
</div><!--end: header 头部 -->
<div id="main">
	<div id="mainContent">
	<div class="forFlow">
		<div id="post_detail">
    <!--done-->
    <div id="topics">
        <div class="post">
            <h1 class="postTitle">
                
<a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/zjutzz/p/13340318.html">
    <span role="heading" aria-level="2">cmake 备忘录</span>
    
</a><button class="cnblogs-toc-button" title="显示目录导航" aria-expanded="false"></button>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<p>记录使用 cmake 时的常见需求和解决办法。</p>
<p></p><div class="toc"><div class="toc-container-header">目录</div><ul><li><a href="#0-推荐使用至少315版本的cmake" rel="noopener">0. 推荐使用至少3.15版本的cmake</a></li><li><a href="#1-用于执行cmake的bat脚本" rel="noopener">1. 用于执行CMake的.bat脚本</a></li><li><a href="#2-判断平台32位还是64位" rel="noopener">2. 判断平台：32位还是64位？</a></li><li><a href="#3-判断visual-studio版本" rel="noopener">3. 判断Visual Studio版本</a></li><li><a href="#4-判断操作系统" rel="noopener">4. 判断操作系统</a></li><li><a href="#5-判断是debug还是release等版本" rel="noopener">5. 判断是Debug还是Release等版本</a></li><li><a href="#6-根据debugrelease添加不同的库目录" rel="noopener">6. 根据Debug/Release添加不同的库目录</a></li><li><a href="#7-visual-studio属性与对应cmake实现方法" rel="noopener">7. Visual Studio属性与对应CMake实现方法</a></li><li><a href="#8-设定编译选项" rel="noopener">8. 设定编译选项</a></li><li><a href="#9-safeseh报错" rel="noopener">9. SAFESEH报错</a></li><li><a href="#10-用了link_directory但是链接不到库" rel="noopener">10. 用了<code>link_directory()</code>但是链接不到库</a></li><li><a href="#11-debug库带d后缀" rel="noopener">11. Debug库带“d”后缀</a></li><li><a href="#12-在cmake中执行目录创建拷贝文件等脚本" rel="noopener">12. 在cmake中执行目录创建、拷贝文件等脚本</a></li><li><a href="#13-现代-cmake" rel="noopener">13. 现代 CMake</a></li><li><a href="#13-创建目录" rel="noopener">13. 创建目录</a></li><li><a href="#14-拷贝文件" rel="noopener">14. 拷贝文件</a></li><li><a href="#15-转换相对路径为绝对路径" rel="noopener">15. 转换相对路径为绝对路径</a></li><li><a href="#16-循环处理列表" rel="noopener">16. 循环处理列表</a></li><li><a href="#17-设置cc编译器" rel="noopener">17. 设置C/C++编译器</a></li><li><a href="#18-设定导入库imported及其属性" rel="noopener">18. 设定导入库(IMPORTED)及其属性</a></li><li><a href="#19-查看并修改visual-studio项目属性中的某个设定" rel="noopener">19. 查看并修改Visual Studio项目属性中的某个设定</a></li><li><a href="#20-添加宏定义" rel="noopener">20. 添加宏定义</a></li><li><a href="#21-设置fpie" rel="noopener">21. 设置fPIE</a></li><li><a href="#22-设置fpic" rel="noopener">22. 设置fPIC</a></li><li><a href="#23-linux-gcc添加链接库-lm" rel="noopener">23. Linux gcc添加链接库"-lm"</a></li><li><a href="#24-清空普通变量" rel="noopener">24. 清空普通变量</a></li><li><a href="#25-清除缓存变量" rel="noopener">25. 清除缓存变量</a></li><li><a href="#26-findxxxcmake简单例子" rel="noopener">26. FindXXX.cmake简单例子</a><ul><li><a href="#我理解的findxxxcmake基本步骤" rel="noopener">我理解的FindXXX.cmake基本步骤</a></li><li><a href="#例子1单个头文件和单个库文件" rel="noopener">例子1：单个头文件和单个库文件</a></li><li><a href="#例子2同时存在debug和release版本的库" rel="noopener">例子2：同时存在Debug和Release版本的库</a></li><li><a href="#例子3找dll" rel="noopener">例子3：找dll</a></li></ul></li><li><a href="#27-cmake各种编译链接参数的默认值" rel="noopener">27. CMake各种编译链接参数的默认值</a></li><li><a href="#28-链接器相关问题" rel="noopener">28. 链接器相关问题</a><ul><li><a href="#检查链接到的重名函数" rel="noopener">检查链接到的重名函数</a></li></ul></li><li><a href="#29-生成compile_commandsjson" rel="noopener">29. 生成<code>compile_commands.json</code></a></li><li><a href="#30-子目录cmakeliststxt中产生变量给父目录中的cmakeliststxt使用" rel="noopener">30. 子目录CMakeLists.txt中产生变量给父目录中的CMakeLists.txt使用</a></li><li><a href="#31-在ide中将targets分组显示使用folder" rel="noopener">31. 在IDE中将targets分组显示：使用folder</a></li><li><a href="#32-设置debug的优化级别参数" rel="noopener">32. 设置Debug的优化级别参数</a></li><li><a href="#33-cmake生成vs2019的工程" rel="noopener">33. cmake生成VS2019的工程</a></li><li><a href="#34-不要同时使用include_directories和target_include_directories" rel="noopener">34. 不要同时使用<code>include_directories()</code>和<code>target_include_directories()</code></a></li><li><a href="#35-ndk开发中出现error-cannot-use-try-with-exceptions-disabled" rel="noopener">35. NDK开发中出现<code>error: cannot use 'try' with exceptions disabled</code></a></li><li><a href="#36-cmake-gui中可见可检索的变量" rel="noopener">36. cmake-gui中可见（可检索）的变量</a></li><li><a href="#37-ninja-error-filename-longer-than-260-characters" rel="noopener">37. Ninja error: Filename longer than 260 characters</a></li><li><a href="#38-cmake判断cc编译器" rel="noopener">38. cmake判断C/C++编译器</a></li><li><a href="#39-cmake字符串追加元素并且用空格分隔" rel="noopener">39. cmake字符串追加元素，并且用空格分隔</a></li><li><a href="#40-cmake---build的使用cmake执行编译链接安装" rel="noopener">40. <code>cmake --build</code>的使用：cmake执行编译链接、安装</a></li><li><a href="#41-cc和汇编混编" rel="noopener">41. C/C++和汇编混编</a></li><li><a href="#42-cmake设置pthread" rel="noopener">42. cmake设置pthread</a></li><li><a href="#43-cmake使用pkg-config" rel="noopener">43. cmake使用pkg-config</a></li><li><a href="#44-cmake多行注释" rel="noopener">44. cmake多行注释</a></li><li><a href="#45-命令行-d指定参数" rel="noopener">45. 命令行<code>-D</code>指定参数</a></li><li><a href="#46-include指令" rel="noopener">46. <code>include()</code>指令</a></li><li><a href="#47-list追加元素或list首部插入元素" rel="noopener">47. list追加元素，或list首部插入元素</a></li><li><a href="#48-cmake中使用iwyu" rel="noopener">48. cmake中使用IWYU</a></li><li><a href="#49-target_link_libraries" rel="noopener">49. target_link_libraries()</a></li><li><a href="#50-cmake构建ndk项目提示asmtypesh找不到" rel="noopener">50. CMake构建NDK项目提示asm/types.h找不到</a></li><li><a href="#51-windows下创建的共享库没生成lib文件" rel="noopener">51. windows下创建的共享库，没生成.lib文件</a></li><li><a href="#52-拷贝dll" rel="noopener">52. 拷贝dll</a></li><li><a href="#53-压缩或解压ziptargz" rel="noopener">53. 压缩或解压.zip/tar.gz</a></li><li><a href="#54-列出所有target" rel="noopener">54. 列出所有target</a></li><li><a href="#55-判断文件是否存在" rel="noopener">55. 判断文件是否存在</a></li><li><a href="#56-打印变量" rel="noopener">56. 打印变量</a></li><li><a href="#57-判断是否为目录" rel="noopener">57. 判断是否为目录</a></li><li><a href="#58-visual-studio环境下的mtmtd-md-mdd的设定" rel="noopener">58. Visual Studio环境下的MT，MTd, MD, MDd的设定</a></li><li><a href="#59-设定address-sanitizerasan" rel="noopener">59. 设定Address Sanitizer(ASAN)</a></li><li><a href="#60-linux下编译32位程序" rel="noopener">60. Linux下编译32位程序</a></li><li><a href="#61-设置vs的可执行文件生成目录" rel="noopener">61. 设置VS的可执行文件生成目录</a></li><li><a href="#62-find_package等的debug输出" rel="noopener">62. find_package等的debug输出</a></li><li><a href="#63-命令行方式传入option的坑" rel="noopener">63. 命令行方式传入option的坑</a></li><li><a href="#64-powershell中从txt读内容传给cmake" rel="noopener">64. PowerShell中从txt读内容传给cmake</a></li><li><a href="#65-visual-studio-清理-cmake-缓存" rel="noopener">65. Visual Studio 清理 CMake 缓存</a></li></ul></div><p></p>
<h2 id="0-推荐使用至少315版本的cmake">0. 推荐使用至少3.15版本的cmake<button class="cnblogs-toc-button" title="显示目录导航" aria-expanded="false"></button></h2>
<h2 id="1-用于执行cmake的bat脚本">1. 用于执行CMake的.bat脚本<button class="cnblogs-toc-button" title="显示目录导航" aria-expanded="false"></button></h2>
<p>使用.bat脚本调用cmake，可以指定比较复杂的cmake.exe命令的参数。</p>
<p>e.g. <code>项目根目录/build/vs2017-x64.bat</code>，内容：</p>
<pre highlighted="true" cnb-code-toolbar-active="true"><code class="language-batch hljs"><table class="hljs-ln"><tbody><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="1"><div class="hljs-ln-n" data-line-number="1"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="1">@echo off</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="2"><div class="hljs-ln-n" data-line-number="2"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="2"> </td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="3"><div class="hljs-ln-n" data-line-number="3"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="3">:: build directory</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="4"><div class="hljs-ln-n" data-line-number="4"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="4">:: it should be similar name with cmake generator name</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="5"><div class="hljs-ln-n" data-line-number="5"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="5">set BUILD_DIR=vs2013-x64</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="6"><div class="hljs-ln-n" data-line-number="6"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="6"> </td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="7"><div class="hljs-ln-n" data-line-number="7"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="7">:: platform</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="8"><div class="hljs-ln-n" data-line-number="8"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="8">:: x86 or x64</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="9"><div class="hljs-ln-n" data-line-number="9"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="9">set BUILD_PLATFORM=x64</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="10"><div class="hljs-ln-n" data-line-number="10"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="10"> </td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="11"><div class="hljs-ln-n" data-line-number="11"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="11">:: cl.exe compiler version</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="12"><div class="hljs-ln-n" data-line-number="12"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="12">set BUILD_COMPILER=vc12</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="13"><div class="hljs-ln-n" data-line-number="13"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="13"> </td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="14"><div class="hljs-ln-n" data-line-number="14"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="14">:: create directory if not exist</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="15"><div class="hljs-ln-n" data-line-number="15"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="15">if not exist %BUILD_DIR% md %BUILD_DIR%</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="16"><div class="hljs-ln-n" data-line-number="16"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="16"> </td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="17"><div class="hljs-ln-n" data-line-number="17"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="17">:: go to build directory</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="18"><div class="hljs-ln-n" data-line-number="18"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="18">cd %BUILD_DIR%</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="19"><div class="hljs-ln-n" data-line-number="19"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="19"> </td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="20"><div class="hljs-ln-n" data-line-number="20"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="20">:: run cmake by specifing:</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="21"><div class="hljs-ln-n" data-line-number="21"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="21">:: - generator</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="22"><div class="hljs-ln-n" data-line-number="22"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="22">:: - installation directory</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="23"><div class="hljs-ln-n" data-line-number="23"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="23">:: - CMakeLists.txt location</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="24"><div class="hljs-ln-n" data-line-number="24"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="24">cmake -G "Visual Studio 12 2013 Win64" ^</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="25"><div class="hljs-ln-n" data-line-number="25"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="25">    -DCMAKE_INSTALL_PREFIX=D:/lib/glfw/3.3/%BUILD_PLATFORM%/%BUILD_COMPILER% ^</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="26"><div class="hljs-ln-n" data-line-number="26"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="26">    ../..</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="27"><div class="hljs-ln-n" data-line-number="27"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="27"> </td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="28"><div class="hljs-ln-n" data-line-number="28"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="28">:: run build by specifying config and target</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="29"><div class="hljs-ln-n" data-line-number="29"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="29">:: note: this may fail, and please open .sln and do manual compilation and installation</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="30"><div class="hljs-ln-n" data-line-number="30"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="30">cmake --build . --config Release --target INSTALL</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="31"><div class="hljs-ln-n" data-line-number="31"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="31"> </td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="32"><div class="hljs-ln-n" data-line-number="32"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="32">:: go back to old folder</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="33"><div class="hljs-ln-n" data-line-number="33"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="33">cd ..</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="34"><div class="hljs-ln-n" data-line-number="34"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="34"> </td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="35"><div class="hljs-ln-n" data-line-number="35"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="35">:: stuck to show build messages</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="36"><div class="hljs-ln-n" data-line-number="36"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="36">pause</td></tr></tbody></table></code><div class="cnb-code-toolbar" style="left: 571px;"><span class="cnb-code-toolbar-item" cnb-code-toolbar-item-id="language-1649917373796">BATCH</span><span class="cnb-code-toolbar-item" cnb-code-toolbar-item-id="copy-1649917373796"><svg class="cnb-code-toolbar-icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg"><path d="M878.250667 981.333333H375.338667a104.661333 104.661333 0 0 1-104.661334-104.661333V375.338667a104.661333 104.661333 0 0 1 104.661334-104.661334h502.912a104.661333 104.661333 0 0 1 104.661333 104.661334v502.912C981.333333 934.485333 934.485333 981.333333 878.250667 981.333333zM375.338667 364.373333a10.666667 10.666667 0 0 0-10.922667 10.965334v502.912c0 6.229333 4.693333 10.922667 10.922667 10.922666h502.912a10.666667 10.666667 0 0 0 10.922666-10.922666V375.338667a10.666667 10.666667 0 0 0-10.922666-10.922667H375.338667z"/><path d="M192.597333 753.322667H147.328A104.661333 104.661333 0 0 1 42.666667 648.661333V147.328A104.661333 104.661333 0 0 1 147.328 42.666667H650.24a104.661333 104.661333 0 0 1 104.618667 104.661333v49.962667c0 26.538667-20.309333 46.848-46.848 46.848a46.037333 46.037333 0 0 1-46.848-46.848V147.328a10.666667 10.666667 0 0 0-10.922667-10.965333H147.328a10.666667 10.666667 0 0 0-10.965333 10.965333V650.24c0 6.229333 4.693333 10.922667 10.965333 10.922667h45.269333c26.538667 0 46.848 20.309333 46.848 46.848 0 26.538667-21.845333 45.312-46.848 45.312z"/></svg> 复制</span><span class="cnb-code-toolbar-item" cnb-code-toolbar-item-id="fullscreen-1649917373796"><svg class="cnb-code-toolbar-icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg"><path d="M149.52928355 149.52928355h258.90765513V45.96622222H97.74775349a51.78153127 51.78153127 0 0 0-51.78153127 51.78153127v310.68918519h103.56306133V149.52928355zM97.74775349 978.03377778h310.68918519v-103.56306133H149.52928355v-258.90765513H45.96622222v310.68918519a51.78153127 51.78153127 0 0 0 51.78153127 51.78153127z m880.28602429-51.78153127v-310.68918519h-103.56306133v258.90765513h-258.90765513v103.56306133h310.68918519a51.78153127 51.78153127 0 0 0 51.78153127-51.78153127zM615.56306132 149.52928355h258.90765513v258.90765513h103.56306133V97.74775349a51.78153127 51.78153127 0 0 0-51.78153127-51.78153127h-310.68918519v103.56306133z" fill=""/></svg> 全屏</span></div></pre>
<h2 id="2-判断平台32位还是64位">2. 判断平台：32位还是64位？<button class="cnblogs-toc-button" title="显示目录导航" aria-expanded="false"></button></h2>
<p><em>能写64位程序的时候轻易别写32位程序</em></p>
<p>方法1：<code>CMAKE_SIZEOF_VOID_P</code> 表示 void* 的大小（例如为 4 或者 8），可以使用其来判断当前构建为 32 位还是 64 位 (<strong>cmake官方推荐方法</strong>)</p>
<pre highlighted="true"><code class="language-cmake hljs"><table class="hljs-ln"><tbody><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="1"><div class="hljs-ln-n" data-line-number="1"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="1"><span class="hljs-keyword">if</span>(CMAKE_SIZEOF_VOID_P <span class="hljs-keyword">EQUAL</span> <span class="hljs-number">8</span>)</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="2"><div class="hljs-ln-n" data-line-number="2"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="2">    <span class="hljs-keyword">message</span>(STATUE <span class="hljs-string">"64bit"</span>)</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="3"><div class="hljs-ln-n" data-line-number="3"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="3"><span class="hljs-keyword">else</span>()</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="4"><div class="hljs-ln-n" data-line-number="4"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="4">    <span class="hljs-keyword">message</span>(STATUE <span class="hljs-string">"32bit"</span>)</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="5"><div class="hljs-ln-n" data-line-number="5"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="5"><span class="hljs-keyword">endif</span>()</td></tr></tbody></table></code></pre>
<p>方法2：判断<code>CMAKE_CL_64</code>是否为true。(<strong>cmake官方已经明确不推荐使用</strong>)</p>
<blockquote>
<p>CMAKE_CL_64: Set to a true value when using a Microsoft Visual Studio cl compiler that targets a 64-bit architecture.</p>
</blockquote>
<p>适用条件：只适合Windows上的64位判断。</p>
<pre highlighted="true"><code class="language-cmake hljs"><table class="hljs-ln"><tbody><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="1"><div class="hljs-ln-n" data-line-number="1"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="1"><span class="hljs-comment">##################################################</span></td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="2"><div class="hljs-ln-n" data-line-number="2"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="2"><span class="hljs-comment"># platform</span></td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="3"><div class="hljs-ln-n" data-line-number="3"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="3"><span class="hljs-comment">##################################################</span></td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="4"><div class="hljs-ln-n" data-line-number="4"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="4"><span class="hljs-keyword">if</span>(CMAKE_CL_64)</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="5"><div class="hljs-ln-n" data-line-number="5"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="5">    <span class="hljs-keyword">message</span>(STATUS <span class="hljs-string">"MSVC 64bit"</span>)</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="6"><div class="hljs-ln-n" data-line-number="6"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="6"><span class="hljs-keyword">else</span>()</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="7"><div class="hljs-ln-n" data-line-number="7"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="7">    <span class="hljs-keyword">message</span>(STATUS <span class="hljs-string">"MSVC 32bit"</span>)</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="8"><div class="hljs-ln-n" data-line-number="8"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="8"><span class="hljs-keyword">endif</span>()</td></tr></tbody></table></code></pre>
<h2 id="3-判断visual-studio版本">3. 判断Visual Studio版本<button class="cnblogs-toc-button" title="显示目录导航" aria-expanded="false"></button></h2>
<p>参考: <a href="https://dev.to/yumetodo/list-of-mscver-and-mscfullver-8nd" target="_blank" rel="noopener">List of _MSC_VER and _MSC_FULL_VER</a></p>
<pre highlighted="true"><code class="language-cmake hljs"><table class="hljs-ln"><tbody><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="1"><div class="hljs-ln-n" data-line-number="1"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="1"><span class="hljs-comment">##################################################</span></td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="2"><div class="hljs-ln-n" data-line-number="2"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="2"><span class="hljs-comment"># visual studio version</span></td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="3"><div class="hljs-ln-n" data-line-number="3"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="3"><span class="hljs-comment">#</span></td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="4"><div class="hljs-ln-n" data-line-number="4"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="4"><span class="hljs-keyword">if</span>(MSVC_VERSION <span class="hljs-keyword">EQUAL</span> <span class="hljs-number">1600</span>)</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="5"><div class="hljs-ln-n" data-line-number="5"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="5">    <span class="hljs-keyword">set</span>(vs_version vs2010)</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="6"><div class="hljs-ln-n" data-line-number="6"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="6">    <span class="hljs-keyword">set</span>(vc_version vc10)</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="7"><div class="hljs-ln-n" data-line-number="7"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="7"><span class="hljs-keyword">elseif</span>(MSVC_VERSION <span class="hljs-keyword">EQUAL</span> <span class="hljs-number">1700</span>)</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="8"><div class="hljs-ln-n" data-line-number="8"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="8">    <span class="hljs-keyword">set</span>(vs_version vs2012)</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="9"><div class="hljs-ln-n" data-line-number="9"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="9">    <span class="hljs-keyword">set</span>(vc_version vc11)</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="10"><div class="hljs-ln-n" data-line-number="10"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="10"><span class="hljs-keyword">elseif</span>(MSVC_VERSION <span class="hljs-keyword">EQUAL</span> <span class="hljs-number">1800</span>)</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="11"><div class="hljs-ln-n" data-line-number="11"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="11">    <span class="hljs-keyword">set</span>(vs_version vs2013)</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="12"><div class="hljs-ln-n" data-line-number="12"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="12">    <span class="hljs-keyword">set</span>(vc_version vc12)</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="13"><div class="hljs-ln-n" data-line-number="13"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="13"><span class="hljs-keyword">elseif</span>(MSVC_VERSION <span class="hljs-keyword">EQUAL</span> <span class="hljs-number">1900</span>)</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="14"><div class="hljs-ln-n" data-line-number="14"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="14">    <span class="hljs-keyword">set</span>(vs_version vs2015)</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="15"><div class="hljs-ln-n" data-line-number="15"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="15">    <span class="hljs-keyword">set</span>(vc_version vc14)</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="16"><div class="hljs-ln-n" data-line-number="16"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="16"><span class="hljs-keyword">elseif</span>(MSVC_VERSION <span class="hljs-keyword">GREATER_EQUAL</span> <span class="hljs-number">1910</span> <span class="hljs-keyword">AND</span> MSVC_VERSION <span class="hljs-keyword">LESS_EQUAL</span> <span class="hljs-number">1920</span>)</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="17"><div class="hljs-ln-n" data-line-number="17"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="17">    <span class="hljs-keyword">set</span>(vs_version vs2017)</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="18"><div class="hljs-ln-n" data-line-number="18"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="18">    <span class="hljs-keyword">set</span>(vc_version vc15)</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="19"><div class="hljs-ln-n" data-line-number="19"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="19"><span class="hljs-keyword">elseif</span>(MSVC_VERSION <span class="hljs-keyword">GREATER_EQUAL</span> <span class="hljs-number">1920</span>)</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="20"><div class="hljs-ln-n" data-line-number="20"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="20">    <span class="hljs-keyword">set</span>(vs_version vs2019)</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="21"><div class="hljs-ln-n" data-line-number="21"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="21">    <span class="hljs-keyword">set</span>(vc_version vc15)</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="22"><div class="hljs-ln-n" data-line-number="22"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="22"><span class="hljs-keyword">endif</span>()</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="23"><div class="hljs-ln-n" data-line-number="23"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="23"> </td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="24"><div class="hljs-ln-n" data-line-number="24"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="24"><span class="hljs-keyword">message</span>(STATUS <span class="hljs-string">"----- vs_version is: ${vs_version}"</span>)</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="25"><div class="hljs-ln-n" data-line-number="25"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="25"><span class="hljs-keyword">message</span>(STATUS <span class="hljs-string">"----- vc_version is: ${vc_version}"</span>)</td></tr></tbody></table></code></pre>
<h2 id="4-判断操作系统">4. 判断操作系统<button class="cnblogs-toc-button" title="显示目录导航" aria-expanded="false"></button></h2>
<p>注：其中WIN32判断的是windows系统，包括32位和64位两种情况</p>
<pre highlighted="true"><code class="language-cmake hljs"><table class="hljs-ln"><tbody><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="1"><div class="hljs-ln-n" data-line-number="1"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="1"><span class="hljs-keyword">if</span>(WIN32)</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="2"><div class="hljs-ln-n" data-line-number="2"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="2">    <span class="hljs-keyword">message</span>(STATUS <span class="hljs-string">"----- This is Windows."</span>)</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="3"><div class="hljs-ln-n" data-line-number="3"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="3"><span class="hljs-keyword">elseif</span>(UNIX)</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="4"><div class="hljs-ln-n" data-line-number="4"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="4">    <span class="hljs-keyword">message</span>(STATUS <span class="hljs-string">"----- This is UNIX."</span>) <span class="hljs-comment">#Linux下输出这个</span></td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="5"><div class="hljs-ln-n" data-line-number="5"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="5"><span class="hljs-keyword">elseif</span>(APPLE)</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="6"><div class="hljs-ln-n" data-line-number="6"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="6">    <span class="hljs-keyword">message</span>(STATUS <span class="hljs-string">"----- This is APPLE."</span>)</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="7"><div class="hljs-ln-n" data-line-number="7"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="7"><span class="hljs-keyword">elseif</span>(ANDROID)</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="8"><div class="hljs-ln-n" data-line-number="8"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="8">    <span class="hljs-keyword">message</span>(STATUS <span class="hljs-string">"----- This is ANDROID."</span>)</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="9"><div class="hljs-ln-n" data-line-number="9"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="9"><span class="hljs-keyword">endif</span>(WIN32)</td></tr></tbody></table></code></pre>
<p>另一种写法：</p>
<pre highlighted="true"><code class="language-cmake hljs"><table class="hljs-ln"><tbody><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="1"><div class="hljs-ln-n" data-line-number="1"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="1"><span class="hljs-keyword">if</span> (CMAKE_SYSTEM_NAME <span class="hljs-keyword">MATCHES</span> <span class="hljs-string">"Windows"</span>)</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="2"><div class="hljs-ln-n" data-line-number="2"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="2">    <span class="hljs-keyword">message</span>(STATUS <span class="hljs-string">"----- OS: Windows"</span>)</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="3"><div class="hljs-ln-n" data-line-number="3"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="3"><span class="hljs-keyword">elseif</span>(CMAKE_SYSTEM_NAME <span class="hljs-keyword">MATCHES</span> <span class="hljs-string">"Linux"</span>)</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="4"><div class="hljs-ln-n" data-line-number="4"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="4">    <span class="hljs-keyword">message</span>(STATUS <span class="hljs-string">"----- OS: Linux"</span>)</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="5"><div class="hljs-ln-n" data-line-number="5"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="5"><span class="hljs-keyword">elseif</span>(CMAKE_SYSTEM_NAME <span class="hljs-keyword">MATCHES</span> <span class="hljs-string">"Darwin"</span>)</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="6"><div class="hljs-ln-n" data-line-number="6"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="6">    <span class="hljs-keyword">message</span>(STATUS <span class="hljs-string">"----- OS: MacOS X"</span>)</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="7"><div class="hljs-ln-n" data-line-number="7"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="7"><span class="hljs-keyword">elseif</span>(CMAKE_SYSTEM_NAME <span class="hljs-keyword">MATCHES</span> <span class="hljs-string">"Android"</span>)</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="8"><div class="hljs-ln-n" data-line-number="8"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="8">    <span class="hljs-keyword">message</span>(STATUS <span class="hljs-string">"----- OS: Android"</span>)</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="9"><div class="hljs-ln-n" data-line-number="9"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="9"><span class="hljs-keyword">endif</span>()</td></tr></tbody></table></code></pre>
<p>测试发现，如果在<code>CMAKE_MINIMUM_VERSION()</code>后立即使用<code>CMAKE_SYSTEM_NAME</code>，Linux下得到结果为空，Android下得到为Android。看起来是Android的toolchain中进行了设定。</p>
<h2 id="5-判断是debug还是release等版本">5. 判断是Debug还是Release等版本<button class="cnblogs-toc-button" title="显示目录导航" aria-expanded="false"></button></h2>
<p>(1) <code>CMAKE_BUILD_TYPE</code>取值：默认值由编译器决定，调用cmake时可通过<code>-DCMAKE_BUILD_TYPE=Release</code>的形式指定其值。</p>
<p>看文档的话，是用<code>CMAKE_BUILD_TYPE</code>判断Debug/Release模式。然而CMake文档的描述其实有问题，不清晰。这个变量的值是由编译器决定的。对于VS2017，默认情况下为空。</p>
<blockquote>
<p>The default will be "empty" or "Debug" depending on the compiler. The value of the variable will be only of interest in places where SOME_VAR_${CONFIG} is used. So to answer your question. From my understanding the debug flags could be added. The documentation (<a href="http://www.cmake.org/cmake/help/v3.3/variable/CMAKE_BUILD_TYPE.html" target="_blank" rel="noopener">http://www.cmake.org/cmake/help/v3.3/variable/CMAKE_BUILD_TYPE.html</a>) is unfortunately not so clear</p>
</blockquote>
<p>ref: <a href="https://stackoverflow.com/questions/32498109/what-happens-for-c-c-builds-if-cmake-build-type-is-empty" target="_blank" rel="noopener">What happens for C/C++ builds if CMAKE_BUILD_TYPE is empty?</a></p>
<p>(2) 值的判断<br />
Debug和Release，用MATCHES判断；<br />
空值""用NOT判断.</p>
<pre highlighted="true"><code class="language-cmake hljs"><table class="hljs-ln"><tbody><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="1"><div class="hljs-ln-n" data-line-number="1"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="1"><span class="hljs-keyword">if</span> (CMAKE_BUILD_TYPE <span class="hljs-keyword">MATCHES</span> <span class="hljs-string">"Debug"</span> <span class="hljs-keyword">OR</span> CMAKE_BUILD_TYPE <span class="hljs-keyword">EQUAL</span> <span class="hljs-string">"None"</span> <span class="hljs-keyword">OR</span> <span class="hljs-keyword">NOT</span> CMAKE_BUILD_TYPE)</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="2"><div class="hljs-ln-n" data-line-number="2"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="2">    <span class="hljs-keyword">message</span>(STATUS <span class="hljs-string">"----- CMAKE_BUILD_TYPE is Debug"</span>)</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="3"><div class="hljs-ln-n" data-line-number="3"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="3"><span class="hljs-keyword">elseif</span> (CMAKE_BUILD_TYPE <span class="hljs-keyword">MATCHES</span> <span class="hljs-string">"Release"</span>)</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="4"><div class="hljs-ln-n" data-line-number="4"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="4">    <span class="hljs-keyword">message</span>(STATUS <span class="hljs-string">"----- CMAKE_BUILD_TYPE is Release"</span>)</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="5"><div class="hljs-ln-n" data-line-number="5"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="5"><span class="hljs-keyword">elseif</span> (CMAKE_BUILD_TYPE <span class="hljs-keyword">MATCHES</span> <span class="hljs-string">"RelWitchDebInfo"</span>)</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="6"><div class="hljs-ln-n" data-line-number="6"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="6">    <span class="hljs-keyword">message</span>(STATUS <span class="hljs-string">"----- CMAKE_BUILD_TYPE is RelWitchDebInfo"</span>)</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="7"><div class="hljs-ln-n" data-line-number="7"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="7"><span class="hljs-keyword">elseif</span> (CMAKE_BUILD_TYPE <span class="hljs-keyword">MATCHES</span> <span class="hljs-string">"MinSizeRel"</span>)</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="8"><div class="hljs-ln-n" data-line-number="8"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="8">    <span class="hljs-keyword">message</span>(STATUS <span class="hljs-string">"----- CMAKE_BUILD_TYPE is MinSizeRel"</span>)</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="9"><div class="hljs-ln-n" data-line-number="9"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="9"><span class="hljs-keyword">else</span> ()</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="10"><div class="hljs-ln-n" data-line-number="10"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="10">    <span class="hljs-keyword">message</span>(STATUS <span class="hljs-string">"----- unknown CMAKE_BUILD_TYPE = "</span> <span class="hljs-variable">${CMAKE_BUILD_TYPE}</span>)</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="11"><div class="hljs-ln-n" data-line-number="11"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="11"><span class="hljs-keyword">endif</span> ()</td></tr></tbody></table></code></pre>
<h2 id="6-根据debugrelease添加不同的库目录">6. 根据Debug/Release添加不同的库目录<button class="cnblogs-toc-button" title="显示目录导航" aria-expanded="false"></button></h2>
<p>在Visual Studio平台下测试发现，如果指定了A目录到库搜索目录，并且A目录下有名为Debug/Release的目录，则会自动把A/Debug和A/Release添加到库搜索目录。</p>
<pre highlighted="true"><code class="language-cmake hljs"><table class="hljs-ln"><tbody><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="1"><div class="hljs-ln-n" data-line-number="1"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="1"><span class="hljs-keyword">set</span>(MY_LIB_DIR</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="2"><div class="hljs-ln-n" data-line-number="2"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="2"><span class="hljs-string">"testbed/lib/"</span></td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="3"><div class="hljs-ln-n" data-line-number="3"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="3"><span class="hljs-string">"testbed/lib/ceva/"</span></td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="4"><div class="hljs-ln-n" data-line-number="4"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="4">)</td></tr></tbody></table></code></pre>
<p><img src="https://img2018.cnblogs.com/blog/495962/201907/495962-20190726181131478-1306583456.png" alt="" loading="lazy" /></p>
<p>因而，至少在VS平台下，不需要手动根据Debug和Release来分别添加库。</p>
<h2 id="7-visual-studio属性与对应cmake实现方法">7. Visual Studio属性与对应CMake实现方法<button class="cnblogs-toc-button" title="显示目录导航" aria-expanded="false"></button></h2>
<p>见<a href="https://blog.csdn.net/xum2008/article/details/7268761" target="_blank" rel="noopener">CMAKE修改VS大总结</a></p>
<h2 id="8-设定编译选项">8. 设定编译选项<button class="cnblogs-toc-button" title="显示目录导航" aria-expanded="false"></button></h2>
<p>也即修改<code>CMAKE_C_FLAGS</code>、<code>CMAKE_CXX_FLAGS</code>变量。例如追加两个选项：</p>
<pre highlighted="true"><code class="language-cmake hljs"><table class="hljs-ln"><tbody><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="1"><div class="hljs-ln-n" data-line-number="1"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="1"><span class="hljs-keyword">set</span>(CMAKE_C_FLAGS <span class="hljs-string">"${CMAKE_C_FLAGS} /we4013 /we4431"</span>)</td></tr></tbody></table></code></pre>
<h2 id="9-safeseh报错">9. SAFESEH报错<button class="cnblogs-toc-button" title="显示目录导航" aria-expanded="false"></button></h2>
<p>报错信息例如：</p>
<pre highlighted="true"><code class="hljs language-vbnet"><table class="hljs-ln"><tbody><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="1"><div class="hljs-ln-n" data-line-number="1"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="1">CalcSum_.obj : <span class="hljs-keyword">error</span> LNK2026: 模块对于 SAFESEH 映像是不安全的。 [E:\dbg\zz\assemble\build\vs2013\run.vcxproj]</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="2"><div class="hljs-ln-n" data-line-number="2"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="2"><span class="hljs-symbol">E:</span>\dbg\zz\assemble\build\vs2013\Debug\run.exe : fatal <span class="hljs-keyword">error</span> LNK1281: 无法生成 SAFESEH 映像。 [E:\dbg\zz\assemble\build\vs2013\</td></tr></tbody></table></code></pre>
<p>简单粗暴的解决办法：</p>
<pre highlighted="true"><code class="language-cmake hljs"><table class="hljs-ln"><tbody><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="1"><div class="hljs-ln-n" data-line-number="1"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="1"><span class="hljs-keyword">if</span> (CMAKE_SYSTEM_NAME <span class="hljs-keyword">MATCHES</span> <span class="hljs-string">"Windows"</span>)</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="2"><div class="hljs-ln-n" data-line-number="2"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="2">    <span class="hljs-comment">#message("inside windows")</span></td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="3"><div class="hljs-ln-n" data-line-number="3"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="3">    <span class="hljs-comment"># add SAFESEH to Visual Studio. copied from http://www.reactos.org/pipermail/ros-diffs/2010-November/039192.html</span></td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="4"><div class="hljs-ln-n" data-line-number="4"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="4">    <span class="hljs-comment">#if(${_MACHINE_ARCH_FLAG} MATCHES X86) # fails</span></td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="5"><div class="hljs-ln-n" data-line-number="5"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="5">    <span class="hljs-comment">#message("inside that branch")</span></td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="6"><div class="hljs-ln-n" data-line-number="6"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="6">    </td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="7"><div class="hljs-ln-n" data-line-number="7"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="7">    <span class="hljs-comment"># in VS2013, there is: fatal error LNK1104: cannot open file "LIBC.lib"</span></td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="8"><div class="hljs-ln-n" data-line-number="8"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="8">    <span class="hljs-comment"># so, we have to add /NODEFAULTLIB:LIBC.LIB</span></td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="9"><div class="hljs-ln-n" data-line-number="9"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="9">    <span class="hljs-comment"># reference: https://stackoverflow.com/questions/6016649/cannot-open-file-libc-lib</span></td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="10"><div class="hljs-ln-n" data-line-number="10"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="10">    <span class="hljs-keyword">set</span> (CMAKE_EXE_LINKER_FLAGS <span class="hljs-string">"${CMAKE_EXE_LINKER_FLAGS} /SAFESEH:NO /NODEFAULTLIB:LIBC.LIB"</span>) </td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="11"><div class="hljs-ln-n" data-line-number="11"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="11">    <span class="hljs-keyword">set</span> (CMAKE_SHARED_LINKER_FLAGS <span class="hljs-string">"${CMAKE_SHARED_LINKER_FLAGS} /SAFESEH:NO /NODEFAULTLIB:LIBC.LIB"</span>)</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="12"><div class="hljs-ln-n" data-line-number="12"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="12">    <span class="hljs-keyword">set</span> (CMAKE_MODULE_LINKER_FLAGS <span class="hljs-string">"${CMAKE_MODULE_LINKER_FLAGS} /SAFESEH:NO /NODEFAULTLIB:LIBC.LIB"</span>)</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="13"><div class="hljs-ln-n" data-line-number="13"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="13">    <span class="hljs-comment">#endif()</span></td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="14"><div class="hljs-ln-n" data-line-number="14"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="14"><span class="hljs-keyword">endif</span> (CMAKE_SYSTEM_NAME <span class="hljs-keyword">MATCHES</span> <span class="hljs-string">"Windows"</span>)</td></tr></tbody></table></code></pre>
<h2 id="10-用了link_directory但是链接不到库">10. 用了<code>link_directory()</code>但是链接不到库<button class="cnblogs-toc-button" title="显示目录导航" aria-expanded="false"></button></h2>
<p>link_directories()  这句话必须在add_executable()之前写 不然找不到库目录</p>
<p>或者先add_executable() 再 target_link_directories(XXX PRIVATE some direcotry)</p>
<h2 id="11-debug库带d后缀">11. Debug库带“d”后缀<button class="cnblogs-toc-button" title="显示目录导航" aria-expanded="false"></button></h2>
<p>设置debug模式下编译出的库文件，相比于release模式下，多带一个字母"d"作为后缀。</p>
<p>对于单个目录：</p>
<pre highlighted="true"><code class="language-cmake hljs"><table class="hljs-ln"><tbody><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="1"><div class="hljs-ln-n" data-line-number="1"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="1"><span class="hljs-keyword">set_target_properties</span>(TargetName PROPERTIES DEBUG_POSTFIX d)</td></tr></tbody></table></code></pre>
<p>对于整个CMakeLists.txt:</p>
<pre highlighted="true"><code class="language-cmake hljs"><table class="hljs-ln"><tbody><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="1"><div class="hljs-ln-n" data-line-number="1"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="1"><span class="hljs-keyword">set</span>(CMAKE_DEBUG_POSTFIX d)</td></tr></tbody></table></code></pre>
<p>也可以在调用cmake时临时指定（例如google的crc32c库、libjpeg-turbo库，作者打死都不肯加postfix的），自己动手丰衣足食：</p>
<pre highlighted="true"><code class="language-batch hljs"><table class="hljs-ln"><tbody><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="1"><div class="hljs-ln-n" data-line-number="1"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="1">-DCMAKE_DEBUG_POSTFIX=d</td></tr></tbody></table></code></pre>
<h2 id="12-在cmake中执行目录创建拷贝文件等脚本">12. 在cmake中执行目录创建、拷贝文件等脚本<button class="cnblogs-toc-button" title="显示目录导航" aria-expanded="false"></button></h2>
<p>例如创建完调用lmdb库的可执行程序这一target后，需要创建目录。不想每次都手动去创建一个目录，希望在CMakeLists.txt中添加这个操作。</p>
<p>尝试了<code>add_custom_command()</code>，不怎么会用。。没有效果，不被调用。</p>
<p>用<code>execute_process()</code>则是可以的，例如：</p>
<pre highlighted="true"><code class="language-cmake hljs"><table class="hljs-ln"><tbody><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="1"><div class="hljs-ln-n" data-line-number="1"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="1"><span class="hljs-keyword">execute_process</span>(<span class="hljs-keyword">COMMAND</span> echo <span class="hljs-string">"====="</span>)</td></tr></tbody></table></code></pre>
<h2 id="13-现代-cmake">13. 现代 CMake<button class="cnblogs-toc-button" title="显示目录导航" aria-expanded="false"></button></h2>
<p><a href="https://pabloariasal.github.io/2018/02/19/its-time-to-do-cmake-right/" target="_blank" rel="noopener">It's Time To Do CMake Right</a></p>
<p><a href="https://moevis.github.io/cheatsheet/2018/09/12/Modern-CMake-%E7%AC%94%E8%AE%B0.html" target="_blank" rel="noopener">https://moevis.github.io/cheatsheet/2018/09/12/Modern-CMake-笔记.html</a></p>
<p><a href="https://cliutils.gitlab.io/modern-cmake/modern-cmake.pdf" target="_blank" rel="noopener">https://cliutils.gitlab.io/modern-cmake/modern-cmake.pdf</a></p>
<p><a href="https://cliutils.gitlab.io/modern-cmake/" target="_blank" rel="noopener">https://cliutils.gitlab.io/modern-cmake/</a></p>
<p>目前我主要用这几个（而不是会影响到所有target的全局设定）：</p>
<p><code>target_compile_definitions()</code>： 目标添加编译器编译选项，例如<code>target_compile_definitions(shadow_jni PRIVATE -DUSE_STB -DUSE_ARM)</code></p>
<p><code>target_include_directories()</code>：目标添加包含文件，例如<code>target_include_directories(shadow_jni PRIVATE "shadow_jni/body_detection" "shadow_jni/util" ${SNPE_INC_DIR})</code></p>
<p><code>target_link_directories()</code>：目标添加链接库查找目录，例如<code>target_link_directories(shadow_jni PRIVATE ${SNPE_LIB_DIR})</code></p>
<p><code>target_link_libraries()</code>：目标添加链接库，例如<code>target_link_libraries(shadow_jni ${log-lib} ${graph-lib} ${SNPE_LIB})</code></p>
<p>此外，还有一些cmake方面的专家的问答、博客等可以关注一下：</p>
<ul>
<li><a href="https://stackoverflow.com/users/4763489/florian" target="_blank" rel="noopener">StackOverFlow用户Florian</a></li>
</ul>
<h2 id="13-创建目录">13. 创建目录<button class="cnblogs-toc-button" title="显示目录导航" aria-expanded="false"></button></h2>
<pre highlighted="true"><code class="hljs language-cmake"><table class="hljs-ln"><tbody><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="1"><div class="hljs-ln-n" data-line-number="1"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="1"><span class="hljs-keyword">file</span>(<span class="hljs-keyword">MAKE_DIRECTORY</span> <span class="hljs-variable">${SO_OUTPUT_PATH}</span>)</td></tr></tbody></table></code></pre>
<p>ref: <a href="https://stackoverflow.com/questions/3702115/creating-a-directory-in-cmake" target="_blank" rel="noopener">Creating a directory in CMake</a></p>
<h2 id="14-拷贝文件">14. 拷贝文件<button class="cnblogs-toc-button" title="显示目录导航" aria-expanded="false"></button></h2>
<p>包括两种类型：<br />
（1）和某个target绑定的文件拷贝，使用<code>add_custom_command()</code>；</p>
<pre highlighted="true"><code class="language-cmake hljs"><table class="hljs-ln"><tbody><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="1"><div class="hljs-ln-n" data-line-number="1"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="1"><span class="hljs-keyword">add_custom_command</span>(<span class="hljs-keyword">TARGET</span> your_target</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="2"><div class="hljs-ln-n" data-line-number="2"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="2">        PRE_BUILD</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="3"><div class="hljs-ln-n" data-line-number="3"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="3"> </td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="4"><div class="hljs-ln-n" data-line-number="4"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="4">        <span class="hljs-keyword">COMMAND</span> <span class="hljs-variable">${CMAKE_COMMAND}</span> -E copy</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="5"><div class="hljs-ln-n" data-line-number="5"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="5">        <span class="hljs-variable">${MY_SO_NAME}</span></td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="6"><div class="hljs-ln-n" data-line-number="6"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="6">        <span class="hljs-variable">${SO_OUTPUT_PATH}</span>/</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="7"><div class="hljs-ln-n" data-line-number="7"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="7">)</td></tr></tbody></table></code></pre>
<p>（2）和target无关的，或者说对于所有target而言都需要做文件拷贝，用<code>execute_process()</code>：</p>
<pre highlighted="true"><code class="language-cmake hljs"><table class="hljs-ln"><tbody><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="1"><div class="hljs-ln-n" data-line-number="1"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="1"><span class="hljs-keyword">foreach</span>(lib_name_pth <span class="hljs-variable">${LIBS_TO_COPY}</span>)</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="2"><div class="hljs-ln-n" data-line-number="2"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="2">    <span class="hljs-keyword">message</span>(STATUS <span class="hljs-string">"--- ${lib_name_pth}"</span>)</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="3"><div class="hljs-ln-n" data-line-number="3"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="3">    <span class="hljs-keyword">execute_process</span>(<span class="hljs-keyword">COMMAND</span> <span class="hljs-variable">${CMAKE_COMMAND}</span> -E copy <span class="hljs-variable">${lib_name_pth}</span> <span class="hljs-variable">${SO_OUTPUT_PATH}</span>)</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="4"><div class="hljs-ln-n" data-line-number="4"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="4"><span class="hljs-keyword">endforeach</span>()</td></tr></tbody></table></code></pre>
<h2 id="15-转换相对路径为绝对路径">15. 转换相对路径为绝对路径<button class="cnblogs-toc-button" title="显示目录导航" aria-expanded="false"></button></h2>
<pre highlighted="true"><code class="language-cmake hljs"><table class="hljs-ln"><tbody><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="1"><div class="hljs-ln-n" data-line-number="1"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="1"><span class="hljs-keyword">get_filename_component</span>(SO_OUTPUT_PATH_ABS</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="2"><div class="hljs-ln-n" data-line-number="2"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="2">        <span class="hljs-variable">${CMAKE_CURRENT_SOURCE_DIR}</span>/../../../libs/<span class="hljs-variable">${ANDROID_ABI}</span></td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="3"><div class="hljs-ln-n" data-line-number="3"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="3">        ABSOLUTE)</td></tr></tbody></table></code></pre>
<p>ref: <a href="https://stackoverflow.com/questions/39027269/cmake-convert-relative-path-to-absolute-path-with-build-directory-as-current-d" target="_blank" rel="noopener">CMake: Convert relative path to absolute path, with build directory as current directory</a></p>
<h2 id="16-循环处理列表">16. 循环处理列表<button class="cnblogs-toc-button" title="显示目录导航" aria-expanded="false"></button></h2>
<p>cmake中的列表也是字符串，不过，通过<code>list(APPEND)</code>得到的列表字符串，可以用<code>foreach</code>来遍历其中每个字符串。举例：</p>
<pre highlighted="true"><code class="language-cmake hljs"><table class="hljs-ln"><tbody><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="1"><div class="hljs-ln-n" data-line-number="1"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="1"><span class="hljs-keyword">foreach</span>(loop_var arg1 arg2 arg3)</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="2"><div class="hljs-ln-n" data-line-number="2"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="2">    <span class="hljs-keyword">message</span>(STATUS <span class="hljs-string">"--- ${loop_var}"</span>)</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="3"><div class="hljs-ln-n" data-line-number="3"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="3"><span class="hljs-keyword">endforeach</span>(loop_var)</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="4"><div class="hljs-ln-n" data-line-number="4"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="4"> </td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="5"><div class="hljs-ln-n" data-line-number="5"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="5"><span class="hljs-keyword">foreach</span>(loop_var <span class="hljs-variable">${SNPE_LIB_ALL}</span>)</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="6"><div class="hljs-ln-n" data-line-number="6"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="6">    <span class="hljs-keyword">message</span>(STATUS <span class="hljs-string">"--- ${loop_var}"</span>)</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="7"><div class="hljs-ln-n" data-line-number="7"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="7"><span class="hljs-keyword">endforeach</span>(loop_var)</td></tr></tbody></table></code></pre>
<h2 id="17-设置cc编译器">17. 设置C/C++编译器<button class="cnblogs-toc-button" title="显示目录导航" aria-expanded="false"></button></h2>
<p>例如在Linux需要切换gcc/g++版本，ubuntu16.04默认是gcc/g++ 5.4，SNPE需要gcc/g++ 4.9。<br />
通过设定<code>CMAKE_C_COMPILER</code>和<code>CMAKE_CXX_COMPILER</code>来做到。<br />
注意：<code>project(&lt;ProjName&gt;)</code>命令必须在设定编译器之后出现，否则编译器的设定不起作用，将使用系统默认编译器。</p>
<pre highlighted="true"><code class="language-cmake hljs"><table class="hljs-ln"><tbody><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="1"><div class="hljs-ln-n" data-line-number="1"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="1"><span class="hljs-keyword">if</span> (UNIX)</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="2"><div class="hljs-ln-n" data-line-number="2"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="2">    <span class="hljs-keyword">message</span>(STATUS <span class="hljs-string">"----- This is Linux."</span>)</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="3"><div class="hljs-ln-n" data-line-number="3"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="3">    <span class="hljs-keyword">set</span>(CMAKE_C_COMPILER <span class="hljs-string">"gcc-4.9"</span>)</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="4"><div class="hljs-ln-n" data-line-number="4"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="4">    <span class="hljs-keyword">set</span>(CMAKE_CXX_COMPILER <span class="hljs-string">"g++-4.9"</span>)</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="5"><div class="hljs-ln-n" data-line-number="5"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="5"><span class="hljs-keyword">endif</span>()</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="6"><div class="hljs-ln-n" data-line-number="6"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="6"> </td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="7"><div class="hljs-ln-n" data-line-number="7"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="7"><span class="hljs-keyword">project</span>(gamma)</td></tr></tbody></table></code></pre>
<p>注：前一种方法是在单个CMakeLists.txt中设定。对于跨平台编译，则应当避免污染根CMakeLists.txt，应该为每个平台分别使用cmake cache script。而在cache script中需要设定的变量，都应该是缓存变量。<br />
例如，<code>sigmastar.cmake</code>:</p>
<pre highlighted="true"><code class="language-cmake hljs"><table class="hljs-ln"><tbody><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="1"><div class="hljs-ln-n" data-line-number="1"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="1"><span class="hljs-keyword">set</span>(CMAKE_C_COMPILER gcc CACHE <span class="hljs-keyword">STRING</span> <span class="hljs-string">"C compiler"</span>)</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="2"><div class="hljs-ln-n" data-line-number="2"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="2"><span class="hljs-keyword">set</span>(CMAKE_CXX_COMPILER g++ CACHE <span class="hljs-keyword">STRING</span> <span class="hljs-string">"C++ compiler"</span>)</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="3"><div class="hljs-ln-n" data-line-number="3"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="3"><span class="hljs-keyword">set</span>(PLATFORM_NAME <span class="hljs-string">"SigmaStar"</span> CACHE <span class="hljs-keyword">STRING</span> <span class="hljs-string">""</span>)</td></tr></tbody></table></code></pre>
<p>ref: <a href="https://stackoverflow.com/questions/23762215/cmake-dcmake-cxx-compiler-works-but-setcmake-cxx-compiler-is-ignored" target="_blank" rel="noopener">CMake -DCMAKE_CXX_COMPILER works but SET(CMAKE_CXX_COMPILER …) is ignored?</a></p>
<h2 id="18-设定导入库imported及其属性">18. 设定导入库(IMPORTED)及其属性<button class="cnblogs-toc-button" title="显示目录导航" aria-expanded="false"></button></h2>
<p>如果是自己项目中的源码基于cmake构建，其中利用<code>add_library()</code>创建的库目标，可以直接用来作为可执行目标、动态库或静态库的依赖库直接使用。<br />
而如果是别人直接丢过来的库和头文件、没有用cmake封装一次呢？显然我们不应该在Visual Studio的项目属性中手动添加，那样也太刀耕火种、没有匠人精神了。<br />
来吧，手写一个导入库的cmake，就现在：</p>
<p>在<code>add_library()</code>命令中指定关键字<code>IMPORTED</code>，再用<code>set_target_properties()</code>命令来设定导入库目标的头文件目录、库目录、库文件名字：</p>
<pre highlighted="true"><code class="language-cmake hljs"><table class="hljs-ln"><tbody><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="1"><div class="hljs-ln-n" data-line-number="1"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="1"><span class="hljs-keyword">add_library</span>(rock SHARED IMPORTED GLOBAL)</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="2"><div class="hljs-ln-n" data-line-number="2"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="2"><span class="hljs-keyword">set_target_properties</span>(rock PROPERTIES</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="3"><div class="hljs-ln-n" data-line-number="3"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="3">    INTERFACE_INCLUDE_DIRECTORIES <span class="hljs-string">"inc"</span>            <span class="hljs-comment">#PUBLIC头文件目录</span></td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="4"><div class="hljs-ln-n" data-line-number="4"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="4">    IMPORTED_IMPLIB <span class="hljs-string">"rock.lib"</span> <span class="hljs-comment">#Windows平台上dll库的.lib库所在位置</span></td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="5"><div class="hljs-ln-n" data-line-number="5"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="5">    IMPORTED_LOCATION <span class="hljs-string">"rock.dll"</span>  <span class="hljs-comment">#dll库的.dll所在位置，或者.so库的位置，或者静态库的位置</span></td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="6"><div class="hljs-ln-n" data-line-number="6"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="6">)</td></tr></tbody></table></code></pre>
<p>其中<code>GLOBAL</code>关键字，是为了让全局可见。例如通过<code>add_subdirectory()</code>添加了mpbase库，里面是上述方式添加的库，但是上级CMakeLists.txt要确保能使用这个库，就需要指定GLOBAL关键字。</p>
<p>以上列出了最常见的三个属性，更多属性看 <a href="https://cmake.org/cmake/help/latest/manual/cmake-properties.7.html#target-properties" target="_blank" rel="noopener">这里</a></p>
<p>P.S. 实践发现，如果库文件所在目录很长（超过256个字符），或者添加的导入库对应的库文件有多个，它们的名字会被拼接起来，在CMake+Ninja的NDK开发环境下直接报错说路径太长。因此，导入库并不是一个好的实践。</p>
<h2 id="19-查看并修改visual-studio项目属性中的某个设定">19. 查看并修改Visual Studio项目属性中的某个设定<button class="cnblogs-toc-button" title="显示目录导航" aria-expanded="false"></button></h2>
<p>问题来自StackOverFlow上某网友的提问：<a href="https://stackoverflow.com/questions/57122886/compile-error-cmake-with-cuda-on-visual-studio-c/57123366#57123366" target="_blank" rel="noopener">Compile error CMAKE with CUDA on Visual Studio C++</a></p>
<p>解决步骤：</p>
<ol>
<li>用cmake-gui.exe或ccmake加载cmake的cache文件</li>
<li>查找需要修改的字符串对应的CMake变量</li>
<li>在CMakeLists.txt中修改、覆盖此变量</li>
</ol>
<h2 id="20-添加宏定义">20. 添加宏定义<button class="cnblogs-toc-button" title="显示目录导航" aria-expanded="false"></button></h2>
<pre highlighted="true"><code class="language-cmake hljs"><table class="hljs-ln"><tbody><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="1"><div class="hljs-ln-n" data-line-number="1"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="1"><span class="hljs-keyword">add_definitions</span>(-DUSE_OPENCV)</td></tr></tbody></table></code></pre>
<p>相当于传递给C/C++编译器:</p>
<pre highlighted="true"><code class="language-C hljs"><table class="hljs-ln"><tbody><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="1"><div class="hljs-ln-n" data-line-number="1"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="1"><span class="hljs-meta">#<span class="hljs-keyword">define</span> USE_OPENCV</span></td></tr></tbody></table></code></pre>
<pre highlighted="true"><code class="language-cmake hljs"><table class="hljs-ln"><tbody><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="1"><div class="hljs-ln-n" data-line-number="1"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="1"><span class="hljs-keyword">add_definitions</span>(-DLANDMARK_VERSION=<span class="hljs-number">2.1</span>.<span class="hljs-number">33</span>)</td></tr></tbody></table></code></pre>
<p>相当于传递给C/C++编译器：</p>
<pre highlighted="true"><code class="language-C hljs"><table class="hljs-ln"><tbody><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="1"><div class="hljs-ln-n" data-line-number="1"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="1"><span class="hljs-meta">#<span class="hljs-keyword">define</span> LANDMARK_VERSION 2.1.33</span></td></tr></tbody></table></code></pre>
<h2 id="21-设置fpie">21. 设置fPIE<button class="cnblogs-toc-button" title="显示目录导航" aria-expanded="false"></button></h2>
<blockquote>
<p>error: Android 5.0 and later only support position-independent executables (-fPIE).</p>
</blockquote>
<p>问题出现在：连接一个静态库到一个可执行程序，并在android6.0上运行。</p>
<p>解决办法：</p>
<pre highlighted="true"><code class="language-cmake hljs"><table class="hljs-ln"><tbody><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="1"><div class="hljs-ln-n" data-line-number="1"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="1"><span class="hljs-keyword">set</span>(CMAKE_C_FLAGS <span class="hljs-string">"${CMAKE_C_FLAGS} -fPIE -pie"</span>)</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="2"><div class="hljs-ln-n" data-line-number="2"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="2"><span class="hljs-keyword">set</span>(CMAKE_CXX_FLAGS <span class="hljs-string">"${CMAKE_C_FLAGS} -fPIE -pie"</span>)</td></tr></tbody></table></code></pre>
<h2 id="22-设置fpic">22. 设置fPIC<button class="cnblogs-toc-button" title="显示目录导航" aria-expanded="false"></button></h2>
<p>问题出现场景：编译动态库<code>libaisf_bodyattr_processor.so</code>的时候，它依赖于静态库<code>libarcsoft_bsd.a</code>，但是<code>libarcsoft_bsd.a</code>库编译时没有指定fPIC编译选项。</p>
<p>设定方法：在编译<strong>静态库</strong>的时候，</p>
<p>全局设定：</p>
<pre highlighted="true"><code class="language-cmake hljs"><table class="hljs-ln"><tbody><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="1"><div class="hljs-ln-n" data-line-number="1"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="1"><span class="hljs-keyword">set</span>(CMAKE_POSITION_INDEPENDENT_CODE <span class="hljs-keyword">ON</span>)</td></tr></tbody></table></code></pre>
<p>或者：</p>
<pre highlighted="true"><code class="language-cmake hljs"><table class="hljs-ln"><tbody><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="1"><div class="hljs-ln-n" data-line-number="1"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="1"><span class="hljs-keyword">add_library</span>(lib1 lib1.cpp)</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="2"><div class="hljs-ln-n" data-line-number="2"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="2"><span class="hljs-keyword">set_property</span>(<span class="hljs-keyword">TARGET</span> lib1 PROPERTY POSITION_INDEPENDENT_CODE <span class="hljs-keyword">ON</span>)</td></tr></tbody></table></code></pre>
<p>ref:<a href="https://stackoverflow.com/questions/38296756/what-is-the-idiomatic-way-in-cmake-to-add-the-fpic-compiler-option" target="_blank" rel="noopener">What is the idiomatic way in CMAKE to add the -fPIC compiler option?</a></p>
<h2 id="23-linux-gcc添加链接库-lm">23. Linux gcc添加链接库"-lm"<button class="cnblogs-toc-button" title="显示目录导航" aria-expanded="false"></button></h2>
<pre highlighted="true"><code class="language-cmake hljs"><table class="hljs-ln"><tbody><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="1"><div class="hljs-ln-n" data-line-number="1"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="1"><span class="hljs-keyword">target_link_libraries</span>(xxx m)</td></tr></tbody></table></code></pre>
<h2 id="24-清空普通变量">24. 清空普通变量<button class="cnblogs-toc-button" title="显示目录导航" aria-expanded="false"></button></h2>
<pre highlighted="true"><code class="language-cmake hljs"><table class="hljs-ln"><tbody><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="1"><div class="hljs-ln-n" data-line-number="1"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="1"><span class="hljs-keyword">unset</span>(&lt;Var&gt;)</td></tr></tbody></table></code></pre>
<h2 id="25-清除缓存变量">25. 清除缓存变量<button class="cnblogs-toc-button" title="显示目录导航" aria-expanded="false"></button></h2>
<pre highlighted="true"><code class="language-cmake hljs"><table class="hljs-ln"><tbody><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="1"><div class="hljs-ln-n" data-line-number="1"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="1"><span class="hljs-keyword">unset</span>(&lt;Var&gt; CACHE)</td></tr></tbody></table></code></pre>
<h2 id="26-findxxxcmake简单例子">26. FindXXX.cmake简单例子<button class="cnblogs-toc-button" title="显示目录导航" aria-expanded="false"></button></h2>
<p>我遇到的使用场景满足的条件：</p>
<ul>
<li>使用了很多依赖项；</li>
<li>每个依赖项仅仅提供了.a/.lib/.so库文件和.h/.hpp头文件，没有提供<code>XXX-config.cmake</code>脚本；</li>
<li>每个依赖项的库文件包括debug和release两种</li>
</ul>
<p>此时如果继续在CMakeLists.txt中“一把梭”，各种设定都写在单个文件中，可以执行就不够高了。每个依赖写成<code>FindXXX.cmake</code>，则后续直接使用<code>find_package(XXX)</code>很方便，定位排查依赖项问题、可移植性都得到了增强。</p>
<h3 id="我理解的findxxxcmake基本步骤">我理解的FindXXX.cmake基本步骤<button class="cnblogs-toc-button" title="显示目录导航" aria-expanded="false"></button></h3>
<p>步骤1：FindXXX.cmake第一行：<code>include(FindPackageHandleStandardArgs)</code></p>
<p>步骤2：想方设法设定<code>&lt;PackageName&gt;_INCLUDE_DIRS</code>和<code>&lt;PackageName&gt;_LIBRARIES</code>的值，并且避免硬编码。具体又可以包括：</p>
<ul>
<li>使用<code>set()</code>和<code>list(APPEND &lt;Var&gt;)</code>来设定变量的值</li>
<li>使用<strong><code>find_library()</code></strong>来找库文件和头文件（比直接写为固定值要灵活）</li>
</ul>
<p>步骤3：<code>find_package_handle_standard_args(&lt;PackageName&gt; DEFAULT_MSG &lt;PackageName&gt;_INCLUDE_DIRS &lt;PackageName&gt;_LIBRARIES)</code></p>
<p>步骤4：根据是否查找成功进行打印</p>
<h3 id="例子1单个头文件和单个库文件">例子1：单个头文件和单个库文件<button class="cnblogs-toc-button" title="显示目录导航" aria-expanded="false"></button></h3>
<p>这里假设我的package叫做milk，对应的目录结构为：</p>
<pre highlighted="true"><code class="hljs language-lua"><table class="hljs-ln"><tbody><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="1"><div class="hljs-ln-n" data-line-number="1"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="1"><span class="hljs-comment">--- milk</span></td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="2"><div class="hljs-ln-n" data-line-number="2"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="2">    <span class="hljs-comment">--- include</span></td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="3"><div class="hljs-ln-n" data-line-number="3"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="3">         <span class="hljs-comment">--- milk.h</span></td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="4"><div class="hljs-ln-n" data-line-number="4"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="4">    <span class="hljs-comment">--- lib</span></td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="5"><div class="hljs-ln-n" data-line-number="5"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="5">         <span class="hljs-comment">--- milk.lib</span></td></tr></tbody></table></code></pre>
<p><code>Findmilk.cmake</code></p>
<pre highlighted="true"><code class="language-cmake hljs"><table class="hljs-ln"><tbody><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="1"><div class="hljs-ln-n" data-line-number="1"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="1"><span class="hljs-comment"># provides `milk_LIBRARIES` and `milk_INCLUDE_DIRS` variable</span></td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="2"><div class="hljs-ln-n" data-line-number="2"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="2"><span class="hljs-comment"># usage: `find_package(milk)`</span></td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="3"><div class="hljs-ln-n" data-line-number="3"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="3"> </td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="4"><div class="hljs-ln-n" data-line-number="4"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="4"><span class="hljs-keyword">include</span>(FindPackageHandleStandardArgs)</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="5"><div class="hljs-ln-n" data-line-number="5"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="5"> </td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="6"><div class="hljs-ln-n" data-line-number="6"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="6"><span class="hljs-keyword">set</span>(milk_ROOT_DIR <span class="hljs-variable">${PROJECT_SOURCE_DIR}</span>/third_party/milk CACHE PATH <span class="hljs-string">"Folder contains milk"</span>)</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="7"><div class="hljs-ln-n" data-line-number="7"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="7"> </td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="8"><div class="hljs-ln-n" data-line-number="8"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="8"><span class="hljs-keyword">set</span>(milk_DIR <span class="hljs-variable">${milk_ROOT_DIR}</span>)</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="9"><div class="hljs-ln-n" data-line-number="9"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="9"> </td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="10"><div class="hljs-ln-n" data-line-number="10"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="10"><span class="hljs-keyword">find_path</span>(milk_INCLUDE_DIRS</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="11"><div class="hljs-ln-n" data-line-number="11"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="11">          NAMES milk.h</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="12"><div class="hljs-ln-n" data-line-number="12"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="12">          PATHS <span class="hljs-variable">${milk_DIR}</span></td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="13"><div class="hljs-ln-n" data-line-number="13"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="13">          PATH_SUFFIXES <span class="hljs-keyword">include</span> <span class="hljs-keyword">include</span>/x86_64 <span class="hljs-keyword">include</span>/x64</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="14"><div class="hljs-ln-n" data-line-number="14"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="14">          DOC <span class="hljs-string">"milk include"</span></td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="15"><div class="hljs-ln-n" data-line-number="15"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="15">          NO_DEFAULT_PATH)</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="16"><div class="hljs-ln-n" data-line-number="16"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="16"> </td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="17"><div class="hljs-ln-n" data-line-number="17"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="17"><span class="hljs-comment"># find milk.lib</span></td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="18"><div class="hljs-ln-n" data-line-number="18"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="18"><span class="hljs-keyword">find_library</span>(milk_LIBRARIES</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="19"><div class="hljs-ln-n" data-line-number="19"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="19">             NAMES milk</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="20"><div class="hljs-ln-n" data-line-number="20"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="20">             PATHS <span class="hljs-variable">${milk_DIR}</span></td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="21"><div class="hljs-ln-n" data-line-number="21"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="21">             PATH_SUFFIXES lib lib64 lib/x86_64 lib/x86_64-linux-gnu lib/x64 lib/x86</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="22"><div class="hljs-ln-n" data-line-number="22"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="22">             DOC <span class="hljs-string">"milk library"</span></td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="23"><div class="hljs-ln-n" data-line-number="23"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="23">             NO_DEFAULT_PATH)</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="24"><div class="hljs-ln-n" data-line-number="24"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="24"> </td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="25"><div class="hljs-ln-n" data-line-number="25"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="25">find_package_handle_standard_args(milk DEFAULT_MSG milk_INCLUDE_DIRS milk_LIBRARIES)</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="26"><div class="hljs-ln-n" data-line-number="26"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="26"> </td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="27"><div class="hljs-ln-n" data-line-number="27"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="27"><span class="hljs-keyword">if</span> (milk_FOUND)</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="28"><div class="hljs-ln-n" data-line-number="28"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="28">  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">NOT</span> milk_FIND_QUIETLY)</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="29"><div class="hljs-ln-n" data-line-number="29"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="29">    <span class="hljs-keyword">message</span>(STATUS <span class="hljs-string">"Found milk: ${milk_INCLUDE_DIRS}, ${milk_LIBRARIES}"</span>)</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="30"><div class="hljs-ln-n" data-line-number="30"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="30">  <span class="hljs-keyword">endif</span> ()</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="31"><div class="hljs-ln-n" data-line-number="31"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="31">  <span class="hljs-keyword">mark_as_advanced</span>(milk_ROOT_DIR milk_INCLUDE_DIRS milk_LIBRARIES)</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="32"><div class="hljs-ln-n" data-line-number="32"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="32"><span class="hljs-keyword">else</span> ()</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="33"><div class="hljs-ln-n" data-line-number="33"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="33">  <span class="hljs-keyword">if</span> (milk_FIND_REQUIRED)</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="34"><div class="hljs-ln-n" data-line-number="34"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="34">    <span class="hljs-keyword">message</span>(FATAL_ERROR <span class="hljs-string">"Could not find milk"</span>)</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="35"><div class="hljs-ln-n" data-line-number="35"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="35">  <span class="hljs-keyword">endif</span> ()</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="36"><div class="hljs-ln-n" data-line-number="36"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="36"><span class="hljs-keyword">endif</span> ()</td></tr></tbody></table></code></pre>
<p>可以看到，这种case的写法很简单直观。</p>
<h3 id="例子2同时存在debug和release版本的库">例子2：同时存在Debug和Release版本的库<button class="cnblogs-toc-button" title="显示目录导航" aria-expanded="false"></button></h3>
<p>这个例子中假设依赖项叫做LEMON，目录结构：</p>
<pre highlighted="true"><code class="hljs language-lua"><table class="hljs-ln"><tbody><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="1"><div class="hljs-ln-n" data-line-number="1"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="1">lemon</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="2"><div class="hljs-ln-n" data-line-number="2"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="2">   <span class="hljs-comment">--- lib</span></td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="3"><div class="hljs-ln-n" data-line-number="3"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="3">       <span class="hljs-comment">--- debug</span></td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="4"><div class="hljs-ln-n" data-line-number="4"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="4">            <span class="hljs-comment">--- lemon_core.lib</span></td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="5"><div class="hljs-ln-n" data-line-number="5"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="5">            <span class="hljs-comment">--- lemon_extra.lib</span></td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="6"><div class="hljs-ln-n" data-line-number="6"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="6">       <span class="hljs-comment">--- release</span></td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="7"><div class="hljs-ln-n" data-line-number="7"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="7">            <span class="hljs-comment">--- lemon_core.lib</span></td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="8"><div class="hljs-ln-n" data-line-number="8"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="8">            <span class="hljs-comment">--- lemon_extra.lib  </span></td></tr></tbody></table></code></pre>
<p><strong>debug和release库的处理</strong><br />
希望在调用<code>find_package(xxx)</code>之后，Visual Studio或XCode等IDE能自动切换debug和release的库。则需要为debug库的路径添加debug字段，为release库添加optimized字段。<br />
e.g.</p>
<pre highlighted="true"><code class="language-cmake hljs"><table class="hljs-ln"><tbody><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="1"><div class="hljs-ln-n" data-line-number="1"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="1">  <span class="hljs-keyword">set</span>(LEMON_LIBRARIES</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="2"><div class="hljs-ln-n" data-line-number="2"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="2">    debug <span class="hljs-string">"${LEMON_DIR}/lib/debug/lemon.lib"</span></td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="3"><div class="hljs-ln-n" data-line-number="3"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="3">    optimized <span class="hljs-string">"${LEMON_DIR}/lib/release/lemon.lib"</span></td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="4"><div class="hljs-ln-n" data-line-number="4"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="4">  )</td></tr></tbody></table></code></pre>
<p>考虑到硬编码不是一个好的方案，库文件可能放在<code>lib</code>、<code>lib64</code>、<code>lib/Release</code>等目录中，应当先用<code>find_library()</code>进行查找，然后再set库文件变量<code>LEMON_LIBRARIES</code>。</p>
<p><strong>多个库的find_library写法</strong><br />
对于依赖库中的多个库，自然的想法是使用<code>foreach()</code>来处理每个库文件。</p>
<p>考虑到<code>find_library(lemon_lib_name)</code>会产生缓存变量<code>lemon_lib_name</code>，这会导致再次调用<code>find_library(lemon_lib_name)</code>时不再查找。需要<code>unset(${lemon_lib_name} CACHE)</code>该缓存变量来确保查找成功。直接给出完整例子：</p>
<pre highlighted="true"><code class="language-cmake hljs"><table class="hljs-ln"><tbody><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="1"><div class="hljs-ln-n" data-line-number="1"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="1"><span class="hljs-keyword">include</span>(FindPackageHandleStandardArgs)</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="2"><div class="hljs-ln-n" data-line-number="2"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="2"> </td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="3"><div class="hljs-ln-n" data-line-number="3"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="3"><span class="hljs-keyword">set</span>(LEMON_ROOT_DIR <span class="hljs-variable">${PROJECT_SOURCE_DIR}</span>/third_party/lemon CACHE PATH <span class="hljs-string">"Folder contains lemon"</span>)</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="4"><div class="hljs-ln-n" data-line-number="4"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="4"> </td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="5"><div class="hljs-ln-n" data-line-number="5"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="5"><span class="hljs-keyword">set</span>(LEMON_DIR <span class="hljs-variable">${CEVA_ROOT_DIR}</span>)</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="6"><div class="hljs-ln-n" data-line-number="6"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="6"> </td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="7"><div class="hljs-ln-n" data-line-number="7"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="7"><span class="hljs-keyword">set</span>(LEMON_DIR <span class="hljs-variable">${LEMON_ROOT_DIR}</span>)</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="8"><div class="hljs-ln-n" data-line-number="8"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="8"> </td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="9"><div class="hljs-ln-n" data-line-number="9"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="9"><span class="hljs-keyword">set</span>(LEMON_LIBRARY_COMPONENTS lemon_core lemon_extra)</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="10"><div class="hljs-ln-n" data-line-number="10"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="10"> </td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="11"><div class="hljs-ln-n" data-line-number="11"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="11"><span class="hljs-keyword">foreach</span>(lemon_component <span class="hljs-variable">${LEMON_LIBRARY_COMPONENTS}</span>)</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="12"><div class="hljs-ln-n" data-line-number="12"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="12">  <span class="hljs-keyword">unset</span>(LEMON_LIBRARIES_DEBUG CACHE)</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="13"><div class="hljs-ln-n" data-line-number="13"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="13">  <span class="hljs-keyword">find_library</span>(LEMON_LIBRARIES_DEBUG</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="14"><div class="hljs-ln-n" data-line-number="14"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="14">            NAMES <span class="hljs-variable">${lemon_component}</span></td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="15"><div class="hljs-ln-n" data-line-number="15"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="15">            PATHS <span class="hljs-variable">${LEMON_DIR}</span></td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="16"><div class="hljs-ln-n" data-line-number="16"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="16">            PATH_SUFFIXES lib lib/debug lib/debug</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="17"><div class="hljs-ln-n" data-line-number="17"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="17">            DOC <span class="hljs-string">"lemon library component ${lemon_component} debug"</span></td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="18"><div class="hljs-ln-n" data-line-number="18"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="18">            NO_DEFAULT_PATH)</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="19"><div class="hljs-ln-n" data-line-number="19"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="19"> </td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="20"><div class="hljs-ln-n" data-line-number="20"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="20">  <span class="hljs-keyword">unset</span>(LEMON_LIBRARIES_RELEASE CACHE)</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="21"><div class="hljs-ln-n" data-line-number="21"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="21">  <span class="hljs-keyword">find_library</span>(LEMON_LIBRARIES_RELEASE</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="22"><div class="hljs-ln-n" data-line-number="22"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="22">              NAMES <span class="hljs-variable">${lemon_component}</span></td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="23"><div class="hljs-ln-n" data-line-number="23"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="23">              PATHS <span class="hljs-variable">${LEMON_DIR}</span></td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="24"><div class="hljs-ln-n" data-line-number="24"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="24">              PATH_SUFFIXES lib lib/release lib/Release</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="25"><div class="hljs-ln-n" data-line-number="25"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="25">              DOC <span class="hljs-string">"lemon library component ${lemon_component} release"</span></td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="26"><div class="hljs-ln-n" data-line-number="26"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="26">              NO_DEFAULT_PATH)</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="27"><div class="hljs-ln-n" data-line-number="27"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="27"> </td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="28"><div class="hljs-ln-n" data-line-number="28"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="28">  <span class="hljs-keyword">list</span>(APPEND LEMON_LIBRARIES</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="29"><div class="hljs-ln-n" data-line-number="29"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="29">    debug <span class="hljs-variable">${LEMON_LIBRARIES_DEBUG}</span></td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="30"><div class="hljs-ln-n" data-line-number="30"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="30">    optimized <span class="hljs-variable">${LEMON_LIBRARIES_RELEASE}</span></td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="31"><div class="hljs-ln-n" data-line-number="31"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="31">  )</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="32"><div class="hljs-ln-n" data-line-number="32"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="32"><span class="hljs-keyword">endforeach</span>()</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="33"><div class="hljs-ln-n" data-line-number="33"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="33"> </td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="34"><div class="hljs-ln-n" data-line-number="34"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="34">find_package_handle_standard_args(LEMON DEFAULT_MSG LEMON_LIBRARIES)</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="35"><div class="hljs-ln-n" data-line-number="35"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="35"> </td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="36"><div class="hljs-ln-n" data-line-number="36"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="36"><span class="hljs-keyword">if</span> (LEMON_FOUND)</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="37"><div class="hljs-ln-n" data-line-number="37"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="37">  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">NOT</span> LEMON_FIND_QUIETLY)</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="38"><div class="hljs-ln-n" data-line-number="38"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="38">    <span class="hljs-keyword">message</span>(STATUS <span class="hljs-string">"Found LEMON: ${LEMON_LIBRARIES}"</span>)</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="39"><div class="hljs-ln-n" data-line-number="39"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="39">  <span class="hljs-keyword">endif</span> ()</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="40"><div class="hljs-ln-n" data-line-number="40"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="40">  <span class="hljs-keyword">mark_as_advanced</span>(LEMON_ROOT_DIR LEMON_LIBRARIES)</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="41"><div class="hljs-ln-n" data-line-number="41"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="41"><span class="hljs-keyword">else</span> ()</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="42"><div class="hljs-ln-n" data-line-number="42"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="42">  <span class="hljs-keyword">if</span> (LEMON_FIND_REQUIRED)</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="43"><div class="hljs-ln-n" data-line-number="43"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="43">    <span class="hljs-keyword">message</span>(FATAL_ERROR <span class="hljs-string">"Could not find lemon"</span>)</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="44"><div class="hljs-ln-n" data-line-number="44"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="44">  <span class="hljs-keyword">endif</span> ()</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="45"><div class="hljs-ln-n" data-line-number="45"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="45"><span class="hljs-keyword">endif</span> ()</td></tr></tbody></table></code></pre>
<h3 id="例子3找dll">例子3：找dll<button class="cnblogs-toc-button" title="显示目录导航" aria-expanded="false"></button></h3>
<p>注意:<code>CMAKE_FIND_LIBRARY_SUFFIXES </code>的使用</p>
<pre highlighted="true"><code class="language-cmake hljs"><table class="hljs-ln"><tbody><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="1"><div class="hljs-ln-n" data-line-number="1"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="1"><span class="hljs-keyword">set</span>(CMAKE_FIND_LIBRARY_SUFFIXES <span class="hljs-string">".dll"</span>)</td></tr></tbody></table></code></pre>
<p>ref: <a href="https://stackoverflow.com/questions/14243524/cmake-find-library-matching-behavior" target="_blank" rel="noopener">https://stackoverflow.com/questions/14243524/cmake-find-library-matching-behavior</a></p>
<p>实际上，<code>CMAKE_FIND_LIBRARY_SUFFIXES</code>影响最大的就是<code>find_library()</code>命令了。譬如zlib安装目录下，同时存在动态库和静态库，分别是libz.a和libz.so，而<code>find_library()</code>的行为是“找到一个就不再找了”，因此如果没有很好的设定<code>CMAKE_FIND_LIBRARY_SUFFIXES</code>，就会导致找不到想要的库。默认情况下是找到动态库，然而windows下还需要手动拷贝DLL。。。麻烦。</p>
<p>可以通过备份原有的<code>CMAKE_FIND_LIBRARY_SUFFIXES</code>的值，改掉它的值，<code>find_library()</code>之后再改回原来的值，这样就支持了 静态库/动态库 分别查找的设定。。（用于魔改cmake自带的FindZLIB.cmake)</p>
<p><a href="https://stackoverflow.com/a/51126719/2999096" target="_blank" rel="noopener">https://stackoverflow.com/a/51126719/2999096</a></p>
<h2 id="27-cmake各种编译链接参数的默认值">27. CMake各种编译链接参数的默认值<button class="cnblogs-toc-button" title="显示目录导航" aria-expanded="false"></button></h2>
<p><a href="https://www.cnblogs.com/flyinggod/p/8026789.html" target="_blank" rel="noopener">CMake 默认编译、链接选项</a></p>
<h2 id="28-链接器相关问题">28. 链接器相关问题<button class="cnblogs-toc-button" title="显示目录导航" aria-expanded="false"></button></h2>
<h3 id="检查链接到的重名函数">检查链接到的重名函数<button class="cnblogs-toc-button" title="显示目录导航" aria-expanded="false"></button></h3>
<p>场景：A库的代码中定义了函数play()，B库的代码中也定义了函数play()，但是这两个play()函数的实现不同，并且被可执行目标C同时链接。<br />
链接器默认是找到一个符号就不再查找，因此默认能链接并且可以运行，只不过运行结果不是所期待的。</p>
<p>容易查到，Linux下gcc对应的链接器中可以使用<code>--whole-archive</code>和<code>--no-whole-archive</code>参数来包含静态库中的所有符号。</p>
<p>如果是gcc，则使用<code>gcc -Wl --whole-archive someLib --no-whole-archive</code>。</p>
<p>如果是Visual Studio，则需要&gt;=2015 update2的版本中才支持<code>/WHOLEARCHIVE</code>选项，VS2013要哭泣了。</p>
<p>因而，在CMakeLists.txt中，可以设定链接器的全局设定:</p>
<pre highlighted="true"><code class="language-cmake hljs"><table class="hljs-ln"><tbody><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="1"><div class="hljs-ln-n" data-line-number="1"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="1"><span class="hljs-keyword">if</span>(CMAKE_SYSTEM_NAME <span class="hljs-keyword">MATCHES</span> <span class="hljs-string">"Windows"</span>)</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="2"><div class="hljs-ln-n" data-line-number="2"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="2">	<span class="hljs-keyword">set</span>(CMAKE_EXE_LINKER_FLAGS <span class="hljs-string">"${CMAKE_EXE_LINKER_FLAGS} /WHOLEARCHIVE"</span>)</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="3"><div class="hljs-ln-n" data-line-number="3"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="3"><span class="hljs-keyword">elseif</span>(CMAKE_SYSTEM_NAME <span class="hljs-keyword">MATCHES</span> <span class="hljs-string">"Linux"</span>)</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="4"><div class="hljs-ln-n" data-line-number="4"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="4">	 <span class="hljs-keyword">set</span>(CMAKE_EXE_LINKER_FLAGS <span class="hljs-string">"${CMAKE_EXE_LINKER_FLAGS} -Wl,--whole-archive"</span>) </td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="5"><div class="hljs-ln-n" data-line-number="5"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="5"><span class="hljs-keyword">endif</span>()</td></tr></tbody></table></code></pre>
<p>缺点：</p>
<ul>
<li>所有库的符号都进行导入，<strong>不能灵活处理</strong>单个不需要导入所有符号的库</li>
<li>系统默认导入的库，例如Windows下的USER32.dll和KERNEL32.dll会产生冲突</li>
</ul>
<p>TODO: 对于单个target，如何设定？</p>
<pre highlighted="true"><code class="language-cmake hljs"><table class="hljs-ln"><tbody><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="1"><div class="hljs-ln-n" data-line-number="1"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="1"><span class="hljs-keyword">if</span> (CMAKE_SYSTEM_NAME <span class="hljs-keyword">MATCHES</span> <span class="hljs-string">"Windows"</span>)</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="2"><div class="hljs-ln-n" data-line-number="2"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="2">    <span class="hljs-keyword">set_target_properties</span>(inter</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="3"><div class="hljs-ln-n" data-line-number="3"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="3">        PROPERTIES LINK_FLAGS</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="4"><div class="hljs-ln-n" data-line-number="4"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="4">        <span class="hljs-string">"/WHOLEARCHIVE:gender /WHOLEARCHIVE:smile"</span></td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="5"><div class="hljs-ln-n" data-line-number="5"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="5">    )</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="6"><div class="hljs-ln-n" data-line-number="6"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="6"><span class="hljs-keyword">elseif</span>(CMAKE_SYSTEM_NAME <span class="hljs-keyword">MATCHES</span> <span class="hljs-string">"Linux"</span>)</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="7"><div class="hljs-ln-n" data-line-number="7"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="7">    <span class="hljs-comment"># 不起作用</span></td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="8"><div class="hljs-ln-n" data-line-number="8"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="8">    <span class="hljs-keyword">set_target_properties</span>(inter</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="9"><div class="hljs-ln-n" data-line-number="9"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="9">        PROPERTIES LINK_FLAGS</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="10"><div class="hljs-ln-n" data-line-number="10"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="10">        <span class="hljs-string">"-Wl,--whole-archive gender   -Wl,--whole-archive smile"</span></td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="11"><div class="hljs-ln-n" data-line-number="11"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="11">    )</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="12"><div class="hljs-ln-n" data-line-number="12"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="12"><span class="hljs-keyword">endif</span>()</td></tr></tbody></table></code></pre>
<p>或者：</p>
<pre highlighted="true"><code class="language-cmake hljs"><table class="hljs-ln"><tbody><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="1"><div class="hljs-ln-n" data-line-number="1"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="1"><span class="hljs-keyword">set</span>(MYLIB -Wl,--whole-archive mytest -Wl,--no-whole-archive)</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="2"><div class="hljs-ln-n" data-line-number="2"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="2"><span class="hljs-keyword">target_link_libraries</span>(main <span class="hljs-variable">${MYLIB}</span>)</td></tr></tbody></table></code></pre>
<p>实际上:</p>
<ul>
<li>
<p>gcc的链接器ld:<br />
通过<code>-Wl, --whole-archive lib_name -Wl, --no-whole-archive</code>能每次分别对一个静态库加载所有的member（函数等）；</p>
</li>
<li>
<p>Visual Studio的链接器：<br />
VS2017（1900）之后才支持-WHOLEARCHIVE来实现同样功能；</p>
</li>
<li>
<p>PC Clang的链接器：<br />
使用lld作为链接器（比如Xcode现在用肯定是lld），用<code>-Wl,-force_load ${lib}</code>来做到只导入一个静态库中的所有member；</p>
</li>
<li>
<p>NDK的链接器<br />
怎么说现在用的NDK也是17b起步了，默认编译器是Clang，gcc暂时没考虑；<br />
虽然编译器很早就(可以)切换到Clang了，但链接器目前还是用的gcc的ld，因此NDK的链接阶段检查重复符号应该用ld的检查方式；<br />
即使是用当前（2020-01-26 02:16:34）最新的NDK也就是NDK21，手动传入<code>ANDROID_LD=lld</code>后，NDK切换到的链接器lld和MacOS上与AppleClang搭配的lld也还是不一样，链接阶段查重复符号仍然需要传gcc的ld的那一套参数：<code>-Wl, --whole-archive lib_name -Wl, --no-whole-archive</code>，但好处是报错界面更加友好直观了：</p>
</li>
</ul>
<p><img src="https://img2018.cnblogs.com/blog/495962/202001/495962-20200126022033471-1566789423.png" alt="" loading="lazy" /></p>
<p>ref:<br />
<a href="https://www.cnblogs.com/noble/p/4144163.html" target="_blank" rel="noopener">gcc和ld 中的参数 --whole-archive 和 --no-whole-archive</a><br />
<a href="https://lists.llvm.org/pipermail/llvm-commits/Week-of-Mon-20141103/243242.html" target="_blank" rel="noopener">lld中的<code>-force_load</code>参数功能说明是在邮件列表中找到的，官方文档里还更新出来</a><br />
<a href="https://github.com/android/ndk/wiki/Changelog-r20" target="_blank" rel="noopener">ndk-20的change log</a></p>
<h2 id="29-生成compile_commandsjson">29. 生成<code>compile_commands.json</code><button class="cnblogs-toc-button" title="显示目录导航" aria-expanded="false"></button></h2>
<pre highlighted="true"><code class="language-cmake hljs"><table class="hljs-ln"><tbody><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="1"><div class="hljs-ln-n" data-line-number="1"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="1"><span class="hljs-keyword">set</span>(CMAKE_EXPORT_COMPILE_COMMANDS <span class="hljs-keyword">ON</span>)</td></tr></tbody></table></code></pre>
<p>用于在VSCode等编辑器/IDE中给C/C++代码做函数定义跳转支持。</p>
<h2 id="30-子目录cmakeliststxt中产生变量给父目录中的cmakeliststxt使用">30. 子目录CMakeLists.txt中产生变量给父目录中的CMakeLists.txt使用<button class="cnblogs-toc-button" title="显示目录导航" aria-expanded="false"></button></h2>
<p><code>set</code>设定变量并且设定<code>PARENT_SCOPE</code>参数。</p>
<p>目录结构举例：</p>
<pre highlighted="true"><code class="hljs language-objectivec"><table class="hljs-ln"><tbody><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="1"><div class="hljs-ln-n" data-line-number="1"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="1">helloworld</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="2"><div class="hljs-ln-n" data-line-number="2"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="2">    - <span class="hljs-built_in">CMakeLists</span>.txt</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="3"><div class="hljs-ln-n" data-line-number="3"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="3">    - src</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="4"><div class="hljs-ln-n" data-line-number="4"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="4">        hello.cpp</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="5"><div class="hljs-ln-n" data-line-number="5"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="5">        hello_internal.h</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="6"><div class="hljs-ln-n" data-line-number="6"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="6">        <span class="hljs-built_in">CMakeLists</span>.txt</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="7"><div class="hljs-ln-n" data-line-number="7"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="7">    - inc</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="8"><div class="hljs-ln-n" data-line-number="8"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="8">        hello.h</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="9"><div class="hljs-ln-n" data-line-number="9"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="9">        <span class="hljs-built_in">CMakeLists</span>.txt</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="10"><div class="hljs-ln-n" data-line-number="10"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="10">    - testbed</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="11"><div class="hljs-ln-n" data-line-number="11"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="11">        main.cpp</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="12"><div class="hljs-ln-n" data-line-number="12"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="12">        <span class="hljs-built_in">CMakeLists</span>.txt</td></tr></tbody></table></code></pre>
<p>当项目中代码变多，就可能需要分成多个目录存放。每个目录下放一个CMakeLists.txt，写出它要处理的文件列表，然后暴露给外层CMakeLists.txt，使外层CMakeLists.txt保持清爽结构。</p>
<pre highlighted="true"><code class="language-cmake hljs"><table class="hljs-ln"><tbody><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="1"><div class="hljs-ln-n" data-line-number="1"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="1"><span class="hljs-keyword">set</span>(hello_srcs</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="2"><div class="hljs-ln-n" data-line-number="2"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="2">    <span class="hljs-variable">${CMAKE_CURRENT_SOURCE_DIR}</span>/hello.cpp</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="3"><div class="hljs-ln-n" data-line-number="3"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="3">)</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="4"><div class="hljs-ln-n" data-line-number="4"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="4"><span class="hljs-keyword">set</span>(hello_private_incs</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="5"><div class="hljs-ln-n" data-line-number="5"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="5">    <span class="hljs-variable">${CMAKE_CURRENT_SOURCE_DIR}</span>/hello.h</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="6"><div class="hljs-ln-n" data-line-number="6"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="6">)</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="7"><div class="hljs-ln-n" data-line-number="7"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="7"> </td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="8"><div class="hljs-ln-n" data-line-number="8"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="8"><span class="hljs-keyword">set</span>(hello_srcs <span class="hljs-variable">${hello_srcs}</span> PARENT_SCOPE)</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="9"><div class="hljs-ln-n" data-line-number="9"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="9"><span class="hljs-keyword">set</span>(hello_private_incs <span class="hljs-variable">${hello_private_incs}</span> PARENT_SCOPE)</td></tr></tbody></table></code></pre>
<h2 id="31-在ide中将targets分组显示使用folder">31. 在IDE中将targets分组显示：使用folder<button class="cnblogs-toc-button" title="显示目录导航" aria-expanded="false"></button></h2>
<p>包括两步：</p>
<ol>
<li>在最顶部的CMakeLists.txt中添加一句</li>
</ol>
<pre highlighted="true"><code class="language-cmake hljs"><table class="hljs-ln"><tbody><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="1"><div class="hljs-ln-n" data-line-number="1"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="1"><span class="hljs-keyword">set_property</span>(GLOBAL PROPERTY USE_FOLDERS <span class="hljs-keyword">ON</span>)</td></tr></tbody></table></code></pre>
<ol start="2">
<li>在希望出现在文件夹的项目的add_library或add_executable后添加</li>
</ol>
<pre highlighted="true"><code class="language-cmake hljs"><table class="hljs-ln"><tbody><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="1"><div class="hljs-ln-n" data-line-number="1"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="1"><span class="hljs-keyword">set_property</span>(<span class="hljs-keyword">TARGET</span> <span class="hljs-variable">${prj_target}</span> PROPERTY FOLDER Samples)</td></tr></tbody></table></code></pre>
<p>效果图：<br />
<img src="https://img2018.cnblogs.com/blog/495962/201909/495962-20190911111359307-1916113238.png" alt="" loading="lazy" /></p>
<p>ref: <a href="https://blog.csdn.net/fb_help/article/details/82252796" target="_blank" rel="noopener">CMake显式添加文件夹</a></p>
<h2 id="32-设置debug的优化级别参数">32. 设置Debug的优化级别参数<button class="cnblogs-toc-button" title="显示目录导航" aria-expanded="false"></button></h2>
<pre highlighted="true"><code class="language-cmake hljs"><table class="hljs-ln"><tbody><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="1"><div class="hljs-ln-n" data-line-number="1"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="1"><span class="hljs-keyword">set</span>(CMAKE_CXX_FLAGS_DEBUG <span class="hljs-string">"${CMAKE_CXX_FLAGS_DEBUG} -O0"</span>)</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="2"><div class="hljs-ln-n" data-line-number="2"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="2"><span class="hljs-keyword">set</span>(CMAKE_C_FLAGS_DEBUG <span class="hljs-string">"${CMAKE_C_FLAGS_DEBUG} -O0"</span>)</td></tr></tbody></table></code></pre>
<h2 id="33-cmake生成vs2019的工程">33. cmake生成VS2019的工程<button class="cnblogs-toc-button" title="显示目录导航" aria-expanded="false"></button></h2>
<p>VS2019开始，需要用-A参数指定是32位程序，还是64位程序。以前的用法不行了。</p>
<p>32位：</p>
<pre highlighted="true"><code class="language-bash hljs"><table class="hljs-ln"><tbody><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="1"><div class="hljs-ln-n" data-line-number="1"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="1">cmake -G <span class="hljs-string">"Visual Studio 16 2019"</span> -A Win32 ..\..</td></tr></tbody></table></code></pre>
<p>64位：</p>
<pre highlighted="true"><code class="language-bash hljs"><table class="hljs-ln"><tbody><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="1"><div class="hljs-ln-n" data-line-number="1"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="1">cmake -G <span class="hljs-string">"Visual Studio 16 2019"</span> -A x64 ..\..</td></tr></tbody></table></code></pre>
<h2 id="34-不要同时使用include_directories和target_include_directories">34. 不要同时使用<code>include_directories()</code>和<code>target_include_directories()</code><button class="cnblogs-toc-button" title="显示目录导航" aria-expanded="false"></button></h2>
<p>如下用法有坑：</p>
<pre highlighted="true"><code class="language-cmake hljs"><table class="hljs-ln"><tbody><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="1"><div class="hljs-ln-n" data-line-number="1"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="1"><span class="hljs-keyword">include_directories</span>(<span class="hljs-string">"inc"</span> <span class="hljs-string">"src"</span>)</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="2"><div class="hljs-ln-n" data-line-number="2"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="2"> </td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="3"><div class="hljs-ln-n" data-line-number="3"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="3"><span class="hljs-keyword">add_library</span>(rock src/rock.cpp)</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="4"><div class="hljs-ln-n" data-line-number="4"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="4"> </td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="5"><div class="hljs-ln-n" data-line-number="5"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="5"><span class="hljs-keyword">target_include_directories</span>(rock PRIVATE <span class="hljs-string">"3rdparty/spdlog"</span>)</td></tr></tbody></table></code></pre>
<p>其中<code>target_include_directories()</code>设置的目录不会生效。经验：只使用其中一种设定include目录的方式。</p>
<h2 id="35-ndk开发中出现error-cannot-use-try-with-exceptions-disabled">35. NDK开发中出现<code>error: cannot use 'try' with exceptions disabled</code><button class="cnblogs-toc-button" title="显示目录导航" aria-expanded="false"></button></h2>
<p>这需要编译器的编译选项中开启exception的支持。现在NDK开发，主流的做法是Android Studio + gradle + cmake做构建，需要在build.gradle中设定<code>-fexceptions</code>:</p>
<pre highlighted="true"><code class="language-groovy hljs"><table class="hljs-ln"><tbody><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="1"><div class="hljs-ln-n" data-line-number="1"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="1">        externalNativeBuild {</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="2"><div class="hljs-ln-n" data-line-number="2"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="2">            cmake {</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="3"><div class="hljs-ln-n" data-line-number="3"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="3"><span class="hljs-comment">//                cppFlags '-std=c++11 -fexceptions'</span></td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="4"><div class="hljs-ln-n" data-line-number="4"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="4"><span class="hljs-comment">//                arguments '-DANDROID_PLATFORM=android-21',</span></td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="5"><div class="hljs-ln-n" data-line-number="5"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="5"><span class="hljs-comment">//                    '-DANDROID_TOOLCHAIN=clang',</span></td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="6"><div class="hljs-ln-n" data-line-number="6"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="6"><span class="hljs-comment">//                    '-DCMAKE_BUILD_TYPE="Release',</span></td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="7"><div class="hljs-ln-n" data-line-number="7"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="7"><span class="hljs-comment">//                    '-DANDROID_ARM_NEON=ON',</span></td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="8"><div class="hljs-ln-n" data-line-number="8"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="8"><span class="hljs-comment">//                    '-DANDROID_STL=c++_shared'</span></td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="9"><div class="hljs-ln-n" data-line-number="9"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="9"><span class="hljs-comment">//                cppFlags '-std=c++11'</span></td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="10"><div class="hljs-ln-n" data-line-number="10"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="10"><span class="hljs-comment">//                arguments '-DANDROID_TOOLCHAIN=clang',</span></td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="11"><div class="hljs-ln-n" data-line-number="11"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="11"><span class="hljs-comment">//                        '-DANDROID_STL=c++_static'</span></td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="12"><div class="hljs-ln-n" data-line-number="12"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="12">                cppFlags <span class="hljs-string">"-std=c++11 -fexceptions"</span></td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="13"><div class="hljs-ln-n" data-line-number="13"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="13">            }</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="14"><div class="hljs-ln-n" data-line-number="14"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="14">        }</td></tr></tbody></table></code></pre>
<p>但有时候，发现上述设定后并不生效；尝试删除.externalBuild目录重新构建，仍然报exception无法处理。后来发现，问题出在CMakeLists.txt加载的.cmake脚本中（用的代码框架是其它部门同事写的，所以不是很熟悉），他给手动设定了这么一句：</p>
<pre highlighted="true"><code class="language-cmake hljs"><table class="hljs-ln"><tbody><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="1"><div class="hljs-ln-n" data-line-number="1"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="1">	<span class="hljs-keyword">SET</span> (CMAKE_CXX_FLAGS <span class="hljs-string">"${CMAKE_CXX_FLAGS} -fno-rtti -fno-exceptions -fno-short-enums -Werror=non-virtual-dtor"</span>)</td></tr></tbody></table></code></pre>
<p>去掉<code>-fno-exception</code>即可。</p>
<h2 id="36-cmake-gui中可见可检索的变量">36. cmake-gui中可见（可检索）的变量<button class="cnblogs-toc-button" title="显示目录导航" aria-expanded="false"></button></h2>
<p>目前遇到的有两种：</p>
<ol>
<li>option( )命令定义的变量，e.g.</li>
</ol>
<pre highlighted="true"><code class="language-cmake hljs"><table class="hljs-ln"><tbody><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="1"><div class="hljs-ln-n" data-line-number="1"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="1"><span class="hljs-keyword">option</span>(USE_OPENCV “use opencv?” CACHE PAH)</td></tr></tbody></table></code></pre>
<ol start="2">
<li>缓存变量。e.g.</li>
</ol>
<pre highlighted="true"><code class="language-cmake hljs"><table class="hljs-ln"><tbody><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="1"><div class="hljs-ln-n" data-line-number="1"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="1"><span class="hljs-keyword">set</span>(varName <span class="hljs-string">"value"</span> CACHE <span class="hljs-keyword">STRING</span> <span class="hljs-string">""</span>)</td></tr></tbody></table></code></pre>
<p>当然，还可以使用mark_as_adances来设定，则默认在cmake-gui中不可见。</p>
<h2 id="37-ninja-error-filename-longer-than-260-characters">37. Ninja error: Filename longer than 260 characters<button class="cnblogs-toc-button" title="显示目录导航" aria-expanded="false"></button></h2>
<p>NDK开发中，CMake+Ninja构建，如果文件名超过260个字符会失败。这个限制略蛋疼。</p>
<pre highlighted="true"><code class="hljs language-bash"><table class="hljs-ln"><tbody><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="1"><div class="hljs-ln-n" data-line-number="1"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="1">ninja: error: Stat(../../deps/arcsoft_landmark/2.1.12021.33/libs/Android/armeabi-v7a/libarc_net_sgl.a;E:/dbg/myy/landmark_demo/deps/arcsoft_landmark/2.1.12021.33/libs/Android/armeabi-v7a/libarcsoft_face_detection.a;E:/dbg/myy/landmark_demo/deps/arcsoft_landmark/2.1.12021.33/libs/Android/armeabi-v7a/libarcsoft_landmark_tracking.a;E:/dbg/myy/landmark_demo/deps/arcsoft_landmark/2.1.12021.33/libs/Android/armeabi-v7a/libarcsoft_videooutline.a): Filename longer than 260 characters</td></tr></tbody></table></code></pre>
<h2 id="38-cmake判断cc编译器">38. cmake判断C/C++编译器<button class="cnblogs-toc-button" title="显示目录导航" aria-expanded="false"></button></h2>
<p>比如我想要定制一些安全的编译选项，发现需要区分msvc，gcc和clang。容易直接想到<code>CMAKE_C_COMPILER</code>和<code>CMAKE_CXX_COMPILER</code>。但考虑到-G Xcode和命令行下分别输出，得到的结果并不都是clang，这就很蛋疼。</p>
<p>使用<code>CMAKE_CXX_COMPILER_ID</code>比较方便，像上面提到的case会做合并输出AppleClang。而如果是NDK-r17c则输出Clang。</p>
<p>常见的平台下对应输出：</p>
<ul>
<li>MSVC</li>
<li>Clang</li>
<li>GNU</li>
<li>AppleClang</li>
</ul>
<p>更多结果看官方文档 <a href="https://cmake.org/cmake/help/latest/variable/CMAKE_LANG_COMPILER_ID.html" target="_blank" rel="noopener"><code>CMAKE_&lt;LANG&gt;_COMPILER_ID</code></a></p>
<h2 id="39-cmake字符串追加元素并且用空格分隔">39. cmake字符串追加元素，并且用空格分隔<button class="cnblogs-toc-button" title="显示目录导航" aria-expanded="false"></button></h2>
<p>简单有效的两种方式：</p>
<p>方法1：用set：</p>
<pre highlighted="true"><code class="language-cmake hljs"><table class="hljs-ln"><tbody><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="1"><div class="hljs-ln-n" data-line-number="1"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="1"><span class="hljs-keyword">set</span>(MY_FLAGS <span class="hljs-string">"${MY_FLAGS} -Werror=shadow"</span>)</td></tr></tbody></table></code></pre>
<p>方法2：封装一个函数：</p>
<pre highlighted="true"><code class="language-cmake hljs"><table class="hljs-ln"><tbody><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="1"><div class="hljs-ln-n" data-line-number="1"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="1"><span class="hljs-keyword">function</span>(afq_list_append __string __element)</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="2"><div class="hljs-ln-n" data-line-number="2"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="2">    <span class="hljs-keyword">set</span>(<span class="hljs-variable">${__string}</span> <span class="hljs-string">"${${__string}} ${__element}"</span> PARENT_SCOPE)</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="3"><div class="hljs-ln-n" data-line-number="3"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="3"><span class="hljs-keyword">endfunction</span>()</td></tr></tbody></table></code></pre>
<h2 id="40-cmake---build的使用cmake执行编译链接安装">40. <code>cmake --build</code>的使用：cmake执行编译链接、安装<button class="cnblogs-toc-button" title="显示目录导航" aria-expanded="false"></button></h2>
<p>本质上，当使用<code>cmake ..</code>，或<code>cmake -G "Visual Studio 15 2017 Win64" ../..</code>类似命令时，是执行“pre-make”，相当于是makefile的生成器，可以说对于你的项目代码来说并没执行编译链接，更没有安装。</p>
<p>cmake --build的用法说明：（copy自<a href="https://www.cnblogs.com/coderfenghc/archive/2012/06/17/2552899.html" target="_blank" rel="noopener">CMake 手册详解（二）</a>）</p>
<pre highlighted="true"><code class="hljs language-lua"><table class="hljs-ln"><tbody><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="1"><div class="hljs-ln-n" data-line-number="1"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="1"><span class="hljs-comment">--build &lt;dir&gt;: 构建由CMake生成的工程的二进制树。（这个选项的含义我不是很清楚—译注）</span></td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="2"><div class="hljs-ln-n" data-line-number="2"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="2">该选项用以下的选项概括了内置构建工具的命令行界面</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="3"><div class="hljs-ln-n" data-line-number="3"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="3"> </td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="4"><div class="hljs-ln-n" data-line-number="4"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="4">  &lt;dir&gt;          = 待创建的工程二进制路径。</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="5"><div class="hljs-ln-n" data-line-number="5"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="5"> </td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="6"><div class="hljs-ln-n" data-line-number="6"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="6"> </td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="7"><div class="hljs-ln-n" data-line-number="7"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="7">  <span class="hljs-comment">--target &lt;tgt&gt; = 构建&lt;tgt&gt;，而不是默认目标。</span></td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="8"><div class="hljs-ln-n" data-line-number="8"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="8">  <span class="hljs-comment">--config &lt;cfg&gt; = 对于多重配置工具，选择配置&lt;cfg&gt;。</span></td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="9"><div class="hljs-ln-n" data-line-number="9"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="9">  <span class="hljs-comment">--clean-first  = 首先构建目标的clean伪目标，然后再构建。</span></td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="10"><div class="hljs-ln-n" data-line-number="10"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="10">                   （如果仅仅要clean掉，使用<span class="hljs-comment">--target 'clean'选项。）</span></td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="11"><div class="hljs-ln-n" data-line-number="11"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="11"> </td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="12"><div class="hljs-ln-n" data-line-number="12"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="12">  <span class="hljs-comment">--             = 向内置工具（native tools）传递剩余的选项。</span></td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="13"><div class="hljs-ln-n" data-line-number="13"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="13">运行不带选项的cmake <span class="hljs-comment">--build来获取快速帮助信息。</span></td></tr></tbody></table></code></pre>
<p>实际使用经验：cmake生成了这些cache文件后，可以打开Visual Studio编译，或执行make编译（Linux下）。但这些都是native tool。通用的方式则是用cmake包装好的接口：</p>
<pre highlighted="true"><code class="hljs language-css"><table class="hljs-ln"><tbody><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="1"><div class="hljs-ln-n" data-line-number="1"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="1"># 执行编译（如果是可执target，则包括链接过程）</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="2"><div class="hljs-ln-n" data-line-number="2"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="2">cmake <span class="hljs-attr">--build</span> . <span class="hljs-attr">--config</span> Release</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="3"><div class="hljs-ln-n" data-line-number="3"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="3"> </td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="4"><div class="hljs-ln-n" data-line-number="4"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="4"># 执行某个target的编译（如果是可执target，则包括链接过程）</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="5"><div class="hljs-ln-n" data-line-number="5"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="5">cmake <span class="hljs-attr">--build</span> . <span class="hljs-attr">--config</span> Release <span class="hljs-attr">--target</span> xx</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="6"><div class="hljs-ln-n" data-line-number="6"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="6"> </td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="7"><div class="hljs-ln-n" data-line-number="7"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="7"># 执行安装</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="8"><div class="hljs-ln-n" data-line-number="8"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="8">cmake <span class="hljs-attr">--install</span> . <span class="hljs-attr">--prefix</span> d:/lib/openblas/clang-cl/x64 -v</td></tr></tbody></table></code></pre>
<h2 id="41-cc和汇编混编">41. C/C++和汇编混编<button class="cnblogs-toc-button" title="显示目录导航" aria-expanded="false"></button></h2>
<p>在cmake里混合编译C/C++与汇编代码，通过<code>enable_language(ASM_&lt;DIALECT&gt;)</code>可以做到。</p>
<p>例如x86(32位）的MASM（Visual Studio支持的一种汇编语法）：</p>
<pre highlighted="true"><code class="language-cmake hljs"><table class="hljs-ln"><tbody><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="1"><div class="hljs-ln-n" data-line-number="1"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="1"><span class="hljs-keyword">enable_language</span>(ASM_MASM)</td></tr></tbody></table></code></pre>
<p>此外往往还需要给Visual Studio设置SEH：</p>
<pre highlighted="true"><code class="language-cmake hljs"><table class="hljs-ln"><tbody><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="1"><div class="hljs-ln-n" data-line-number="1"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="1"><span class="hljs-keyword">set</span>(CMAKE_EXE_LINKER_FLAGS <span class="hljs-string">"${CMAKE_EXE_LINKER_FLAGS} /SAFESEH:NO /NODEFAULTLIB:LIBC.LIB"</span>) </td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="2"><div class="hljs-ln-n" data-line-number="2"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="2"><span class="hljs-keyword">set</span>(CMAKE_SHARED_LINKER_FLAGS <span class="hljs-string">"${CMAKE_SHARED_LINKER_FLAGS} /SAFESEH:NO /NODEFAULTLIB:LIBC.LIB"</span>)</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="3"><div class="hljs-ln-n" data-line-number="3"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="3"><span class="hljs-keyword">set</span>(CMAKE_MODULE_LINKER_FLAGS <span class="hljs-string">"${CMAKE_MODULE_LINKER_FLAGS} /SAFESEH:NO /NODEFAULTLIB:LIBC.LIB"</span>)</td></tr></tbody></table></code></pre>
<p>汇编文件则和C/C++文件一起，正常添加为target的依赖即可：</p>
<pre highlighted="true"><code class="language-cmake hljs"><table class="hljs-ln"><tbody><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="1"><div class="hljs-ln-n" data-line-number="1"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="1"><span class="hljs-keyword">add_executable</span>(run src/main.cpp src/CalcSum_.asm)</td></tr></tbody></table></code></pre>
<p>例如<code>src/CalcSum_.cpp</code>:</p>
<pre highlighted="true"><code class="language-asm hljs"><table class="hljs-ln"><tbody><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="1"><div class="hljs-ln-n" data-line-number="1"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="1">    .model flat, c</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="2"><div class="hljs-ln-n" data-line-number="2"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="2">    .code</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="3"><div class="hljs-ln-n" data-line-number="3"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="3"> </td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="4"><div class="hljs-ln-n" data-line-number="4"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="4">; extern "C" int CalcSum_(int a, int b, int c)</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="5"><div class="hljs-ln-n" data-line-number="5"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="5">;</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="6"><div class="hljs-ln-n" data-line-number="6"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="6">; Description:  This function demonstrates passing arguments between</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="7"><div class="hljs-ln-n" data-line-number="7"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="7">;               a C++ function and an assembly language function.</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="8"><div class="hljs-ln-n" data-line-number="8"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="8">;</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="9"><div class="hljs-ln-n" data-line-number="9"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="9">; Returns:      a + b + c</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="10"><div class="hljs-ln-n" data-line-number="10"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="10"> </td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="11"><div class="hljs-ln-n" data-line-number="11"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="11">CalcSum_ proc</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="12"><div class="hljs-ln-n" data-line-number="12"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="12"> </td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="13"><div class="hljs-ln-n" data-line-number="13"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="13">; Initialize a stack frame pointer</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="14"><div class="hljs-ln-n" data-line-number="14"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="14">        push ebp</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="15"><div class="hljs-ln-n" data-line-number="15"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="15">        mov ebp,esp</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="16"><div class="hljs-ln-n" data-line-number="16"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="16"> </td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="17"><div class="hljs-ln-n" data-line-number="17"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="17">; Load the argument values</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="18"><div class="hljs-ln-n" data-line-number="18"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="18">        mov eax,[ebp+8]                     ; eax = 'a'</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="19"><div class="hljs-ln-n" data-line-number="19"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="19">        mov ecx,[ebp+12]                    ; ecx = 'b'</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="20"><div class="hljs-ln-n" data-line-number="20"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="20">        mov edx,[ebp+16]                    ; edx = 'c'</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="21"><div class="hljs-ln-n" data-line-number="21"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="21"> </td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="22"><div class="hljs-ln-n" data-line-number="22"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="22">; Calculate the sum</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="23"><div class="hljs-ln-n" data-line-number="23"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="23">        add eax,ecx                         ; eax = 'a' + 'b'</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="24"><div class="hljs-ln-n" data-line-number="24"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="24">        add eax,edx                         ; eax = 'a' + 'b' + 'c'</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="25"><div class="hljs-ln-n" data-line-number="25"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="25"> </td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="26"><div class="hljs-ln-n" data-line-number="26"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="26">; Restore the caller's stack frame pointer</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="27"><div class="hljs-ln-n" data-line-number="27"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="27">        pop ebp</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="28"><div class="hljs-ln-n" data-line-number="28"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="28">        ret</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="29"><div class="hljs-ln-n" data-line-number="29"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="29"> </td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="30"><div class="hljs-ln-n" data-line-number="30"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="30">CalcSum_ endp</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="31"><div class="hljs-ln-n" data-line-number="31"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="31">        end</td></tr></tbody></table></code></pre>
<p><code>src/main.cpp</code>:</p>
<pre highlighted="true"><code class="language-c++ hljs language-c"><table class="hljs-ln"><tbody><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="1"><div class="hljs-ln-n" data-line-number="1"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="1"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span></td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="2"><div class="hljs-ln-n" data-line-number="2"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="2"> </td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="3"><div class="hljs-ln-n" data-line-number="3"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="3"><span class="hljs-meta">#<span class="hljs-keyword">ifdef</span> USE_ASSEMBLY</span></td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="4"><div class="hljs-ln-n" data-line-number="4"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="4"><span class="hljs-keyword">extern</span> <span class="hljs-string">"C"</span> <span class="hljs-type">int</span> <span class="hljs-title function_">CalcSum_</span><span class="hljs-params">(<span class="hljs-type">int</span> a, <span class="hljs-type">int</span> b, <span class="hljs-type">int</span> c)</span>;</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="5"><div class="hljs-ln-n" data-line-number="5"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="5"><span class="hljs-meta">#<span class="hljs-keyword">else</span></span></td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="6"><div class="hljs-ln-n" data-line-number="6"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="6"><span class="hljs-type">int</span> <span class="hljs-title function_">CalcSumTest</span><span class="hljs-params">(<span class="hljs-type">int</span> a, <span class="hljs-type">int</span> b, <span class="hljs-type">int</span> c)</span></td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="7"><div class="hljs-ln-n" data-line-number="7"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="7">{</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="8"><div class="hljs-ln-n" data-line-number="8"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="8">    <span class="hljs-keyword">return</span> a + b + c;</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="9"><div class="hljs-ln-n" data-line-number="9"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="9">}</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="10"><div class="hljs-ln-n" data-line-number="10"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="10"><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span></td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="11"><div class="hljs-ln-n" data-line-number="11"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="11"> </td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="12"><div class="hljs-ln-n" data-line-number="12"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="12"><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span> {</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="13"><div class="hljs-ln-n" data-line-number="13"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="13">    <span class="hljs-type">int</span> a = <span class="hljs-number">17</span>, b = <span class="hljs-number">11</span>, c = <span class="hljs-number">14</span>;</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="14"><div class="hljs-ln-n" data-line-number="14"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="14"><span class="hljs-meta">#<span class="hljs-keyword">ifdef</span> USE_ASSEMBLY</span></td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="15"><div class="hljs-ln-n" data-line-number="15"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="15">    <span class="hljs-type">int</span> sum = CalcSum_(a, b, c);</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="16"><div class="hljs-ln-n" data-line-number="16"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="16"><span class="hljs-meta">#<span class="hljs-keyword">else</span></span></td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="17"><div class="hljs-ln-n" data-line-number="17"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="17">    <span class="hljs-type">int</span> sum = CalcSumTest(a, b, c);</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="18"><div class="hljs-ln-n" data-line-number="18"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="18"><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span></td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="19"><div class="hljs-ln-n" data-line-number="19"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="19"> </td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="20"><div class="hljs-ln-n" data-line-number="20"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="20">    <span class="hljs-built_in">printf</span>(<span class="hljs-string">" a: %d\n"</span>, a);</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="21"><div class="hljs-ln-n" data-line-number="21"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="21">    <span class="hljs-built_in">printf</span>(<span class="hljs-string">" b: %d\n"</span>, b);</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="22"><div class="hljs-ln-n" data-line-number="22"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="22">    <span class="hljs-built_in">printf</span>(<span class="hljs-string">" c: %d\n"</span>, c);</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="23"><div class="hljs-ln-n" data-line-number="23"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="23">    <span class="hljs-built_in">printf</span>(<span class="hljs-string">" sum: %d\n"</span>, sum);</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="24"><div class="hljs-ln-n" data-line-number="24"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="24"> </td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="25"><div class="hljs-ln-n" data-line-number="25"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="25">    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="26"><div class="hljs-ln-n" data-line-number="26"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="26">}</td></tr></tbody></table></code></pre>
<h2 id="42-cmake设置pthread">42. cmake设置pthread<button class="cnblogs-toc-button" title="显示目录导航" aria-expanded="false"></button></h2>
<p>第一种：</p>
<pre highlighted="true"><code class="language-cmake hljs"><table class="hljs-ln"><tbody><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="1"><div class="hljs-ln-n" data-line-number="1"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="1"><span class="hljs-keyword">target_link_libraries</span>(xxx pthread)</td></tr></tbody></table></code></pre>
<p>有时候不管用（例如ARM Android平台），则用下面的方式:</p>
<pre highlighted="true"><code class="language-cmake hljs"><table class="hljs-ln"><tbody><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="1"><div class="hljs-ln-n" data-line-number="1"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="1"><span class="hljs-keyword">find_package</span>( Threads )</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="2"><div class="hljs-ln-n" data-line-number="2"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="2"><span class="hljs-keyword">target_link_libraries</span>( testbed <span class="hljs-variable">${CMAKE_THREAD_LIBS_INIT}</span> log)</td></tr></tbody></table></code></pre>
<p>注意ARM Android（也就是通常说的NDK开发中），需要给cmake传一个选项：</p>
<pre highlighted="true"><code class="language-cmake hljs"><table class="hljs-ln"><tbody><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="1"><div class="hljs-ln-n" data-line-number="1"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="1">-DANDROID_PLATFORM=android-<span class="hljs-number">24</span> ^</td></tr></tbody></table></code></pre>
<p>（我是armv8所以用24）</p>
<h2 id="43-cmake使用pkg-config">43. cmake使用pkg-config<button class="cnblogs-toc-button" title="显示目录导航" aria-expanded="false"></button></h2>
<p>有些依赖库只提供.pc文件，甚至已经配置了CMake脚本但是安装后还是只有.pc而没有XXXConfig.cmake或xxx-config.cmake。并且不仅是Linux，Windows上也这样。<br />
这就不得不在CMake中尝试去加载.pc文件。原理是，cmake里面封装了对pkg-config工具的兼容，可以认为是一个插件，用这个插件去加载.pc文件。实际测试发现Linux和Windows都可以用。</p>
<p>Linux安装pkg-config:</p>
<pre highlighted="true"><code class="language-bash hljs"><table class="hljs-ln"><tbody><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="1"><div class="hljs-ln-n" data-line-number="1"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="1">sudo apt install pkg-config</td></tr></tbody></table></code></pre>
<p>Windows安装<a href="https://sourceforge.net/projects/pkgconfiglite/files/0.28-1/pkg-config-lite-0.28-1_bin-win32.zip/download" target="_blank" rel="noopener">pkg-config-lite</a></p>
<p>使用：先找到xx.pc文件，然后分成目录和文件前缀两部分，在cmake中配置</p>
<p><strong>举例1：Ubuntu 16.04下用apt安装openblas并在CMake中用pkg-config方式配置：</strong></p>
<pre highlighted="true"><code class="language-cmake hljs"><table class="hljs-ln"><tbody><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="1"><div class="hljs-ln-n" data-line-number="1"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="1"><span class="hljs-keyword">cmake_minimum_required</span>(VERSION <span class="hljs-number">3.15</span>)</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="2"><div class="hljs-ln-n" data-line-number="2"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="2"> </td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="3"><div class="hljs-ln-n" data-line-number="3"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="3"><span class="hljs-keyword">project</span>(cmake_pkg_config_example)</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="4"><div class="hljs-ln-n" data-line-number="4"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="4"> </td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="5"><div class="hljs-ln-n" data-line-number="5"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="5"><span class="hljs-keyword">set</span>(ENV{PKG_CONFIG_PATH} /usr/lib/pkgconfig)</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="6"><div class="hljs-ln-n" data-line-number="6"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="6"><span class="hljs-keyword">find_package</span>(PkgConfig)</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="7"><div class="hljs-ln-n" data-line-number="7"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="7">pkg_search_module(OBS REQUIRED blas-openblas)</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="8"><div class="hljs-ln-n" data-line-number="8"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="8"> </td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="9"><div class="hljs-ln-n" data-line-number="9"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="9"><span class="hljs-keyword">message</span>(STATUS <span class="hljs-string">"=== OBS_LIBRARIES: ${OBS_LIBRARIES}"</span>)</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="10"><div class="hljs-ln-n" data-line-number="10"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="10"><span class="hljs-keyword">message</span>(STATUS <span class="hljs-string">"=== OBS_INCLUDE_DIRS: ${OBS_INCLUDE_DIRS}"</span>)</td></tr></tbody></table></code></pre>
<p><strong>举例2：Windows 10下用CMake配置Pangolin安装中配置的zlib</strong></p>
<pre highlighted="true"><code class="language-cmake hljs"><table class="hljs-ln"><tbody><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="1"><div class="hljs-ln-n" data-line-number="1"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="1"><span class="hljs-keyword">cmake_minimum_required</span>(VERSION <span class="hljs-number">3.15</span>)</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="2"><div class="hljs-ln-n" data-line-number="2"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="2"> </td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="3"><div class="hljs-ln-n" data-line-number="3"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="3"><span class="hljs-keyword">project</span>(cmake_pkg_config_example)</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="4"><div class="hljs-ln-n" data-line-number="4"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="4"> </td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="5"><div class="hljs-ln-n" data-line-number="5"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="5"><span class="hljs-comment">#指定pkg-config.exe绝对路径</span></td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="6"><div class="hljs-ln-n" data-line-number="6"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="6"><span class="hljs-keyword">set</span>(PKG_CONFIG_EXECUTABLE <span class="hljs-string">"D:/soft/pkg-config/bin/pkg-config.exe"</span>)</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="7"><div class="hljs-ln-n" data-line-number="7"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="7"> </td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="8"><div class="hljs-ln-n" data-line-number="8"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="8"><span class="hljs-comment">#指定zlib.pc所在目录</span></td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="9"><div class="hljs-ln-n" data-line-number="9"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="9"><span class="hljs-keyword">set</span>(ENV{PKG_CONFIG_PATH} <span class="hljs-string">"D:/lib/pangolin/share/pkgconfig"</span>)</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="10"><div class="hljs-ln-n" data-line-number="10"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="10"> </td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="11"><div class="hljs-ln-n" data-line-number="11"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="11"><span class="hljs-keyword">find_package</span>(PkgConfig)</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="12"><div class="hljs-ln-n" data-line-number="12"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="12"><span class="hljs-keyword">message</span>(STATUS <span class="hljs-string">"--- PKG_CONFIG_FOUND: ${PKG_CONFIG_FOUND}"</span>)</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="13"><div class="hljs-ln-n" data-line-number="13"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="13"><span class="hljs-keyword">message</span>(STATUS <span class="hljs-string">"--- PKG_CONFIG_VERSION_STRING: ${PKG_CONFIG_VERSION_STRING}"</span>)</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="14"><div class="hljs-ln-n" data-line-number="14"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="14"> </td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="15"><div class="hljs-ln-n" data-line-number="15"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="15">pkg_search_module(ZLIB REQUIRED zlib)</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="16"><div class="hljs-ln-n" data-line-number="16"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="16"> </td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="17"><div class="hljs-ln-n" data-line-number="17"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="17"><span class="hljs-keyword">message</span>(STATUS <span class="hljs-string">"=== ZLIB_LIBRARIES: ${ZLIB_LIBRARIES}"</span>)</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="18"><div class="hljs-ln-n" data-line-number="18"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="18"><span class="hljs-keyword">message</span>(STATUS <span class="hljs-string">"=== ZLIB_INCLUDE_DIRS: ${ZLIB_INCLUDE_DIRS}"</span>)</td></tr></tbody></table></code></pre>
<p>再详细点的话，看这篇：<a href="https://www.jianshu.com/p/eb6b06463da9" target="_blank" rel="noopener">在cmake中使用pkg-config</a></p>
<h2 id="44-cmake多行注释">44. cmake多行注释<button class="cnblogs-toc-button" title="显示目录导航" aria-expanded="false"></button></h2>
<p>从cmake 3.0版本开始，可以使用多行注释</p>
<pre highlighted="true"><code class="language-cmake hljs"><table class="hljs-ln"><tbody><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="1"><div class="hljs-ln-n" data-line-number="1"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="1"><span class="hljs-comment">#[[</span></td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="2"><div class="hljs-ln-n" data-line-number="2"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="2">第一种注释方式</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="3"><div class="hljs-ln-n" data-line-number="3"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="3"><span class="hljs-comment">#]]</span></td></tr></tbody></table></code></pre>
<pre highlighted="true"><code class="language-cmake hljs"><table class="hljs-ln"><tbody><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="1"><div class="hljs-ln-n" data-line-number="1"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="1"><span class="hljs-comment">#[===============[</span></td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="2"><div class="hljs-ln-n" data-line-number="2"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="2">第二种注释方式</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="3"><div class="hljs-ln-n" data-line-number="3"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="3"><span class="hljs-comment">#]===============]</span></td></tr></tbody></table></code></pre>
<p>ref: <a href="https://stackoverflow.com/questions/20804468/cmake-multiple-line-comments-block-comment" target="_blank" rel="noopener">CMake Multiple line comments - Block Comment</a></p>
<h2 id="45-命令行-d指定参数">45. 命令行<code>-D</code>指定参数<button class="cnblogs-toc-button" title="显示目录导航" aria-expanded="false"></button></h2>
<p>在cmake脚本中指定其中任意一种：</p>
<ol>
<li>cmake缓存类型的变量，例如</li>
</ol>
<pre highlighted="true"><code class="language-cmake hljs"><table class="hljs-ln"><tbody><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="1"><div class="hljs-ln-n" data-line-number="1"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="1"><span class="hljs-keyword">set</span>(CAFFE_TARGET_VERSION <span class="hljs-string">"1.0.0"</span> CACHE <span class="hljs-keyword">STRING</span> <span class="hljs-string">"Caffe logical version"</span>)</td></tr></tbody></table></code></pre>
<ol start="2">
<li>option</li>
</ol>
<pre highlighted="true"><code class="language-cmake hljs"><table class="hljs-ln"><tbody><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="1"><div class="hljs-ln-n" data-line-number="1"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="1"><span class="hljs-keyword">option</span>(USE_OPENCV <span class="hljs-string">"Do we use OpenCV?"</span> <span class="hljs-keyword">ON</span>)</td></tr></tbody></table></code></pre>
<h2 id="46-include指令">46. <code>include()</code>指令<button class="cnblogs-toc-button" title="显示目录导航" aria-expanded="false"></button></h2>
<p>两种作用：</p>
<ol>
<li>
<p>包含文件，例如<code>include(utils.cmake)</code></p>
</li>
<li>
<p>包含模块，在<code>CMAKE_MODULE_PATH</code>-&gt;CMAKE MODULE DIRECTORY依次查找。例如<code>include(ExternalModule)</code>，会在这两个路径列表中查找<code>ExternalModule.cmake</code>文件并加载。</p>
</li>
</ol>
<p><code>CMAKE_MODULE_PATH</code>是在CMake脚本中用户可以自行修改的变量。<br />
CMAKE MODULE DIRECTORY是什么，官方文档没明确说。其实说的应该是cmake安装后的Modules目录，例如<code>/usr/local/share/cmake/Modules</code></p>
<h2 id="47-list追加元素或list首部插入元素">47. list追加元素，或list首部插入元素<button class="cnblogs-toc-button" title="显示目录导航" aria-expanded="false"></button></h2>
<p>追加（链表尾部插入）：</p>
<pre highlighted="true"><code class="language-cmake hljs"><table class="hljs-ln"><tbody><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="1"><div class="hljs-ln-n" data-line-number="1"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="1"><span class="hljs-keyword">list</span>(APPEND CMAKE_MODULE_PATH <span class="hljs-string">"cmake/Modules"</span>)</td></tr></tbody></table></code></pre>
<p>首部插入（链表首元素前插入）：</p>
<pre highlighted="true"><code class="language-cmake hljs"><table class="hljs-ln"><tbody><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="1"><div class="hljs-ln-n" data-line-number="1"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="1"><span class="hljs-keyword">list</span>(INSERT CMAKE_PREFIX_PATH <span class="hljs-number">0</span> <span class="hljs-string">"$ENV{HOME}/soft/opencv/build"</span>)</td></tr></tbody></table></code></pre>
<h2 id="48-cmake中使用iwyu">48. cmake中使用IWYU<button class="cnblogs-toc-button" title="显示目录导航" aria-expanded="false"></button></h2>
<p>IWYU 是 google 的开源项目，用来移除不必要的头文件。<a href="https://github.com/include-what-you-use/include-what-you-use#using-with-cmake" target="_blank" rel="noopener">在cmake中使用IWYU</a>。</p>
<h2 id="49-target_link_libraries">49. target_link_libraries()<button class="cnblogs-toc-button" title="显示目录导航" aria-expanded="false"></button></h2>
<p>cmake 3.13 开始提供的命令。低版本cmake无法使用。</p>
<h2 id="50-cmake构建ndk项目提示asmtypesh找不到">50. CMake构建NDK项目提示asm/types.h找不到<button class="cnblogs-toc-button" title="显示目录导航" aria-expanded="false"></button></h2>
<p>用CMake构建NDK项目时，会传入toolchain的cmake脚本文件<code>android.toolchain.cmake</code>给CMake。这个文件中会做若干设定，其中就包括include路径。</p>
<p>我遇到的情况是，自己手动修改<code>CMAKE_C_FLAGS</code>和<code>CMAKE_CXX_FLAGS</code>时，覆盖了它们原有的（android.toolchain.cmake修改后的）值，导致<code>asm/types.h</code>找不到。</p>
<p>我的错误设定：</p>
<pre highlighted="true"><code class="language-cmake hljs"><table class="hljs-ln"><tbody><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="1"><div class="hljs-ln-n" data-line-number="1"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="1"><span class="hljs-keyword">set</span>(CMAKE_C_FLAGS <span class="hljs-string">"${MY_CMAKE_C_FLAGS}"</span>)</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="2"><div class="hljs-ln-n" data-line-number="2"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="2"><span class="hljs-keyword">set</span>(CMAKE_CXX_FLAGS <span class="hljs-string">"${MY_CMAKE_CXX_FLAGS}"</span>)</td></tr></tbody></table></code></pre>
<p>正确做法应该是追加内容而非修改：</p>
<pre highlighted="true"><code class="language-cmake hljs"><table class="hljs-ln"><tbody><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="1"><div class="hljs-ln-n" data-line-number="1"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="1"><span class="hljs-keyword">set</span>(CMAKE_C_FLAGS <span class="hljs-string">"${CMAKE_C_FLAGS} ${MY_CMAKE_C_FLAGS}"</span>)</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="2"><div class="hljs-ln-n" data-line-number="2"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="2"><span class="hljs-keyword">set</span>(CMAKE_CXX_FLAGS <span class="hljs-string">"${CMAKE_CXX_FLAGS} ${MY_CMAKE_CXX_FLAGS}"</span>)</td></tr></tbody></table></code></pre>
<p>P.S. 排查方法：由于我是基于ninja构建的（cmake+ndk的组合下，现在通常用ninja），通过对比”能正常构建的工程“和”提示asm/types.h找不到的工程“之间<code>${CMAKE_BINARY_DIR}</code>目录下的<code>rules.ninja</code>和<code>build.ninja</code>来发现问题所在。</p>
<h2 id="51-windows下创建的共享库没生成lib文件">51. windows下创建的共享库，没生成.lib文件<button class="cnblogs-toc-button" title="显示目录导航" aria-expanded="false"></button></h2>
<p>.lib是导入库，里面存访对外可见（暴露）的符号（函数、变量）。.dll应该搭配一个.lib导入库才能使用。</p>
<p>如果是自己的源码生成的dll共享库，则在CMakeLists.txt一开始，添加：</p>
<pre highlighted="true"><code class="language-cmake hljs"><table class="hljs-ln"><tbody><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="1"><div class="hljs-ln-n" data-line-number="1"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="1"><span class="hljs-keyword">set</span>(CMAKE_WINDOWS_EXPORT_ALL_SYMBOLS <span class="hljs-keyword">ON</span>)</td></tr></tbody></table></code></pre>
<p>则可以导出所有的符号。</p>
<p>ref: <a href="https://stackoverflow.com/questions/1941443/cmake-linking-against-shared-library-on-windows-error-about-not-finding-lib-fi" target="_blank" rel="noopener">CMake linking against shared library on windows: error about not finding .lib file</a></p>
<p>而如果只想导出一部分符号，则可以为每个函数分别指定导出规则。</p>
<h2 id="52-拷贝dll">52. 拷贝dll<button class="cnblogs-toc-button" title="显示目录导航" aria-expanded="false"></button></h2>
<p>在Windows下，Visual Studio中，如果用了动态库（例如opencv、zlib等），需要把dll放到PATH环境变量中，使得运行时能找到dll。<br />
而其实Windows下的PATH查找，是会在<code>CMAKE_BINARY_DIR</code>目录下查找的。如果不想改PATH环境变量，也不希望每次都要手动拷贝dll，包括清掉build目录后重新构建时也不想手动拷贝，那么可以用cmake命令来搞。</p>
<p>举个例子，调用zlib库执行文本压缩解压，用到了zlib1.dll，其中executable target名字是demo。</p>
<p>zlib的二进制包下载：<a href="https://nsis.sourceforge.io/mediawiki/images/b/bb/Zlib-1.2.8-win64-AMD64.zip" target="_blank" rel="noopener">https://nsis.sourceforge.io/mediawiki/images/b/bb/Zlib-1.2.8-win64-AMD64.zip</a></p>
<p>zlib的调用示例代码：<a href="https://blog.csdn.net/yuhuqiao/article/details/82188963" target="_blank" rel="noopener">https://blog.csdn.net/yuhuqiao/article/details/82188963</a></p>
<p>cmake中拷贝zlib1.dll的写法：</p>
<pre highlighted="true"><code class="language-cmake hljs"><table class="hljs-ln"><tbody><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="1"><div class="hljs-ln-n" data-line-number="1"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="1"><span class="hljs-comment"># each time the `demo` target is built, we copy zlib1.dll if it is changed.</span></td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="2"><div class="hljs-ln-n" data-line-number="2"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="2"><span class="hljs-keyword">add_custom_command</span>(<span class="hljs-keyword">TARGET</span> demo</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="3"><div class="hljs-ln-n" data-line-number="3"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="3">    POST_BUILD</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="4"><div class="hljs-ln-n" data-line-number="4"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="4"> </td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="5"><div class="hljs-ln-n" data-line-number="5"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="5">    <span class="hljs-keyword">COMMAND</span> <span class="hljs-variable">${CMAKE_COMMAND}</span> -E copy_if_different</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="6"><div class="hljs-ln-n" data-line-number="6"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="6">    <span class="hljs-variable">${ZLIB_DLL}</span></td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="7"><div class="hljs-ln-n" data-line-number="7"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="7">    <span class="hljs-variable">${CMAKE_BINARY_DIR}</span>/</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="8"><div class="hljs-ln-n" data-line-number="8"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="8">)</td></tr></tbody></table></code></pre>
<h2 id="53-压缩或解压ziptargz">53. 压缩或解压.zip/tar.gz<button class="cnblogs-toc-button" title="显示目录导航" aria-expanded="false"></button></h2>
<p>以解压<code>doctest.zip</code>到项目根目录为例：</p>
<pre highlighted="true"><code class="language-cmake hljs"><table class="hljs-ln"><tbody><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="1"><div class="hljs-ln-n" data-line-number="1"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="1"><span class="hljs-keyword">execute_process</span>(</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="2"><div class="hljs-ln-n" data-line-number="2"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="2">    <span class="hljs-keyword">COMMAND</span> <span class="hljs-variable">${CMAKE_COMMAND}</span> -E tar xzf <span class="hljs-variable">${CMAKE_SOURCE_DIR}</span>/doctest.zip</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="3"><div class="hljs-ln-n" data-line-number="3"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="3">    WORKING_DIRECTORY <span class="hljs-variable">${CMAKE_SOURCE_DIR}</span></td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="4"><div class="hljs-ln-n" data-line-number="4"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="4">)</td></tr></tbody></table></code></pre>
<p>tar命令是从cmake 3.2开始支持的内置命令。</p>
<p><a href="https://stackoverflow.com/questions/48891928/cmake-unzip-automaticallywhile-building-when-the-zip-file-changes" target="_blank" rel="noopener">https://stackoverflow.com/questions/48891928/cmake-unzip-automaticallywhile-building-when-the-zip-file-changes</a></p>
<h2 id="54-列出所有target">54. 列出所有target<button class="cnblogs-toc-button" title="显示目录导航" aria-expanded="false"></button></h2>
<p>有些基于cmake的项目，CMakeLists.txt写的很复杂很庞大。可以列出所有target，帮助理清思路。</p>
<p>列出makefile中的所有target:</p>
<pre highlighted="true"><code class="language-bash hljs"><table class="hljs-ln"><tbody><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="1"><div class="hljs-ln-n" data-line-number="1"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="1"><span class="hljs-built_in">cd</span> build</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="2"><div class="hljs-ln-n" data-line-number="2"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="2">cmake --build . --target <span class="hljs-built_in">help</span> </td></tr></tbody></table></code></pre>
<p>实际上，makefile里诸如"all"和"clean"这样的target，并不是我们感兴趣的。还是shell大法拼凑一下吧：</p>
<pre highlighted="true"><code class="language-bash hljs"><table class="hljs-ln"><tbody><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="1"><div class="hljs-ln-n" data-line-number="1"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="1"><span class="hljs-built_in">cd</span> ~/work/my_project</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="2"><div class="hljs-ln-n" data-line-number="2"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="2"><span class="hljs-built_in">mkdir</span> build &amp;&amp; <span class="hljs-built_in">cd</span> build &amp;&amp; cmake ..</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="3"><div class="hljs-ln-n" data-line-number="3"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="3">make -j4 &gt; log.txt 2&gt;&amp;1</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="4"><div class="hljs-ln-n" data-line-number="4"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="4">grep <span class="hljs-string">'Built target'</span> log.txt | awk <span class="hljs-string">'{print $4}'</span></td></tr></tbody></table></code></pre>
<h2 id="55-判断文件是否存在">55. 判断文件是否存在<button class="cnblogs-toc-button" title="显示目录导航" aria-expanded="false"></button></h2>
<p><code>EXISTS</code>可以判断，同时适用于文件和目录。</p>
<p>举例：查找当前目录下是否存在doctest目录，并且检查doctest目录下是否存在<code>doctest_fwd.h</code>和<code>doctest.cpp</code>文件：</p>
<pre highlighted="true"><code class="language-cmake hljs"><table class="hljs-ln"><tbody><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="1"><div class="hljs-ln-n" data-line-number="1"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="1"><span class="hljs-keyword">if</span> (<span class="hljs-keyword">EXISTS</span> <span class="hljs-string">"${CMAKE_SOURCE_DIR}/doctest"</span></td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="2"><div class="hljs-ln-n" data-line-number="2"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="2">    <span class="hljs-keyword">AND</span> <span class="hljs-keyword">EXISTS</span> <span class="hljs-string">"${CMAKE_SOURCE_DIR}/doctest/doctest_fwd.h"</span></td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="3"><div class="hljs-ln-n" data-line-number="3"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="3">    <span class="hljs-keyword">AND</span> <span class="hljs-keyword">EXISTS</span> <span class="hljs-string">"${CMAKE_SOURCE_DIR}/doctest/doctest.cpp"</span></td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="4"><div class="hljs-ln-n" data-line-number="4"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="4">)</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="5"><div class="hljs-ln-n" data-line-number="5"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="5">    <span class="hljs-keyword">message</span>(STATUS <span class="hljs-string">"--- doctest source code ready !"</span>)</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="6"><div class="hljs-ln-n" data-line-number="6"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="6"><span class="hljs-keyword">else</span>()</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="7"><div class="hljs-ln-n" data-line-number="7"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="7">    <span class="hljs-keyword">message</span>(STATUS <span class="hljs-string">"--- extracting doctest source code from zip..."</span>)</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="8"><div class="hljs-ln-n" data-line-number="8"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="8">    <span class="hljs-keyword">execute_process</span>(</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="9"><div class="hljs-ln-n" data-line-number="9"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="9">        <span class="hljs-keyword">COMMAND</span> <span class="hljs-variable">${CMAKE_COMMAND}</span> -E tar xzf <span class="hljs-variable">${CMAKE_SOURCE_DIR}</span>/doctest.zip</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="10"><div class="hljs-ln-n" data-line-number="10"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="10">        WORKING_DIRECTORY <span class="hljs-variable">${CMAKE_SOURCE_DIR}</span></td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="11"><div class="hljs-ln-n" data-line-number="11"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="11">    )</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="12"><div class="hljs-ln-n" data-line-number="12"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="12"><span class="hljs-keyword">endif</span>()</td></tr></tbody></table></code></pre>
<h2 id="56-打印变量">56. 打印变量<button class="cnblogs-toc-button" title="显示目录导航" aria-expanded="false"></button></h2>
<p>可以用<code>message</code>命里，例如：</p>
<pre highlighted="true"><code class="language-cmake hljs"><table class="hljs-ln"><tbody><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="1"><div class="hljs-ln-n" data-line-number="1"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="1"><span class="hljs-keyword">message</span>(STATUS <span class="hljs-string">"--- CMAKE_CXX_COMPILER is: ${CMAKE_CXX_COMPILER}"</span>)</td></tr></tbody></table></code></pre>
<p>也可以用如下函数：</p>
<pre highlighted="true"><code class="language-cmake hljs"><table class="hljs-ln"><tbody><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="1"><div class="hljs-ln-n" data-line-number="1"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="1"><span class="hljs-keyword">include</span>(CMakePrintHelpers)</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="2"><div class="hljs-ln-n" data-line-number="2"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="2">cmake_print_variables(CMAKE_CXX_COMPILER)</td></tr></tbody></table></code></pre>
<h2 id="57-判断是否为目录">57. 判断是否为目录<button class="cnblogs-toc-button" title="显示目录导航" aria-expanded="false"></button></h2>
<p>用<code>IS_DIRECTORY</code>命令判断。例如shadow中判断各个backend，如果是目录，则添加subdirectory，写法如下：</p>
<pre highlighted="true"><code class="language-cmake hljs"><table class="hljs-ln"><tbody><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="1"><div class="hljs-ln-n" data-line-number="1"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="1"><span class="hljs-keyword">foreach</span> (backend_dir <span class="hljs-variable">${backends_dir}</span>)</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="2"><div class="hljs-ln-n" data-line-number="2"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="2">  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">IS_DIRECTORY</span> <span class="hljs-variable">${backend_dir}</span>)</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="3"><div class="hljs-ln-n" data-line-number="3"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="3">    <span class="hljs-keyword">add_subdirectory</span>(<span class="hljs-variable">${backend_dir}</span>)</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="4"><div class="hljs-ln-n" data-line-number="4"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="4">  <span class="hljs-keyword">endif</span>()</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="5"><div class="hljs-ln-n" data-line-number="5"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="5"><span class="hljs-keyword">endforeach</span>()</td></tr></tbody></table></code></pre>
<h2 id="58-visual-studio环境下的mtmtd-md-mdd的设定">58. Visual Studio环境下的MT，MTd, MD, MDd的设定<button class="cnblogs-toc-button" title="显示目录导航" aria-expanded="false"></button></h2>
<p><a href="https://stackoverflow.com/a/56490614/2999096" target="_blank" rel="noopener">https://stackoverflow.com/a/56490614/2999096</a></p>
<p>从cmake3.15开始，可以用<code>CMAKE_MSVC_RUNTIME_LIBRARY</code>和<code>MSVC_RUNTIME_LIBRARY</code>设定。</p>
<p>可以全局设定：</p>
<pre highlighted="true"><code class="language-cmake hljs"><table class="hljs-ln"><tbody><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="1"><div class="hljs-ln-n" data-line-number="1"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="1"><span class="hljs-keyword">set</span>(CMAKE_MSVC_RUNTIME_LIBRARY MultiThreadedDebug)</td></tr></tbody></table></code></pre>
<p>或者针对单个目标设定：</p>
<pre highlighted="true"><code class="language-cmake hljs"><table class="hljs-ln"><tbody><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="1"><div class="hljs-ln-n" data-line-number="1"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="1"><span class="hljs-keyword">add_executable</span>(foo foo.c)</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="2"><div class="hljs-ln-n" data-line-number="2"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="2"><span class="hljs-keyword">set_property</span>(<span class="hljs-keyword">TARGET</span> foo PROPERTY</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="3"><div class="hljs-ln-n" data-line-number="3"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="3">             MSVC_RUNTIME_LIBRARY <span class="hljs-string">"MultiThreaded$&lt;$&lt;CONFIG:Debug&gt;:Debug&gt;"</span>)</td></tr></tbody></table></code></pre>
<p>候选值有4种：<br />
<code>MultiThreaded</code><br />
Compile with -MT or equivalent flag(s) to use a multi-threaded statically-linked runtime library.</p>
<p><code>MultiThreadedDLL</code><br />
Compile with -MD or equivalent flag(s) to use a multi-threaded dynamically-linked runtime library.</p>
<p><code>MultiThreadedDebug</code><br />
Compile with -MTd or equivalent flag(s) to use a multi-threaded statically-linked runtime library.</p>
<p><code>MultiThreadedDebugDLL</code><br />
Compile with -MDd or equivalent flag(s) to use a multi-threaded dynamically-linked runtime library.</p>
<h2 id="59-设定address-sanitizerasan">59. 设定Address Sanitizer(ASAN)<button class="cnblogs-toc-button" title="显示目录导航" aria-expanded="false"></button></h2>
<p>首先确保有符号信息（例如CMAKE_BUILD_TYPE设定为Debug）。</p>
<p>其次是设定如下几个变量中的其中一个（多个也行但没必要，看你需求）：</p>
<ul>
<li><code>CMAKE_EXE_LINKER_FLAGS</code></li>
<li><code>CMAKE_EXE_LINKER_FLAGS_DEBUG</code></li>
<li><code>CMAKE_SHARED_LINKER_FLAGS</code></li>
<li><code>CMAKE_SHARED_LINKER_FLAGS_DEBUG</code></li>
</ul>
<p>例如我编译的是可执行目标，那么：</p>
<pre highlighted="true"><code class="language-cmake hljs"><table class="hljs-ln"><tbody><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="1"><div class="hljs-ln-n" data-line-number="1"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="1"><span class="hljs-keyword">set</span>(CMAKE_BUILD_TYPE <span class="hljs-string">"Debug"</span>)</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="2"><div class="hljs-ln-n" data-line-number="2"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="2"><span class="hljs-keyword">set</span>(CMAKE_EXE_LINKER_FLAGS <span class="hljs-string">"${CMAKE_LINKER_FLAGS_DEBUG} -fno-omit-frame-pointer -fsanitize=address"</span>)</td></tr></tbody></table></code></pre>
<p>对于可执行目标，并且依赖于静态库或动态库，懒人用法：</p>
<pre highlighted="true"><code class="language-cmake hljs"><table class="hljs-ln"><tbody><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="1"><div class="hljs-ln-n" data-line-number="1"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="1"><span class="hljs-keyword">set</span>(CMAKE_BUILD_TYPE <span class="hljs-string">"Debug"</span>)</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="2"><div class="hljs-ln-n" data-line-number="2"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="2"><span class="hljs-keyword">set</span>(CMAKE_C_FLAGS_DEBUG <span class="hljs-string">"${CMAKE_C_FLAGS_DEBUG} -fno-omit-frame-pointer -fsanitize=address"</span>)</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="3"><div class="hljs-ln-n" data-line-number="3"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="3"><span class="hljs-keyword">set</span>(CMAKE_CXX_FLAGS_DEBUG <span class="hljs-string">"${CMAKE_CXX_FLAGS_DEBUG} -fno-omit-frame-pointer -fsanitize=address"</span>)</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="4"><div class="hljs-ln-n" data-line-number="4"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="4"><span class="hljs-keyword">set</span>(CMAKE_LINKER_FLAGS_DEBUG <span class="hljs-string">"${CMAKE_LINKER_FLAGS_DEBUG} -fno-omit-frame-pointer -fsanitize=address"</span>)</td></tr></tbody></table></code></pre>
<p>注意：ASAN似乎对vector等容器的支持不够好。对于vector，预先分配多少内存，似乎ASAN并不知道，导致vector被clear后再使用，（做下标访问一段时间后）出现的segfault，没被ASAN检测到。</p>
<p>例如如下代码中的<code>visit.clear();</code>导致的后续visit的非法访问：</p>
<pre highlighted="true"><code class="language-C++ hljs language-C"><table class="hljs-ln"><tbody><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="1"><div class="hljs-ln-n" data-line-number="1"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="1"><span class="hljs-comment"><span class="hljs-comment">/*</span></span></td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="2"><div class="hljs-ln-n" data-line-number="2"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="2"><span class="hljs-comment">请设计一个函数，用来判断在一个矩阵中是否存在一条包含某字符串所有字符的路径。</span></td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="3"><div class="hljs-ln-n" data-line-number="3"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="3"><span class="hljs-comment">路径可以从矩阵中的任意一个格子开始，每一步可以在矩阵中向左，向右，向上，向下移动一个格子。</span></td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="4"><div class="hljs-ln-n" data-line-number="4"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="4"><span class="hljs-comment">如果一条路径经过了矩阵中的某一个格子，则该路径不能再进入该格子。</span></td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="5"><div class="hljs-ln-n" data-line-number="5"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="5"><span class="hljs-comment"> </span></td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="6"><div class="hljs-ln-n" data-line-number="6"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="6"><span class="hljs-comment">     a b c e</span></td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="7"><div class="hljs-ln-n" data-line-number="7"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="7"><span class="hljs-comment">例如  s f c s</span></td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="8"><div class="hljs-ln-n" data-line-number="8"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="8"><span class="hljs-comment">     a d e e</span></td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="9"><div class="hljs-ln-n" data-line-number="9"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="9"><span class="hljs-comment"> </span></td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="10"><div class="hljs-ln-n" data-line-number="10"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="10"><span class="hljs-comment">矩阵中包含一条字符串"bcced"的路径，但是矩阵中不包含"abcb"路径，因为字符串的第一个字符b占据了矩阵中的第一行第二个格子之后，路径不能再次进入该格子。</span></td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="11"><div class="hljs-ln-n" data-line-number="11"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="11"><span class="hljs-comment">*/</span></td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="12"><div class="hljs-ln-n" data-line-number="12"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="12"> </td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="13"><div class="hljs-ln-n" data-line-number="13"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="13"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span></td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="14"><div class="hljs-ln-n" data-line-number="14"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="14"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span></td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="15"><div class="hljs-ln-n" data-line-number="15"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="15"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string.h&gt;</span></span></td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="16"><div class="hljs-ln-n" data-line-number="16"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="16"> </td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="17"><div class="hljs-ln-n" data-line-number="17"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="17"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span></td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="18"><div class="hljs-ln-n" data-line-number="18"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="18"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string&gt;</span></span></td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="19"><div class="hljs-ln-n" data-line-number="19"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="19"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;vector&gt;</span></span></td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="20"><div class="hljs-ln-n" data-line-number="20"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="20"> </td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="21"><div class="hljs-ln-n" data-line-number="21"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="21">using namespace <span class="hljs-built_in">std</span>;</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="22"><div class="hljs-ln-n" data-line-number="22"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="22"> </td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="23"><div class="hljs-ln-n" data-line-number="23"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="23"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Solution</span> {</span></td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="24"><div class="hljs-ln-n" data-line-number="24"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="24">public:</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="25"><div class="hljs-ln-n" data-line-number="25"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="25">    <span class="hljs-type">bool</span> <span class="hljs-title function_">hasPath</span><span class="hljs-params">(<span class="hljs-type">char</span>* matrix, <span class="hljs-type">int</span> rows, <span class="hljs-type">int</span> cols, <span class="hljs-type">char</span>* str)</span></td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="26"><div class="hljs-ln-n" data-line-number="26"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="26">    {</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="27"><div class="hljs-ln-n" data-line-number="27"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="27">        <span class="hljs-type">bool</span> flag = <span class="hljs-literal">false</span>;</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="28"><div class="hljs-ln-n" data-line-number="28"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="28">        <span class="hljs-type">int</span> len = <span class="hljs-built_in">strlen</span>(str);</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="29"><div class="hljs-ln-n" data-line-number="29"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="29"> </td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="30"><div class="hljs-ln-n" data-line-number="30"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="30">        <span class="hljs-type">int</span> cnt = <span class="hljs-number">0</span>;</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="31"><div class="hljs-ln-n" data-line-number="31"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="31">        <span class="hljs-built_in">vector</span>&lt;<span class="hljs-built_in">vector</span>&lt;<span class="hljs-type">char</span>&gt; &gt; mat(rows, <span class="hljs-built_in">vector</span>&lt;<span class="hljs-type">char</span>&gt;(cols, <span class="hljs-string">'0'</span>));</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="32"><div class="hljs-ln-n" data-line-number="32"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="32">        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>; i&lt;rows; i++) {</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="33"><div class="hljs-ln-n" data-line-number="33"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="33">            <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> j=<span class="hljs-number">0</span>; j&lt;cols; j++) {</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="34"><div class="hljs-ln-n" data-line-number="34"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="34">                mat[i][j] = matrix[cnt];</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="35"><div class="hljs-ln-n" data-line-number="35"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="35">                cnt++;</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="36"><div class="hljs-ln-n" data-line-number="36"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="36">            }</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="37"><div class="hljs-ln-n" data-line-number="37"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="37">        }</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="38"><div class="hljs-ln-n" data-line-number="38"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="38">        <span class="hljs-built_in">vector</span>&lt;<span class="hljs-built_in">vector</span>&lt;<span class="hljs-type">int</span>&gt; &gt; visit(rows, <span class="hljs-built_in">vector</span>&lt;<span class="hljs-type">int</span>&gt;(cols, <span class="hljs-number">0</span>));</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="39"><div class="hljs-ln-n" data-line-number="39"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="39"> </td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="40"><div class="hljs-ln-n" data-line-number="40"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="40">        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>; i&lt;rows; i++) {</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="41"><div class="hljs-ln-n" data-line-number="41"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="41">            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> j=<span class="hljs-number">0</span>; j&lt;cols; j++) {</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="42"><div class="hljs-ln-n" data-line-number="42"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="42">                visit.clear(); <span class="hljs-comment">//!!!</span></td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="43"><div class="hljs-ln-n" data-line-number="43"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="43">                flag = dfs(<span class="hljs-number">0</span>, i, j, rows, cols, len, str, mat, visit);</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="44"><div class="hljs-ln-n" data-line-number="44"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="44">                <span class="hljs-keyword">if</span>(flag) <span class="hljs-keyword">break</span>;</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="45"><div class="hljs-ln-n" data-line-number="45"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="45">            }</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="46"><div class="hljs-ln-n" data-line-number="46"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="46">        }</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="47"><div class="hljs-ln-n" data-line-number="47"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="47">        <span class="hljs-keyword">return</span> flag;</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="48"><div class="hljs-ln-n" data-line-number="48"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="48">    }</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="49"><div class="hljs-ln-n" data-line-number="49"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="49">private:</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="50"><div class="hljs-ln-n" data-line-number="50"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="50">    <span class="hljs-type">bool</span> <span class="hljs-title function_">dfs</span><span class="hljs-params">(<span class="hljs-type">int</span> t, <span class="hljs-type">int</span> i, <span class="hljs-type">int</span> j, <span class="hljs-type">int</span> rows, <span class="hljs-type">int</span> cols, <span class="hljs-type">int</span> len, <span class="hljs-type">char</span>* str, <span class="hljs-type">const</span> <span class="hljs-built_in">vector</span>&lt;<span class="hljs-built_in">vector</span>&lt;<span class="hljs-type">char</span>&gt; &gt;&amp; mat, <span class="hljs-built_in">vector</span>&lt;<span class="hljs-built_in">vector</span>&lt;<span class="hljs-type">int</span>&gt; &gt;&amp; visit)</span></td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="51"><div class="hljs-ln-n" data-line-number="51"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="51">    {</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="52"><div class="hljs-ln-n" data-line-number="52"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="52">        </td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="53"><div class="hljs-ln-n" data-line-number="53"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="53">        <span class="hljs-keyword">if</span>(i&lt;<span class="hljs-number">0</span> || j&lt;<span class="hljs-number">0</span> || i&gt;=rows || j&gt;=cols || visit[i][j]==<span class="hljs-number">1</span>) {</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="54"><div class="hljs-ln-n" data-line-number="54"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="54">            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="55"><div class="hljs-ln-n" data-line-number="55"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="55">        }</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="56"><div class="hljs-ln-n" data-line-number="56"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="56"> </td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="57"><div class="hljs-ln-n" data-line-number="57"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="57">        <span class="hljs-keyword">if</span> (str[t]!=mat[i][j]) {</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="58"><div class="hljs-ln-n" data-line-number="58"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="58">            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="59"><div class="hljs-ln-n" data-line-number="59"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="59">        }</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="60"><div class="hljs-ln-n" data-line-number="60"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="60"> </td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="61"><div class="hljs-ln-n" data-line-number="61"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="61">        visit[i][j] = <span class="hljs-number">1</span>;</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="62"><div class="hljs-ln-n" data-line-number="62"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="62">        </td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="63"><div class="hljs-ln-n" data-line-number="63"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="63">        <span class="hljs-keyword">if</span> (t==len<span class="hljs-number">-1</span>) {</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="64"><div class="hljs-ln-n" data-line-number="64"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="64">            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="65"><div class="hljs-ln-n" data-line-number="65"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="65">        }</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="66"><div class="hljs-ln-n" data-line-number="66"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="66"> </td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="67"><div class="hljs-ln-n" data-line-number="67"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="67">        <span class="hljs-type">const</span> <span class="hljs-type">static</span> <span class="hljs-type">int</span> dir[<span class="hljs-number">4</span>][<span class="hljs-number">2</span>] = {</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="68"><div class="hljs-ln-n" data-line-number="68"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="68">            {<span class="hljs-number">-1</span>, <span class="hljs-number">0</span>}, {<span class="hljs-number">1</span>, <span class="hljs-number">0</span>},</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="69"><div class="hljs-ln-n" data-line-number="69"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="69">            {<span class="hljs-number">0</span>, <span class="hljs-number">-1</span>}, {<span class="hljs-number">0</span>, <span class="hljs-number">1</span>}</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="70"><div class="hljs-ln-n" data-line-number="70"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="70">        };</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="71"><div class="hljs-ln-n" data-line-number="71"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="71">        <span class="hljs-type">bool</span> flag = <span class="hljs-literal">false</span>;</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="72"><div class="hljs-ln-n" data-line-number="72"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="72">        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> q=<span class="hljs-number">0</span>; q&lt;<span class="hljs-number">4</span>; q++) {</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="73"><div class="hljs-ln-n" data-line-number="73"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="73">            flag = dfs(t+<span class="hljs-number">1</span>, i+dir[q][<span class="hljs-number">0</span>], j+dir[q][<span class="hljs-number">1</span>], rows, cols, len, str, mat, visit);</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="74"><div class="hljs-ln-n" data-line-number="74"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="74">            <span class="hljs-keyword">if</span> (flag) <span class="hljs-keyword">break</span>;</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="75"><div class="hljs-ln-n" data-line-number="75"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="75">        }</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="76"><div class="hljs-ln-n" data-line-number="76"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="76">        <span class="hljs-keyword">return</span> flag;</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="77"><div class="hljs-ln-n" data-line-number="77"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="77">    }</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="78"><div class="hljs-ln-n" data-line-number="78"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="78"> </td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="79"><div class="hljs-ln-n" data-line-number="79"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="79">};</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="80"><div class="hljs-ln-n" data-line-number="80"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="80"> </td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="81"><div class="hljs-ln-n" data-line-number="81"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="81"><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span> {</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="82"><div class="hljs-ln-n" data-line-number="82"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="82">    <span class="hljs-type">char</span> matrix[] = <span class="hljs-string">"abcesfcsadee\0"</span>;</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="83"><div class="hljs-ln-n" data-line-number="83"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="83">    <span class="hljs-type">int</span> rows = <span class="hljs-number">3</span>;</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="84"><div class="hljs-ln-n" data-line-number="84"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="84">    <span class="hljs-type">int</span> cols = <span class="hljs-number">4</span>;</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="85"><div class="hljs-ln-n" data-line-number="85"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="85">    <span class="hljs-type">char</span> str[] = <span class="hljs-string">"bcced\0"</span>;</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="86"><div class="hljs-ln-n" data-line-number="86"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="86"> </td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="87"><div class="hljs-ln-n" data-line-number="87"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="87">    Solution s;</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="88"><div class="hljs-ln-n" data-line-number="88"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="88">    <span class="hljs-built_in">cout</span> &lt;&lt; s.hasPath(matrix, rows, cols, str);</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="89"><div class="hljs-ln-n" data-line-number="89"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="89"> </td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="90"><div class="hljs-ln-n" data-line-number="90"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="90">    <span class="hljs-comment">//char str2[] = "abcb";</span></td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="91"><div class="hljs-ln-n" data-line-number="91"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="91">    <span class="hljs-comment">//cout &lt;&lt; s.hasPath(matrix, rows, cols, str2);</span></td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="92"><div class="hljs-ln-n" data-line-number="92"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="92"> </td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="93"><div class="hljs-ln-n" data-line-number="93"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="93">    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="94"><div class="hljs-ln-n" data-line-number="94"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="94">}</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="95"><div class="hljs-ln-n" data-line-number="95"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="95"><span class="hljs-comment"><span class="hljs-comment">/*</span></span></td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="96"><div class="hljs-ln-n" data-line-number="96"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="96"><span class="hljs-comment">a b c e</span></td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="97"><div class="hljs-ln-n" data-line-number="97"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="97"><span class="hljs-comment">s f c s</span></td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="98"><div class="hljs-ln-n" data-line-number="98"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="98"><span class="hljs-comment">a d e e </span></td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="99"><div class="hljs-ln-n" data-line-number="99"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="99"><span class="hljs-comment">*/</span></td></tr></tbody></table></code></pre>
<h2 id="60-linux下编译32位程序">60. Linux下编译32位程序<button class="cnblogs-toc-button" title="显示目录导航" aria-expanded="false"></button></h2>
<pre highlighted="true"><code class="language-cmake hljs"><table class="hljs-ln"><tbody><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="1"><div class="hljs-ln-n" data-line-number="1"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="1"><span class="hljs-keyword">set</span>(CMAKE_C_FLAGS <span class="hljs-string">"${CMAKE_C_FLAGS} -m32"</span>)</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="2"><div class="hljs-ln-n" data-line-number="2"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="2"><span class="hljs-keyword">set</span>(CMAKE_CXX_FLAGS <span class="hljs-string">"${CMAKE_CXX_FLAGS} -m32"</span>)</td></tr></tbody></table></code></pre>
<h2 id="61-设置vs的可执行文件生成目录">61. 设置VS的可执行文件生成目录<button class="cnblogs-toc-button" title="显示目录导航" aria-expanded="false"></button></h2>
<p>假设.sln目录在 build/vs2019-x64 下，则默认的可执行文件生成目录是 build/vs2019-x64/Debug 或 build/vs2019-x64/Release；而如果文件放在这一默认生成目录下的话无法被读取到（不加前缀的情况），需要放在 build/vs2019-x64 目录下才能读到。</p>
<p>以至于，代码里经常要根据 <code>_MSC_VER</code> 或者 <code>ANDROID</code> 等平台相关的宏，设定不同的路径，例如：</p>
<pre highlighted="true"><code class="language-cpp hljs"><table class="hljs-ln"><tbody><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="1"><div class="hljs-ln-n" data-line-number="1"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="1"><span class="hljs-meta">#<span class="hljs-keyword">if</span> _MSC_VER</span></td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="2"><div class="hljs-ln-n" data-line-number="2"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="2">    <span class="hljs-type">const</span> <span class="hljs-type">char</span>* image_path = <span class="hljs-string">"E:/share/to_zcx/ncnn_vk_dbg/build/vs2019-x64/ncnn_input_cpu.bmp"</span>;</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="3"><div class="hljs-ln-n" data-line-number="3"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="3"><span class="hljs-meta">#<span class="hljs-keyword">elif</span> ANDROID</span></td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="4"><div class="hljs-ln-n" data-line-number="4"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="4">    <span class="hljs-type">const</span> <span class="hljs-type">char</span>* image_path = <span class="hljs-string">"ncnn_input_cpu.bmp"</span>;</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="5"><div class="hljs-ln-n" data-line-number="5"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="5"><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span></td></tr></tbody></table></code></pre>
<p>这让代码不整洁，也增加了出错的可能。</p>
<p><img src="https://img2020.cnblogs.com/blog/495962/202101/495962-20210129195009442-1839049234.png" alt="" loading="lazy" /></p>
<p><img src="https://img2020.cnblogs.com/blog/495962/202101/495962-20210129195109549-1463368745.png" alt="" loading="lazy" /></p>
<p>可以通过上面两截图中的方式，在项目属性中修改可执行文件的生成目录和启动目录，但仍然不方便；最好的办法还是在 CMakeLists.txt 里设定：</p>
<pre highlighted="true"><code class="language-cmake hljs"><table class="hljs-ln"><tbody><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="1"><div class="hljs-ln-n" data-line-number="1"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="1"><span class="hljs-keyword">set</span>(CMAKE_RUNTIME_OUTPUT_DIRECTORY $&lt;<span class="hljs-number">1</span>:<span class="hljs-variable">${CMAKE_SOURCE_DIR}</span>/bin&gt;)</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="2"><div class="hljs-ln-n" data-line-number="2"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="2"> </td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="3"><div class="hljs-ln-n" data-line-number="3"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="3"><span class="hljs-keyword">add_executable</span>(testbed hello.cpp)</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="4"><div class="hljs-ln-n" data-line-number="4"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="4"><span class="hljs-keyword">set_target_properties</span>(testbed PROPERTIES</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="5"><div class="hljs-ln-n" data-line-number="5"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="5">    VS_DEBUGGER_WORKING_DIRECTORY <span class="hljs-string">"${CMAKE_SOURCE_DIR}/bin"</span>)</td></tr></tbody></table></code></pre>
<p><a href="https://stackoverflow.com/questions/47175912/using-cmake-how-to-stop-the-debug-and-release-subdirectories" target="_blank" rel="noopener">https://stackoverflow.com/questions/47175912/using-cmake-how-to-stop-the-debug-and-release-subdirectories</a><br />
<a href="https://stackoverflow.com/questions/41864259/how-to-set-working-directory-for-visual-studio-2017-rc-cmake-project" target="_blank" rel="noopener">https://stackoverflow.com/questions/41864259/how-to-set-working-directory-for-visual-studio-2017-rc-cmake-project</a></p>
<h2 id="62-find_package等的debug输出">62. find_package等的debug输出<button class="cnblogs-toc-button" title="显示目录导航" aria-expanded="false"></button></h2>
<p>从cmake3.17开始，文档里正式说明支持<code>CMAKE_FIND_DEBUG_MODE</code>这一cmake变量，设定为TRUE则打印find_package/find_program/find_file等函数的打印过程</p>
<pre highlighted="true"><code class="language-cmake hljs"><table class="hljs-ln"><tbody><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="1"><div class="hljs-ln-n" data-line-number="1"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="1"><span class="hljs-keyword">set</span>(CMAKE_FIND_DEBUG_MODE <span class="hljs-keyword">TRUE</span>)</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="2"><div class="hljs-ln-n" data-line-number="2"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="2"><span class="hljs-keyword">find_package</span>(...)</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="3"><div class="hljs-ln-n" data-line-number="3"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="3"><span class="hljs-keyword">set</span>(CMAKE_FIND_DEBUG_MODE <span class="hljs-keyword">FALSE</span>)</td></tr></tbody></table></code></pre>
<p>实际上据网友反馈，稍早的版本也可以用这一变量，只不过文档里当时没写。</p>
<p>另外，设定<code>CMAKE_FIND_DEBUG_MODE</code>变量为TRUE，等价于调用cmake时候指定<code>--debug-find</code>参数。</p>
<p>如果你是cmake-GUI方式构建，菜单栏也可以选择输出debug信息：<br />
<img src="https://img2020.cnblogs.com/blog/495962/202102/495962-20210222084708829-339689298.png" alt="" loading="lazy" /></p>
<h2 id="63-命令行方式传入option的坑">63. 命令行方式传入option的坑<button class="cnblogs-toc-button" title="显示目录导航" aria-expanded="false"></button></h2>
<p>场景：命令行方式调用cmake，指定了很多option和cache variable的值，希望把这些option和cache variable放在.txt文件中，然后通过<code>cat option.txt</code>方式传给cmake。<br />
结论：option.txt里的写法，-D之后不能有空格，否则无法生效。</p>
<p>例如，正确写法是：</p>
<pre highlighted="true"><code class="hljs language-ini"><table class="hljs-ln"><tbody><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="1"><div class="hljs-ln-n" data-line-number="1"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="1"><span class="hljs-attr">-DUSE_X1</span>=<span class="hljs-literal">ON</span></td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="2"><div class="hljs-ln-n" data-line-number="2"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="2"><span class="hljs-attr">-DUSE_X2</span>=<span class="hljs-literal">ON</span></td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="3"><div class="hljs-ln-n" data-line-number="3"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="3"><span class="hljs-attr">-DUSE_X3</span>=<span class="hljs-literal">ON</span></td></tr></tbody></table></code></pre>
<p>错误写法是</p>
<pre highlighted="true"><code class="hljs language-diff"><table class="hljs-ln"><tbody><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="1"><div class="hljs-ln-n" data-line-number="1"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="1"><span class="hljs-deletion">-D USE_X1=ON</span></td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="2"><div class="hljs-ln-n" data-line-number="2"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="2"><span class="hljs-deletion">-D USE_X2=ON</span></td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="3"><div class="hljs-ln-n" data-line-number="3"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="3"><span class="hljs-deletion">-D USE_X3=ON</span></td></tr></tbody></table></code></pre>
<p>可以用如下 CMakeLists.txt 验证结论：</p>
<pre highlighted="true"><code class="hljs language-scss"><table class="hljs-ln"><tbody><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="1"><div class="hljs-ln-n" data-line-number="1"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="1"><span class="hljs-built_in">cmake_minimum_required</span>(VERSION <span class="hljs-number">3.15</span>)</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="2"><div class="hljs-ln-n" data-line-number="2"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="2"> </td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="3"><div class="hljs-ln-n" data-line-number="3"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="3"><span class="hljs-built_in">project</span>(x)</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="4"><div class="hljs-ln-n" data-line-number="4"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="4"> </td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="5"><div class="hljs-ln-n" data-line-number="5"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="5"><span class="hljs-built_in">option</span>(USE_X1 "USE X1?" OFF)</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="6"><div class="hljs-ln-n" data-line-number="6"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="6"><span class="hljs-built_in">option</span>(USE_X2 "USE_X2?" OFF)</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="7"><div class="hljs-ln-n" data-line-number="7"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="7"><span class="hljs-built_in">option</span>(USE_X3 "USE_X3?" OFF)</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="8"><div class="hljs-ln-n" data-line-number="8"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="8"> </td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="9"><div class="hljs-ln-n" data-line-number="9"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="9">if (USE_X1)</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="10"><div class="hljs-ln-n" data-line-number="10"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="10">    <span class="hljs-built_in">message</span>(STATUS "USE_X1: ON")</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="11"><div class="hljs-ln-n" data-line-number="11"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="11"><span class="hljs-built_in">else</span>()</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="12"><div class="hljs-ln-n" data-line-number="12"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="12">    <span class="hljs-built_in">message</span>(STATUS "USE_X1: OFF")</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="13"><div class="hljs-ln-n" data-line-number="13"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="13"><span class="hljs-built_in">endif</span>()</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="14"><div class="hljs-ln-n" data-line-number="14"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="14"> </td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="15"><div class="hljs-ln-n" data-line-number="15"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="15">if (USE_X2)</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="16"><div class="hljs-ln-n" data-line-number="16"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="16">    <span class="hljs-built_in">message</span>(STATUS "USE_X2: ON")</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="17"><div class="hljs-ln-n" data-line-number="17"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="17"><span class="hljs-built_in">else</span>()</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="18"><div class="hljs-ln-n" data-line-number="18"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="18">    <span class="hljs-built_in">message</span>(STATUS "USE_X2: OFF")</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="19"><div class="hljs-ln-n" data-line-number="19"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="19"><span class="hljs-built_in">endif</span>()</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="20"><div class="hljs-ln-n" data-line-number="20"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="20"> </td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="21"><div class="hljs-ln-n" data-line-number="21"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="21">if (USE_X3)</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="22"><div class="hljs-ln-n" data-line-number="22"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="22">    <span class="hljs-built_in">message</span>(STATUS "USE_X3: ON")</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="23"><div class="hljs-ln-n" data-line-number="23"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="23"><span class="hljs-built_in">else</span>()</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="24"><div class="hljs-ln-n" data-line-number="24"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="24">    <span class="hljs-built_in">message</span>(STATUS "USE_X3: OFF")</td></tr><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="25"><div class="hljs-ln-n" data-line-number="25"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="25"><span class="hljs-built_in">endif</span>()</td></tr></tbody></table></code></pre>
<h2 id="64-powershell中从txt读内容传给cmake">64. PowerShell中从txt读内容传给cmake<button class="cnblogs-toc-button" title="显示目录导航" aria-expanded="false"></button></h2>
<p>bash里头的做法：</p>
<pre highlighted="true"><code class="language-bash hljs"><table class="hljs-ln"><tbody><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="1"><div class="hljs-ln-n" data-line-number="1"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="1">cmake `<span class="hljs-built_in">cat</span> options.txt`</td></tr></tbody></table></code></pre>
<p>powershell里头，不能用``符号，也没有cat命令。作为替代，用的是<code>$(type options.txt)</code>，例如：</p>
<pre highlighted="true"><code class="language-powershell hljs"><table class="hljs-ln"><tbody><tr><td class="hljs-ln-line hljs-ln-numbers" data-line-number="1"><div class="hljs-ln-n" data-line-number="1"></div></td><td class="hljs-ln-line hljs-ln-code" data-line-number="1">cmake G:/dev/opencv<span class="hljs-literal">-build</span>/mock <span class="hljs-literal">-G</span> <span class="hljs-string">"Visual Studio 16 2019"</span> <span class="hljs-literal">-A</span> x64 <span class="hljs-literal">-DCMAKE_INSTALL_PREFIX</span>=install <span class="hljs-variable">$</span>(<span class="hljs-built_in">type</span> G:/dev/opencv<span class="hljs-literal">-build</span>/mock/options.txt)</td></tr></tbody></table></code></pre>
<p>powershell是基于ksh语法修改而来（而不是M<span class="math inline"><span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-1-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo&gt;&amp;#x7684;&lt;/mo&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo&gt;&amp;#x522B;&lt;/mo&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo&gt;&amp;#x7684;&lt;/mo&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo&gt;&amp;#x5176;&lt;/mo&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo&gt;&amp;#x4ED6;&lt;/mo&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo&gt;&amp;#x7684;&lt;/mo&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo&gt;&amp;#x8BED;&lt;/mo&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo&gt;&amp;#x6CD5;&lt;/mo&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo&gt;&amp;#xFF09;&lt;/mo&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo&gt;&amp;#xFF1B;&lt;/mo&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#x2018;&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1" style="width: 10.439em; display: inline-block;"><span style="display: inline-block; position: relative; width: 8.272em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.372em, 1008.22em, 2.74em, -999.997em); top: -2.335em; left: 0em;"><span class="mrow" id="MathJax-Span-2"><span class="texatom" id="MathJax-Span-3"><span class="mrow" id="MathJax-Span-4"><span class="mo" id="MathJax-Span-5"><span style="font-family: STIXGeneral, &quot;Arial Unicode MS&quot;, serif; font-size: 79%; font-style: normal; font-weight: normal;">的</span></span></span></span><span class="texatom" id="MathJax-Span-6"><span class="mrow" id="MathJax-Span-7"><span class="mo" id="MathJax-Span-8"><span style="font-family: STIXGeneral, &quot;Arial Unicode MS&quot;, serif; font-size: 79%; font-style: normal; font-weight: normal;">别</span></span></span></span><span class="texatom" id="MathJax-Span-9"><span class="mrow" id="MathJax-Span-10"><span class="mo" id="MathJax-Span-11"><span style="font-family: STIXGeneral, &quot;Arial Unicode MS&quot;, serif; font-size: 79%; font-style: normal; font-weight: normal;">的</span></span></span></span><span class="texatom" id="MathJax-Span-12"><span class="mrow" id="MathJax-Span-13"><span class="mo" id="MathJax-Span-14"><span style="font-family: STIXGeneral, &quot;Arial Unicode MS&quot;, serif; font-size: 79%; font-style: normal; font-weight: normal;">其</span></span></span></span><span class="texatom" id="MathJax-Span-15"><span class="mrow" id="MathJax-Span-16"><span class="mo" id="MathJax-Span-17"><span style="font-family: STIXGeneral, &quot;Arial Unicode MS&quot;, serif; font-size: 79%; font-style: normal; font-weight: normal;">他</span></span></span></span><span class="texatom" id="MathJax-Span-18"><span class="mrow" id="MathJax-Span-19"><span class="mo" id="MathJax-Span-20"><span style="font-family: STIXGeneral, &quot;Arial Unicode MS&quot;, serif; font-size: 79%; font-style: normal; font-weight: normal;">的</span></span></span></span><span class="texatom" id="MathJax-Span-21"><span class="mrow" id="MathJax-Span-22"><span class="mo" id="MathJax-Span-23"><span style="font-family: STIXGeneral, &quot;Arial Unicode MS&quot;, serif; font-size: 79%; font-style: normal; font-weight: normal;">语</span></span></span></span><span class="texatom" id="MathJax-Span-24"><span class="mrow" id="MathJax-Span-25"><span class="mo" id="MathJax-Span-26"><span style="font-family: STIXGeneral, &quot;Arial Unicode MS&quot;, serif; font-size: 79%; font-style: normal; font-weight: normal;">法</span></span></span></span><span class="texatom" id="MathJax-Span-27"><span class="mrow" id="MathJax-Span-28"><span class="mo" id="MathJax-Span-29"><span style="font-family: STIXGeneral, &quot;Arial Unicode MS&quot;, serif; font-size: 79%; font-style: normal; font-weight: normal;">）</span></span></span></span><span class="texatom" id="MathJax-Span-30"><span class="mrow" id="MathJax-Span-31"><span class="mo" id="MathJax-Span-32"><span style="font-family: STIXGeneral, &quot;Arial Unicode MS&quot;, serif; font-size: 79%; font-style: normal; font-weight: normal;">；</span></span></span></span><span class="mo" id="MathJax-Span-33" style="font-family: MathJax_Main;">‘</span></span><span style="display: inline-block; width: 0px; height: 2.341em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.356em; border-left: 0px solid; width: 0px; height: 1.441em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mo>的</mo></mrow><mrow class="MJX-TeXAtom-ORD"><mo>别</mo></mrow><mrow class="MJX-TeXAtom-ORD"><mo>的</mo></mrow><mrow class="MJX-TeXAtom-ORD"><mo>其</mo></mrow><mrow class="MJX-TeXAtom-ORD"><mo>他</mo></mrow><mrow class="MJX-TeXAtom-ORD"><mo>的</mo></mrow><mrow class="MJX-TeXAtom-ORD"><mo>语</mo></mrow><mrow class="MJX-TeXAtom-ORD"><mo>法</mo></mrow><mrow class="MJX-TeXAtom-ORD"><mo>）</mo></mrow><mrow class="MJX-TeXAtom-ORD"><mo>；</mo></mrow><mo>‘</mo></math></span></span><script type="math/tex" id="MathJax-Element-1">的别的其他的语法）；`</script></span>(cat options.txt)`在bash里也能用；<br />
两个``符号，英文正式名字叫做backtick，而不是"reverse quote"。</p>
<p>refs:</p>
<ul>
<li><a href="https://stackoverflow.com/questions/66485987/what-is-the-bash-reverse-quote-equivalent-in-powershell" target="_blank" rel="noopener">What is the bash reverse quote equivalent in powershell? [duplicate]</a></li>
<li><a href="https://stackoverflow.com/questions/434038/whats-the-cmd-powershell-equivalent-of-back-tick-on-bash" target="_blank" rel="noopener">What's the cmd/PowerShell equivalent of back tick on Bash?</a></li>
<li><a href="http://mywiki.wooledge.org/BashFAQ/082" target="_blank" rel="noopener">Why is $(...) preferred over <code>...</code> (backticks)?</a></li>
</ul>
<h2 id="65-visual-studio-清理-cmake-缓存">65. Visual Studio 清理 CMake 缓存<button class="cnblogs-toc-button" title="显示目录导航" aria-expanded="false"></button></h2>
<p>清理 CMake 缓存的意思是 “删除 CMakeCache.txt” 文件。除了手动切换到目录，手动删除， 还可以在VS的界面中做到：<br />
<img src="https://img2022.cnblogs.com/blog/495962/202201/495962-20220122175506928-688967725.png" alt="" loading="lazy" /></p>

</div>
<div id="MySignature" role="contentinfo">
    Greatness is never a given, it must be earned.
</div>
<div class="clear"></div>
<div id="blog_post_info_block" role="contentinfo">


    <div id="blog_post_info">
<div id="green_channel">
        <a href="javascript:void(0);" id="green_channel_digg" onclick="DiggIt(13340318,cb_blogId,1);green_channel_success(this,'谢谢推荐！');">好文要顶</a>
        <a id="green_channel_follow" onclick="follow('5b019ead-4c73-e211-aa8f-842b2b196315');" href="javascript:void(0);">关注我</a>
    <a id="green_channel_favorite" onclick="AddToWz(cb_entryId);return false;" href="javascript:void(0);">收藏该文</a>
    <a id="green_channel_weibo" href="javascript:void(0);" title="分享至新浪微博" onclick="ShareToTsina()"><img src="https://common.cnblogs.com/images/icon_weibo_24.png" alt="" /></a>
    <a id="green_channel_wechat" href="javascript:void(0);" title="分享至微信" onclick="shareOnWechat()"><img src="https://common.cnblogs.com/images/wechat.png" alt="" /></a>
</div>
<div id="author_profile">
    <div id="author_profile_info" class="author_profile_info">
            <a href="https://home.cnblogs.com/u/zjutzz/" target="_blank"><img src="https://pic.cnblogs.com/face/495962/20140506231331.png" class="author_avatar" alt="" /></a>
        <div id="author_profile_detail" class="author_profile_info">
            <a href="https://home.cnblogs.com/u/zjutzz/">ChrisZZ</a><br />
            <a href="https://home.cnblogs.com/u/zjutzz/followees/">关注 - 48</a><br />
            <a href="https://home.cnblogs.com/u/zjutzz/followers/">粉丝 - 131</a>
        </div>
    </div>
    <div class="clear"></div>
    <div id="author_profile_honor"></div>
    <div id="author_profile_follow">
                <a href="javascript:void(0);" onclick="follow('5b019ead-4c73-e211-aa8f-842b2b196315');return false;">+加关注</a>
    </div>
</div>
<div id="div_digg">
    <div class="diggit" onclick="votePost(13340318,'Digg')">
        <span class="diggnum" id="digg_count">1</span>
    </div>
    <div class="buryit" onclick="votePost(13340318,'Bury')">
        <span class="burynum" id="bury_count">0</span>
    </div>
    <div class="clear"></div>
    <div class="diggword" id="digg_tips">
    </div>
</div>

<script type="text/javascript">
    currentDiggType = 0;
</script></div>
    <div class="clear"></div>
    <div id="post_next_prev">

    <a href="https://www.cnblogs.com/zjutzz/p/13026200.html" class="p_n_p_prefix">« </a> 上一篇：    <a href="https://www.cnblogs.com/zjutzz/p/13026200.html" data-featured-image="" title="发布于 2020-06-01 17:13">tkinter缩放窗口和图像</a>
    <br />
    <a href="https://www.cnblogs.com/zjutzz/p/13340328.html" class="p_n_p_prefix">» </a> 下一篇：    <a href="https://www.cnblogs.com/zjutzz/p/13340328.html" data-featured-image="" title="发布于 2020-07-19 16:52">git 备忘录</a>

</div>
</div>
            </div>
            <div class="postDesc">posted @ 
<span id="post-date">2020-07-19 16:50</span> 
<a href="https://www.cnblogs.com/zjutzz/">ChrisZZ</a> 
阅读(<span id="post_view_count">2435</span>) 
评论(<span id="post_comment_count">5</span>) 
<a href="https://i.cnblogs.com/EditPosts.aspx?postid=13340318" rel="nofollow">编辑</a> 
<a href="javascript:void(0)" onclick="AddToWz(13340318);return false;">收藏</a> 
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: '', targetType: 'blogPost', targetId: '13340318', targetLink: 'https://www.cnblogs.com/zjutzz/p/13340318.html', title: 'cmake 备忘录' })">举报</a></div>
        </div>
	    
	    
    </div><!--end: topics 文章、评论容器-->
</div>

<script>
    var cb_entryId = 13340318, cb_entryCreatedDate = '2020-07-19 16:50', cb_postType = 1, cb_postTitle = 'cmake 备忘录';
    var allowComments = true, cb_blogId = 141691, cb_blogApp = 'zjutzz', cb_blogUserGuid = '5b019ead-4c73-e211-aa8f-842b2b196315';
    mermaidRender.render()
    markdown_highlight()
    zoomManager.apply("#cnblogs_post_body img:not(.code_img_closed):not(.code_img_opened)");
    updatePostStats(
            [cb_entryId],
            function(id, count) { $("#post_view_count").text(count) },
            function(id, count) { $("#post_comment_count").text(count) })
</script>
<a id="!comments"></a>
<div id="blog-comments-placeholder"></div>
<div id="comment_form" class="commentform">
    <a name="commentform"></a>
    <div id="divCommentShow"></div>
    <div id="comment_nav"><span id="span_refresh_tips"></span><a href="javascript:void(0);" onclick="return RefreshCommentList();" id="lnk_RefreshComments" runat="server" clientidmode="Static">刷新评论</a><a href="#" onclick="return RefreshPage();">刷新页面</a><a href="#top">返回顶部</a></div>
    <div id="comment_form_container" style="visibility: visible;"><div class="login_tips">
    登录后才能查看或发表评论，立即 <a rel="nofollow" href="javascript:void(0);" class="underline" onclick="return account.login('!comments');">登录</a> 或者
    <a href="https://www.cnblogs.com/">逛逛</a> 博客园首页
</div>
</div>
    <div class="ad_text_commentbox" id="ad_text_under_commentbox"></div>
    <div id="cnblogs_ch"><a href="https://cloud.baidu.com/campaign/2022developer/index.html?track=18708feb6fc4c4db36171b5d7d99f1509444b5c535f8dfc7#person" target="_blank" onclick="gtag('event', 'click', {'event_category': 'ad', 'event_label': 'T2-百度智能云-开发者赋能计划'})">【推荐】百度智能云开发者赋能计划，云服务器4元起，域名1元起</a><br /><a href="https://brands.cnblogs.com/huawei" target="_blank" onclick="gtag('event', 'click', {'event_category': 'ad', 'event_label': 'T2-华为专区'})">【推荐】华为开发者专区，与开发者一起构建万物互联的智能世界</a><br /><a href="https://developer.huawei.com/consumer/cn/forum/topic/0202851788421280176?fid=23&amp;ha_source=bokeyuan&amp;ha_source=HeZuo30&amp;ha_sourceId=89000081" target="_blank" onclick="gtag('event', 'click', {'event_category': 'ad', 'event_label': 'T2-华为专区-Codelabs挑战赛'})">【推荐】集成赢好礼：华为 Codelabs 挑战赛，搭建认证查询系统</a><br /></div>
    <div id="opt_under_post"></div>
    <div id="cnblogs_c1" class="under-post-card">
            <div id="div-gpt-ad-1592365906576-0" style="width: 300px; height: 250px;" data-google-query-id="CMfhn5b1kvcCFUp_vQodHnAMPg"><div id="google_ads_iframe_/1090369/C1_0__container__" style="border: 0pt none;"><iframe id="google_ads_iframe_/1090369/C1_0" name="google_ads_iframe_/1090369/C1_0" title="3rd party ad content" width="300" height="250" scrolling="no" marginwidth="0" marginheight="0" frameborder="0" role="region" aria-label="Advertisement" tabindex="0" srcdoc="" data-google-container-id="1" style="border: 0px; vertical-align: bottom;" data-load-complete="true"></iframe></div></div>
    </div>
    <div id="under_post_card1"><div class="under-post-card">
<b>编辑推荐：</b>
<br />

· <a href="https://www.cnblogs.com/boostwei/p/16137087.html" target="_blank">使用 Harr 特征的级联分类器实现目标检测</a>
    <br />
· <a href="https://www.cnblogs.com/skychen1218/p/16059148.html" target="_blank">后端思维之数据库性能优化方案</a>
    <br />
· <a href="https://www.cnblogs.com/wucy/p/16124449.html" target="_blank">ASP.NET Core WebApi 返回结果统一包装实践 </a>
    <br />
· <a href="https://www.cnblogs.com/1996-Chinese-Chen/p/16117062.html" target="_blank">asp.net core启动源码以及监听，到处理请求响应的过程 </a>
    <br />
· <a href="https://www.cnblogs.com/artech/p/inside-asp-net-core-6-33.html" target="_blank">ASP.NET Core 高性能服务器 HTTP.SYS</a>
    <br />
</div></div>
        <div id="cnblogs_c2" class="under-post-card">
            <a href="https://developer.huawei.com/consumer/cn/forum/topic/0202851788421280176?fid=23&amp;ha_source=bokeyuan&amp;ha_source=HeZuo30&amp;ha_sourceId=89000081" rel="nofollow" target="_blank" onclick="countCreativeClicks('C2-华为-codelabs')">
                <img src="https://img2022.cnblogs.com/blog/35695/202204/35695-20220413123003334-931328747.jpg" alt="" onload="countCreativeImpressions('C2-华为-codelabs')" />
            </a>
        </div>
    <div id="under_post_card2"><div class="itnews under-post-card">
    <b>最新新闻</b>：
    <br />
 ·          <a href="//news.cnblogs.com/n/718765/" target="_blank">快手国际化中场战事：告别烧钱，深耕区域</a>
        <br />
 ·          <a href="//news.cnblogs.com/n/718764/" target="_blank">NASA照片记录了ISS经过巨大SLS火箭上空的画面</a>
        <br />
 ·          <a href="//news.cnblogs.com/n/718763/" target="_blank">微软总裁史密斯：科技监管即将到来 行业应该参与塑造它</a>
        <br />
 ·          <a href="//news.cnblogs.com/n/718762/" target="_blank">研究小组发现了非常规超导体奇异行为的新线索</a>
        <br />
 ·          <a href="//news.cnblogs.com/n/718761/" target="_blank">开房车、住营地，郊游掏空我钱包</a>
        <br />
    » <a href="https://news.cnblogs.com/" title="IT 新闻" target="_blank">更多新闻...</a>
</div></div>
    <div id="HistoryToday" class="under-post-card">
<b>历史上的今天：</b>
<br />

2017-07-19    <a href="https://www.cnblogs.com/zjutzz/p/7207854.html">OpenCV图像逆时针旋转90度</a>
    <br />
2016-07-19    <a href="https://www.cnblogs.com/zjutzz/p/5684462.html">mysql导入sql文件，乱码，一个例子</a>
    <br />
2015-07-19    <a href="https://www.cnblogs.com/zjutzz/p/4658496.html">不需要打密码的sudo方法</a>
    <br />
</div>
    <script type="text/javascript">
        var commentManager = new blogCommentManager();
        commentManager.renderComments(0);
        fixPostBody();

                        window.tocManager.displayDisableTocTips = false;
                        window.tocManager.generateToc();
            setTimeout(function() { incrementViewCount(cb_entryId); }, 50);        deliverT2();
        deliverC1C2();
        loadNewsAndKb();
LoadPostCategoriesTags(cb_blogId, cb_entryId);        LoadPostInfoBlock(cb_blogId, cb_entryId, cb_blogApp, cb_blogUserGuid);
        GetPrevNextPost(cb_entryId, cb_blogId, cb_entryCreatedDate, cb_postType);
        loadOptUnderPost();
        GetHistoryToday(cb_blogId, cb_blogApp, cb_entryCreatedDate);
    </script>
</div>

	</div><!--end: forFlow -->
	</div><!--end: mainContent 主体内容容器-->
	<div id="sideBar">
		<div id="sideBarMain">
			<div id="sidebar_news" class="newsItem"><!--done-->
<h3 class="catListTitle">公告</h3>

<div id="blog-news">
    我的<a href="https://github.com/zchrissirhcz" style="color:blue">Github</a>
<br /><hr />

我的<a href="https://stackoverflow.com/users/2999096/haxtraz" style="color:blue">StackOverFlow</a>
<br /><hr />

我的<a href="mailto:imzhuo#foxmail%com" style="color:blue">email</a>
<br /><hr />

<br /><hr />
Make a better world by coding.
<br /><hr />
    <div id="profile_block">
        昵称：
        <a href="https://home.cnblogs.com/u/zjutzz/">
            ChrisZZ
        </a>
        <br />
        园龄：
        <a href="https://home.cnblogs.com/u/zjutzz/" title="入园时间：2013-02-10">
            9年2个月
        </a>
        <br />
        粉丝：
        <a href="https://home.cnblogs.com/u/zjutzz/followers/">
            131
        </a>
        <br />
        关注：
        <a href="https://home.cnblogs.com/u/zjutzz/followees/">
            48
        </a>
        <div id="p_b_follow">
<a href="javascript:void(0)" onclick="follow('5b019ead-4c73-e211-aa8f-842b2b196315')">+加关注</a></div>
        <script>getFollowStatus('5b019ead-4c73-e211-aa8f-842b2b196315');</script>
    </div>
</div>

</div>
<div id="sidebar_c3"></div>
			<div id="blog-calendar" style="display:none"></div><script>loadBlogDefaultCalendar();</script>			
			<div id="leftcontentcontainer">
				<div id="blog-sidecolumn"><!-- 搜索 -->
<div id="sidebar_search" class="sidebar-block">
    <div id="sidebar_search" class="mySearch">
        <h3 class="catListTitle">搜索</h3>
        <div id="sidebar_search_box">
            <div id="widget_my_zzk" class="div_my_zzk">
                <input type="text" id="q" onkeydown="return zzk_go_enter(event);" class="input_my_zzk" /> <input onclick="zzk_go()" type="button" value="找找看" id="btnZzk" class="btn_my_zzk" />
            </div>
            
        </div>
    </div>
</div>

<!-- 常用链接 -->
<div id="sidebar_shortcut" class="sidebar-block"><div class="catListLink">
<h3 class="catListTitle">
常用链接
</h3>
<ul>
    
<li><a href="https://www.cnblogs.com/zjutzz/p/" title="我的博客的随笔列表">我的随笔</a></li>
<li><a href="https://www.cnblogs.com/zjutzz/MyComments.html" title="我的发表过的评论列表">我的评论</a></li>
<li><a href="https://www.cnblogs.com/zjutzz/OtherPosts.html" title="我评论过的随笔列表">我的参与</a></li>
<li><a href="https://www.cnblogs.com/zjutzz/RecentComments.html" title="我的博客的评论列表">最新评论</a></li>
<li><a href="https://www.cnblogs.com/zjutzz/tag/" title="我的博客的标签列表">我的标签</a></li>

</ul>
</div>

</div>

<!-- 最新随笔 -->


<!-- 我的标签 -->
<div id="sidebar_toptags" class="sidebar-block"><div class="catListTag">
<h3 class="catListTitle">我的标签</h3>
<ul>
        <li>
            <a href="https://www.cnblogs.com/zjutzz/tag/libfc/">libfc<span class="tag-count">(13)</span></a>
        </li>
        <li>
            <a href="https://www.cnblogs.com/zjutzz/tag/Python/">Python<span class="tag-count">(10)</span></a>
        </li>
        <li>
            <a href="https://www.cnblogs.com/zjutzz/tag/opencv/">opencv<span class="tag-count">(8)</span></a>
        </li>
        <li>
            <a href="https://www.cnblogs.com/zjutzz/tag/%E5%9B%BE%E5%83%8F%E5%A4%84%E7%90%86/">图像处理<span class="tag-count">(5)</span></a>
        </li>
        <li>
            <a href="https://www.cnblogs.com/zjutzz/tag/%E9%85%8D%E7%BD%AE/">配置<span class="tag-count">(5)</span></a>
        </li>
        <li>
            <a href="https://www.cnblogs.com/zjutzz/tag/%E7%AE%97%E6%B3%95/">算法<span class="tag-count">(5)</span></a>
        </li>
        <li>
            <a href="https://www.cnblogs.com/zjutzz/tag/%E4%BC%98%E5%8C%96/">优化<span class="tag-count">(4)</span></a>
        </li>
        <li>
            <a href="https://www.cnblogs.com/zjutzz/tag/%E8%BF%90%E7%BB%B4/">运维<span class="tag-count">(4)</span></a>
        </li>
        <li>
            <a href="https://www.cnblogs.com/zjutzz/tag/PHP/">PHP<span class="tag-count">(4)</span></a>
        </li>
        <li>
            <a href="https://www.cnblogs.com/zjutzz/tag/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/">机器学习<span class="tag-count">(4)</span></a>
        </li>
    <li>
        <a href="https://www.cnblogs.com/zjutzz/tag/">更多</a>
    </li>

</ul>
</div>

</div>

<!-- 积分与排名 -->


<!-- 随笔分类、随笔档案、文章分类、新闻分类、相册、链接 -->
<div id="sidebar_categories">

    <div id="sidebar_articlearchive" class="catListArticleArchive sidebar-block">
        <h3 class="catListTitle">
            
文章档案
<span style="font-size:11px;font-weight:normal">(1)</span>


        </h3>

        <ul>

                <li data-category-list-item-visible="true" style="display: block">
                    
<a href="https://www.cnblogs.com/zjutzz/archives/2018/04.html" class="category-item-link" rel="nofollow noopener noreferrer" target="">2018年4月(1)</a>
 
                </li>                
            
        </ul>


    </div>    
    <div id="sidebar_zjut" class="catListZJUT sidebar-block">
        <h3 class="catListTitle">
            
ZJUT



        </h3>

        <ul>

                <li data-category-list-item-visible="true" style="display: block">
                    
<a href="http://jusoy.com/blog/" class="category-item-link" rel="nofollow noopener noreferrer" target="">ZIKI</a>
 
                </li>                
                <li data-category-list-item-visible="true" style="display: block">
                    
<a href="http://renkai.org/" class="category-item-link" rel="nofollow noopener noreferrer" target="">笋干太咸</a>
 
                </li>                
                <li data-category-list-item-visible="true" style="display: block">
                    
<a href="http://www.paeonia.me/Blog/" class="category-item-link" rel="nofollow noopener noreferrer" target="">Brilliant</a>
 
                </li>                
                <li data-category-list-item-visible="true" style="display: block">
                    
<a href="http://boskijr.com/" class="category-item-link" rel="nofollow noopener noreferrer" target="">小波斯基</a>
 
                </li>                
                <li data-category-list-item-visible="true" style="display: block">
                    
<a href="http://blog.imsuzie.com/" class="category-item-link" rel="nofollow noopener noreferrer" target="">酥西黄</a>
 
                </li>                
                <li data-category-list-item-visible="true" style="display: block">
                    
<a href="http://altynai.me/" class="category-item-link" rel="nofollow noopener noreferrer" target="">鹏神，网络流</a>
 
                </li>                
            
        </ul>


    </div>    
    <div id="sidebar_coder" class="catListcoder sidebar-block">
        <h3 class="catListTitle">
            
程序员充电站



        </h3>

        <ul>

                <li data-category-list-item-visible="true" style="display: block">
                    
<a href="http://www.matrix67.com/blog/" class="category-item-link" rel="nofollow noopener noreferrer" target="">Matrix67</a>
 
                </li>                
                <li data-category-list-item-visible="true" style="display: block">
                    
<a href="http://coolshell.cn/" class="category-item-link" rel="nofollow noopener noreferrer" target="">酷壳</a>
 
                </li>                
                <li data-category-list-item-visible="true" style="display: block">
                    
<a href="http://www.ruanyifeng.com/home.html" class="category-item-link" rel="nofollow noopener noreferrer" target="">阮一峰的网络日志</a>
 
                </li>                
                <li data-category-list-item-visible="true" style="display: block">
                    
<a href="https://xiaobazhang.github.io/category/#C++" class="category-item-link" rel="" target="">Suli's Blob</a>
 
                </li>                
                <li data-category-list-item-visible="true" style="display: block">
                    
<a href="http://www.wowotech.net/page/4" class="category-item-link" rel="nofollow noopener noreferrer" target="">蜗窝科技</a>
 
                </li>                
                <li data-category-list-item-visible="true" style="display: block">
                    
<a href="https://blog.csdn.net/pcb4jr" class="category-item-link" rel="nofollow noopener noreferrer" target="">格友</a>
 
                </li>                
                <li data-category-list-item-visible="true" style="display: block">
                    
<a href="http://www.yebangyu.org/blog/categories/c-plus-plus/" class="category-item-link" rel="nofollow noopener noreferrer" target="">Yebangyu's Blog</a>
 
                </li>                
                <li data-category-list-item-visible="true" style="display: block">
                    
<a href="http://blog.guorongfei.com/archives/" class="category-item-link" rel="nofollow noopener noreferrer" target="">时习之</a>
 
                </li>                
                <li data-category-list-item-visible="true" style="display: block">
                    
<a href="http://hanpfei.github.io/" class="category-item-link" rel="nofollow noopener noreferrer" target="">WolfcsTech</a>
 
                </li>                
                <li data-category-list-item-visible="true" style="display: block">
                    
<a href="https://blog.tensor-robotics.com/tags/%E9%9B%B7%E8%BE%BE/" class="category-item-link" rel="nofollow noopener noreferrer" target="">毫米波雷达</a>
 
                </li>                
            
        </ul>


    </div>    
    <div id="sidebar_links1467387" class="catList sidebar-block">
        <h3 class="catListTitle">
            
友情链接



        </h3>

        <ul>

                <li data-category-list-item-visible="true" style="display: block">
                    
<a href="https://blog.csdn.net/derteanoo" class="category-item-link" rel="nofollow noopener noreferrer" target="">derteanoo的博客</a>
 
                </li>                
                <li data-category-list-item-visible="true" style="display: block">
                    
<a href="https://zhengtq.github.io/" class="category-item-link" rel="nofollow noopener noreferrer" target="">all star的博客</a>
 
                </li>                
            
        </ul>


    </div>    
</div>

<!-- 最新评论 -->



<!-- 阅读排行榜 -->


<!-- 评论排行榜 -->


<!-- 推荐排行榜 -->
</div>
                    <script>loadBlogSideColumn();</script>
			</div>			
		</div><!--end: sideBarMain -->
	</div><!--end: sideBar 侧边栏容器 -->
	<div class="clear"></div>
	</div><!--end: main -->
	<div class="clear"></div>
	<div id="footer">
		<!--done-->
Copyright © 2022 ChrisZZ
<br /><span id="poweredby">Powered by .NET 6 on Kubernetes</span>



	</div><!--end: footer -->
</div><!--end: home 自定义的最大容器 -->


    

    <input type="hidden" id="antiforgery_token" value="CfDJ8AuMt_3FvyxIgNOR82PHE4l2N4_M0JGGvaq6UpAR9KL1BjWZCqI4Fj9Nxy9qbiuhzcswMVyQQnwv2uDLnW35x2N5hlaBmcyGRLCS-aJo80dYAgnib_Mzw6dmX_HY2YikXbQPg9wmUgEDRqiCeiIaU5c" />
        <script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-476124-1"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        var kv = getGACustom();
        if (kv) {
            gtag('set', kv);
        }
        gtag('config', 'UA-476124-1');
    </script>
<script defer="" src="https://hm.baidu.com/hm.js?866c9be12d4a814454792b1fd0fed295"></script><iframe src="https://16975819229a169450bd680a1c0a2d92.safeframe.googlesyndication.com/safeframe/1-0-38/html/container.html" style="visibility: hidden; display: none;"></iframe>

<div style="position: absolute; width: 0px; height: 0px; overflow: hidden; padding: 0px; border: 0px; margin: 0px;"><div id="MathJax_Font_Test" style="position: absolute; visibility: hidden; top: 0px; left: 0px; width: auto; min-width: 0px; max-width: none; padding: 0px; border: 0px; margin: 0px; white-space: nowrap; text-align: left; text-indent: 0px; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; font-size: 40px; font-weight: normal; font-style: normal; font-family: MathJax_Main, sans-serif;"></div></div><iframe src="https://www.google.com/recaptcha/api2/aframe" width="0" height="0" style="display: none;"></iframe></body></html>