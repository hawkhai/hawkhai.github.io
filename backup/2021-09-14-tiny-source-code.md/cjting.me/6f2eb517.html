<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=0" />
  <title>消失的除法指令：Part1 - CJ Ting's Blog</title>
  <meta name="author" content="CJ Ting" />
  <meta name="description" content="消失的除法指令：Part1" />
  <meta charset="utf-8" />
  <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/normalize.css@8.0.1/normalize.min.css" />

  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
  <link rel="stylesheet" type="text/css" href="//at.alicdn.com/t/font_1919785_agios4od1qk.css" />

  <script src="https://hm.baidu.com/hm.js?4f34ee3c85734c8235badd2b99b092a6"></script><script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>
  <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css" />

  <script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js"></script>

  <script src="https://cdn.jsdelivr.net/npm/notyf@3.1.0/notyf.min.js"></script>
  <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/notyf@3.1.0/notyf.min.css" />

  <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/zoom-vanilla.js@2.0.6/css/zoom.css" />

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script>
  MathJax = {
    tex: {
      inlineMath: [["$", "$"]],
    },
    chtml: {
      scale: 1.2,
    },
  }
  </script>
  <script id="MathJax-script" async="" src="https://cdn.jsdelivr.net/npm/mathjax@3.0.0/es5/tex-chtml.js"></script>
  <script type="text/javascript">
    window.PAGE = {
      title: "消失的除法指令：Part1",
      tags: ["gcc","clang","compiler","assembly","math"],
    }
  </script>

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.11.2/dist/tocbot.css" />
  <script src="https://cdn.jsdelivr.net/npm/tocbot@4.11.2/dist/tocbot.min.js"></script>

  <link rel="stylesheet" href="/asset/main.css" />
<style type="text/css">.CtxtMenu_InfoClose {  top:.2em; right:.2em;}
.CtxtMenu_InfoContent {  overflow:auto; text-align:left; font-size:80%;  padding:.4em .6em; border:1px inset; margin:1em 0px;  max-height:20em; max-width:30em; background-color:#EEEEEE;  white-space:normal;}
.CtxtMenu_Info.CtxtMenu_MousePost {outline:none;}
.CtxtMenu_Info {  position:fixed; left:50%; width:auto; text-align:center;  border:3px outset; padding:1em 2em; background-color:#DDDDDD;  color:black;  cursor:default; font-family:message-box; font-size:120%;  font-style:normal; text-indent:0; text-transform:none;  line-height:normal; letter-spacing:normal; word-spacing:normal;  word-wrap:normal; white-space:nowrap; float:none; z-index:201;  border-radius: 15px;                     /* Opera 10.5 and IE9 */  -webkit-border-radius:15px;               /* Safari and Chrome */  -moz-border-radius:15px;                  /* Firefox */  -khtml-border-radius:15px;                /* Konqueror */  box-shadow:0px 10px 20px #808080;         /* Opera 10.5 and IE9 */  -webkit-box-shadow:0px 10px 20px #808080; /* Safari 3 &amp; Chrome */  -moz-box-shadow:0px 10px 20px #808080;    /* Forefox 3.5 */  -khtml-box-shadow:0px 10px 20px #808080;  /* Konqueror */  filter:progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color="gray", Positive="true"); /* IE */}
</style><style type="text/css">.CtxtMenu_MenuClose {  position:absolute;  cursor:pointer;  display:inline-block;  border:2px solid #AAA;  border-radius:18px;  -webkit-border-radius: 18px;             /* Safari and Chrome */  -moz-border-radius: 18px;                /* Firefox */  -khtml-border-radius: 18px;              /* Konqueror */  font-family: "Courier New", Courier;  font-size:24px;  color:#F0F0F0}
.CtxtMenu_MenuClose span {  display:block; background-color:#AAA; border:1.5px solid;  border-radius:18px;  -webkit-border-radius: 18px;             /* Safari and Chrome */  -moz-border-radius: 18px;                /* Firefox */  -khtml-border-radius: 18px;              /* Konqueror */  line-height:0;  padding:8px 0 6px     /* may need to be browser-specific */}
.CtxtMenu_MenuClose:hover {  color:white!important;  border:2px solid #CCC!important}
.CtxtMenu_MenuClose:hover span {  background-color:#CCC!important}
.CtxtMenu_MenuClose:hover:focus {  outline:none}
</style><style type="text/css">.CtxtMenu_Menu {  position:absolute;  background-color:white;  color:black;  width:auto; padding:5px 0px;  border:1px solid #CCCCCC; margin:0; cursor:default;  font: menu; text-align:left; text-indent:0; text-transform:none;  line-height:normal; letter-spacing:normal; word-spacing:normal;  word-wrap:normal; white-space:nowrap; float:none; z-index:201;  border-radius: 5px;                     /* Opera 10.5 and IE9 */  -webkit-border-radius: 5px;             /* Safari and Chrome */  -moz-border-radius: 5px;                /* Firefox */  -khtml-border-radius: 5px;              /* Konqueror */  box-shadow:0px 10px 20px #808080;         /* Opera 10.5 and IE9 */  -webkit-box-shadow:0px 10px 20px #808080; /* Safari 3 &amp; Chrome */  -moz-box-shadow:0px 10px 20px #808080;    /* Forefox 3.5 */  -khtml-box-shadow:0px 10px 20px #808080;  /* Konqueror */}
.CtxtMenu_MenuItem {  padding: 1px 2em;  background:transparent;}
.CtxtMenu_MenuArrow {  position:absolute; right:.5em; padding-top:.25em; color:#666666;  font-family: null; font-size: .75em}
.CtxtMenu_MenuActive .CtxtMenu_MenuArrow {color:white}
.CtxtMenu_MenuArrow.CtxtMenu_RTL {left:.5em; right:auto}
.CtxtMenu_MenuCheck {  position:absolute; left:.7em;  font-family: null}
.CtxtMenu_MenuCheck.CtxtMenu_RTL { right:.7em; left:auto }
.CtxtMenu_MenuRadioCheck {  position:absolute; left: .7em;}
.CtxtMenu_MenuRadioCheck.CtxtMenu_RTL {  right: .7em; left:auto}
.CtxtMenu_MenuInputBox {  padding-left: 1em; right:.5em; color:#666666;  font-family: null;}
.CtxtMenu_MenuInputBox.CtxtMenu_RTL {  left: .1em;}
.CtxtMenu_MenuComboBox {  left:.1em; padding-bottom:.5em;}
.CtxtMenu_MenuLabel {  padding: 1px 2em 3px 1.33em;  font-style:italic}
.CtxtMenu_MenuRule {  border-top: 1px solid #DDDDDD;  margin: 4px 3px;}
.CtxtMenu_MenuDisabled {  color:GrayText}
.CtxtMenu_MenuActive {  background-color: #606872;  color: white;}
.CtxtMenu_MenuDisabled:focus {  background-color: #E8E8E8}
.CtxtMenu_MenuLabel:focus {  background-color: #E8E8E8}
.CtxtMenu_ContextMenu:focus {  outline:none}
.CtxtMenu_ContextMenu .CtxtMenu_MenuItem:focus {  outline:none}
.CtxtMenu_Menu .CtxtMenu_MenuClose {  top:-10px; left:-10px}
</style><style id="MJX-CHTML-styles">
mjx-container [space="1"] {
  margin-left: .111em;
}

mjx-container [space="2"] {
  margin-left: .167em;
}

mjx-container [space="3"] {
  margin-left: .222em;
}

mjx-container [space="4"] {
  margin-left: .278em;
}

mjx-container [space="5"] {
  margin-left: .333em;
}

mjx-container [rspace="1"] {
  margin-right: .111em;
}

mjx-container [rspace="2"] {
  margin-right: .167em;
}

mjx-container [rspace="3"] {
  margin-right: .222em;
}

mjx-container [rspace="4"] {
  margin-right: .278em;
}

mjx-container [rspace="5"] {
  margin-right: .333em;
}

mjx-container [size="s"] {
  font-size: 70.7%;
}

mjx-container [size="ss"] {
  font-size: 50%;
}

mjx-container [size="Tn"] {
  font-size: 60%;
}

mjx-container [size="sm"] {
  font-size: 85%;
}

mjx-container [size="lg"] {
  font-size: 120%;
}

mjx-container [size="Lg"] {
  font-size: 144%;
}

mjx-container [size="LG"] {
  font-size: 173%;
}

mjx-container [size="hg"] {
  font-size: 207%;
}

mjx-container [size="HG"] {
  font-size: 249%;
}

mjx-container [width="full"] {
  width: 100%;
}

mjx-box {
  display: inline-block;
}

mjx-block {
  display: block;
}

mjx-itable {
  display: inline-table;
}

mjx-row {
  display: table-row;
}

mjx-row &gt; * {
  display: table-cell;
}

mjx-mtext {
  display: inline-block;
  text-align: left;
}

mjx-mstyle {
  display: inline-block;
}

mjx-merror {
  display: inline-block;
  color: red;
  background-color: yellow;
}

mjx-mphantom {
  visibility: hidden;
}

mjx-math {
  display: inline-block;
  text-align: left;
  line-height: 0;
  text-indent: 0;
  font-style: normal;
  font-weight: normal;
  font-size: 100%;
  font-size-adjust: none;
  letter-spacing: normal;
  word-wrap: normal;
  word-spacing: normal;
  white-space: nowrap;
  direction: ltr;
  padding: 1px 0;
}

mjx-container[jax="CHTML"][display="true"] {
  display: block;
  text-align: center;
  margin: 1em 0;
}

mjx-container[jax="CHTML"][display="true"] mjx-math {
  padding: 0;
}

mjx-container[jax="CHTML"][justify="left"] {
  text-align: left;
}

mjx-container[jax="CHTML"][justify="right"] {
  text-align: right;
}

mjx-mrow {
  display: inline-block;
  text-align: left;
}

mjx-inferredMrow {
  display: inline-block;
  text-align: left;
}

mjx-mi {
  display: inline-block;
  text-align: left;
}

mjx-mo {
  display: inline-block;
  text-align: left;
}

mjx-stretchy-h {
  display: inline-table;
  width: 100%;
}

mjx-stretchy-h &gt; * {
  display: table-cell;
  width: 0;
}

mjx-stretchy-h &gt; * &gt; mjx-c {
  display: inline-block;
}

mjx-stretchy-h &gt; * &gt; mjx-c::before {
  padding: .001em 0;
  width: initial;
}

mjx-stretchy-h &gt; mjx-ext {
  overflow: hidden;
  width: 100%;
}

mjx-stretchy-h &gt; mjx-ext &gt; mjx-c::before {
  transform: scalex(500);
}

mjx-stretchy-h &gt; mjx-ext &gt; mjx-c {
  width: 0;
}

mjx-stretchy-h &gt; mjx-beg &gt; mjx-c {
  margin-right: -.1em;
}

mjx-stretchy-h &gt; mjx-end &gt; mjx-c {
  margin-left: -.1em;
}

mjx-stretchy-v {
  display: inline-block;
}

mjx-stretchy-v &gt; * {
  display: block;
}

mjx-stretchy-v &gt; mjx-beg {
  height: 0;
}

mjx-stretchy-v &gt; mjx-end &gt; mjx-c {
  display: block;
}

mjx-stretchy-v &gt; * &gt; mjx-c {
  transform: scale(1);
  transform-origin: left center;
  overflow: hidden;
}

mjx-stretchy-v &gt; mjx-ext {
  display: block;
  height: 100%;
  box-sizing: border-box;
  border: 0px solid transparent;
  overflow: hidden;
}

mjx-stretchy-v &gt; mjx-ext &gt; mjx-c::before {
  width: initial;
}

mjx-stretchy-v &gt; mjx-ext &gt; mjx-c {
  transform: scaleY(500) translateY(.1em);
  overflow: visible;
}

mjx-mark {
  display: inline-block;
  height: 0px;
}

mjx-mn {
  display: inline-block;
  text-align: left;
}

mjx-ms {
  display: inline-block;
  text-align: left;
}

mjx-mspace {
  display: inline-block;
  text-align: left;
}

mjx-mpadded {
  display: inline-block;
  text-align: left;
}

mjx-rbox {
  display: inline-block;
  position: relative;
}

mjx-menclose {
  display: inline-block;
  text-align: left;
  position: relative;
}

mjx-menclose &gt; mjx-dstrike {
  display: inline-block;
  left: 0;
  top: 0;
  position: absolute;
  border-top: 0.067em solid;
  transform-origin: top left;
}

mjx-menclose &gt; mjx-ustrike {
  display: inline-block;
  left: 0;
  bottom: 0;
  position: absolute;
  border-top: 0.067em solid;
  transform-origin: bottom left;
}

mjx-menclose &gt; mjx-hstrike {
  border-top: 0.067em solid;
  position: absolute;
  left: 0;
  right: 0;
  bottom: 50%;
  transform: translateY(0.034em);
}

mjx-menclose &gt; mjx-vstrike {
  border-left: 0.067em solid;
  position: absolute;
  top: 0;
  bottom: 0;
  right: 50%;
  transform: translateX(0.034em);
}

mjx-menclose &gt; mjx-rbox {
  position: absolute;
  top: 0;
  bottom: 0;
  right: 0;
  left: 0;
  border: 0.067em solid;
  border-radius: 0.267em;
}

mjx-menclose &gt; mjx-cbox {
  position: absolute;
  top: 0;
  bottom: 0;
  right: 0;
  left: 0;
  border: 0.067em solid;
  border-radius: 50%;
}

mjx-menclose &gt; mjx-arrow {
  position: absolute;
  left: 0;
  bottom: 50%;
  height: 0;
  width: 0;
}

mjx-menclose &gt; mjx-arrow &gt; * {
  display: block;
  position: absolute;
  transform-origin: bottom;
  border-left: 0.268em solid;
  border-right: 0;
  box-sizing: border-box;
}

mjx-menclose &gt; mjx-arrow &gt; mjx-aline {
  left: 0;
  top: -0.034em;
  right: 0.201em;
  height: 0;
  border-top: 0.067em solid;
  border-left: 0;
}

mjx-menclose &gt; mjx-arrow[double] &gt; mjx-aline {
  left: 0.201em;
  height: 0;
}

mjx-menclose &gt; mjx-arrow &gt; mjx-rthead {
  transform: skewX(0.464rad);
  right: 0;
  bottom: -1px;
  border-bottom: 1px solid transparent;
  border-top: 0.134em solid transparent;
}

mjx-menclose &gt; mjx-arrow &gt; mjx-rbhead {
  transform: skewX(-0.464rad);
  transform-origin: top;
  right: 0;
  top: -1px;
  border-top: 1px solid transparent;
  border-bottom: 0.134em solid transparent;
}

mjx-menclose &gt; mjx-arrow &gt; mjx-lthead {
  transform: skewX(-0.464rad);
  left: 0;
  bottom: -1px;
  border-left: 0;
  border-right: 0.268em solid;
  border-bottom: 1px solid transparent;
  border-top: 0.134em solid transparent;
}

mjx-menclose &gt; mjx-arrow &gt; mjx-lbhead {
  transform: skewX(0.464rad);
  transform-origin: top;
  left: 0;
  top: -1px;
  border-left: 0;
  border-right: 0.268em solid;
  border-top: 1px solid transparent;
  border-bottom: 0.134em solid transparent;
}

mjx-menclose &gt; dbox {
  position: absolute;
  top: 0;
  bottom: 0;
  left: -0.3em;
  width: 0.6em;
  border: 0.067em solid;
  border-radius: 50%;
  clip-path: inset(0 0 0 0.3em);
  box-sizing: border-box;
}

mjx-mfrac {
  display: inline-block;
  text-align: left;
}

mjx-frac {
  display: inline-block;
  vertical-align: 0.17em;
  padding: 0 .22em;
}

mjx-frac[type="d"] {
  vertical-align: .04em;
}

mjx-frac[delims] {
  padding: 0 .1em;
}

mjx-frac[atop] {
  padding: 0 .12em;
}

mjx-frac[atop][delims] {
  padding: 0;
}

mjx-dtable {
  display: inline-table;
  width: 100%;
}

mjx-dtable &gt; * {
  font-size: 2000%;
}

mjx-dbox {
  display: block;
  font-size: 5%;
}

mjx-num {
  display: block;
  text-align: center;
}

mjx-den {
  display: block;
  text-align: center;
}

mjx-mfrac[bevelled] &gt; mjx-num {
  display: inline-block;
}

mjx-mfrac[bevelled] &gt; mjx-den {
  display: inline-block;
}

mjx-den[align="right"], mjx-num[align="right"] {
  text-align: right;
}

mjx-den[align="left"], mjx-num[align="left"] {
  text-align: left;
}

mjx-nstrut {
  display: inline-block;
  height: .054em;
  width: 0;
  vertical-align: -.054em;
}

mjx-nstrut[type="d"] {
  height: .217em;
  vertical-align: -.217em;
}

mjx-dstrut {
  display: inline-block;
  height: .505em;
  width: 0;
}

mjx-dstrut[type="d"] {
  height: .726em;
}

mjx-line {
  display: block;
  box-sizing: border-box;
  min-height: 1px;
  height: .06em;
  border-top: .06em solid;
  margin: .06em -.1em;
  overflow: hidden;
}

mjx-line[type="d"] {
  margin: .18em -.1em;
}

mjx-msqrt {
  display: inline-block;
  text-align: left;
}

mjx-root {
  display: inline-block;
  white-space: nowrap;
}

mjx-surd {
  display: inline-block;
  vertical-align: top;
}

mjx-sqrt {
  display: inline-block;
  padding-top: .07em;
}

mjx-sqrt &gt; mjx-box {
  border-top: .07em solid;
}

mjx-sqrt.mjx-tall &gt; mjx-box {
  padding-left: .3em;
  margin-left: -.3em;
}

mjx-mroot {
  display: inline-block;
  text-align: left;
}

mjx-msub {
  display: inline-block;
  text-align: left;
}

mjx-msup {
  display: inline-block;
  text-align: left;
}

mjx-msubsup {
  display: inline-block;
  text-align: left;
}

mjx-script {
  display: inline-block;
  padding-right: .05em;
}

mjx-script &gt; * {
  display: block;
}

mjx-munder {
  display: inline-block;
  text-align: left;
}

mjx-over {
  text-align: left;
}

mjx-munder:not([limits="false"]) {
  display: inline-table;
}

mjx-munder &gt; mjx-row {
  text-align: left;
}

mjx-under {
  padding-bottom: .1em;
}

mjx-mover {
  display: inline-block;
  text-align: left;
}

mjx-mover:not([limits="false"]) {
  padding-top: .1em;
}

mjx-mover:not([limits="false"]) &gt; * {
  display: block;
  text-align: left;
}

mjx-munderover {
  display: inline-block;
  text-align: left;
}

mjx-munderover:not([limits="false"]) {
  padding-top: .1em;
}

mjx-munderover:not([limits="false"]) &gt; * {
  display: block;
}

mjx-mmultiscripts {
  display: inline-block;
  text-align: left;
}

mjx-prescripts {
  display: inline-table;
  padding-left: .05em;
}

mjx-scripts {
  display: inline-table;
  padding-right: .05em;
}

mjx-prescripts &gt; mjx-row &gt; mjx-cell {
  text-align: right;
}

mjx-mfenced {
  display: inline-block;
  text-align: left;
}

mjx-mtable {
  display: inline-block;
  text-align: center;
  vertical-align: .25em;
  position: relative;
  box-sizing: border-box;
}

mjx-labels {
  position: absolute;
  left: 0;
  top: 0;
}

mjx-table {
  display: inline-block;
}

mjx-table &gt; mjx-itable {
  vertical-align: middle;
  text-align: left;
  box-sizing: border-box;
}

mjx-labels &gt; mjx-itable {
  position: absolute;
  top: 0;
}

mjx-mtable[justify="left"] {
  text-align: left;
}

mjx-mtable[justify="right"] {
  text-align: right;
}

mjx-mtable[justify="left"][side="left"] {
  padding-right: 0 ! important;
}

mjx-mtable[justify="left"][side="right"] {
  padding-left: 0 ! important;
}

mjx-mtable[justify="right"][side="left"] {
  padding-right: 0 ! important;
}

mjx-mtable[justify="right"][side="right"] {
  padding-left: 0 ! important;
}

mjx-mtable[align] {
  vertical-align: baseline;
}

mjx-mtable[align="top"] &gt; mjx-table {
  vertical-align: top;
}

mjx-mtable[align="bottom"] &gt; mjx-table {
  vertical-align: bottom;
}

mjx-mtable[align="center"] &gt; mjx-table {
  vertical-align: middle;
}

mjx-mtable[align="baseline"] &gt; mjx-table {
  vertical-align: middle;
}

mjx-mtr {
  display: table-row;
  text-align: left;
}

mjx-mtr[rowalign="top"] &gt; mjx-mtd {
  vertical-align: top;
}

mjx-mtr[rowalign="center"] &gt; mjx-mtd {
  vertical-align: middle;
}

mjx-mtr[rowalign="bottom"] &gt; mjx-mtd {
  vertical-align: bottom;
}

mjx-mtr[rowalign="baseline"] &gt; mjx-mtd {
  vertical-align: baseline;
}

mjx-mtr[rowalign="axis"] &gt; mjx-mtd {
  vertical-align: .25em;
}

mjx-mlabeledtr {
  display: table-row;
  text-align: left;
}

mjx-mlabeledtr[rowalign="top"] &gt; mjx-mtd {
  vertical-align: top;
}

mjx-mlabeledtr[rowalign="center"] &gt; mjx-mtd {
  vertical-align: middle;
}

mjx-mlabeledtr[rowalign="bottom"] &gt; mjx-mtd {
  vertical-align: bottom;
}

mjx-mlabeledtr[rowalign="baseline"] &gt; mjx-mtd {
  vertical-align: baseline;
}

mjx-mlabeledtr[rowalign="axis"] &gt; mjx-mtd {
  vertical-align: .25em;
}

mjx-mtd {
  display: table-cell;
  text-align: center;
  padding: .215em .4em;
}

mjx-mtd:first-child {
  padding-left: 0;
}

mjx-mtd:last-child {
  padding-right: 0;
}

mjx-mtable &gt; * &gt; mjx-itable &gt; *:first-child &gt; mjx-mtd {
  padding-top: 0;
}

mjx-mtable &gt; * &gt; mjx-itable &gt; *:last-child &gt; mjx-mtd {
  padding-bottom: 0;
}

mjx-tstrut {
  display: inline-block;
  height: 1em;
  vertical-align: -.25em;
}

mjx-labels[align="left"] &gt; mjx-mtr &gt; mjx-mtd {
  text-align: left;
}

mjx-labels[align="right"] &gt; mjx-mtr &gt; mjx-mtd {
  text-align: right;
}

mjx-mtr mjx-mtd[rowalign="top"], mjx-mlabeledtr mjx-mtd[rowalign="top"] {
  vertical-align: top;
}

mjx-mtr mjx-mtd[rowalign="center"], mjx-mlabeledtr mjx-mtd[rowalign="center"] {
  vertical-align: middle;
}

mjx-mtr mjx-mtd[rowalign="bottom"], mjx-mlabeledtr mjx-mtd[rowalign="bottom"] {
  vertical-align: bottom;
}

mjx-mtr mjx-mtd[rowalign="baseline"], mjx-mlabeledtr mjx-mtd[rowalign="baseline"] {
  vertical-align: baseline;
}

mjx-mtr mjx-mtd[rowalign="axis"], mjx-mlabeledtr mjx-mtd[rowalign="axis"] {
  vertical-align: .25em;
}

mjx-maction {
  display: inline-block;
  text-align: left;
  position: relative;
}

mjx-maction &gt; mjx-tool {
  display: none;
  position: absolute;
  bottom: 0;
  right: 0;
  width: 0;
  height: 0;
  z-index: 500;
}

mjx-tool &gt; mjx-tip {
  display: inline-block;
  padding: .2em;
  border: 1px solid #888;
  font-size: 70%;
  background-color: #F8F8F8;
  color: black;
  box-shadow: 2px 2px 5px #AAAAAA;
}

mjx-maction[toggle] {
  cursor: pointer;
}

mjx-status {
  display: block;
  position: fixed;
  left: 1em;
  bottom: 1em;
  min-width: 25%;
  padding: .2em .4em;
  border: 1px solid #888;
  font-size: 90%;
  background-color: #F8F8F8;
  color: black;
}

mjx-mglyph {
  display: inline-block;
  text-align: left;
}

mjx-mglyph &gt; img {
  display: inline-block;
  border: 0;
  padding: 0;
}

mjx-semantics {
  display: inline-block;
  text-align: left;
}

mjx-annotation {
  display: inline-block;
  text-align: left;
}

mjx-annotation-xml {
  display: inline-block;
  text-align: left;
}

mjx-TeXAtom {
  display: inline-block;
  text-align: left;
}

mjx-c {
  display: inline-block;
}

mjx-utext {
  display: inline-block;
  padding: .75em 0 .25em 0;
}

mjx-measure-text {
  position: absolute;
  font-family: MJXZERO;
  white-space: nowrap;
  height: 1px;
  width: 1px;
  overflow: hidden;
}

mjx-c::before {
  display: inline-block;
  width: 0;
}

.mjx-n mjx-c {
  font-family: MJXZERO, MJXTEX, MJXTEX-I, MJXTEX-S1, MJXTEX-A;
}

.mjx-i mjx-c {
  font-family: MJXZERO, MJXTEX-I, MJXTEX, MJXTEX-S1, MJXTEX-A;
}

.mjx-b mjx-c {
  font-family: MJXZERO, MJXTEX-B, MJXTEX-BI, MJXTEX, MJXTEX-I, MJXTEX-S1, MJXTEX-A;
}

.mjx-b.mjx-i mjx-c {
  font-family: MJXZERO, MJXTEX-BI, MJXTEX-B, MJXTEX-I, MJXTEX, MJXTEX-S1, MJXTEX-A;
}

.mjx-cal mjx-c {
  font-family: MJXZERO, MJXTEX-C, MJXTEX-I, MJXTEX, MJXTEX-S1, MJXTEX-A;
}

.mjx-cal.mjx-b mjx-c {
  font-family: MJXZERO, MJXTEX-C-B, MJXTEX-C, MJXTEX-B, MJXTEX-BI, MJXTEX, MJXTEX-S1, MJXTEX-A;
}

.mjx-ds mjx-c {
  font-family: MJXZERO, MJXTEX-A, MJXTEX-B, MJXTEX-BI, MJXTEX, MJXTEX-I, MJXTEX-S1;
}

.mjx-fr mjx-c {
  font-family: MJXZERO, MJXTEX-FR, MJXTEX, MJXTEX-I, MJXTEX-S1, MJXTEX-A;
}

.mjx-fr.mjx-b mjx-c {
  font-family: MJXZERO, MJXTEX-FR-B, MJXTEX-FR, MJXTEX-B, MJXTEX-BI, MJXTEX, MJXTEX-I, MJXTEX-S1, MJXTEX-A;
}

.mjx-sc mjx-c {
  font-family: MJXZERO, MJXTEX-SC, MJXTEX, MJXTEX-I, MJXTEX-S1, MJXTEX-A;
}

.mjx-sc.mjx-b mjx-c {
  font-family: MJXZERO, MJXTEX-SC-B, MJXTEX-SC, MJXTEX-B, MJXTEX-BI, MJXTEX, MJXTEX-I, MJXTEX-S1, MJXTEX-A;
}

.mjx-ss mjx-c {
  font-family: MJXZERO, MJXTEX-SS, MJXTEX, MJXTEX-I, MJXTEX-S1, MJXTEX-A;
}

.mjx-ss.mjx-b mjx-c {
  font-family: MJXZERO, MJXTEX-SS-B, MJXTEX-SS, MJXTEX-B, MJXTEX-BI, MJXTEX, MJXTEX-I, MJXTEX-S1, MJXTEX-A;
}

.mjx-ss.mjx-i mjx-c {
  font-family: MJXZERO, MJXTEX-SS-I, MJXTEX-I, MJXTEX, MJXTEX-S1, MJXTEX-A;
}

.mjx-ss.mjx-b.mjx-i mjx-c {
  font-family: MJXZERO, MJXTEX-SS-B, MJXTEX-SS-I, MJXTEX-BI, MJXTEX-B, MJXTEX-I, MJXTEX, MJXTEX-S1, MJXTEX-A;
}

.mjx-ty mjx-c {
  font-family: MJXZERO, MJXTEX-T, MJXTEX, MJXTEX-I, MJXTEX-S1, MJXTEX-A;
}

.mjx-var mjx-c {
  font-family: MJXZERO, MJXTEX-A, MJXTEX, MJXTEX-I, MJXTEX-S1;
}

.mjx-os mjx-c {
  font-family: MJXZERO, MJXTEX-C, MJXTEX, MJXTEX-I, MJXTEX-S1, MJXTEX-A;
}

.mjx-os.mjx-b mjx-c {
  font-family: MJXZERO, MJXTEX-C-B, MJXTEX-C, MJXTEX-B, MJXTEX-BI, MJXTEX, MJXTEX-I, MJXTEX-S1, MJXTEX-A;
}

.mjx-mit mjx-c {
  font-family: MJXZERO, MJXTEX-MI, MJXTEX-I, MJXTEX, MJXTEX-S1, MJXTEX-A;
}

.mjx-lop mjx-c {
  font-family: MJXZERO, MJXTEX-S2, MJXTEX-S1, MJXTEX, MJXTEX-I, MJXTEX-A;
}

.mjx-sop mjx-c {
  font-family: MJXZERO, MJXTEX-S1, MJXTEX, MJXTEX-I, MJXTEX-A;
}

.mjx-s3 mjx-c {
  font-family: MJXZERO, MJXTEX-S3, MJXTEX, MJXTEX-I, MJXTEX-S1, MJXTEX-A;
}

.mjx-s4 mjx-c {
  font-family: MJXZERO, MJXTEX-S4, MJXTEX, MJXTEX-I, MJXTEX-S1, MJXTEX-A;
}

.MJX-TEX {
  font-family: MJXZERO;
}

mjx-stretchy-v mjx-c, mjx-stretchy-h mjx-c {
  font-family: MJXZERO, MJXTEX-S1, MJXTEX-S4, MJXTEX, MJXTEX-A ! important;
}

@font-face /* 0 */ {
  font-family: MJXZERO;
  src: url("https://cdn.jsdelivr.net/npm/mathjax@3.0.0/es5/output/chtml/fonts/woff-v2/MathJax_Zero.woff") format("woff");
}

@font-face /* 1 */ {
  font-family: MJXTEX;
  src: url("https://cdn.jsdelivr.net/npm/mathjax@3.0.0/es5/output/chtml/fonts/woff-v2/MathJax_Main-Regular.woff") format("woff");
}

@font-face /* 2 */ {
  font-family: MJXTEX-B;
  src: url("https://cdn.jsdelivr.net/npm/mathjax@3.0.0/es5/output/chtml/fonts/woff-v2/MathJax_Main-Bold.woff") format("woff");
}

@font-face /* 3 */ {
  font-family: MJXTEX-MI;
  src: url("https://cdn.jsdelivr.net/npm/mathjax@3.0.0/es5/output/chtml/fonts/woff-v2/MathJax_Main-Italic.woff") format("woff");
}

@font-face /* 4 */ {
  font-family: MJXTEX-I;
  src: url("https://cdn.jsdelivr.net/npm/mathjax@3.0.0/es5/output/chtml/fonts/woff-v2/MathJax_Math-Italic.woff") format("woff");
}

@font-face /* 5 */ {
  font-family: MJXTEX-BI;
  src: url("https://cdn.jsdelivr.net/npm/mathjax@3.0.0/es5/output/chtml/fonts/woff-v2/MathJax_Math-BoldItalic.woff") format("woff");
}

@font-face /* 6 */ {
  font-family: MJXTEX-S1;
  src: url("https://cdn.jsdelivr.net/npm/mathjax@3.0.0/es5/output/chtml/fonts/woff-v2/MathJax_Size1-Regular.woff") format("woff");
}

@font-face /* 7 */ {
  font-family: MJXTEX-S2;
  src: url("https://cdn.jsdelivr.net/npm/mathjax@3.0.0/es5/output/chtml/fonts/woff-v2/MathJax_Size2-Regular.woff") format("woff");
}

@font-face /* 8 */ {
  font-family: MJXTEX-S3;
  src: url("https://cdn.jsdelivr.net/npm/mathjax@3.0.0/es5/output/chtml/fonts/woff-v2/MathJax_Size3-Regular.woff") format("woff");
}

@font-face /* 9 */ {
  font-family: MJXTEX-S4;
  src: url("https://cdn.jsdelivr.net/npm/mathjax@3.0.0/es5/output/chtml/fonts/woff-v2/MathJax_Size4-Regular.woff") format("woff");
}

@font-face /* 10 */ {
  font-family: MJXTEX-A;
  src: url("https://cdn.jsdelivr.net/npm/mathjax@3.0.0/es5/output/chtml/fonts/woff-v2/MathJax_AMS-Regular.woff") format("woff");
}

@font-face /* 11 */ {
  font-family: MJXTEX-C;
  src: url("https://cdn.jsdelivr.net/npm/mathjax@3.0.0/es5/output/chtml/fonts/woff-v2/MathJax_Calligraphic-Regular.woff") format("woff");
}

@font-face /* 12 */ {
  font-family: MJXTEX-C-B;
  src: url("https://cdn.jsdelivr.net/npm/mathjax@3.0.0/es5/output/chtml/fonts/woff-v2/MathJax_Calligraphic-Bold.woff") format("woff");
}

@font-face /* 13 */ {
  font-family: MJXTEX-FR;
  src: url("https://cdn.jsdelivr.net/npm/mathjax@3.0.0/es5/output/chtml/fonts/woff-v2/MathJax_Fraktur-Regular.woff") format("woff");
}

@font-face /* 14 */ {
  font-family: MJXTEX-FR-B;
  src: url("https://cdn.jsdelivr.net/npm/mathjax@3.0.0/es5/output/chtml/fonts/woff-v2/MathJax_Fraktur-Bold.woff") format("woff");
}

@font-face /* 15 */ {
  font-family: MJXTEX-SS;
  src: url("https://cdn.jsdelivr.net/npm/mathjax@3.0.0/es5/output/chtml/fonts/woff-v2/MathJax_SansSerif-Regular.woff") format("woff");
}

@font-face /* 16 */ {
  font-family: MJXTEX-SS-B;
  src: url("https://cdn.jsdelivr.net/npm/mathjax@3.0.0/es5/output/chtml/fonts/woff-v2/MathJax_SansSerif-Bold.woff") format("woff");
}

@font-face /* 17 */ {
  font-family: MJXTEX-SS-I;
  src: url("https://cdn.jsdelivr.net/npm/mathjax@3.0.0/es5/output/chtml/fonts/woff-v2/MathJax_SansSerif-Italic.woff") format("woff");
}

@font-face /* 18 */ {
  font-family: MJXTEX-SC;
  src: url("https://cdn.jsdelivr.net/npm/mathjax@3.0.0/es5/output/chtml/fonts/woff-v2/MathJax_Script-Regular.woff") format("woff");
}

@font-face /* 19 */ {
  font-family: MJXTEX-T;
  src: url("https://cdn.jsdelivr.net/npm/mathjax@3.0.0/es5/output/chtml/fonts/woff-v2/MathJax_Typewriter-Regular.woff") format("woff");
}

@font-face /* 20 */ {
  font-family: MJXTEX-V;
  src: url("https://cdn.jsdelivr.net/npm/mathjax@3.0.0/es5/output/chtml/fonts/woff-v2/MathJax_Vector-Regular.woff") format("woff");
}

@font-face /* 21 */ {
  font-family: MJXTEX-VB;
  src: url("https://cdn.jsdelivr.net/npm/mathjax@3.0.0/es5/output/chtml/fonts/woff-v2/MathJax_Vector-Bold.woff") format("woff");
}

 mjx-c.mjx-c20::before {
  content: " ";
}

mjx-c.mjx-c20 {
  padding: 0 0.25em 0 0;
}

 mjx-c.mjx-c28::before {
  content: "(";
}

mjx-c.mjx-c28 {
  padding: 0.75em 0.389em 0.25em 0;
}

 mjx-c.mjx-c29::before {
  content: ")";
}

mjx-c.mjx-c29 {
  padding: 0.75em 0.389em 0.25em 0;
}

 mjx-c.mjx-c2B::before {
  content: "+";
}

mjx-c.mjx-c2B {
  padding: 0.583em 0.778em 0.082em 0;
}

 mjx-c.mjx-c2C::before {
  content: ",";
}

mjx-c.mjx-c2C {
  padding: 0.121em 0.278em 0.194em 0;
}

 mjx-c.mjx-c2D::before {
  content: "-";
}

mjx-c.mjx-c2D {
  padding: 0.252em 0.333em 0 0;
}

 mjx-c.mjx-c2F::before {
  content: "/";
}

mjx-c.mjx-c2F {
  padding: 0.75em 0.5em 0.25em 0;
}

 mjx-c.mjx-c30::before {
  content: "0";
}

mjx-c.mjx-c30 {
  padding: 0.666em 0.5em 0.022em 0;
}

 mjx-c.mjx-c31::before {
  content: "1";
}

mjx-c.mjx-c31 {
  padding: 0.666em 0.5em 0 0;
}

 mjx-c.mjx-c32::before {
  content: "2";
}

mjx-c.mjx-c32 {
  padding: 0.666em 0.5em 0 0;
}

 mjx-c.mjx-c33::before {
  content: "3";
}

mjx-c.mjx-c33 {
  padding: 0.665em 0.5em 0.022em 0;
}

 mjx-c.mjx-c34::before {
  content: "4";
}

mjx-c.mjx-c34 {
  padding: 0.677em 0.5em 0 0;
}

 mjx-c.mjx-c35::before {
  content: "5";
}

mjx-c.mjx-c35 {
  padding: 0.666em 0.5em 0.022em 0;
}

 mjx-c.mjx-c36::before {
  content: "6";
}

mjx-c.mjx-c36 {
  padding: 0.666em 0.5em 0.022em 0;
}

 mjx-c.mjx-c37::before {
  content: "7";
}

mjx-c.mjx-c37 {
  padding: 0.676em 0.5em 0.022em 0;
}

 mjx-c.mjx-c3C::before {
  content: "&lt;";
}

mjx-c.mjx-c3C {
  padding: 0.54em 0.778em 0.04em 0;
}

 mjx-c.mjx-c3D::before {
  content: "=";
}

mjx-c.mjx-c3D {
  padding: 0.583em 0.778em 0.082em 0;
}

 mjx-c.mjx-c3E::before {
  content: "&gt;";
}

mjx-c.mjx-c3E {
  padding: 0.54em 0.778em 0.04em 0;
}

 mjx-c.mjx-c44::before {
  content: "D";
}

mjx-c.mjx-c44 {
  padding: 0.683em 0.764em 0 0;
}

 mjx-c.mjx-c61::before {
  content: "a";
}

mjx-c.mjx-c61 {
  padding: 0.448em 0.5em 0.011em 0;
}

 mjx-c.mjx-c64::before {
  content: "d";
}

mjx-c.mjx-c64 {
  padding: 0.694em 0.556em 0.011em 0;
}

 mjx-c.mjx-c65::before {
  content: "e";
}

mjx-c.mjx-c65 {
  padding: 0.448em 0.444em 0.011em 0;
}

 mjx-c.mjx-c66::before {
  content: "f";
}

mjx-c.mjx-c66 {
  padding: 0.705em 0.372em 0 0;
}

mjx-mo[noIC]mjx-c.mjx-c66:last-child {
  padding-right: 0.306em;
}

mjx-mi[noIC]mjx-c.mjx-c66:last-child {
  padding-right: 0.306em;
}

 mjx-c.mjx-c67::before {
  content: "g";
}

mjx-c.mjx-c67 {
  padding: 0.453em 0.5em 0.206em 0;
}

 mjx-c.mjx-c69::before {
  content: "i";
}

mjx-c.mjx-c69 {
  padding: 0.669em 0.278em 0 0;
}

 mjx-c.mjx-c6C::before {
  content: "l";
}

mjx-c.mjx-c6C {
  padding: 0.694em 0.278em 0 0;
}

 mjx-c.mjx-c6D::before {
  content: "m";
}

mjx-c.mjx-c6D {
  padding: 0.442em 0.833em 0 0;
}

 mjx-c.mjx-c6E::before {
  content: "n";
}

mjx-c.mjx-c6E {
  padding: 0.442em 0.556em 0 0;
}

 mjx-c.mjx-c6F::before {
  content: "o";
}

mjx-c.mjx-c6F {
  padding: 0.448em 0.5em 0.01em 0;
}

 mjx-c.mjx-c72::before {
  content: "r";
}

mjx-c.mjx-c72 {
  padding: 0.442em 0.392em 0 0;
}

 mjx-c.mjx-c73::before {
  content: "s";
}

mjx-c.mjx-c73 {
  padding: 0.448em 0.394em 0.011em 0;
}

 mjx-c.mjx-c74::before {
  content: "t";
}

mjx-c.mjx-c74 {
  padding: 0.615em 0.389em 0.01em 0;
}

 mjx-c.mjx-c78::before {
  content: "x";
}

mjx-c.mjx-c78 {
  padding: 0.431em 0.528em 0 0;
}

 mjx-c.mjx-c7C::before {
  content: "|";
}

mjx-c.mjx-c7C {
  padding: 0.75em 0.278em 0.249em 0;
}

mjx-c.mjx-cA0::before {
  content: "\A0";
}

mjx-c.mjx-cA0 {
  padding: 0 0.25em 0 0;
}

mjx-c.mjx-cF7::before {
  content: "\F7";
}

mjx-c.mjx-cF7 {
  padding: 0.537em 0.778em 0.036em 0;
}

mjx-c.mjx-c2212::before {
  content: "\2212";
}

mjx-c.mjx-c2212 {
  padding: 0.583em 0.778em 0.082em 0;
}

mjx-c.mjx-c2217::before {
  content: "\2217";
}

mjx-c.mjx-c2217 {
  padding: 0.465em 0.5em 0 0;
}

mjx-c.mjx-c2260::before {
  content: "\2260";
}

mjx-c.mjx-c2260 {
  padding: 0.716em 0.778em 0.215em 0;
}

mjx-c.mjx-c2264::before {
  content: "\2264";
}

mjx-c.mjx-c2264 {
  padding: 0.636em 0.778em 0.138em 0;
}

mjx-c.mjx-c2265::before {
  content: "\2265";
}

mjx-c.mjx-c2265 {
  padding: 0.636em 0.778em 0.138em 0;
}

mjx-c.mjx-c22C5::before {
  content: "\22C5";
}

mjx-c.mjx-c22C5 {
  padding: 0.31em 0.278em 0 0;
}

mjx-c.mjx-c2308::before {
  content: "\2308";
}

mjx-c.mjx-c2308 {
  padding: 0.75em 0.444em 0.25em 0;
}

mjx-c.mjx-c2309::before {
  content: "\2309";
}

mjx-c.mjx-c2309 {
  padding: 0.75em 0.444em 0.25em 0;
}

mjx-c.mjx-c230A::before {
  content: "\230A";
}

mjx-c.mjx-c230A {
  padding: 0.75em 0.444em 0.25em 0;
}

mjx-c.mjx-c230B::before {
  content: "\230B";
}

mjx-c.mjx-c230B {
  padding: 0.75em 0.444em 0.25em 0;
}

.mjx-i mjx-c.mjx-c61::before {
  content: "a";
}

.mjx-i mjx-c.mjx-c61 {
  padding: 0.441em 0.529em 0.01em 0;
}

.mjx-i mjx-c.mjx-c63::before {
  content: "c";
}

.mjx-i mjx-c.mjx-c63 {
  padding: 0.442em 0.433em 0.011em 0;
}

.mjx-i mjx-c.mjx-c64::before {
  content: "d";
}

.mjx-i mjx-c.mjx-c64 {
  padding: 0.694em 0.52em 0.01em 0;
}

.mjx-i mjx-c.mjx-c65::before {
  content: "e";
}

.mjx-i mjx-c.mjx-c65 {
  padding: 0.442em 0.466em 0.011em 0;
}

.mjx-i mjx-c.mjx-c66::before {
  content: "f";
}

.mjx-i mjx-c.mjx-c66 {
  padding: 0.705em 0.55em 0.205em 0;
}

mjx-mo[noIC].mjx-i mjx-c.mjx-c66:last-child {
  padding-right: 0.49em;
}

mjx-mi[noIC].mjx-i mjx-c.mjx-c66:last-child {
  padding-right: 0.49em;
}

.mjx-i mjx-c.mjx-c67::before {
  content: "g";
}

.mjx-i mjx-c.mjx-c67 {
  padding: 0.442em 0.477em 0.205em 0;
}

.mjx-i mjx-c.mjx-c69::before {
  content: "i";
}

.mjx-i mjx-c.mjx-c69 {
  padding: 0.661em 0.345em 0.011em 0;
}

.mjx-i mjx-c.mjx-c6C::before {
  content: "l";
}

.mjx-i mjx-c.mjx-c6C {
  padding: 0.694em 0.298em 0.011em 0;
}

.mjx-i mjx-c.mjx-c6D::before {
  content: "m";
}

.mjx-i mjx-c.mjx-c6D {
  padding: 0.442em 0.878em 0.011em 0;
}

.mjx-i mjx-c.mjx-c6E::before {
  content: "n";
}

.mjx-i mjx-c.mjx-c6E {
  padding: 0.442em 0.6em 0.011em 0;
}

.mjx-i mjx-c.mjx-c6F::before {
  content: "o";
}

.mjx-i mjx-c.mjx-c6F {
  padding: 0.441em 0.485em 0.011em 0;
}

.mjx-i mjx-c.mjx-c71::before {
  content: "q";
}

.mjx-i mjx-c.mjx-c71 {
  padding: 0.442em 0.446em 0.194em 0;
}

.mjx-i mjx-c.mjx-c72::before {
  content: "r";
}

.mjx-i mjx-c.mjx-c72 {
  padding: 0.442em 0.451em 0.011em 0;
}

.mjx-i mjx-c.mjx-c73::before {
  content: "s";
}

.mjx-i mjx-c.mjx-c73 {
  padding: 0.442em 0.469em 0.01em 0;
}

.mjx-i mjx-c.mjx-c74::before {
  content: "t";
}

.mjx-i mjx-c.mjx-c74 {
  padding: 0.626em 0.361em 0.011em 0;
}

.mjx-i mjx-c.mjx-c75::before {
  content: "u";
}

.mjx-i mjx-c.mjx-c75 {
  padding: 0.442em 0.572em 0.011em 0;
}

.mjx-i mjx-c.mjx-c76::before {
  content: "v";
}

.mjx-i mjx-c.mjx-c76 {
  padding: 0.443em 0.485em 0.011em 0;
}

.mjx-i mjx-c.mjx-c78::before {
  content: "x";
}

.mjx-i mjx-c.mjx-c78 {
  padding: 0.442em 0.572em 0.011em 0;
}

.mjx-lop mjx-c.mjx-c2308 {
  padding: 1.15em 0.528em 0.649em 0;
}

.mjx-lop mjx-c.mjx-c2309 {
  padding: 1.15em 0.528em 0.649em 0;
}

.mjx-lop mjx-c.mjx-c230A {
  padding: 1.15em 0.528em 0.649em 0;
}

.mjx-lop mjx-c.mjx-c230B {
  padding: 1.15em 0.528em 0.649em 0;
}

.mjx-s3 mjx-c.mjx-c7B::before {
  content: "{";
}

.mjx-s3 mjx-c.mjx-c7B {
  padding: 1.45em 0.75em 0.949em 0;
}

.mjx-s3 mjx-c.mjx-c2308 {
  padding: 1.45em 0.583em 0.949em 0;
}

.mjx-s3 mjx-c.mjx-c2309 {
  padding: 1.45em 0.583em 0.949em 0;
}

.mjx-s3 mjx-c.mjx-c230A {
  padding: 1.45em 0.583em 0.949em 0;
}

.mjx-s3 mjx-c.mjx-c230B {
  padding: 1.45em 0.583em 0.949em 0;
}
</style></head>
<body>
  
  <div class="post">
    <header class="post__header" data-cover="/image/FtjQZJYq8i7cRUwvcLX63Qqnvggz.jpg" style="background-image: url(&quot;/image/FtjQZJYq8i7cRUwvcLX63Qqnvggz.jpg&quot;);">
      <a href="/">
        HOME
      </a>
    </header>

    <div class="post__wrapper">
      <div class="post__main">
        <div class="post__body">
          <h1 class="post__title">
              消失的除法指令：Part1
          </h1>

          <div class="post__meta">
            <div class="tags">
              
                <span class="tag">gcc</span>
              
                <span class="tag">clang</span>
              
                <span class="tag">compiler</span>
              
                <span class="tag">assembly</span>
              
                <span class="tag">math</span>
              
            </div>

            <div class="date">
              2021.03.16
            </div>
          </div>

          <div class="post__content">
            <p>之前学汇编的时候观察到一个现象，我在 C 语言中写了一个函数进行除法操作，但是编译得到的汇编代码中却没有除法指令，取而代之的是一条乘法指令。</p>
<p><img src="/image/FjCkN1q9ePhijDTEBzws-jI0B7w1.png" alt="" /></p>
<p>图片对应的 GodBolt 地址在 <a href="https://gcc.godbolt.org/z/YrK4vnY1E" target="_blank">这里</a>，可以看到有一个 <code>imulq</code> 指令，这是一个乘法指令，乘了一个奇怪的数字 1431655766。</p>
<p>为什么编译器要这样操作？为什么能这样操作？1431655766 这个数字又是怎么来的？</p>
<h2 id="assembly-code">Assembly Code</h2>
<p>我们先来分析一下 GodBolt 中的汇编代码，注意这里使用的编译器是 GCC 10。</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2;" id="code-block-0"><code class="language-plain" data-lang="plain"><span style="display:flex;"><span>div3(int):
</span></span><span style="display:flex;"><span>  movslq  %edi, %rax
</span></span><span style="display:flex;"><span>  imulq   $1431655766, %rax, %rax
</span></span><span style="display:flex;"><span>  shrq    $32, %rax
</span></span><span style="display:flex;"><span>  sarl    $31, %edi
</span></span><span style="display:flex;"><span>  subl    %edi, %eax
</span></span><span style="display:flex;"><span>  ret
</span></span></code></pre><i class="iconfont icon-copy copy-code-btn" data-clipboard-target="#code-block-0"></i></div><p>一共 6 条指令，除去最后一条 <code>ret</code> 指令用于函数返回，总计 5 条指令解决了除以三运算。</p>
<div class="post__tip">
  <span class="post__tip__span">T</span>ip: 关于 X86/X64 的汇编，Intel 官方的手册 <a href="https://software.intel.com/content/www/us/en/develop/articles/intel-sdm.html" target="_blank">Intel® 64 and IA-32 Architectures Software Developer’s Manuals</a> 是居家旅行必备的。
</div>
<p>GCC 使用的是 AT&amp;T 汇编语法，基本特点是 source 在左边，target 在右边。</p>
<p>首先，<code>movslq %edi, %rax</code> 将 <code>edi</code> 寄存器中的值有符号扩展为 64bit 然后移动到 <code>rax</code> 寄存器中。</p>
<blockquote>
<p>MOVSLQ is move and sign-extend a value from a 32-bit source to a 64-bit destination.</p>
</blockquote>
<p>我们的函数接收 32-bit 的有符号整数作为第一个参数，可以看到背后的 ABI 规范是第一个参数存储在 edi 寄存器中。</p>
<div class="post__tip">
  <span class="post__tip__span">T</span>ip: <p>这里使用的 ABI 叫做 AMD64 ABI，我没有找到特别正式的资料，但是在 <a href="https://docs.oracle.com/cd/E19253-01/816-5138/fcowb/index.html" target="_blank">这个页面</a> 找到了传参的相关说明。</p>
<blockquote>
<p>The basic function calling convention is different for the AMD ABI. Arguments are placed in registers. For simple integer arguments, the first arguments are placed in the %rdi, %rsi, %rdx, %rcx, %r8, and %r9 registers, in that order.</p>
</blockquote>
</div>
<p>接下来的 <code>imulq $1431655766, %rax, %rax</code> 就比较简单了，将 <code>rax</code> 中的数字和 <code>1431655766</code> 乘在一起，结果存储在 <code>rax</code> 中。</p>
<p>我们知道 <code>rax</code> 存储的的数字是 <code>edi</code> 扩展来的，所以是 32-bit 范围内的有符号整数。<code>1431655766</code> 也是 32-bit 范围内的有符号整数，两个 32bit 的整数相乘，结果不会超过 64bit，所以这一步运算不会溢出。</p>
<p><code>shrq $32, %rax</code> 将 <code>rax</code> 寄存器中的值逻辑右移 32 位，也就是 <code>rax</code> 中的高 32 位到了低位，高位全部变成了 0。</p>
<p><code>sarl $31, %edi</code> 这里的 <code>a</code> 是 arithmetic 算术的意思，所以这是是将 <code>edi</code> 寄存器算术右移 31 位，也就是此时最高位到了最低位，根据 edi 中数字的正负，结果的二进制要么是全 0 要么是全 1，也就是十进制的 0 和 -1。</p>
<p>最后 <code>subl %edi, %eax</code> 将 <code>eax - edi</code> 的值赋给 <code>eax</code>，<code>edi</code> 要么是 0（如果参数 &gt;= 0），要么是 -1（如果参数 &lt; 0）。</p>
<p>所以，我们可以总结一下这里的算法，当我们对一个 32bit 有符号整数 N 除以 3 时，可以等价于</p>
<ul>
<li>R = N * 1431655766 的高 32 位</li>
<li>如果 N &lt; 0，那么 R = R + 1</li>
<li>返回 R</li>
</ul>
<h2 id="validate">Validate</h2>
<p>我们先抛开数学证明，写个程序验证一下上面的算法确实是正确的。</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2;" id="code-block-1"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#999;font-weight:bold;font-style:italic">#include</span> <span style="color:#999;font-weight:bold;font-style:italic">&lt;stdint.h&gt;</span><span style="color:#999;font-weight:bold;font-style:italic">
</span></span></span><span style="display:flex;"><span><span style="color:#999;font-weight:bold;font-style:italic">#include</span> <span style="color:#999;font-weight:bold;font-style:italic">&lt;stdio.h&gt;</span><span style="color:#999;font-weight:bold;font-style:italic">
</span></span></span><span style="display:flex;"><span><span style="color:#999;font-weight:bold;font-style:italic">#include</span> <span style="color:#999;font-weight:bold;font-style:italic">&lt;stdlib.h&gt;</span><span style="color:#999;font-weight:bold;font-style:italic">
</span></span></span><span style="display:flex;"><span><span style="color:#999;font-weight:bold;font-style:italic"></span>
</span></span><span style="display:flex;"><span><span style="color:#999;font-weight:bold;font-style:italic">#define i32 int32_t
</span></span></span><span style="display:flex;"><span><span style="color:#999;font-weight:bold;font-style:italic">#define i64 int64_t
</span></span></span><span style="display:flex;"><span><span style="color:#999;font-weight:bold;font-style:italic"></span>
</span></span><span style="display:flex;"><span>i32
</span></span><span style="display:flex;"><span><span style="color:#900;font-weight:bold">div3</span>(i32 v)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  i32 magic <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">1431655766</span>;
</span></span><span style="display:flex;"><span>  i32 result <span style="color:#000;font-weight:bold">=</span> ((i64)v <span style="color:#000;font-weight:bold">*</span> (i64)magic) <span style="color:#000;font-weight:bold">&gt;&gt;</span> <span style="color:#099">32</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#000;font-weight:bold">if</span>(v <span style="color:#000;font-weight:bold">&lt;</span> <span style="color:#099">0</span>) {
</span></span><span style="display:flex;"><span>    result <span style="color:#000;font-weight:bold">+=</span> <span style="color:#099">1</span>;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#000;font-weight:bold">return</span> result;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#458;font-weight:bold">int</span>
</span></span><span style="display:flex;"><span><span style="color:#900;font-weight:bold">main</span>(<span style="color:#458;font-weight:bold">void</span>)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  srand(<span style="color:#099">0x1234</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#000;font-weight:bold">for</span>(<span style="color:#458;font-weight:bold">int</span> i <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">0</span>; i <span style="color:#000;font-weight:bold">&lt;</span> <span style="color:#099">10000</span>; i<span style="color:#000;font-weight:bold">++</span>) {
</span></span><span style="display:flex;"><span>    i32 v <span style="color:#000;font-weight:bold">=</span> (i32)rand() <span style="color:#000;font-weight:bold">*</span> (rand() <span style="color:#000;font-weight:bold">%</span> <span style="color:#099">2</span> <span style="color:#000;font-weight:bold">==</span> <span style="color:#099">0</span> <span style="color:#000;font-weight:bold">?</span> <span style="color:#099">1</span> <span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">-</span><span style="color:#099">1</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    i32 got <span style="color:#000;font-weight:bold">=</span> div3(v);
</span></span><span style="display:flex;"><span>    i32 expected <span style="color:#000;font-weight:bold">=</span> v <span style="color:#000;font-weight:bold">/</span> <span style="color:#099">3</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">if</span>(got <span style="color:#000;font-weight:bold">!=</span> expected) {
</span></span><span style="display:flex;"><span>      printf(<span style="color:#d14">"div3 error! dividend %d, got %d, expected %d</span><span style="color:#d14">\n</span><span style="color:#d14">"</span>,
</span></span><span style="display:flex;"><span>        v,
</span></span><span style="display:flex;"><span>        got,
</span></span><span style="display:flex;"><span>        expected);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre><i class="iconfont icon-copy copy-code-btn" data-clipboard-target="#code-block-1"></i></div><p>这里我们使用 10000 个随机数进行验证，会发现程序运行正常，没有报错。</p>
<h2 id="proof">Proof</h2>
<p>接下来我们在数学上进行证明。</p>
<p>我们先来理清 <em>除法</em> 这个运算。</p>
<p>在数学中，整数除法得到的是一个有理数。</p>
<p>但是在计算机中，整数除法运算返回的结果是整数，这里面实际上可以有三种模式。</p>
<ul>
<li>
<p>truncating，运算结果始终向 0 截断</p>
</li>
<li>
<p>floor，运算结果始终向下截断</p>
</li>
<li>
<p>modulus，余数始终为非负</p>
</li>
</ul>
<p><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" display="true" tabindex="0" ctxtmenu_counter="0" style="font-size: 148.2%;"><mjx-math display="true" class="MJX-TEX"><mjx-mtable style="min-width: 24.748em;"><mjx-table><mjx-itable><mjx-mtr><mjx-mtd style="text-align: right; padding-right: 0px; padding-bottom: 0.101em;"><mjx-tstrut></mjx-tstrut></mjx-mtd><mjx-mtd style="text-align: left; padding-left: 0px; padding-right: 1em; padding-bottom: 0.101em;"><mjx-tstrut></mjx-tstrut></mjx-mtd><mjx-mtd style="text-align: right; padding-left: 1em; padding-right: 0px; padding-bottom: 0.101em;"><mjx-tstrut></mjx-tstrut></mjx-mtd><mjx-mtd style="text-align: left; padding-left: 0px; padding-right: 1em; padding-bottom: 0.101em;"><mjx-mi class="mjx-i"><mjx-c class="mjx-c74"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c72"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c75"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c6E"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c63"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c61"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c74"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c69"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c6E"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c67"></mjx-c></mjx-mi><mjx-tstrut></mjx-tstrut></mjx-mtd><mjx-mtd style="text-align: right; padding-left: 1em; padding-right: 0px; padding-bottom: 0.101em;"><mjx-tstrut></mjx-tstrut></mjx-mtd><mjx-mtd style="text-align: left; padding-left: 0px; padding-right: 1em; padding-bottom: 0.101em;"><mjx-mi class="mjx-i"><mjx-c class="mjx-c6D"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c6F"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c64"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c75"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c6C"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c75"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c73"></mjx-c></mjx-mi><mjx-tstrut></mjx-tstrut></mjx-mtd><mjx-mtd style="text-align: right; padding-left: 1em; padding-right: 0px; padding-bottom: 0.101em;"><mjx-tstrut></mjx-tstrut></mjx-mtd><mjx-mtd style="text-align: left; padding-left: 0px; padding-bottom: 0.101em;"><mjx-mi class="mjx-i"><mjx-c class="mjx-c66"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c6C"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c6F"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c6F"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c72"></mjx-c></mjx-mi><mjx-tstrut></mjx-tstrut></mjx-mtd></mjx-mtr><mjx-mtr><mjx-mtd style="text-align: right; padding-right: 0px; padding-top: 0.101em; padding-bottom: 0.101em;"><mjx-mn class="mjx-n"><mjx-c class="mjx-c37"></mjx-c></mjx-mn><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-cF7"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="3"><mjx-c class="mjx-c33"></mjx-c></mjx-mn><mjx-tstrut></mjx-tstrut></mjx-mtd><mjx-mtd style="text-align: left; padding: 0.101em 1em 0.101em 0px;"><mjx-mi class="mjx-n"></mjx-mi><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-tstrut></mjx-tstrut></mjx-mtd><mjx-mtd style="text-align: right; padding: 0.101em 0px 0.101em 1em;"><mjx-tstrut></mjx-tstrut></mjx-mtd><mjx-mtd style="text-align: left; padding: 0.101em 1em 0.101em 0px;"><mjx-mtext class="mjx-n"><mjx-c class="mjx-c32"></mjx-c><mjx-c class="mjx-c20"></mjx-c><mjx-c class="mjx-c72"></mjx-c><mjx-c class="mjx-c65"></mjx-c><mjx-c class="mjx-c6D"></mjx-c><mjx-c class="mjx-c20"></mjx-c><mjx-c class="mjx-c31"></mjx-c></mjx-mtext><mjx-tstrut></mjx-tstrut></mjx-mtd><mjx-mtd style="text-align: right; padding: 0.101em 0px 0.101em 1em;"><mjx-tstrut></mjx-tstrut></mjx-mtd><mjx-mtd style="text-align: left; padding: 0.101em 1em 0.101em 0px;"><mjx-mtext class="mjx-n"><mjx-c class="mjx-c32"></mjx-c><mjx-c class="mjx-c20"></mjx-c><mjx-c class="mjx-c72"></mjx-c><mjx-c class="mjx-c65"></mjx-c><mjx-c class="mjx-c6D"></mjx-c><mjx-c class="mjx-c20"></mjx-c><mjx-c class="mjx-c31"></mjx-c></mjx-mtext><mjx-tstrut></mjx-tstrut></mjx-mtd><mjx-mtd style="text-align: right; padding: 0.101em 0px 0.101em 1em;"><mjx-tstrut></mjx-tstrut></mjx-mtd><mjx-mtd style="text-align: left; padding-left: 0px; padding-top: 0.101em; padding-bottom: 0.101em;"><mjx-mtext class="mjx-n"><mjx-c class="mjx-c32"></mjx-c><mjx-c class="mjx-c20"></mjx-c><mjx-c class="mjx-c72"></mjx-c><mjx-c class="mjx-c65"></mjx-c><mjx-c class="mjx-c6D"></mjx-c><mjx-c class="mjx-c20"></mjx-c><mjx-c class="mjx-c31"></mjx-c></mjx-mtext><mjx-tstrut></mjx-tstrut></mjx-mtd></mjx-mtr><mjx-mtr><mjx-mtd style="text-align: right; padding-right: 0px; padding-top: 0.101em; padding-bottom: 0.101em;"><mjx-mo class="mjx-n"><mjx-c class="mjx-c28"></mjx-c></mjx-mo><mjx-mo class="mjx-n"><mjx-c class="mjx-c2212"></mjx-c></mjx-mo><mjx-mn class="mjx-n"><mjx-c class="mjx-c37"></mjx-c></mjx-mn><mjx-mo class="mjx-n"><mjx-c class="mjx-c29"></mjx-c></mjx-mo><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-cF7"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="3"><mjx-c class="mjx-c33"></mjx-c></mjx-mn><mjx-tstrut></mjx-tstrut></mjx-mtd><mjx-mtd style="text-align: left; padding: 0.101em 1em 0.101em 0px;"><mjx-mi class="mjx-n"></mjx-mi><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-tstrut></mjx-tstrut></mjx-mtd><mjx-mtd style="text-align: right; padding: 0.101em 0px 0.101em 1em;"><mjx-tstrut></mjx-tstrut></mjx-mtd><mjx-mtd style="text-align: left; padding: 0.101em 1em 0.101em 0px;"><mjx-mtext class="mjx-n"><mjx-c class="mjx-c2D"></mjx-c><mjx-c class="mjx-c32"></mjx-c><mjx-c class="mjx-c20"></mjx-c><mjx-c class="mjx-c72"></mjx-c><mjx-c class="mjx-c65"></mjx-c><mjx-c class="mjx-c6D"></mjx-c><mjx-c class="mjx-c20"></mjx-c><mjx-c class="mjx-c2D"></mjx-c><mjx-c class="mjx-c31"></mjx-c></mjx-mtext><mjx-tstrut></mjx-tstrut></mjx-mtd><mjx-mtd style="text-align: right; padding: 0.101em 0px 0.101em 1em;"><mjx-tstrut></mjx-tstrut></mjx-mtd><mjx-mtd style="text-align: left; padding: 0.101em 1em 0.101em 0px;"><mjx-mtext class="mjx-n"><mjx-c class="mjx-c2D"></mjx-c><mjx-c class="mjx-c33"></mjx-c><mjx-c class="mjx-c20"></mjx-c><mjx-c class="mjx-c72"></mjx-c><mjx-c class="mjx-c65"></mjx-c><mjx-c class="mjx-c6D"></mjx-c><mjx-c class="mjx-c20"></mjx-c><mjx-c class="mjx-c32"></mjx-c></mjx-mtext><mjx-tstrut></mjx-tstrut></mjx-mtd><mjx-mtd style="text-align: right; padding: 0.101em 0px 0.101em 1em;"><mjx-tstrut></mjx-tstrut></mjx-mtd><mjx-mtd style="text-align: left; padding-left: 0px; padding-top: 0.101em; padding-bottom: 0.101em;"><mjx-mtext class="mjx-n"><mjx-c class="mjx-c2D"></mjx-c><mjx-c class="mjx-c33"></mjx-c><mjx-c class="mjx-c20"></mjx-c><mjx-c class="mjx-c72"></mjx-c><mjx-c class="mjx-c65"></mjx-c><mjx-c class="mjx-c6D"></mjx-c><mjx-c class="mjx-c20"></mjx-c><mjx-c class="mjx-c32"></mjx-c></mjx-mtext><mjx-tstrut></mjx-tstrut></mjx-mtd></mjx-mtr><mjx-mtr><mjx-mtd style="text-align: right; padding-right: 0px; padding-top: 0.101em; padding-bottom: 0.101em;"><mjx-mn class="mjx-n"><mjx-c class="mjx-c37"></mjx-c></mjx-mn><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-cF7"></mjx-c></mjx-mo><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c28"></mjx-c></mjx-mo><mjx-mo class="mjx-n"><mjx-c class="mjx-c2212"></mjx-c></mjx-mo><mjx-mn class="mjx-n"><mjx-c class="mjx-c33"></mjx-c></mjx-mn><mjx-mo class="mjx-n"><mjx-c class="mjx-c29"></mjx-c></mjx-mo><mjx-tstrut></mjx-tstrut></mjx-mtd><mjx-mtd style="text-align: left; padding: 0.101em 1em 0.101em 0px;"><mjx-mi class="mjx-n"></mjx-mi><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-tstrut></mjx-tstrut></mjx-mtd><mjx-mtd style="text-align: right; padding: 0.101em 0px 0.101em 1em;"><mjx-tstrut></mjx-tstrut></mjx-mtd><mjx-mtd style="text-align: left; padding: 0.101em 1em 0.101em 0px;"><mjx-mtext class="mjx-n"><mjx-c class="mjx-c2D"></mjx-c><mjx-c class="mjx-c32"></mjx-c><mjx-c class="mjx-c20"></mjx-c><mjx-c class="mjx-c72"></mjx-c><mjx-c class="mjx-c65"></mjx-c><mjx-c class="mjx-c6D"></mjx-c><mjx-c class="mjx-c20"></mjx-c><mjx-c class="mjx-c31"></mjx-c></mjx-mtext><mjx-tstrut></mjx-tstrut></mjx-mtd><mjx-mtd style="text-align: right; padding: 0.101em 0px 0.101em 1em;"><mjx-tstrut></mjx-tstrut></mjx-mtd><mjx-mtd style="text-align: left; padding: 0.101em 1em 0.101em 0px;"><mjx-mtext class="mjx-n"><mjx-c class="mjx-c2D"></mjx-c><mjx-c class="mjx-c32"></mjx-c><mjx-c class="mjx-c20"></mjx-c><mjx-c class="mjx-c72"></mjx-c><mjx-c class="mjx-c65"></mjx-c><mjx-c class="mjx-c6D"></mjx-c><mjx-c class="mjx-c20"></mjx-c><mjx-c class="mjx-c31"></mjx-c></mjx-mtext><mjx-tstrut></mjx-tstrut></mjx-mtd><mjx-mtd style="text-align: right; padding: 0.101em 0px 0.101em 1em;"><mjx-tstrut></mjx-tstrut></mjx-mtd><mjx-mtd style="text-align: left; padding-left: 0px; padding-top: 0.101em; padding-bottom: 0.101em;"><mjx-mtext class="mjx-n"><mjx-c class="mjx-c2D"></mjx-c><mjx-c class="mjx-c33"></mjx-c><mjx-c class="mjx-c20"></mjx-c><mjx-c class="mjx-c72"></mjx-c><mjx-c class="mjx-c65"></mjx-c><mjx-c class="mjx-c6D"></mjx-c><mjx-c class="mjx-c20"></mjx-c><mjx-c class="mjx-c2D"></mjx-c><mjx-c class="mjx-c32"></mjx-c></mjx-mtext><mjx-tstrut></mjx-tstrut></mjx-mtd></mjx-mtr><mjx-mtr><mjx-mtd style="text-align: right; padding-right: 0px; padding-top: 0.101em;"><mjx-mo class="mjx-n"><mjx-c class="mjx-c28"></mjx-c></mjx-mo><mjx-mo class="mjx-n"><mjx-c class="mjx-c2212"></mjx-c></mjx-mo><mjx-mn class="mjx-n"><mjx-c class="mjx-c37"></mjx-c></mjx-mn><mjx-mo class="mjx-n"><mjx-c class="mjx-c29"></mjx-c></mjx-mo><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-cF7"></mjx-c></mjx-mo><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c28"></mjx-c></mjx-mo><mjx-mo class="mjx-n"><mjx-c class="mjx-c2212"></mjx-c></mjx-mo><mjx-mn class="mjx-n"><mjx-c class="mjx-c33"></mjx-c></mjx-mn><mjx-mo class="mjx-n"><mjx-c class="mjx-c29"></mjx-c></mjx-mo><mjx-tstrut></mjx-tstrut></mjx-mtd><mjx-mtd style="text-align: left; padding-left: 0px; padding-right: 1em; padding-top: 0.101em;"><mjx-mi class="mjx-n"></mjx-mi><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-tstrut></mjx-tstrut></mjx-mtd><mjx-mtd style="text-align: right; padding-left: 1em; padding-right: 0px; padding-top: 0.101em;"><mjx-tstrut></mjx-tstrut></mjx-mtd><mjx-mtd style="text-align: left; padding-left: 0px; padding-right: 1em; padding-top: 0.101em;"><mjx-mtext class="mjx-n"><mjx-c class="mjx-c32"></mjx-c><mjx-c class="mjx-c20"></mjx-c><mjx-c class="mjx-c72"></mjx-c><mjx-c class="mjx-c65"></mjx-c><mjx-c class="mjx-c6D"></mjx-c><mjx-c class="mjx-c20"></mjx-c><mjx-c class="mjx-c2D"></mjx-c><mjx-c class="mjx-c31"></mjx-c></mjx-mtext><mjx-tstrut></mjx-tstrut></mjx-mtd><mjx-mtd style="text-align: right; padding-left: 1em; padding-right: 0px; padding-top: 0.101em;"><mjx-tstrut></mjx-tstrut></mjx-mtd><mjx-mtd style="text-align: left; padding-left: 0px; padding-right: 1em; padding-top: 0.101em;"><mjx-mtext class="mjx-n"><mjx-c class="mjx-c33"></mjx-c><mjx-c class="mjx-c20"></mjx-c><mjx-c class="mjx-c72"></mjx-c><mjx-c class="mjx-c65"></mjx-c><mjx-c class="mjx-c6D"></mjx-c><mjx-c class="mjx-c20"></mjx-c><mjx-c class="mjx-c32"></mjx-c></mjx-mtext><mjx-tstrut></mjx-tstrut></mjx-mtd><mjx-mtd style="text-align: right; padding-left: 1em; padding-right: 0px; padding-top: 0.101em;"><mjx-tstrut></mjx-tstrut></mjx-mtd><mjx-mtd style="text-align: left; padding-left: 0px; padding-top: 0.101em;"><mjx-mtext class="mjx-n"><mjx-c class="mjx-c32"></mjx-c><mjx-c class="mjx-c20"></mjx-c><mjx-c class="mjx-c72"></mjx-c><mjx-c class="mjx-c65"></mjx-c><mjx-c class="mjx-c6D"></mjx-c><mjx-c class="mjx-c20"></mjx-c><mjx-c class="mjx-c2D"></mjx-c><mjx-c class="mjx-c31"></mjx-c></mjx-mtext><mjx-tstrut></mjx-tstrut></mjx-mtd></mjx-mtr></mjx-itable></mjx-table></mjx-mtable></mjx-math></mjx-container></p>
<p>不管是哪种模式，对于计算机中的除法运算，被除数一定等于商乘以除数加上余数。</p>
<p><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" display="true" tabindex="0" ctxtmenu_counter="1" style="font-size: 148.2%;"><mjx-math display="true" class="MJX-TEX"><mjx-mi class="mjx-i"><mjx-c class="mjx-c64"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c69"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c76"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c69"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c64"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c65"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c6E"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c64"></mjx-c></mjx-mi><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-mi class="mjx-i" space="4"><mjx-c class="mjx-c71"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c75"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c6F"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c74"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c69"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c65"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c6E"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c74"></mjx-c></mjx-mi><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2217"></mjx-c></mjx-mo><mjx-mi class="mjx-i" space="3"><mjx-c class="mjx-c64"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c69"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c76"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c69"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c73"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c6F"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c72"></mjx-c></mjx-mi><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2B"></mjx-c></mjx-mo><mjx-mi class="mjx-i" space="3"><mjx-c class="mjx-c72"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c65"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c6D"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c61"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c69"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c6E"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c64"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c65"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c72"></mjx-c></mjx-mi></mjx-math></mjx-container></p>
<p>这三种模式不存在对错，只是不同的选择，大部分的程序语言和指令集选择的都是 truncating 模式，C 语言也不例外。</p>
<p>所以，计算机中的除法（truncating 模式）和数学中的除法之间的关系可以表达为</p>
<p><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" display="true" tabindex="0" ctxtmenu_counter="2" style="font-size: 148.2%;"><mjx-math display="true" class="MJX-TEX"><mjx-mi class="mjx-i"><mjx-c class="mjx-c6E"></mjx-c></mjx-mi><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-cF7"></mjx-c></mjx-mo><mjx-mi class="mjx-i" space="3"><mjx-c class="mjx-c64"></mjx-c></mjx-mi><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-mrow space="4"><mjx-mo class="mjx-s3"><mjx-c class="mjx-c7B"></mjx-c></mjx-mo><mjx-mtable style="min-width: 10.655em;"><mjx-table><mjx-itable><mjx-mtr><mjx-mtd style="text-align: left; padding-right: 0.5em; padding-bottom: 0.1em;"><mjx-mrow><mjx-mo class="mjx-n"><mjx-c class="mjx-c230A"></mjx-c></mjx-mo><mjx-texatom><mjx-mi class="mjx-i"><mjx-c class="mjx-c6E"></mjx-c></mjx-mi><mjx-texatom><mjx-mo class="mjx-n"><mjx-c class="mjx-c2F"></mjx-c></mjx-mo></mjx-texatom><mjx-mi class="mjx-i"><mjx-c class="mjx-c64"></mjx-c></mjx-mi></mjx-texatom><mjx-mo class="mjx-n"><mjx-c class="mjx-c230B"></mjx-c></mjx-mo></mjx-mrow><mjx-tstrut></mjx-tstrut></mjx-mtd><mjx-mtd style="text-align: left; padding-left: 0.5em; padding-bottom: 0.1em;"><mjx-mi class="mjx-i"><mjx-c class="mjx-c69"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c66"></mjx-c></mjx-mi><mjx-mstyle><mjx-mspace style="width: 0.5em;"></mjx-mspace></mjx-mstyle><mjx-mi class="mjx-i"><mjx-c class="mjx-c64"></mjx-c></mjx-mi><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c2260"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="4"><mjx-c class="mjx-c30"></mjx-c></mjx-mn><mjx-mo class="mjx-n"><mjx-c class="mjx-c2C"></mjx-c></mjx-mo><mjx-mi class="mjx-i" space="2"><mjx-c class="mjx-c6E"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c64"></mjx-c></mjx-mi><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c2265"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="4"><mjx-c class="mjx-c30"></mjx-c></mjx-mn><mjx-tstrut></mjx-tstrut></mjx-mtd></mjx-mtr><mjx-mtr><mjx-mtd style="text-align: left; padding-right: 0.5em; padding-top: 0.1em;"><mjx-mrow><mjx-mo class="mjx-n"><mjx-c class="mjx-c2308"></mjx-c></mjx-mo><mjx-texatom><mjx-mi class="mjx-i"><mjx-c class="mjx-c6E"></mjx-c></mjx-mi><mjx-texatom><mjx-mo class="mjx-n"><mjx-c class="mjx-c2F"></mjx-c></mjx-mo></mjx-texatom><mjx-mi class="mjx-i"><mjx-c class="mjx-c64"></mjx-c></mjx-mi></mjx-texatom><mjx-mo class="mjx-n"><mjx-c class="mjx-c2309"></mjx-c></mjx-mo></mjx-mrow><mjx-tstrut></mjx-tstrut></mjx-mtd><mjx-mtd style="text-align: left; padding-left: 0.5em; padding-top: 0.1em;"><mjx-mi class="mjx-i"><mjx-c class="mjx-c69"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c66"></mjx-c></mjx-mi><mjx-mstyle><mjx-mspace style="width: 0.5em;"></mjx-mspace></mjx-mstyle><mjx-mi class="mjx-i"><mjx-c class="mjx-c64"></mjx-c></mjx-mi><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c2260"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="4"><mjx-c class="mjx-c30"></mjx-c></mjx-mn><mjx-mo class="mjx-n"><mjx-c class="mjx-c2C"></mjx-c></mjx-mo><mjx-mi class="mjx-i" space="2"><mjx-c class="mjx-c6E"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c64"></mjx-c></mjx-mi><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3C"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="4"><mjx-c class="mjx-c30"></mjx-c></mjx-mn><mjx-tstrut></mjx-tstrut></mjx-mtd></mjx-mtr></mjx-itable></mjx-table></mjx-mtable><mjx-mo class="mjx-n"></mjx-mo></mjx-mrow></mjx-math></mjx-container></p>
<p>接下来我们从数学上证明，上述的乘法算法给出的是正确的除法结果。</p>
<p>首先，我们将 1431655766 这个 Magic Number 改写一下形式。</p>
<div class="post__tip">
  <span class="post__tip__span">T</span>ip: <p>关于 Magic Number（魔数），我印象最深的是 Quake III（雷神之锤三）中的 0X5F3759DF。</p>
<p>在一个求平方根倒数的函数中，John Carmack 使用了这个魔数使得计算效率比普通的 <code>1.0f / sqrt(x)</code> 快了 4 倍。</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2;" id="code-block-2"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#458;font-weight:bold">float</span>
</span></span><span style="display:flex;"><span><span style="color:#900;font-weight:bold">InvSqrt</span>(<span style="color:#458;font-weight:bold">float</span> x)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#458;font-weight:bold">float</span> xhalf <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">0.5f</span> <span style="color:#000;font-weight:bold">*</span> x;
</span></span><span style="display:flex;"><span>  <span style="color:#458;font-weight:bold">int</span> i <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">*</span>(<span style="color:#458;font-weight:bold">int</span> <span style="color:#000;font-weight:bold">*</span>)<span style="color:#000;font-weight:bold">&amp;</span>x;
</span></span><span style="display:flex;"><span>  i <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">0x5f3759df</span> <span style="color:#000;font-weight:bold">-</span> (i <span style="color:#000;font-weight:bold">&gt;&gt;</span> <span style="color:#099">1</span>); <span style="color:#998;font-style:italic">// what the fuck???
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>  x <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">*</span>(<span style="color:#458;font-weight:bold">float</span> <span style="color:#000;font-weight:bold">*</span>)<span style="color:#000;font-weight:bold">&amp;</span>i;
</span></span><span style="display:flex;"><span>  x <span style="color:#000;font-weight:bold">=</span> x <span style="color:#000;font-weight:bold">*</span> (<span style="color:#099">1.5f</span> <span style="color:#000;font-weight:bold">-</span> xhalf <span style="color:#000;font-weight:bold">*</span> x <span style="color:#000;font-weight:bold">*</span> x);
</span></span><span style="display:flex;"><span>  <span style="color:#000;font-weight:bold">return</span> x;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre><i class="iconfont icon-copy copy-code-btn" data-clipboard-target="#code-block-2"></i></div><p>关于约翰卡马克和 ID Software 的传奇故事，有一本书推荐给大家：<a href="https://book.douban.com/subject/1438119/" target="_blank">Master of Doom</a>。</p>
</div>
<p><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" display="true" tabindex="0" ctxtmenu_counter="3" style="font-size: 148.2%;"><mjx-math display="true" class="MJX-TEX"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c34"></mjx-c><mjx-c class="mjx-c33"></mjx-c><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c36"></mjx-c><mjx-c class="mjx-c35"></mjx-c><mjx-c class="mjx-c35"></mjx-c><mjx-c class="mjx-c37"></mjx-c><mjx-c class="mjx-c36"></mjx-c><mjx-c class="mjx-c36"></mjx-c></mjx-mn><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-mfrac space="4"><mjx-frac type="d"><mjx-num><mjx-nstrut type="d"></mjx-nstrut><mjx-mrow><mjx-msup><mjx-mn class="mjx-n"><mjx-c class="mjx-c32"></mjx-c></mjx-mn><mjx-script style="vertical-align: 0.363em;"><mjx-texatom size="s"><mjx-mn class="mjx-n"><mjx-c class="mjx-c33"></mjx-c><mjx-c class="mjx-c32"></mjx-c></mjx-mn></mjx-texatom></mjx-script></mjx-msup><mjx-mo class="mjx-n"><mjx-c class="mjx-c2B"></mjx-c></mjx-mo><mjx-mn class="mjx-n"><mjx-c class="mjx-c32"></mjx-c></mjx-mn></mjx-mrow></mjx-num><mjx-dbox><mjx-dtable><mjx-line type="d"></mjx-line><mjx-row><mjx-den><mjx-dstrut type="d"></mjx-dstrut><mjx-mn class="mjx-n"><mjx-c class="mjx-c33"></mjx-c></mjx-mn></mjx-den></mjx-row></mjx-dtable></mjx-dbox></mjx-frac></mjx-mfrac></mjx-math></mjx-container></p>
<p>对于 n &gt;= 0，上述运算可以表示为</p>
<p><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" display="true" tabindex="0" ctxtmenu_counter="4" style="font-size: 148.2%;"><mjx-math display="true" class="MJX-TEX"><mjx-mi class="mjx-i"><mjx-c class="mjx-c71"></mjx-c></mjx-mi><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-mrow space="4"><mjx-mo class="mjx-s3"><mjx-c class="mjx-c230A"></mjx-c></mjx-mo><mjx-mfrac><mjx-frac type="d"><mjx-num><mjx-nstrut type="d"></mjx-nstrut><mjx-mrow><mjx-msup><mjx-mn class="mjx-n"><mjx-c class="mjx-c32"></mjx-c></mjx-mn><mjx-script style="vertical-align: 0.363em;"><mjx-texatom size="s"><mjx-mn class="mjx-n"><mjx-c class="mjx-c33"></mjx-c><mjx-c class="mjx-c32"></mjx-c></mjx-mn></mjx-texatom></mjx-script></mjx-msup><mjx-mo class="mjx-n"><mjx-c class="mjx-c2B"></mjx-c></mjx-mo><mjx-mn class="mjx-n"><mjx-c class="mjx-c32"></mjx-c></mjx-mn></mjx-mrow></mjx-num><mjx-dbox><mjx-dtable><mjx-line type="d"></mjx-line><mjx-row><mjx-den><mjx-dstrut type="d"></mjx-dstrut><mjx-mn class="mjx-n"><mjx-c class="mjx-c33"></mjx-c></mjx-mn></mjx-den></mjx-row></mjx-dtable></mjx-dbox></mjx-frac></mjx-mfrac><mjx-mfrac><mjx-frac type="d"><mjx-num><mjx-nstrut type="d"></mjx-nstrut><mjx-mi class="mjx-i"><mjx-c class="mjx-c6E"></mjx-c></mjx-mi></mjx-num><mjx-dbox><mjx-dtable><mjx-line type="d"></mjx-line><mjx-row><mjx-den><mjx-dstrut type="d"></mjx-dstrut><mjx-msup><mjx-mn class="mjx-n"><mjx-c class="mjx-c32"></mjx-c></mjx-mn><mjx-script style="vertical-align: 0.363em;"><mjx-texatom size="s"><mjx-mn class="mjx-n"><mjx-c class="mjx-c33"></mjx-c><mjx-c class="mjx-c32"></mjx-c></mjx-mn></mjx-texatom></mjx-script></mjx-msup></mjx-den></mjx-row></mjx-dtable></mjx-dbox></mjx-frac></mjx-mfrac><mjx-mo class="mjx-s3"><mjx-c class="mjx-c230B"></mjx-c></mjx-mo></mjx-mrow></mjx-math></mjx-container></p>
<p>这里我们使用了一个事实：<strong>对有符号整数 n 右移 x 位，相当于 对 n/(2^x) 进行 floor 操作</strong>。</p>
<p>例如，5 右移 1 位得到 2，是 (5/2 = 2.5) floor 的结果。</p>
<p>-5 右移 1 位得到 -3，是 (-5/2 = -2.5) floor 的结果。</p>
<p>所以，我们现在要做的就是证明如下数学等式成立</p>
<p><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" display="true" tabindex="0" ctxtmenu_counter="5" style="font-size: 148.2%;"><mjx-math display="true" class="MJX-TEX"><mjx-mrow><mjx-mo class="mjx-s3"><mjx-c class="mjx-c230A"></mjx-c></mjx-mo><mjx-mfrac><mjx-frac type="d"><mjx-num><mjx-nstrut type="d"></mjx-nstrut><mjx-mrow><mjx-msup><mjx-mn class="mjx-n"><mjx-c class="mjx-c32"></mjx-c></mjx-mn><mjx-script style="vertical-align: 0.363em;"><mjx-texatom size="s"><mjx-mn class="mjx-n"><mjx-c class="mjx-c33"></mjx-c><mjx-c class="mjx-c32"></mjx-c></mjx-mn></mjx-texatom></mjx-script></mjx-msup><mjx-mo class="mjx-n"><mjx-c class="mjx-c2B"></mjx-c></mjx-mo><mjx-mn class="mjx-n"><mjx-c class="mjx-c32"></mjx-c></mjx-mn></mjx-mrow></mjx-num><mjx-dbox><mjx-dtable><mjx-line type="d"></mjx-line><mjx-row><mjx-den><mjx-dstrut type="d"></mjx-dstrut><mjx-mn class="mjx-n"><mjx-c class="mjx-c33"></mjx-c></mjx-mn></mjx-den></mjx-row></mjx-dtable></mjx-dbox></mjx-frac></mjx-mfrac><mjx-mfrac><mjx-frac type="d"><mjx-num><mjx-nstrut type="d"></mjx-nstrut><mjx-mi class="mjx-i"><mjx-c class="mjx-c6E"></mjx-c></mjx-mi></mjx-num><mjx-dbox><mjx-dtable><mjx-line type="d"></mjx-line><mjx-row><mjx-den><mjx-dstrut type="d"></mjx-dstrut><mjx-msup><mjx-mn class="mjx-n"><mjx-c class="mjx-c32"></mjx-c></mjx-mn><mjx-script style="vertical-align: 0.363em;"><mjx-texatom size="s"><mjx-mn class="mjx-n"><mjx-c class="mjx-c33"></mjx-c><mjx-c class="mjx-c32"></mjx-c></mjx-mn></mjx-texatom></mjx-script></mjx-msup></mjx-den></mjx-row></mjx-dtable></mjx-dbox></mjx-frac></mjx-mfrac><mjx-mo class="mjx-s3"><mjx-c class="mjx-c230B"></mjx-c></mjx-mo></mjx-mrow><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-mrow space="4"><mjx-mo class="mjx-n"><mjx-c class="mjx-c230A"></mjx-c></mjx-mo><mjx-texatom><mjx-mi class="mjx-i"><mjx-c class="mjx-c6E"></mjx-c></mjx-mi><mjx-texatom><mjx-mo class="mjx-n"><mjx-c class="mjx-c2F"></mjx-c></mjx-mo></mjx-texatom><mjx-mn class="mjx-n"><mjx-c class="mjx-c33"></mjx-c></mjx-mn></mjx-texatom><mjx-mo class="mjx-n"><mjx-c class="mjx-c230B"></mjx-c></mjx-mo></mjx-mrow><mjx-mstyle><mjx-mspace style="width: 1em;"></mjx-mspace></mjx-mstyle><mjx-mstyle size="sm"><mjx-texatom><mjx-mn class="mjx-n"><mjx-c class="mjx-c30"></mjx-c></mjx-mn><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c2264"></mjx-c></mjx-mo><mjx-mi class="mjx-i" space="4"><mjx-c class="mjx-c6E"></mjx-c></mjx-mi><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3C"></mjx-c></mjx-mo><mjx-msup><mjx-mn class="mjx-n"><mjx-c class="mjx-c32"></mjx-c></mjx-mn><mjx-script style="vertical-align: 0.413em;"><mjx-texatom size="s"><mjx-mn class="mjx-n"><mjx-c class="mjx-c33"></mjx-c><mjx-c class="mjx-c31"></mjx-c></mjx-mn></mjx-texatom></mjx-script></mjx-msup></mjx-texatom></mjx-mstyle></mjx-math></mjx-container></p>
<p>我们首先来引入几个定理供后面使用。</p>
<p>THEOREM D0.</p>
<p><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" display="true" tabindex="0" ctxtmenu_counter="6" style="font-size: 148.2%;"><mjx-math display="true" class="MJX-TEX"><mjx-mtext class="mjx-n"><mjx-c class="mjx-c66"></mjx-c><mjx-c class="mjx-c6F"></mjx-c><mjx-c class="mjx-c72"></mjx-c><mjx-c class="mjx-c20"></mjx-c><mjx-c class="mjx-c78"></mjx-c><mjx-c class="mjx-c20"></mjx-c><mjx-c class="mjx-c72"></mjx-c><mjx-c class="mjx-c65"></mjx-c><mjx-c class="mjx-c61"></mjx-c><mjx-c class="mjx-c6C"></mjx-c><mjx-c class="mjx-c2C"></mjx-c></mjx-mtext><mjx-mrow><mjx-mo class="mjx-n"><mjx-c class="mjx-c230A"></mjx-c></mjx-mo><mjx-texatom><mjx-mi class="mjx-i"><mjx-c class="mjx-c78"></mjx-c></mjx-mi></mjx-texatom><mjx-mo class="mjx-n"><mjx-c class="mjx-c230B"></mjx-c></mjx-mo></mjx-mrow><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2B"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="3"><mjx-c class="mjx-c31"></mjx-c></mjx-mn><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-mrow space="4"><mjx-mo class="mjx-n"><mjx-c class="mjx-c230A"></mjx-c></mjx-mo><mjx-texatom><mjx-mi class="mjx-i"><mjx-c class="mjx-c78"></mjx-c></mjx-mi><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2B"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="3"><mjx-c class="mjx-c31"></mjx-c></mjx-mn></mjx-texatom><mjx-mo class="mjx-n"><mjx-c class="mjx-c230B"></mjx-c></mjx-mo></mjx-mrow></mjx-math></mjx-container></p>
<p>THEOREM D1.</p>
<p><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" display="true" tabindex="0" ctxtmenu_counter="7" style="font-size: 148.2%;"><mjx-math display="true" class="MJX-TEX"><mjx-mtable style="min-width: 9.875em;"><mjx-table><mjx-itable><mjx-mtr><mjx-mtd style="text-align: right; padding-bottom: 0.101em;"><mjx-mtext class="mjx-n"><mjx-c class="mjx-c66"></mjx-c><mjx-c class="mjx-c6F"></mjx-c><mjx-c class="mjx-c72"></mjx-c><mjx-c class="mjx-c20"></mjx-c><mjx-c class="mjx-c6E"></mjx-c><mjx-c class="mjx-c2C"></mjx-c><mjx-c class="mjx-c20"></mjx-c><mjx-c class="mjx-c64"></mjx-c><mjx-c class="mjx-c20"></mjx-c><mjx-c class="mjx-c69"></mjx-c><mjx-c class="mjx-c6E"></mjx-c><mjx-c class="mjx-c74"></mjx-c><mjx-c class="mjx-c65"></mjx-c><mjx-c class="mjx-c67"></mjx-c><mjx-c class="mjx-c65"></mjx-c><mjx-c class="mjx-c72"></mjx-c><mjx-c class="mjx-c73"></mjx-c><mjx-c class="mjx-c2C"></mjx-c><mjx-c class="mjx-c20"></mjx-c><mjx-c class="mjx-c64"></mjx-c><mjx-c class="mjx-c20"></mjx-c><mjx-c class="mjx-c3E"></mjx-c><mjx-c class="mjx-c20"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c2C"></mjx-c></mjx-mtext><mjx-tstrut></mjx-tstrut></mjx-mtd></mjx-mtr><mjx-mtr><mjx-mtd style="text-align: right; padding-top: 0.101em; padding-bottom: 0.101em;"><mjx-mrow><mjx-mo class="mjx-lop"><mjx-c class="mjx-c230A"></mjx-c></mjx-mo><mjx-texatom><mjx-mfrac><mjx-frac type="d"><mjx-num><mjx-nstrut type="d"></mjx-nstrut><mjx-mi class="mjx-i"><mjx-c class="mjx-c6E"></mjx-c></mjx-mi></mjx-num><mjx-dbox><mjx-dtable><mjx-line type="d"></mjx-line><mjx-row><mjx-den><mjx-dstrut type="d"></mjx-dstrut><mjx-mi class="mjx-i"><mjx-c class="mjx-c64"></mjx-c></mjx-mi></mjx-den></mjx-row></mjx-dtable></mjx-dbox></mjx-frac></mjx-mfrac></mjx-texatom><mjx-mo class="mjx-lop"><mjx-c class="mjx-c230B"></mjx-c></mjx-mo></mjx-mrow><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-mrow space="4"><mjx-mo class="mjx-s3"><mjx-c class="mjx-c2308"></mjx-c></mjx-mo><mjx-texatom><mjx-mfrac><mjx-frac type="d"><mjx-num><mjx-nstrut type="d"></mjx-nstrut><mjx-mrow><mjx-mi class="mjx-i"><mjx-c class="mjx-c6E"></mjx-c></mjx-mi><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2212"></mjx-c></mjx-mo><mjx-mi class="mjx-i" space="3"><mjx-c class="mjx-c64"></mjx-c></mjx-mi><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2B"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="3"><mjx-c class="mjx-c31"></mjx-c></mjx-mn></mjx-mrow></mjx-num><mjx-dbox><mjx-dtable><mjx-line type="d"></mjx-line><mjx-row><mjx-den><mjx-dstrut type="d"></mjx-dstrut><mjx-mi class="mjx-i"><mjx-c class="mjx-c64"></mjx-c></mjx-mi></mjx-den></mjx-row></mjx-dtable></mjx-dbox></mjx-frac></mjx-mfrac></mjx-texatom><mjx-mo class="mjx-s3"><mjx-c class="mjx-c2309"></mjx-c></mjx-mo></mjx-mrow><mjx-tstrut></mjx-tstrut></mjx-mtd></mjx-mtr><mjx-mtr><mjx-mtd style="text-align: right; padding-top: 0.101em;"><mjx-mrow><mjx-mo class="mjx-lop"><mjx-c class="mjx-c2308"></mjx-c></mjx-mo><mjx-texatom><mjx-mfrac><mjx-frac type="d"><mjx-num><mjx-nstrut type="d"></mjx-nstrut><mjx-mi class="mjx-i"><mjx-c class="mjx-c6E"></mjx-c></mjx-mi></mjx-num><mjx-dbox><mjx-dtable><mjx-line type="d"></mjx-line><mjx-row><mjx-den><mjx-dstrut type="d"></mjx-dstrut><mjx-mi class="mjx-i"><mjx-c class="mjx-c64"></mjx-c></mjx-mi></mjx-den></mjx-row></mjx-dtable></mjx-dbox></mjx-frac></mjx-mfrac></mjx-texatom><mjx-mo class="mjx-lop"><mjx-c class="mjx-c2309"></mjx-c></mjx-mo></mjx-mrow><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-mrow space="4"><mjx-mo class="mjx-s3"><mjx-c class="mjx-c230A"></mjx-c></mjx-mo><mjx-texatom><mjx-mfrac><mjx-frac type="d"><mjx-num><mjx-nstrut type="d"></mjx-nstrut><mjx-mrow><mjx-mi class="mjx-i"><mjx-c class="mjx-c6E"></mjx-c></mjx-mi><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2B"></mjx-c></mjx-mo><mjx-mi class="mjx-i" space="3"><mjx-c class="mjx-c64"></mjx-c></mjx-mi><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2212"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="3"><mjx-c class="mjx-c31"></mjx-c></mjx-mn></mjx-mrow></mjx-num><mjx-dbox><mjx-dtable><mjx-line type="d"></mjx-line><mjx-row><mjx-den><mjx-dstrut type="d"></mjx-dstrut><mjx-mi class="mjx-i"><mjx-c class="mjx-c64"></mjx-c></mjx-mi></mjx-den></mjx-row></mjx-dtable></mjx-dbox></mjx-frac></mjx-mfrac></mjx-texatom><mjx-mo class="mjx-s3"><mjx-c class="mjx-c230B"></mjx-c></mjx-mo></mjx-mrow><mjx-tstrut></mjx-tstrut></mjx-mtd></mjx-mtr></mjx-itable></mjx-table></mjx-mtable></mjx-math></mjx-container></p>
<p>THEOREM D2.</p>
<p><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" display="true" tabindex="0" ctxtmenu_counter="8" style="font-size: 148.2%;"><mjx-math display="true" class="MJX-TEX"><mjx-mtable style="min-width: 14.677em;"><mjx-table><mjx-itable><mjx-mtr><mjx-mtd style="text-align: right; padding-bottom: 0.101em;"><mjx-mtext class="mjx-n"><mjx-c class="mjx-c66"></mjx-c><mjx-c class="mjx-c6F"></mjx-c><mjx-c class="mjx-c72"></mjx-c><mjx-c class="mjx-c20"></mjx-c><mjx-c class="mjx-c6E"></mjx-c><mjx-c class="mjx-c2C"></mjx-c><mjx-c class="mjx-c20"></mjx-c><mjx-c class="mjx-c64"></mjx-c><mjx-c class="mjx-c20"></mjx-c><mjx-c class="mjx-c69"></mjx-c><mjx-c class="mjx-c6E"></mjx-c><mjx-c class="mjx-c74"></mjx-c><mjx-c class="mjx-c65"></mjx-c><mjx-c class="mjx-c67"></mjx-c><mjx-c class="mjx-c65"></mjx-c><mjx-c class="mjx-c72"></mjx-c><mjx-c class="mjx-c73"></mjx-c><mjx-c class="mjx-c2C"></mjx-c><mjx-c class="mjx-cA0"></mjx-c></mjx-mtext><mjx-mi class="mjx-i"><mjx-c class="mjx-c64"></mjx-c></mjx-mi><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c2260"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="4"><mjx-c class="mjx-c30"></mjx-c></mjx-mn><mjx-mtext class="mjx-n"><mjx-c class="mjx-c2C"></mjx-c><mjx-c class="mjx-c20"></mjx-c><mjx-c class="mjx-c61"></mjx-c><mjx-c class="mjx-c6E"></mjx-c><mjx-c class="mjx-c64"></mjx-c><mjx-c class="mjx-c20"></mjx-c><mjx-c class="mjx-c78"></mjx-c><mjx-c class="mjx-c20"></mjx-c><mjx-c class="mjx-c72"></mjx-c><mjx-c class="mjx-c65"></mjx-c><mjx-c class="mjx-c61"></mjx-c><mjx-c class="mjx-c6C"></mjx-c><mjx-c class="mjx-c2C"></mjx-c></mjx-mtext><mjx-tstrut></mjx-tstrut></mjx-mtd></mjx-mtr><mjx-mtr><mjx-mtd style="text-align: right; padding-top: 0.101em; padding-bottom: 0.101em;"><mjx-mrow><mjx-mo class="mjx-lop"><mjx-c class="mjx-c230A"></mjx-c></mjx-mo><mjx-texatom><mjx-mfrac><mjx-frac type="d"><mjx-num><mjx-nstrut type="d"></mjx-nstrut><mjx-mi class="mjx-i"><mjx-c class="mjx-c6E"></mjx-c></mjx-mi></mjx-num><mjx-dbox><mjx-dtable><mjx-line type="d"></mjx-line><mjx-row><mjx-den><mjx-dstrut type="d"></mjx-dstrut><mjx-mi class="mjx-i"><mjx-c class="mjx-c64"></mjx-c></mjx-mi></mjx-den></mjx-row></mjx-dtable></mjx-dbox></mjx-frac></mjx-mfrac><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2B"></mjx-c></mjx-mo><mjx-mi class="mjx-i" space="3"><mjx-c class="mjx-c78"></mjx-c></mjx-mi></mjx-texatom><mjx-mo class="mjx-lop"><mjx-c class="mjx-c230B"></mjx-c></mjx-mo></mjx-mrow><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-mrow space="4"><mjx-mo class="mjx-lop"><mjx-c class="mjx-c230A"></mjx-c></mjx-mo><mjx-texatom><mjx-mfrac><mjx-frac type="d"><mjx-num><mjx-nstrut type="d"></mjx-nstrut><mjx-mi class="mjx-i"><mjx-c class="mjx-c6E"></mjx-c></mjx-mi></mjx-num><mjx-dbox><mjx-dtable><mjx-line type="d"></mjx-line><mjx-row><mjx-den><mjx-dstrut type="d"></mjx-dstrut><mjx-mi class="mjx-i"><mjx-c class="mjx-c64"></mjx-c></mjx-mi></mjx-den></mjx-row></mjx-dtable></mjx-dbox></mjx-frac></mjx-mfrac></mjx-texatom><mjx-mo class="mjx-lop"><mjx-c class="mjx-c230B"></mjx-c></mjx-mo></mjx-mrow><mjx-mtext class="mjx-n"><mjx-c class="mjx-c69"></mjx-c><mjx-c class="mjx-c66"></mjx-c><mjx-c class="mjx-cA0"></mjx-c></mjx-mtext><mjx-mn class="mjx-n"><mjx-c class="mjx-c30"></mjx-c></mjx-mn><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c2264"></mjx-c></mjx-mo><mjx-mi class="mjx-i" space="4"><mjx-c class="mjx-c78"></mjx-c></mjx-mi><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3C"></mjx-c></mjx-mo><mjx-texatom space="4"><mjx-mo class="mjx-n"><mjx-c class="mjx-c7C"></mjx-c></mjx-mo></mjx-texatom><mjx-texatom><mjx-mfrac><mjx-frac type="d"><mjx-num><mjx-nstrut type="d"></mjx-nstrut><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c></mjx-mn></mjx-num><mjx-dbox><mjx-dtable><mjx-line type="d"></mjx-line><mjx-row><mjx-den><mjx-dstrut type="d"></mjx-dstrut><mjx-mi class="mjx-i"><mjx-c class="mjx-c64"></mjx-c></mjx-mi></mjx-den></mjx-row></mjx-dtable></mjx-dbox></mjx-frac></mjx-mfrac></mjx-texatom><mjx-mo class="mjx-n"><mjx-c class="mjx-c7C"></mjx-c></mjx-mo><mjx-tstrut></mjx-tstrut></mjx-mtd></mjx-mtr><mjx-mtr><mjx-mtd style="text-align: right; padding-top: 0.101em;"><mjx-mrow><mjx-mo class="mjx-lop"><mjx-c class="mjx-c2308"></mjx-c></mjx-mo><mjx-texatom><mjx-mfrac><mjx-frac type="d"><mjx-num><mjx-nstrut type="d"></mjx-nstrut><mjx-mi class="mjx-i"><mjx-c class="mjx-c6E"></mjx-c></mjx-mi></mjx-num><mjx-dbox><mjx-dtable><mjx-line type="d"></mjx-line><mjx-row><mjx-den><mjx-dstrut type="d"></mjx-dstrut><mjx-mi class="mjx-i"><mjx-c class="mjx-c64"></mjx-c></mjx-mi></mjx-den></mjx-row></mjx-dtable></mjx-dbox></mjx-frac></mjx-mfrac><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2B"></mjx-c></mjx-mo><mjx-mi class="mjx-i" space="3"><mjx-c class="mjx-c78"></mjx-c></mjx-mi></mjx-texatom><mjx-mo class="mjx-lop"><mjx-c class="mjx-c2309"></mjx-c></mjx-mo></mjx-mrow><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-mrow space="4"><mjx-mo class="mjx-lop"><mjx-c class="mjx-c2308"></mjx-c></mjx-mo><mjx-texatom><mjx-mfrac><mjx-frac type="d"><mjx-num><mjx-nstrut type="d"></mjx-nstrut><mjx-mi class="mjx-i"><mjx-c class="mjx-c6E"></mjx-c></mjx-mi></mjx-num><mjx-dbox><mjx-dtable><mjx-line type="d"></mjx-line><mjx-row><mjx-den><mjx-dstrut type="d"></mjx-dstrut><mjx-mi class="mjx-i"><mjx-c class="mjx-c64"></mjx-c></mjx-mi></mjx-den></mjx-row></mjx-dtable></mjx-dbox></mjx-frac></mjx-mfrac></mjx-texatom><mjx-mo class="mjx-lop"><mjx-c class="mjx-c2309"></mjx-c></mjx-mo></mjx-mrow><mjx-mtext class="mjx-n"><mjx-c class="mjx-c69"></mjx-c><mjx-c class="mjx-c66"></mjx-c><mjx-c class="mjx-cA0"></mjx-c></mjx-mtext><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2212"></mjx-c></mjx-mo><mjx-texatom space="3"><mjx-mo class="mjx-n"><mjx-c class="mjx-c7C"></mjx-c></mjx-mo></mjx-texatom><mjx-texatom><mjx-mfrac><mjx-frac type="d"><mjx-num><mjx-nstrut type="d"></mjx-nstrut><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c></mjx-mn></mjx-num><mjx-dbox><mjx-dtable><mjx-line type="d"></mjx-line><mjx-row><mjx-den><mjx-dstrut type="d"></mjx-dstrut><mjx-mi class="mjx-i"><mjx-c class="mjx-c64"></mjx-c></mjx-mi></mjx-den></mjx-row></mjx-dtable></mjx-dbox></mjx-frac></mjx-mfrac></mjx-texatom><mjx-texatom><mjx-mo class="mjx-n"><mjx-c class="mjx-c7C"></mjx-c></mjx-mo></mjx-texatom><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3C"></mjx-c></mjx-mo><mjx-mi class="mjx-i" space="4"><mjx-c class="mjx-c78"></mjx-c></mjx-mi><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c2264"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="4"><mjx-c class="mjx-c30"></mjx-c></mjx-mn><mjx-tstrut></mjx-tstrut></mjx-mtd></mjx-mtr></mjx-itable></mjx-table></mjx-mtable></mjx-math></mjx-container></p>
<p>这一步的证明相对比较简单。</p>
<p><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" display="true" tabindex="0" ctxtmenu_counter="9" style="font-size: 148.2%;"><mjx-math display="true" class="MJX-TEX"><mjx-mtable style="min-width: 16.632em;"><mjx-table><mjx-itable><mjx-mtr><mjx-mtd style="text-align: right; padding-right: 0px; padding-bottom: 0.101em;"><mjx-mi class="mjx-i"><mjx-c class="mjx-c71"></mjx-c></mjx-mi><mjx-tstrut></mjx-tstrut></mjx-mtd><mjx-mtd style="text-align: left; padding-left: 0px; padding-bottom: 0.101em;"><mjx-mi class="mjx-n"></mjx-mi><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-mrow space="4"><mjx-mo class="mjx-s3"><mjx-c class="mjx-c230A"></mjx-c></mjx-mo><mjx-mfrac><mjx-frac type="d"><mjx-num><mjx-nstrut type="d"></mjx-nstrut><mjx-mrow><mjx-msup><mjx-mn class="mjx-n"><mjx-c class="mjx-c32"></mjx-c></mjx-mn><mjx-script style="vertical-align: 0.363em;"><mjx-texatom size="s"><mjx-mn class="mjx-n"><mjx-c class="mjx-c33"></mjx-c><mjx-c class="mjx-c32"></mjx-c></mjx-mn></mjx-texatom></mjx-script></mjx-msup><mjx-mo class="mjx-n"><mjx-c class="mjx-c2B"></mjx-c></mjx-mo><mjx-mn class="mjx-n"><mjx-c class="mjx-c32"></mjx-c></mjx-mn></mjx-mrow></mjx-num><mjx-dbox><mjx-dtable><mjx-line type="d"></mjx-line><mjx-row><mjx-den><mjx-dstrut type="d"></mjx-dstrut><mjx-mn class="mjx-n"><mjx-c class="mjx-c33"></mjx-c></mjx-mn></mjx-den></mjx-row></mjx-dtable></mjx-dbox></mjx-frac></mjx-mfrac><mjx-mfrac><mjx-frac type="d"><mjx-num><mjx-nstrut type="d"></mjx-nstrut><mjx-mi class="mjx-i"><mjx-c class="mjx-c6E"></mjx-c></mjx-mi></mjx-num><mjx-dbox><mjx-dtable><mjx-line type="d"></mjx-line><mjx-row><mjx-den><mjx-dstrut type="d"></mjx-dstrut><mjx-msup><mjx-mn class="mjx-n"><mjx-c class="mjx-c32"></mjx-c></mjx-mn><mjx-script style="vertical-align: 0.363em;"><mjx-texatom size="s"><mjx-mn class="mjx-n"><mjx-c class="mjx-c33"></mjx-c><mjx-c class="mjx-c32"></mjx-c></mjx-mn></mjx-texatom></mjx-script></mjx-msup></mjx-den></mjx-row></mjx-dtable></mjx-dbox></mjx-frac></mjx-mfrac><mjx-mo class="mjx-s3"><mjx-c class="mjx-c230B"></mjx-c></mjx-mo></mjx-mrow><mjx-tstrut></mjx-tstrut></mjx-mtd></mjx-mtr><mjx-mtr><mjx-mtd style="text-align: right; padding-right: 0px; padding-top: 0.101em; padding-bottom: 0.101em;"><mjx-tstrut></mjx-tstrut></mjx-mtd><mjx-mtd style="text-align: left; padding-left: 0px; padding-top: 0.101em; padding-bottom: 0.101em;"><mjx-mi class="mjx-n"></mjx-mi><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-mrow space="4"><mjx-mo class="mjx-s3"><mjx-c class="mjx-c230A"></mjx-c></mjx-mo><mjx-texatom><mjx-mfrac><mjx-frac type="d"><mjx-num><mjx-nstrut type="d"></mjx-nstrut><mjx-mi class="mjx-i"><mjx-c class="mjx-c6E"></mjx-c></mjx-mi></mjx-num><mjx-dbox><mjx-dtable><mjx-line type="d"></mjx-line><mjx-row><mjx-den><mjx-dstrut type="d"></mjx-dstrut><mjx-mn class="mjx-n"><mjx-c class="mjx-c33"></mjx-c></mjx-mn></mjx-den></mjx-row></mjx-dtable></mjx-dbox></mjx-frac></mjx-mfrac><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2B"></mjx-c></mjx-mo><mjx-mfrac space="3"><mjx-frac type="d"><mjx-num><mjx-nstrut type="d"></mjx-nstrut><mjx-mrow><mjx-mn class="mjx-n"><mjx-c class="mjx-c32"></mjx-c></mjx-mn><mjx-mi class="mjx-i"><mjx-c class="mjx-c6E"></mjx-c></mjx-mi></mjx-mrow></mjx-num><mjx-dbox><mjx-dtable><mjx-line type="d"></mjx-line><mjx-row><mjx-den><mjx-dstrut type="d"></mjx-dstrut><mjx-mrow><mjx-mn class="mjx-n"><mjx-c class="mjx-c33"></mjx-c></mjx-mn><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c22C5"></mjx-c></mjx-mo><mjx-msup><mjx-mn class="mjx-n"><mjx-c class="mjx-c32"></mjx-c></mjx-mn><mjx-script style="vertical-align: 0.363em;"><mjx-texatom size="s"><mjx-mn class="mjx-n"><mjx-c class="mjx-c33"></mjx-c><mjx-c class="mjx-c32"></mjx-c></mjx-mn></mjx-texatom></mjx-script></mjx-msup></mjx-mrow></mjx-den></mjx-row></mjx-dtable></mjx-dbox></mjx-frac></mjx-mfrac></mjx-texatom><mjx-mo class="mjx-s3"><mjx-c class="mjx-c230B"></mjx-c></mjx-mo></mjx-mrow><mjx-tstrut></mjx-tstrut></mjx-mtd></mjx-mtr><mjx-mtr><mjx-mtd style="text-align: right; padding-right: 0px; padding-top: 0.101em; padding-bottom: 0.101em;"><mjx-mstyle size="sm"><mjx-mtext class="mjx-n"><mjx-utext variant="normal" style="font-size: 81%; font-family: serif;">因</mjx-utext><mjx-utext variant="normal" style="font-size: 81%; font-family: serif;">为</mjx-utext></mjx-mtext><mjx-mstyle><mjx-mspace style="width: 0.5em;"></mjx-mspace></mjx-mstyle><mjx-mn class="mjx-n"><mjx-c class="mjx-c30"></mjx-c></mjx-mn><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c2264"></mjx-c></mjx-mo><mjx-mi class="mjx-i" space="4"><mjx-c class="mjx-c6E"></mjx-c></mjx-mi><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3C"></mjx-c></mjx-mo><mjx-msup><mjx-mn class="mjx-n"><mjx-c class="mjx-c32"></mjx-c></mjx-mn><mjx-script style="vertical-align: 0.413em;"><mjx-texatom size="s"><mjx-mn class="mjx-n"><mjx-c class="mjx-c33"></mjx-c><mjx-c class="mjx-c31"></mjx-c></mjx-mn></mjx-texatom></mjx-script></mjx-msup></mjx-mstyle><mjx-tstrut></mjx-tstrut></mjx-mtd><mjx-mtd style="text-align: left; padding-left: 0px; padding-top: 0.101em; padding-bottom: 0.101em;"><mjx-mstyle><mjx-mspace style="width: 0.5em;"></mjx-mspace></mjx-mstyle><mjx-mstyle size="sm"><mjx-mtext class="mjx-n"><mjx-utext variant="normal" style="font-size: 81%; font-family: serif;">所</mjx-utext><mjx-utext variant="normal" style="font-size: 81%; font-family: serif;">以</mjx-utext></mjx-mtext><mjx-mstyle><mjx-mspace style="width: 0.5em;"></mjx-mspace></mjx-mstyle><mjx-mn class="mjx-n"><mjx-c class="mjx-c30"></mjx-c></mjx-mn><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c2264"></mjx-c></mjx-mo><mjx-mfrac space="4"><mjx-frac type="d"><mjx-num><mjx-nstrut type="d"></mjx-nstrut><mjx-mrow><mjx-mn class="mjx-n"><mjx-c class="mjx-c32"></mjx-c></mjx-mn><mjx-mi class="mjx-i"><mjx-c class="mjx-c6E"></mjx-c></mjx-mi></mjx-mrow></mjx-num><mjx-dbox><mjx-dtable><mjx-line type="d"></mjx-line><mjx-row><mjx-den><mjx-dstrut type="d"></mjx-dstrut><mjx-mrow><mjx-mn class="mjx-n"><mjx-c class="mjx-c33"></mjx-c></mjx-mn><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c22C5"></mjx-c></mjx-mo><mjx-msup><mjx-mn class="mjx-n"><mjx-c class="mjx-c32"></mjx-c></mjx-mn><mjx-script style="vertical-align: 0.363em;"><mjx-texatom size="s"><mjx-mn class="mjx-n"><mjx-c class="mjx-c33"></mjx-c><mjx-c class="mjx-c32"></mjx-c></mjx-mn></mjx-texatom></mjx-script></mjx-msup></mjx-mrow></mjx-den></mjx-row></mjx-dtable></mjx-dbox></mjx-frac></mjx-mfrac><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3C"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="4"><mjx-c class="mjx-c31"></mjx-c></mjx-mn><mjx-texatom><mjx-mo class="mjx-n"><mjx-c class="mjx-c2F"></mjx-c></mjx-mo></mjx-texatom><mjx-mn class="mjx-n"><mjx-c class="mjx-c33"></mjx-c></mjx-mn></mjx-mstyle><mjx-tstrut></mjx-tstrut></mjx-mtd></mjx-mtr><mjx-mtr><mjx-mtd style="text-align: right; padding-right: 0px; padding-top: 0.101em;"><mjx-mstyle size="sm"><mjx-mtext class="mjx-n"><mjx-utext variant="normal" style="font-size: 81%; font-family: serif;">根</mjx-utext><mjx-utext variant="normal" style="font-size: 81%; font-family: serif;">据</mjx-utext><mjx-c class="mjx-c20"></mjx-c><mjx-c class="mjx-c44"></mjx-c><mjx-c class="mjx-c32"></mjx-c><mjx-utext variant="normal" style="font-size: 81%; font-family: serif;">，</mjx-utext><mjx-utext variant="normal" style="font-size: 81%; font-family: serif;">我</mjx-utext><mjx-utext variant="normal" style="font-size: 81%; font-family: serif;">们</mjx-utext><mjx-utext variant="normal" style="font-size: 81%; font-family: serif;">得</mjx-utext><mjx-utext variant="normal" style="font-size: 81%; font-family: serif;">到</mjx-utext></mjx-mtext><mjx-mstyle><mjx-mspace style="width: 0.5em;"></mjx-mspace></mjx-mstyle><mjx-mi class="mjx-i"><mjx-c class="mjx-c71"></mjx-c></mjx-mi></mjx-mstyle><mjx-tstrut></mjx-tstrut></mjx-mtd><mjx-mtd style="text-align: left; padding-left: 0px; padding-top: 0.101em;"><mjx-mi class="mjx-n"></mjx-mi><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-mrow space="4"><mjx-mo class="mjx-lop"><mjx-c class="mjx-c230A"></mjx-c></mjx-mo><mjx-texatom><mjx-mfrac><mjx-frac type="d"><mjx-num><mjx-nstrut type="d"></mjx-nstrut><mjx-mi class="mjx-i"><mjx-c class="mjx-c6E"></mjx-c></mjx-mi></mjx-num><mjx-dbox><mjx-dtable><mjx-line type="d"></mjx-line><mjx-row><mjx-den><mjx-dstrut type="d"></mjx-dstrut><mjx-mn class="mjx-n"><mjx-c class="mjx-c33"></mjx-c></mjx-mn></mjx-den></mjx-row></mjx-dtable></mjx-dbox></mjx-frac></mjx-mfrac></mjx-texatom><mjx-mo class="mjx-lop"><mjx-c class="mjx-c230B"></mjx-c></mjx-mo></mjx-mrow><mjx-tstrut></mjx-tstrut></mjx-mtd></mjx-mtr></mjx-itable></mjx-table></mjx-mtable></mjx-math></mjx-container></p>
<p>接下来我们来看 n &lt; 0 的情况，此时我们要证明的是</p>
<p><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" display="true" tabindex="0" ctxtmenu_counter="10" style="font-size: 148.2%;"><mjx-math display="true" class="MJX-TEX"><mjx-mrow><mjx-mo class="mjx-s3"><mjx-c class="mjx-c230A"></mjx-c></mjx-mo><mjx-texatom><mjx-mfrac><mjx-frac type="d"><mjx-num><mjx-nstrut type="d"></mjx-nstrut><mjx-mrow><mjx-msup><mjx-mn class="mjx-n"><mjx-c class="mjx-c32"></mjx-c></mjx-mn><mjx-script style="vertical-align: 0.363em;"><mjx-texatom size="s"><mjx-mn class="mjx-n"><mjx-c class="mjx-c33"></mjx-c><mjx-c class="mjx-c32"></mjx-c></mjx-mn></mjx-texatom></mjx-script></mjx-msup><mjx-mo class="mjx-n"><mjx-c class="mjx-c2B"></mjx-c></mjx-mo><mjx-mn class="mjx-n"><mjx-c class="mjx-c32"></mjx-c></mjx-mn></mjx-mrow></mjx-num><mjx-dbox><mjx-dtable><mjx-line type="d"></mjx-line><mjx-row><mjx-den><mjx-dstrut type="d"></mjx-dstrut><mjx-mn class="mjx-n"><mjx-c class="mjx-c33"></mjx-c></mjx-mn></mjx-den></mjx-row></mjx-dtable></mjx-dbox></mjx-frac></mjx-mfrac><mjx-mfrac><mjx-frac type="d"><mjx-num><mjx-nstrut type="d"></mjx-nstrut><mjx-mi class="mjx-i"><mjx-c class="mjx-c6E"></mjx-c></mjx-mi></mjx-num><mjx-dbox><mjx-dtable><mjx-line type="d"></mjx-line><mjx-row><mjx-den><mjx-dstrut type="d"></mjx-dstrut><mjx-msup><mjx-mn class="mjx-n"><mjx-c class="mjx-c32"></mjx-c></mjx-mn><mjx-script style="vertical-align: 0.363em;"><mjx-texatom size="s"><mjx-mn class="mjx-n"><mjx-c class="mjx-c33"></mjx-c><mjx-c class="mjx-c32"></mjx-c></mjx-mn></mjx-texatom></mjx-script></mjx-msup></mjx-den></mjx-row></mjx-dtable></mjx-dbox></mjx-frac></mjx-mfrac></mjx-texatom><mjx-mo class="mjx-s3"><mjx-c class="mjx-c230B"></mjx-c></mjx-mo></mjx-mrow><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2B"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="3"><mjx-c class="mjx-c31"></mjx-c></mjx-mn><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-mrow space="4"><mjx-mo class="mjx-lop"><mjx-c class="mjx-c2308"></mjx-c></mjx-mo><mjx-texatom><mjx-mfrac><mjx-frac type="d"><mjx-num><mjx-nstrut type="d"></mjx-nstrut><mjx-mi class="mjx-i"><mjx-c class="mjx-c6E"></mjx-c></mjx-mi></mjx-num><mjx-dbox><mjx-dtable><mjx-line type="d"></mjx-line><mjx-row><mjx-den><mjx-dstrut type="d"></mjx-dstrut><mjx-mn class="mjx-n"><mjx-c class="mjx-c33"></mjx-c></mjx-mn></mjx-den></mjx-row></mjx-dtable></mjx-dbox></mjx-frac></mjx-mfrac></mjx-texatom><mjx-mo class="mjx-lop"><mjx-c class="mjx-c2309"></mjx-c></mjx-mo></mjx-mrow><mjx-mstyle><mjx-mspace style="width: 1em;"></mjx-mspace></mjx-mstyle><mjx-mstyle size="sm"><mjx-texatom><mjx-mo class="mjx-n"><mjx-c class="mjx-c2212"></mjx-c></mjx-mo><mjx-msup><mjx-mn class="mjx-n"><mjx-c class="mjx-c32"></mjx-c></mjx-mn><mjx-script style="vertical-align: 0.413em;"><mjx-texatom size="s"><mjx-mn class="mjx-n"><mjx-c class="mjx-c33"></mjx-c><mjx-c class="mjx-c31"></mjx-c></mjx-mn></mjx-texatom></mjx-script></mjx-msup><mjx-mo class="mjx-n"><mjx-c class="mjx-c2264"></mjx-c></mjx-mo><mjx-mi class="mjx-i" space="4"><mjx-c class="mjx-c6E"></mjx-c></mjx-mi><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3C"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="4"><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-texatom></mjx-mstyle></mjx-math></mjx-container></p>
<p>首先把 1 放进 Floor 运算符里面。</p>
<p><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" display="true" tabindex="0" ctxtmenu_counter="11" style="font-size: 148.2%;"><mjx-math display="true" class="MJX-TEX"><mjx-mtable style="min-width: 13.521em;"><mjx-table><mjx-itable><mjx-mtr><mjx-mtd style="text-align: right; padding-right: 0px; padding-bottom: 0.101em;"><mjx-mi class="mjx-i"><mjx-c class="mjx-c71"></mjx-c></mjx-mi><mjx-tstrut></mjx-tstrut></mjx-mtd><mjx-mtd style="text-align: left; padding-left: 0px; padding-bottom: 0.101em;"><mjx-mi class="mjx-n"></mjx-mi><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-mrow space="4"><mjx-mo class="mjx-s3"><mjx-c class="mjx-c230A"></mjx-c></mjx-mo><mjx-texatom><mjx-mfrac><mjx-frac type="d"><mjx-num><mjx-nstrut type="d"></mjx-nstrut><mjx-mrow><mjx-msup><mjx-mn class="mjx-n"><mjx-c class="mjx-c32"></mjx-c></mjx-mn><mjx-script style="vertical-align: 0.363em;"><mjx-texatom size="s"><mjx-mn class="mjx-n"><mjx-c class="mjx-c33"></mjx-c><mjx-c class="mjx-c32"></mjx-c></mjx-mn></mjx-texatom></mjx-script></mjx-msup><mjx-mo class="mjx-n"><mjx-c class="mjx-c2B"></mjx-c></mjx-mo><mjx-mn class="mjx-n"><mjx-c class="mjx-c32"></mjx-c></mjx-mn></mjx-mrow></mjx-num><mjx-dbox><mjx-dtable><mjx-line type="d"></mjx-line><mjx-row><mjx-den><mjx-dstrut type="d"></mjx-dstrut><mjx-mn class="mjx-n"><mjx-c class="mjx-c33"></mjx-c></mjx-mn></mjx-den></mjx-row></mjx-dtable></mjx-dbox></mjx-frac></mjx-mfrac><mjx-mfrac><mjx-frac type="d"><mjx-num><mjx-nstrut type="d"></mjx-nstrut><mjx-mi class="mjx-i"><mjx-c class="mjx-c6E"></mjx-c></mjx-mi></mjx-num><mjx-dbox><mjx-dtable><mjx-line type="d"></mjx-line><mjx-row><mjx-den><mjx-dstrut type="d"></mjx-dstrut><mjx-msup><mjx-mn class="mjx-n"><mjx-c class="mjx-c32"></mjx-c></mjx-mn><mjx-script style="vertical-align: 0.363em;"><mjx-texatom size="s"><mjx-mn class="mjx-n"><mjx-c class="mjx-c33"></mjx-c><mjx-c class="mjx-c32"></mjx-c></mjx-mn></mjx-texatom></mjx-script></mjx-msup></mjx-den></mjx-row></mjx-dtable></mjx-dbox></mjx-frac></mjx-mfrac></mjx-texatom><mjx-mo class="mjx-s3"><mjx-c class="mjx-c230B"></mjx-c></mjx-mo></mjx-mrow><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2B"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="3"><mjx-c class="mjx-c31"></mjx-c></mjx-mn><mjx-tstrut></mjx-tstrut></mjx-mtd></mjx-mtr><mjx-mtr><mjx-mtd style="text-align: right; padding-right: 0px; padding-top: 0.101em; padding-bottom: 0.101em;"><mjx-mstyle size="sm"><mjx-mtext class="mjx-n"><mjx-utext variant="normal" style="font-size: 81%; font-family: serif;">根</mjx-utext><mjx-utext variant="normal" style="font-size: 81%; font-family: serif;">据</mjx-utext><mjx-c class="mjx-c20"></mjx-c><mjx-c class="mjx-c44"></mjx-c><mjx-c class="mjx-c30"></mjx-c></mjx-mtext></mjx-mstyle><mjx-tstrut></mjx-tstrut></mjx-mtd><mjx-mtd></mjx-mtd></mjx-mtr><mjx-mtr><mjx-mtd style="text-align: right; padding-right: 0px; padding-top: 0.101em; padding-bottom: 0.101em;"><mjx-tstrut></mjx-tstrut></mjx-mtd><mjx-mtd style="text-align: left; padding-left: 0px; padding-top: 0.101em; padding-bottom: 0.101em;"><mjx-mi class="mjx-n"></mjx-mi><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-mrow space="4"><mjx-mo class="mjx-s3"><mjx-c class="mjx-c230A"></mjx-c></mjx-mo><mjx-texatom><mjx-mfrac><mjx-frac type="d"><mjx-num><mjx-nstrut type="d"></mjx-nstrut><mjx-mrow><mjx-msup><mjx-mn class="mjx-n"><mjx-c class="mjx-c32"></mjx-c></mjx-mn><mjx-script style="vertical-align: 0.363em;"><mjx-texatom size="s"><mjx-mn class="mjx-n"><mjx-c class="mjx-c33"></mjx-c><mjx-c class="mjx-c32"></mjx-c></mjx-mn></mjx-texatom></mjx-script></mjx-msup><mjx-mi class="mjx-i"><mjx-c class="mjx-c6E"></mjx-c></mjx-mi><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2B"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="3"><mjx-c class="mjx-c32"></mjx-c></mjx-mn><mjx-mi class="mjx-i"><mjx-c class="mjx-c6E"></mjx-c></mjx-mi><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2B"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="3"><mjx-c class="mjx-c33"></mjx-c></mjx-mn><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c22C5"></mjx-c></mjx-mo><mjx-msup><mjx-mn class="mjx-n"><mjx-c class="mjx-c32"></mjx-c></mjx-mn><mjx-script style="vertical-align: 0.363em;"><mjx-texatom size="s"><mjx-mn class="mjx-n"><mjx-c class="mjx-c33"></mjx-c><mjx-c class="mjx-c32"></mjx-c></mjx-mn></mjx-texatom></mjx-script></mjx-msup></mjx-mrow></mjx-num><mjx-dbox><mjx-dtable><mjx-line type="d"></mjx-line><mjx-row><mjx-den><mjx-dstrut type="d"></mjx-dstrut><mjx-mrow><mjx-mn class="mjx-n"><mjx-c class="mjx-c33"></mjx-c></mjx-mn><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c22C5"></mjx-c></mjx-mo><mjx-msup><mjx-mn class="mjx-n"><mjx-c class="mjx-c32"></mjx-c></mjx-mn><mjx-script style="vertical-align: 0.363em;"><mjx-texatom size="s"><mjx-mn class="mjx-n"><mjx-c class="mjx-c33"></mjx-c><mjx-c class="mjx-c32"></mjx-c></mjx-mn></mjx-texatom></mjx-script></mjx-msup></mjx-mrow></mjx-den></mjx-row></mjx-dtable></mjx-dbox></mjx-frac></mjx-mfrac></mjx-texatom><mjx-mo class="mjx-s3"><mjx-c class="mjx-c230B"></mjx-c></mjx-mo></mjx-mrow><mjx-tstrut></mjx-tstrut></mjx-mtd></mjx-mtr><mjx-mtr><mjx-mtd style="text-align: right; padding-right: 0px; padding-top: 0.101em; padding-bottom: 0.101em;"><mjx-mstyle size="sm"><mjx-mtext class="mjx-n"><mjx-utext variant="normal" style="font-size: 81%; font-family: serif;">根</mjx-utext><mjx-utext variant="normal" style="font-size: 81%; font-family: serif;">据</mjx-utext><mjx-c class="mjx-c20"></mjx-c><mjx-c class="mjx-c44"></mjx-c><mjx-c class="mjx-c31"></mjx-c></mjx-mtext></mjx-mstyle><mjx-tstrut></mjx-tstrut></mjx-mtd><mjx-mtd></mjx-mtd></mjx-mtr><mjx-mtr><mjx-mtd style="text-align: right; padding-right: 0px; padding-top: 0.101em; padding-bottom: 0.101em;"><mjx-tstrut></mjx-tstrut></mjx-mtd><mjx-mtd style="text-align: left; padding-left: 0px; padding-top: 0.101em; padding-bottom: 0.101em;"><mjx-mi class="mjx-n"></mjx-mi><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-mrow space="4"><mjx-mo class="mjx-s3"><mjx-c class="mjx-c2308"></mjx-c></mjx-mo><mjx-texatom><mjx-mfrac><mjx-frac type="d"><mjx-num><mjx-nstrut type="d"></mjx-nstrut><mjx-mrow><mjx-msup><mjx-mn class="mjx-n"><mjx-c class="mjx-c32"></mjx-c></mjx-mn><mjx-script style="vertical-align: 0.363em;"><mjx-texatom size="s"><mjx-mn class="mjx-n"><mjx-c class="mjx-c33"></mjx-c><mjx-c class="mjx-c32"></mjx-c></mjx-mn></mjx-texatom></mjx-script></mjx-msup><mjx-mi class="mjx-i"><mjx-c class="mjx-c6E"></mjx-c></mjx-mi><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2B"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="3"><mjx-c class="mjx-c32"></mjx-c></mjx-mn><mjx-mi class="mjx-i"><mjx-c class="mjx-c6E"></mjx-c></mjx-mi><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2B"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="3"><mjx-c class="mjx-c31"></mjx-c></mjx-mn></mjx-mrow></mjx-num><mjx-dbox><mjx-dtable><mjx-line type="d"></mjx-line><mjx-row><mjx-den><mjx-dstrut type="d"></mjx-dstrut><mjx-mrow><mjx-mn class="mjx-n"><mjx-c class="mjx-c33"></mjx-c></mjx-mn><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c22C5"></mjx-c></mjx-mo><mjx-msup><mjx-mn class="mjx-n"><mjx-c class="mjx-c32"></mjx-c></mjx-mn><mjx-script style="vertical-align: 0.363em;"><mjx-texatom size="s"><mjx-mn class="mjx-n"><mjx-c class="mjx-c33"></mjx-c><mjx-c class="mjx-c32"></mjx-c></mjx-mn></mjx-texatom></mjx-script></mjx-msup></mjx-mrow></mjx-den></mjx-row></mjx-dtable></mjx-dbox></mjx-frac></mjx-mfrac></mjx-texatom><mjx-mo class="mjx-s3"><mjx-c class="mjx-c2309"></mjx-c></mjx-mo></mjx-mrow><mjx-tstrut></mjx-tstrut></mjx-mtd></mjx-mtr><mjx-mtr><mjx-mtd style="text-align: right; padding-right: 0px; padding-top: 0.101em;"><mjx-tstrut></mjx-tstrut></mjx-mtd><mjx-mtd style="text-align: left; padding-left: 0px; padding-top: 0.101em;"><mjx-mi class="mjx-n"></mjx-mi><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-mrow space="4"><mjx-mo class="mjx-s3"><mjx-c class="mjx-c2308"></mjx-c></mjx-mo><mjx-texatom><mjx-mfrac><mjx-frac type="d"><mjx-num><mjx-nstrut type="d"></mjx-nstrut><mjx-mi class="mjx-i"><mjx-c class="mjx-c6E"></mjx-c></mjx-mi></mjx-num><mjx-dbox><mjx-dtable><mjx-line type="d"></mjx-line><mjx-row><mjx-den><mjx-dstrut type="d"></mjx-dstrut><mjx-mn class="mjx-n"><mjx-c class="mjx-c33"></mjx-c></mjx-mn></mjx-den></mjx-row></mjx-dtable></mjx-dbox></mjx-frac></mjx-mfrac><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2B"></mjx-c></mjx-mo><mjx-mfrac space="3"><mjx-frac type="d"><mjx-num><mjx-nstrut type="d"></mjx-nstrut><mjx-mrow><mjx-mn class="mjx-n"><mjx-c class="mjx-c32"></mjx-c></mjx-mn><mjx-mi class="mjx-i"><mjx-c class="mjx-c6E"></mjx-c></mjx-mi><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2B"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="3"><mjx-c class="mjx-c31"></mjx-c></mjx-mn></mjx-mrow></mjx-num><mjx-dbox><mjx-dtable><mjx-line type="d"></mjx-line><mjx-row><mjx-den><mjx-dstrut type="d"></mjx-dstrut><mjx-mrow><mjx-mn class="mjx-n"><mjx-c class="mjx-c33"></mjx-c></mjx-mn><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c22C5"></mjx-c></mjx-mo><mjx-msup><mjx-mn class="mjx-n"><mjx-c class="mjx-c32"></mjx-c></mjx-mn><mjx-script style="vertical-align: 0.363em;"><mjx-texatom size="s"><mjx-mn class="mjx-n"><mjx-c class="mjx-c33"></mjx-c><mjx-c class="mjx-c32"></mjx-c></mjx-mn></mjx-texatom></mjx-script></mjx-msup></mjx-mrow></mjx-den></mjx-row></mjx-dtable></mjx-dbox></mjx-frac></mjx-mfrac></mjx-texatom><mjx-mo class="mjx-s3"><mjx-c class="mjx-c2309"></mjx-c></mjx-mo></mjx-mrow><mjx-tstrut></mjx-tstrut></mjx-mtd></mjx-mtr></mjx-itable></mjx-table></mjx-mtable></mjx-math></mjx-container></p>
<p>接下来就比较简单了。</p>
<p><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" display="true" tabindex="0" ctxtmenu_counter="12" style="font-size: 148.2%;"><mjx-math display="true" class="MJX-TEX"><mjx-mtable style="min-width: 23.536em;"><mjx-table><mjx-itable><mjx-mtr><mjx-mtd style="text-align: right; padding-right: 0px; padding-bottom: 0.101em;"><mjx-mi class="mjx-i"><mjx-c class="mjx-c71"></mjx-c></mjx-mi><mjx-tstrut></mjx-tstrut></mjx-mtd><mjx-mtd style="text-align: left; padding-left: 0px; padding-bottom: 0.101em;"><mjx-mi class="mjx-n"></mjx-mi><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-mrow space="4"><mjx-mo class="mjx-s3"><mjx-c class="mjx-c2308"></mjx-c></mjx-mo><mjx-texatom><mjx-mfrac><mjx-frac type="d"><mjx-num><mjx-nstrut type="d"></mjx-nstrut><mjx-mi class="mjx-i"><mjx-c class="mjx-c6E"></mjx-c></mjx-mi></mjx-num><mjx-dbox><mjx-dtable><mjx-line type="d"></mjx-line><mjx-row><mjx-den><mjx-dstrut type="d"></mjx-dstrut><mjx-mn class="mjx-n"><mjx-c class="mjx-c33"></mjx-c></mjx-mn></mjx-den></mjx-row></mjx-dtable></mjx-dbox></mjx-frac></mjx-mfrac><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2B"></mjx-c></mjx-mo><mjx-mfrac space="3"><mjx-frac type="d"><mjx-num><mjx-nstrut type="d"></mjx-nstrut><mjx-mrow><mjx-mn class="mjx-n"><mjx-c class="mjx-c32"></mjx-c></mjx-mn><mjx-mi class="mjx-i"><mjx-c class="mjx-c6E"></mjx-c></mjx-mi><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2B"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="3"><mjx-c class="mjx-c31"></mjx-c></mjx-mn></mjx-mrow></mjx-num><mjx-dbox><mjx-dtable><mjx-line type="d"></mjx-line><mjx-row><mjx-den><mjx-dstrut type="d"></mjx-dstrut><mjx-mrow><mjx-mn class="mjx-n"><mjx-c class="mjx-c33"></mjx-c></mjx-mn><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c22C5"></mjx-c></mjx-mo><mjx-msup><mjx-mn class="mjx-n"><mjx-c class="mjx-c32"></mjx-c></mjx-mn><mjx-script style="vertical-align: 0.363em;"><mjx-texatom size="s"><mjx-mn class="mjx-n"><mjx-c class="mjx-c33"></mjx-c><mjx-c class="mjx-c32"></mjx-c></mjx-mn></mjx-texatom></mjx-script></mjx-msup></mjx-mrow></mjx-den></mjx-row></mjx-dtable></mjx-dbox></mjx-frac></mjx-mfrac></mjx-texatom><mjx-mo class="mjx-s3"><mjx-c class="mjx-c2309"></mjx-c></mjx-mo></mjx-mrow><mjx-tstrut></mjx-tstrut></mjx-mtd></mjx-mtr><mjx-mtr><mjx-mtd style="text-align: right; padding-right: 0px; padding-top: 0.101em; padding-bottom: 0.101em;"><mjx-tstrut></mjx-tstrut></mjx-mtd><mjx-mtd></mjx-mtd></mjx-mtr><mjx-mtr><mjx-mtd style="text-align: right; padding-right: 0px; padding-top: 0.101em; padding-bottom: 0.101em;"><mjx-mstyle size="sm"><mjx-mtext class="mjx-n"><mjx-utext variant="normal" style="font-size: 81%; font-family: serif;">因</mjx-utext><mjx-utext variant="normal" style="font-size: 81%; font-family: serif;">为</mjx-utext></mjx-mtext><mjx-mstyle><mjx-mspace style="width: 0.5em;"></mjx-mspace></mjx-mstyle><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2212"></mjx-c></mjx-mo><mjx-msup><mjx-mn class="mjx-n"><mjx-c class="mjx-c32"></mjx-c></mjx-mn><mjx-script style="vertical-align: 0.413em;"><mjx-texatom size="s"><mjx-mn class="mjx-n"><mjx-c class="mjx-c33"></mjx-c><mjx-c class="mjx-c31"></mjx-c></mjx-mn></mjx-texatom></mjx-script></mjx-msup><mjx-mo class="mjx-n"><mjx-c class="mjx-c2264"></mjx-c></mjx-mo><mjx-mi class="mjx-i" space="4"><mjx-c class="mjx-c6E"></mjx-c></mjx-mi><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c2264"></mjx-c></mjx-mo><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c2212"></mjx-c></mjx-mo><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c></mjx-mn></mjx-mstyle><mjx-tstrut></mjx-tstrut></mjx-mtd><mjx-mtd style="text-align: left; padding-left: 0px; padding-top: 0.101em; padding-bottom: 0.101em;"><mjx-mstyle><mjx-mspace style="width: 0.5em;"></mjx-mspace></mjx-mstyle><mjx-mstyle size="sm"><mjx-mtext class="mjx-n"><mjx-utext variant="normal" style="font-size: 81%; font-family: serif;">所</mjx-utext><mjx-utext variant="normal" style="font-size: 81%; font-family: serif;">以</mjx-utext></mjx-mtext><mjx-mstyle><mjx-mspace style="width: 0.5em;"></mjx-mspace></mjx-mstyle><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2212"></mjx-c></mjx-mo><mjx-mfrac space="3"><mjx-frac type="d"><mjx-num><mjx-nstrut type="d"></mjx-nstrut><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c></mjx-mn></mjx-num><mjx-dbox><mjx-dtable><mjx-line type="d"></mjx-line><mjx-row><mjx-den><mjx-dstrut type="d"></mjx-dstrut><mjx-mn class="mjx-n"><mjx-c class="mjx-c33"></mjx-c></mjx-mn></mjx-den></mjx-row></mjx-dtable></mjx-dbox></mjx-frac></mjx-mfrac><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2B"></mjx-c></mjx-mo><mjx-mfrac space="3"><mjx-frac type="d"><mjx-num><mjx-nstrut type="d"></mjx-nstrut><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c></mjx-mn></mjx-num><mjx-dbox><mjx-dtable><mjx-line type="d"></mjx-line><mjx-row><mjx-den><mjx-dstrut type="d"></mjx-dstrut><mjx-mrow><mjx-mn class="mjx-n"><mjx-c class="mjx-c33"></mjx-c></mjx-mn><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c22C5"></mjx-c></mjx-mo><mjx-msup><mjx-mn class="mjx-n"><mjx-c class="mjx-c32"></mjx-c></mjx-mn><mjx-script style="vertical-align: 0.363em;"><mjx-texatom size="s"><mjx-mn class="mjx-n"><mjx-c class="mjx-c33"></mjx-c><mjx-c class="mjx-c32"></mjx-c></mjx-mn></mjx-texatom></mjx-script></mjx-msup></mjx-mrow></mjx-den></mjx-row></mjx-dtable></mjx-dbox></mjx-frac></mjx-mfrac><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c2264"></mjx-c></mjx-mo><mjx-mfrac space="4"><mjx-frac type="d"><mjx-num><mjx-nstrut type="d"></mjx-nstrut><mjx-mrow><mjx-mn class="mjx-n"><mjx-c class="mjx-c32"></mjx-c></mjx-mn><mjx-mi class="mjx-i"><mjx-c class="mjx-c6E"></mjx-c></mjx-mi><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2B"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="3"><mjx-c class="mjx-c31"></mjx-c></mjx-mn></mjx-mrow></mjx-num><mjx-dbox><mjx-dtable><mjx-line type="d"></mjx-line><mjx-row><mjx-den><mjx-dstrut type="d"></mjx-dstrut><mjx-mrow><mjx-mn class="mjx-n"><mjx-c class="mjx-c33"></mjx-c></mjx-mn><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c22C5"></mjx-c></mjx-mo><mjx-msup><mjx-mn class="mjx-n"><mjx-c class="mjx-c32"></mjx-c></mjx-mn><mjx-script style="vertical-align: 0.363em;"><mjx-texatom size="s"><mjx-mn class="mjx-n"><mjx-c class="mjx-c33"></mjx-c><mjx-c class="mjx-c32"></mjx-c></mjx-mn></mjx-texatom></mjx-script></mjx-msup></mjx-mrow></mjx-den></mjx-row></mjx-dtable></mjx-dbox></mjx-frac></mjx-mfrac><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c2264"></mjx-c></mjx-mo><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c2212"></mjx-c></mjx-mo><mjx-mfrac><mjx-frac type="d"><mjx-num><mjx-nstrut type="d"></mjx-nstrut><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c></mjx-mn></mjx-num><mjx-dbox><mjx-dtable><mjx-line type="d"></mjx-line><mjx-row><mjx-den><mjx-dstrut type="d"></mjx-dstrut><mjx-mrow><mjx-mn class="mjx-n"><mjx-c class="mjx-c33"></mjx-c></mjx-mn><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c22C5"></mjx-c></mjx-mo><mjx-msup><mjx-mn class="mjx-n"><mjx-c class="mjx-c32"></mjx-c></mjx-mn><mjx-script style="vertical-align: 0.363em;"><mjx-texatom size="s"><mjx-mn class="mjx-n"><mjx-c class="mjx-c33"></mjx-c><mjx-c class="mjx-c32"></mjx-c></mjx-mn></mjx-texatom></mjx-script></mjx-msup></mjx-mrow></mjx-den></mjx-row></mjx-dtable></mjx-dbox></mjx-frac></mjx-mfrac></mjx-mstyle><mjx-tstrut></mjx-tstrut></mjx-mtd></mjx-mtr><mjx-mtr><mjx-mtd style="text-align: right; padding-right: 0px; padding-top: 0.101em; padding-bottom: 0.101em;"><mjx-tstrut></mjx-tstrut></mjx-mtd><mjx-mtd></mjx-mtd></mjx-mtr><mjx-mtr><mjx-mtd style="text-align: right; padding-right: 0px; padding-top: 0.101em;"><mjx-mstyle size="sm"><mjx-mtext class="mjx-n"><mjx-utext variant="normal" style="font-size: 81%; font-family: serif;">根</mjx-utext><mjx-utext variant="normal" style="font-size: 81%; font-family: serif;">据</mjx-utext><mjx-c class="mjx-c20"></mjx-c><mjx-c class="mjx-c44"></mjx-c><mjx-c class="mjx-c32"></mjx-c><mjx-utext variant="normal" style="font-size: 81%; font-family: serif;">，</mjx-utext><mjx-utext variant="normal" style="font-size: 81%; font-family: serif;">我</mjx-utext><mjx-utext variant="normal" style="font-size: 81%; font-family: serif;">们</mjx-utext><mjx-utext variant="normal" style="font-size: 81%; font-family: serif;">得</mjx-utext><mjx-utext variant="normal" style="font-size: 81%; font-family: serif;">到</mjx-utext></mjx-mtext><mjx-mstyle><mjx-mspace style="width: 0.5em;"></mjx-mspace></mjx-mstyle><mjx-mi class="mjx-i"><mjx-c class="mjx-c71"></mjx-c></mjx-mi></mjx-mstyle><mjx-tstrut></mjx-tstrut></mjx-mtd><mjx-mtd style="text-align: left; padding-left: 0px; padding-top: 0.101em;"><mjx-mi class="mjx-n"></mjx-mi><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-mrow space="4"><mjx-mo class="mjx-lop"><mjx-c class="mjx-c2308"></mjx-c></mjx-mo><mjx-texatom><mjx-mfrac><mjx-frac type="d"><mjx-num><mjx-nstrut type="d"></mjx-nstrut><mjx-mi class="mjx-i"><mjx-c class="mjx-c6E"></mjx-c></mjx-mi></mjx-num><mjx-dbox><mjx-dtable><mjx-line type="d"></mjx-line><mjx-row><mjx-den><mjx-dstrut type="d"></mjx-dstrut><mjx-mn class="mjx-n"><mjx-c class="mjx-c33"></mjx-c></mjx-mn></mjx-den></mjx-row></mjx-dtable></mjx-dbox></mjx-frac></mjx-mfrac></mjx-texatom><mjx-mo class="mjx-lop"><mjx-c class="mjx-c2309"></mjx-c></mjx-mo></mjx-mrow><mjx-tstrut></mjx-tstrut></mjx-mtd></mjx-mtr></mjx-itable></mjx-table></mjx-mtable></mjx-math></mjx-container></p>
<h2 id="why">Why</h2>
<p>最后，我们来看一下，为什么？</p>
<p>为什么编译器要用这样一个算法来计算除以 3 运算？</p>
<p>为什么不直接调用 CPU 的除法指令？</p>
<p>这个问题的答案很好猜测，在保证结果不变的情况下编译器修改了实现细节，那么一定是因为性能。</p>
<p>在我做 <a href="https://handmadehero.org/" target="_blank">HandmadeHero</a> 项目的过程中，不止一次听到 Casey 说过除法的性能非常非常糟糕。</p>
<p>或者准确点来说，在早期计算机中，除法的性能非常非常糟糕，比乘法要慢的多得多，游戏开发者一般会想尽办法避免除法。</p>
<p>Casey 的代码中就充满了规避除法养成的一些习惯。</p>
<p>比如，要把 RGB 值从 0 ~ 255 规整到 0 ~ 1，一般我们的写法是</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2;" id="code-block-3"><code class="language-c" data-lang="c"><span style="display:flex;"><span>v3
</span></span><span style="display:flex;"><span><span style="color:#900;font-weight:bold">RGBToLinear</span>(i8 r, i8 g, i8 b) {
</span></span><span style="display:flex;"><span>  <span style="color:#000;font-weight:bold">return</span> V3((f32)r <span style="color:#000;font-weight:bold">/</span> <span style="color:#099">255.0f</span>, (f32)g <span style="color:#000;font-weight:bold">/</span> <span style="color:#099">255.0f</span>, (f32)b <span style="color:#000;font-weight:bold">/</span> <span style="color:#099">255.0f</span>);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre><i class="iconfont icon-copy copy-code-btn" data-clipboard-target="#code-block-3"></i></div><p>但是，Casey 的代码写法是</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2;" id="code-block-4"><code class="language-c" data-lang="c"><span style="display:flex;"><span>v3
</span></span><span style="display:flex;"><span><span style="color:#900;font-weight:bold">RGBToLinear</span>(i8 r, i8 g, i8 b) {
</span></span><span style="display:flex;"><span>  f32 inv <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">1.0f</span> <span style="color:#000;font-weight:bold">/</span> <span style="color:#099">255.0f</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#000;font-weight:bold">return</span> V3((f32)r <span style="color:#000;font-weight:bold">*</span> inv, (f32)g <span style="color:#000;font-weight:bold">*</span> inv, (f32)b <span style="color:#000;font-weight:bold">*</span> inv);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre><i class="iconfont icon-copy copy-code-btn" data-clipboard-target="#code-block-4"></i></div><p>这样写的好处就是只做一次除法，剩下的都是乘法运算。</p>
<div class="post__tip">
  <span class="post__tip__span">T</span>ip: <p>注意这里我们举的例子是浮点数除法而不是整数除法。</p>
<p>但是它们背后的机理是一样的，不管是浮点数还是整数，除法运算都比乘法运算要慢。</p>
</div>
<p>我很好奇在当代的 CPU 上，除法到底比乘法慢多少？</p>
<p>我们来写个程序比较一下。</p>
<p>在 X86 中，进行除法运算的指令是 <code>idiv</code>。</p>
<blockquote>
<p>IDIV r/m32, Signed divide EDX:EAX by r/m32, with result stored in EAX ← Quotient, EDX ← Remainder.</p>
</blockquote>
<p>根据手册，<code>idiv x</code> 会将 EDX:EAX 构成的 64bit 整数除以 x 寄存器中的值，商存储在 EAX 中，余数存储在 EDX 中。</p>
<p>我们先把两个算法用汇编写出来，这里我们用的是 nasm，注意它的语法是 Intel，和 GCC 的 AT&amp;T 不一样，target 在左边，source 在右边。</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2;" id="code-block-5"><code class="language-nasm" data-lang="nasm"><span style="display:flex;"><span><span style="color:#998;font-style:italic">; div.asm</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">section</span> <span style="color:#008080">.text</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">global</span> <span style="color:#0086b3">di</span><span style="color:#008080">v3</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">global</span> <span style="color:#0086b3">di</span><span style="color:#008080">v3ByMul</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#900;font-weight:bold">div3:</span>
</span></span><span style="display:flex;"><span>  <span style="color:#900;font-weight:bold">mov</span> <span style="color:#0086b3">eax</span>, <span style="color:#0086b3">edi</span>
</span></span><span style="display:flex;"><span>  <span style="color:#900;font-weight:bold">movsx</span> <span style="color:#0086b3">rdx</span>, <span style="color:#0086b3">edi</span>
</span></span><span style="display:flex;"><span>  <span style="color:#900;font-weight:bold">shr</span> <span style="color:#0086b3">rdx</span>, <span style="color:#099">32</span>
</span></span><span style="display:flex;"><span>  <span style="color:#900;font-weight:bold">mov</span> <span style="color:#0086b3">ecx</span>, <span style="color:#099">3</span>
</span></span><span style="display:flex;"><span>  <span style="color:#900;font-weight:bold">idiv</span> <span style="color:#0086b3">ecx</span>
</span></span><span style="display:flex;"><span>  <span style="color:#900;font-weight:bold">ret</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#900;font-weight:bold">div3ByMul:</span>
</span></span><span style="display:flex;"><span>  <span style="color:#900;font-weight:bold">movsx</span>  <span style="color:#0086b3">rax</span>, <span style="color:#0086b3">edi</span>
</span></span><span style="display:flex;"><span>  <span style="color:#900;font-weight:bold">imul</span>   <span style="color:#0086b3">rax</span>, <span style="color:#099">1431655766</span>
</span></span><span style="display:flex;"><span>  <span style="color:#900;font-weight:bold">shr</span>    <span style="color:#0086b3">rax</span>, <span style="color:#099">32</span>
</span></span><span style="display:flex;"><span>  <span style="color:#900;font-weight:bold">sar</span>    <span style="color:#0086b3">edi</span>, <span style="color:#099">31</span>
</span></span><span style="display:flex;"><span>  <span style="color:#900;font-weight:bold">sub</span>    <span style="color:#0086b3">eax</span>, <span style="color:#0086b3">edi</span>
</span></span><span style="display:flex;"><span>  <span style="color:#900;font-weight:bold">ret</span>
</span></span></code></pre><i class="iconfont icon-copy copy-code-btn" data-clipboard-target="#code-block-5"></i></div><p>在 Linux 上使用 <code>nasm -f elf64 div.asm</code> 编译得到 <code>div.o</code> 文件。</p>
<p>然后是写一段 C 程序调用上面的两个汇编函数并分别测量时间。</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2;" id="code-block-6"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#998;font-style:italic">// compare.c
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#999;font-weight:bold;font-style:italic">#include</span> <span style="color:#999;font-weight:bold;font-style:italic">&lt;stdint.h&gt;</span><span style="color:#999;font-weight:bold;font-style:italic">
</span></span></span><span style="display:flex;"><span><span style="color:#999;font-weight:bold;font-style:italic">#include</span> <span style="color:#999;font-weight:bold;font-style:italic">&lt;stdio.h&gt;</span><span style="color:#999;font-weight:bold;font-style:italic">
</span></span></span><span style="display:flex;"><span><span style="color:#999;font-weight:bold;font-style:italic">#include</span> <span style="color:#999;font-weight:bold;font-style:italic">&lt;sys/time.h&gt;</span><span style="color:#999;font-weight:bold;font-style:italic">
</span></span></span><span style="display:flex;"><span><span style="color:#999;font-weight:bold;font-style:italic">#include</span> <span style="color:#999;font-weight:bold;font-style:italic">&lt;stdlib.h&gt;</span><span style="color:#999;font-weight:bold;font-style:italic">
</span></span></span><span style="display:flex;"><span><span style="color:#999;font-weight:bold;font-style:italic"></span>
</span></span><span style="display:flex;"><span><span style="color:#999;font-weight:bold;font-style:italic">#define i32 int32_t
</span></span></span><span style="display:flex;"><span><span style="color:#999;font-weight:bold;font-style:italic">#define i64 int64_t
</span></span></span><span style="display:flex;"><span><span style="color:#999;font-weight:bold;font-style:italic"></span>
</span></span><span style="display:flex;"><span>i32 <span style="color:#900;font-weight:bold">div3</span>(i32);
</span></span><span style="display:flex;"><span>i32 <span style="color:#900;font-weight:bold">div3ByMul</span>(i32);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#458;font-weight:bold">long</span>
</span></span><span style="display:flex;"><span><span style="color:#900;font-weight:bold">getUS</span>(<span style="color:#000;font-weight:bold">struct</span> timeval start)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#000;font-weight:bold">struct</span> timeval stop;
</span></span><span style="display:flex;"><span>  gettimeofday(<span style="color:#000;font-weight:bold">&amp;</span>stop, <span style="color:#0086b3">NULL</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#000;font-weight:bold">return</span> (stop.tv_sec <span style="color:#000;font-weight:bold">-</span> start.tv_sec) <span style="color:#000;font-weight:bold">*</span> <span style="color:#099">1000000</span> <span style="color:#000;font-weight:bold">+</span> stop.tv_usec <span style="color:#000;font-weight:bold">-</span> start.tv_usec;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#458;font-weight:bold">int</span>
</span></span><span style="display:flex;"><span><span style="color:#900;font-weight:bold">main</span>(<span style="color:#458;font-weight:bold">void</span>)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  srand(<span style="color:#099">0x1234</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#458;font-weight:bold">int</span> n <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">100000</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  i32 <span style="color:#000;font-weight:bold">*</span>randoms <span style="color:#000;font-weight:bold">=</span> (i32 <span style="color:#000;font-weight:bold">*</span>)malloc(<span style="color:#000;font-weight:bold">sizeof</span>(i32) <span style="color:#000;font-weight:bold">*</span> n);
</span></span><span style="display:flex;"><span>  <span style="color:#000;font-weight:bold">if</span>(randoms <span style="color:#000;font-weight:bold">==</span> <span style="color:#0086b3">NULL</span>) {
</span></span><span style="display:flex;"><span>    printf(<span style="color:#d14">"malloc error"</span>);
</span></span><span style="display:flex;"><span>    exit(<span style="color:#099">1</span>);
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#000;font-weight:bold">struct</span> timeval start;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#000;font-weight:bold">while</span>(<span style="color:#099">1</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">for</span>(<span style="color:#458;font-weight:bold">int</span> i <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">0</span>; i <span style="color:#000;font-weight:bold">&lt;</span> n; i<span style="color:#000;font-weight:bold">++</span>) {
</span></span><span style="display:flex;"><span>      i32 v <span style="color:#000;font-weight:bold">=</span> (i32)rand() <span style="color:#000;font-weight:bold">*</span> (rand() <span style="color:#000;font-weight:bold">%</span> <span style="color:#099">2</span> <span style="color:#000;font-weight:bold">==</span> <span style="color:#099">0</span> <span style="color:#000;font-weight:bold">?</span> <span style="color:#099">1</span> <span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">-</span><span style="color:#099">1</span>);
</span></span><span style="display:flex;"><span>      randoms[i] <span style="color:#000;font-weight:bold">=</span> v;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#998;font-style:italic">// check correctness
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>      i32 expected <span style="color:#000;font-weight:bold">=</span> v <span style="color:#000;font-weight:bold">/</span> <span style="color:#099">3</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      i32 r1 <span style="color:#000;font-weight:bold">=</span> div3(v);
</span></span><span style="display:flex;"><span>      <span style="color:#000;font-weight:bold">if</span>(r1 <span style="color:#000;font-weight:bold">!=</span> expected) {
</span></span><span style="display:flex;"><span>        printf(<span style="color:#d14">"div3 produced error result, got %d, expect %d</span><span style="color:#d14">\n</span><span style="color:#d14">"</span>, r1, expected);
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      i32 r2 <span style="color:#000;font-weight:bold">=</span> div3ByMul(v);
</span></span><span style="display:flex;"><span>      <span style="color:#000;font-weight:bold">if</span>(r2 <span style="color:#000;font-weight:bold">!=</span> expected) {
</span></span><span style="display:flex;"><span>        printf(<span style="color:#d14">"div3ByMul produced error result, got %d, expect %d</span><span style="color:#d14">\n</span><span style="color:#d14">"</span>,
</span></span><span style="display:flex;"><span>          r2,
</span></span><span style="display:flex;"><span>          expected);
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#458;font-weight:bold">long</span> t1 <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">0</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#458;font-weight:bold">long</span> t2 <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">0</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">for</span>(<span style="color:#458;font-weight:bold">int</span> i <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">0</span>; i <span style="color:#000;font-weight:bold">&lt;</span> n; i<span style="color:#000;font-weight:bold">++</span>) {
</span></span><span style="display:flex;"><span>      i32 v <span style="color:#000;font-weight:bold">=</span> randoms[i];
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      gettimeofday(<span style="color:#000;font-weight:bold">&amp;</span>start, <span style="color:#0086b3">NULL</span>);
</span></span><span style="display:flex;"><span>      div3ByMul(v);
</span></span><span style="display:flex;"><span>      t1 <span style="color:#000;font-weight:bold">+=</span> getUS(start);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">for</span>(<span style="color:#458;font-weight:bold">int</span> i <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">0</span>; i <span style="color:#000;font-weight:bold">&lt;</span> n; i<span style="color:#000;font-weight:bold">++</span>) {
</span></span><span style="display:flex;"><span>      i32 v <span style="color:#000;font-weight:bold">=</span> randoms[i];
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      gettimeofday(<span style="color:#000;font-weight:bold">&amp;</span>start, <span style="color:#0086b3">NULL</span>);
</span></span><span style="display:flex;"><span>      div3(v);
</span></span><span style="display:flex;"><span>      t2 <span style="color:#000;font-weight:bold">+=</span> getUS(start);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    printf(<span style="color:#d14">"div3ByMul: %ld </span><span style="color:#d14">\t</span><span style="color:#d14"> div3: %ld</span><span style="color:#d14">\n</span><span style="color:#d14">"</span>, t1, t2);
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre><i class="iconfont icon-copy copy-code-btn" data-clipboard-target="#code-block-6"></i></div><p>C 代码很简单，生成一些随机数，首先验证我们的汇编函数返回的结果是正确的，然后测量时间。</p>
<p><code>gcc -Og compare.c div.o -o compare</code> 编译运行。</p>
<p>在我的 64bit CentOS7 中结果如下：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2;" id="code-block-7"><code class="language-plain" data-lang="plain"><span style="display:flex;"><span>div3ByMul: 39976   div3: 42402
</span></span><span style="display:flex;"><span>div3ByMul: 39374   div3: 40548
</span></span><span style="display:flex;"><span>div3ByMul: 39185   div3: 39914
</span></span><span style="display:flex;"><span>div3ByMul: 39655   div3: 40626
</span></span><span style="display:flex;"><span>div3ByMul: 42580   div3: 39658
</span></span><span style="display:flex;"><span>div3ByMul: 39625   div3: 41399
</span></span><span style="display:flex;"><span>div3ByMul: 39196   div3: 40411
</span></span><span style="display:flex;"><span>div3ByMul: 39880   div3: 40563
</span></span><span style="display:flex;"><span>div3ByMul: 39922   div3: 41022
</span></span><span style="display:flex;"><span>div3ByMul: 40601   div3: 40245
</span></span><span style="display:flex;"><span>div3ByMul: 40007   div3: 39863
</span></span><span style="display:flex;"><span>div3ByMul: 39973   div3: 40509
</span></span><span style="display:flex;"><span>div3ByMul: 40600   div3: 40302
</span></span><span style="display:flex;"><span>div3ByMul: 40413   div3: 40462
</span></span><span style="display:flex;"><span>div3ByMul: 40315   div3: 40448
</span></span><span style="display:flex;"><span>div3ByMul: 39506   div3: 40808
</span></span><span style="display:flex;"><span>div3ByMul: 40634   div3: 40772
</span></span><span style="display:flex;"><span>div3ByMul: 39944   div3: 39894
</span></span><span style="display:flex;"><span>div3ByMul: 39727   div3: 40631
</span></span><span style="display:flex;"><span>div3ByMul: 40553   div3: 40393
</span></span><span style="display:flex;"><span>div3ByMul: 39891   div3: 41112
</span></span><span style="display:flex;"><span>div3ByMul: 39334   div3: 48546
</span></span></code></pre><i class="iconfont icon-copy copy-code-btn" data-clipboard-target="#code-block-7"></i></div><p>好像性能差不多？？？</p>
<p>未完待续。</p>
          </div>

          <div id="post__comments"><div class="gt-container"><div class="gt-meta"><span class="gt-counts"><a class="gt-link gt-link-counts" href="https://github.com/cj1128/cj1128.github.io/issues/37" target="_blank" rel="noopener noreferrer">7</a> 条评论</span><div class="gt-user"><div class="gt-user-inner"><span class="gt-user-name">未登录用户</span><span class="gt-ico gt-ico-arrdown"><span class="gt-svg"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" p-id="1619"><path d="M511.872 676.8c-0.003 0-0.006 0-0.008 0-9.137 0-17.379-3.829-23.21-9.97l-251.277-265.614c-5.415-5.72-8.743-13.464-8.744-21.984 0-17.678 14.33-32.008 32.008-32.008 9.157 0 17.416 3.845 23.25 10.009l228.045 241.103 228.224-241.088c5.855-6.165 14.113-10.001 23.266-10.001 8.516 0 16.256 3.32 21.998 8.736 12.784 12.145 13.36 32.434 1.264 45.233l-251.52 265.6c-5.844 6.155-14.086 9.984-23.223 9.984-0.025 0-0.051 0-0.076 0z" p-id="1620"/></svg></span></span></div></div></div><div class="gt-header"><a class="gt-avatar-github"><span class="gt-ico gt-ico-github"><span class="gt-svg"><svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <path d="M64 524C64 719.602 189.356 885.926 364.113 947.017 387.65799 953 384 936.115 384 924.767L384 847.107C248.118 863.007 242.674 773.052 233.5 758.001 215 726.501 171.5 718.501 184.5 703.501 215.5 687.501 247 707.501 283.5 761.501 309.956 800.642 361.366 794.075 387.658 787.497 393.403 763.997 405.637 743.042 422.353 726.638 281.774 701.609 223 615.67 223 513.5 223 464.053 239.322 418.406 271.465 381.627 251.142 320.928 273.421 269.19 276.337 261.415 334.458 256.131 394.888 302.993 399.549 306.685 432.663 297.835 470.341 293 512.5 293 554.924 293 592.81 297.896 626.075 306.853 637.426 298.219 693.46 258.054 747.5 262.966 750.382 270.652 772.185 321.292 753.058 381.083 785.516 417.956 802 463.809 802 513.5 802 615.874 742.99 701.953 601.803 726.786 625.381 750.003 640 782.295 640 818.008L640 930.653C640.752 939.626 640 948.664978 655.086 948.665 832.344 888.962 960 721.389 960 524 960 276.576 759.424 76 512 76 264.577 76 64 276.576 64 524Z"/>
</svg>
</span></span></a><div class="gt-header-comment"><textarea class="gt-header-textarea " placeholder="说点什么" style="overflow: hidden; overflow-wrap: break-word; resize: none; height: 72px;"></textarea><div class="gt-header-preview markdown-body hide"></div><div class="gt-header-controls"><a class="gt-header-controls-tip" href="https://guides.github.com/features/mastering-markdown/" target="_blank" rel="noopener noreferrer"><span class="gt-ico gt-ico-tip"><span class="gt-svg"><svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <path d="M512 366.949535c-16.065554 0-29.982212 13.405016-29.982212 29.879884l0 359.070251c0 16.167882 13.405016 29.879884 29.982212 29.879884 15.963226 0 29.879884-13.405016 29.879884-29.879884L541.879884 396.829419C541.879884 380.763865 528.474868 366.949535 512 366.949535L512 366.949535z" p-id="3083"/>
  <path d="M482.017788 287.645048c0-7.776956 3.274508-15.553912 8.80024-21.181973 5.525732-5.525732 13.302688-8.80024 21.181973-8.80024 7.776956 0 15.553912 3.274508 21.079644 8.80024 5.525732 5.62806 8.80024 13.405016 8.80024 21.181973 0 7.776956-3.274508 15.656241-8.80024 21.181973-5.525732 5.525732-13.405016 8.697911-21.079644 8.697911-7.879285 0-15.656241-3.274508-21.181973-8.697911C485.292295 303.301289 482.017788 295.524333 482.017788 287.645048L482.017788 287.645048z" p-id="3084"/>
  <path d="M512 946.844409c-239.8577 0-434.895573-195.037873-434.895573-434.895573 0-239.8577 195.037873-434.895573 434.895573-434.895573 239.755371 0 434.895573 195.037873 434.895573 434.895573C946.895573 751.806535 751.755371 946.844409 512 946.844409zM512 126.17088c-212.740682 0-385.880284 173.037274-385.880284 385.777955 0 212.740682 173.037274 385.777955 385.880284 385.777955 212.740682 0 385.777955-173.037274 385.777955-385.777955C897.777955 299.208154 724.740682 126.17088 512 126.17088z" p-id="3085"/>
</svg>
</span><span class="gt-ico-text">支持 Markdown 语法</span></span></a><button class="gt-btn gt-btn-preview"><span class="gt-btn-text">预览</span></button><button class="gt-btn gt-btn-login"><span class="gt-btn-text">使用 GitHub 登录</span></button></div></div></div><div class="gt-comments"><div style="position: relative;"><div class="gt-comment " style="transform-origin: center top;"><div class="gt-avatar gt-comment-avatar"><img src="https://avatars.githubusercontent.com/u/1448643?v=4" alt="@mendlin" /></div><div class="gt-comment-content"><div class="gt-comment-header"><div class="gt-comment-block-1"></div><a class="gt-comment-username" href="https://github.com/mendlin">mendlin</a><span class="gt-comment-text">发表于</span><span class="gt-comment-date">大约 1 年前</span><a class="gt-comment-like" title="Like"><span class="gt-ico gt-ico-heart"><span class="gt-svg"><svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
  <path d="M527.061333 166.528A277.333333 277.333333 0 0 1 1000.618667 362.666667a277.333333 277.333333 0 0 1-81.28 196.138666l-377.173334 377.173334a42.666667 42.666667 0 0 1-60.330666 0l-377.173334-377.173334a277.376 277.376 0 0 1 392.277334-392.277333l15.061333 15.061333 15.061333-15.061333z m286.72 377.173333l45.226667-45.226666a192 192 0 0 0-135.808-327.893334 192 192 0 0 0-135.808 56.32l-45.226667 45.226667a42.666667 42.666667 0 0 1-60.330666 0l-45.226667-45.226667a192.042667 192.042667 0 0 0-271.616 271.573334L512 845.482667l301.781333-301.781334z"/>
</svg>
</span></span></a><a class="gt-comment-reply" title="Reply"><span class="gt-ico gt-ico-reply"><span class="gt-svg"><svg viewBox="0 0 1332 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <path d="M529.066665 273.066666 529.066665 0 51.2 477.866666 529.066665 955.733335 529.066665 675.84C870.4 675.84 1109.333335 785.066665 1280 1024 1211.733335 682.666665 1006.933335 341.333334 529.066665 273.066666"/>
</svg>
</span></span></a></div><div class="gt-comment-body markdown-body"><p dir="auto">谢谢文章，看了很受启发。</p></div></div></div><div class="gt-comment " style="transform-origin: center top;"><div class="gt-avatar gt-comment-avatar"><img src="https://avatars.githubusercontent.com/u/1628118?v=4" alt="@wkongzhu" /></div><div class="gt-comment-content"><div class="gt-comment-header"><div class="gt-comment-block-1"></div><a class="gt-comment-username" href="https://github.com/wkongzhu">wkongzhu</a><span class="gt-comment-text">发表于</span><span class="gt-comment-date">大约 1 年前</span><a class="gt-comment-like" title="Like"><span class="gt-ico gt-ico-heart"><span class="gt-svg"><svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
  <path d="M527.061333 166.528A277.333333 277.333333 0 0 1 1000.618667 362.666667a277.333333 277.333333 0 0 1-81.28 196.138666l-377.173334 377.173334a42.666667 42.666667 0 0 1-60.330666 0l-377.173334-377.173334a277.376 277.376 0 0 1 392.277334-392.277333l15.061333 15.061333 15.061333-15.061333z m286.72 377.173333l45.226667-45.226666a192 192 0 0 0-135.808-327.893334 192 192 0 0 0-135.808 56.32l-45.226667 45.226667a42.666667 42.666667 0 0 1-60.330666 0l-45.226667-45.226667a192.042667 192.042667 0 0 0-271.616 271.573334L512 845.482667l301.781333-301.781334z"/>
</svg>
</span></span></a><a class="gt-comment-reply" title="Reply"><span class="gt-ico gt-ico-reply"><span class="gt-svg"><svg viewBox="0 0 1332 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <path d="M529.066665 273.066666 529.066665 0 51.2 477.866666 529.066665 955.733335 529.066665 675.84C870.4 675.84 1109.333335 785.066665 1280 1024 1211.733335 682.666665 1006.933335 341.333334 529.066665 273.066666"/>
</svg>
</span></span></a></div><div class="gt-comment-body markdown-body"><p dir="auto">很深入, 到实现细节. 赞楼主.</p></div></div></div><div class="gt-comment " style="transform-origin: center top;"><div class="gt-avatar gt-comment-avatar"><img src="https://avatars.githubusercontent.com/u/17720494?v=4" alt="@lightfindyou" /></div><div class="gt-comment-content"><div class="gt-comment-header"><div class="gt-comment-block-1"></div><a class="gt-comment-username" href="https://github.com/lightfindyou">lightfindyou</a><span class="gt-comment-text">发表于</span><span class="gt-comment-date">12 个月前</span><a class="gt-comment-like" title="Like"><span class="gt-ico gt-ico-heart"><span class="gt-svg"><svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
  <path d="M527.061333 166.528A277.333333 277.333333 0 0 1 1000.618667 362.666667a277.333333 277.333333 0 0 1-81.28 196.138666l-377.173334 377.173334a42.666667 42.666667 0 0 1-60.330666 0l-377.173334-377.173334a277.376 277.376 0 0 1 392.277334-392.277333l15.061333 15.061333 15.061333-15.061333z m286.72 377.173333l45.226667-45.226666a192 192 0 0 0-135.808-327.893334 192 192 0 0 0-135.808 56.32l-45.226667 45.226667a42.666667 42.666667 0 0 1-60.330666 0l-45.226667-45.226667a192.042667 192.042667 0 0 0-271.616 271.573334L512 845.482667l301.781333-301.781334z"/>
</svg>
</span></span></a><a class="gt-comment-reply" title="Reply"><span class="gt-ico gt-ico-reply"><span class="gt-svg"><svg viewBox="0 0 1332 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <path d="M529.066665 273.066666 529.066665 0 51.2 477.866666 529.066665 955.733335 529.066665 675.84C870.4 675.84 1109.333335 785.066665 1280 1024 1211.733335 682.666665 1006.933335 341.333334 529.066665 273.066666"/>
</svg>
</span></span></a></div><div class="gt-comment-body markdown-body"><p dir="auto">测量的时候尝试把gettime放在循环外面试一下?</p>
<p dir="auto">因为获取时间的开销是很大的,为了减小这个函数的开销,它甚至专门被从从内核从提取到了用户空间(见 man vdso),现在测量的时间可能很大一部分是来自获取时间的开销(尤其是getUS中的getimeofday),在循环外面一次测量总的计算时间可能比较合适</p></div></div></div><div class="gt-comment gt-comment-admin" style="transform-origin: center top;"><div class="gt-avatar gt-comment-avatar"><img src="https://avatars.githubusercontent.com/u/4210829?v=4" alt="@cj1128" /></div><div class="gt-comment-content"><div class="gt-comment-header"><div class="gt-comment-block-1"></div><a class="gt-comment-username" href="https://github.com/cj1128">cj1128</a><span class="gt-comment-text">发表于</span><span class="gt-comment-date">11 个月前</span><a class="gt-comment-like" title="Like"><span class="gt-ico gt-ico-heart"><span class="gt-svg"><svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
  <path d="M527.061333 166.528A277.333333 277.333333 0 0 1 1000.618667 362.666667a277.333333 277.333333 0 0 1-81.28 196.138666l-377.173334 377.173334a42.666667 42.666667 0 0 1-60.330666 0l-377.173334-377.173334a277.376 277.376 0 0 1 392.277334-392.277333l15.061333 15.061333 15.061333-15.061333z m286.72 377.173333l45.226667-45.226666a192 192 0 0 0-135.808-327.893334 192 192 0 0 0-135.808 56.32l-45.226667 45.226667a42.666667 42.666667 0 0 1-60.330666 0l-45.226667-45.226667a192.042667 192.042667 0 0 0-271.616 271.573334L512 845.482667l301.781333-301.781334z"/>
</svg>
</span></span></a><a class="gt-comment-reply" title="Reply"><span class="gt-ico gt-ico-reply"><span class="gt-svg"><svg viewBox="0 0 1332 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <path d="M529.066665 273.066666 529.066665 0 51.2 477.866666 529.066665 955.733335 529.066665 675.84C870.4 675.84 1109.333335 785.066665 1280 1024 1211.733335 682.666665 1006.933335 341.333334 529.066665 273.066666"/>
</svg>
</span></span></a></div><div class="gt-comment-body markdown-body"><blockquote>
<p dir="auto"><a class="user-mention notranslate" data-hovercard-type="user" data-hovercard-url="/users/lightfindyou/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/lightfindyou">@lightfindyou</a><br />
测量的时候尝试把gettime放在循环外面试一下?</p>
<p dir="auto">因为获取时间的开销是很大的,为了减小这个函数的开销,它甚至专门被从从内核从提取到了用户空间(见 man vdso),现在测量的时间可能很大一部分是来自获取时间的开销(尤其是getUS中的getimeofday),在循环外面一次测量总的计算时间可能比较合适</p>
</blockquote>
<p dir="auto">有道理，后面我来试试，感谢这个建议~</p></div></div></div><div class="gt-comment " style="transform-origin: center top;"><div class="gt-avatar gt-comment-avatar"><img src="https://avatars.githubusercontent.com/u/18614678?v=4" alt="@aguludunu" /></div><div class="gt-comment-content"><div class="gt-comment-header"><div class="gt-comment-block-1"></div><a class="gt-comment-username" href="https://github.com/aguludunu">aguludunu</a><span class="gt-comment-text">发表于</span><span class="gt-comment-date">11 个月前</span><a class="gt-comment-like" title="Like"><span class="gt-ico gt-ico-heart"><span class="gt-svg"><svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
  <path d="M527.061333 166.528A277.333333 277.333333 0 0 1 1000.618667 362.666667a277.333333 277.333333 0 0 1-81.28 196.138666l-377.173334 377.173334a42.666667 42.666667 0 0 1-60.330666 0l-377.173334-377.173334a277.376 277.376 0 0 1 392.277334-392.277333l15.061333 15.061333 15.061333-15.061333z m286.72 377.173333l45.226667-45.226666a192 192 0 0 0-135.808-327.893334 192 192 0 0 0-135.808 56.32l-45.226667 45.226667a42.666667 42.666667 0 0 1-60.330666 0l-45.226667-45.226667a192.042667 192.042667 0 0 0-271.616 271.573334L512 845.482667l301.781333-301.781334z"/>
</svg>
</span></span></a><a class="gt-comment-reply" title="Reply"><span class="gt-ico gt-ico-reply"><span class="gt-svg"><svg viewBox="0 0 1332 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <path d="M529.066665 273.066666 529.066665 0 51.2 477.866666 529.066665 955.733335 529.066665 675.84C870.4 675.84 1109.333335 785.066665 1280 1024 1211.733335 682.666665 1006.933335 341.333334 529.066665 273.066666"/>
</svg>
</span></span></a></div><div class="gt-comment-body markdown-body"><p dir="auto">测量时间用RDTSC，记得关闭降频</p></div></div></div><div class="gt-comment gt-comment-admin" style="transform-origin: center top;"><div class="gt-avatar gt-comment-avatar"><img src="https://avatars.githubusercontent.com/u/4210829?v=4" alt="@cj1128" /></div><div class="gt-comment-content"><div class="gt-comment-header"><div class="gt-comment-block-1"></div><a class="gt-comment-username" href="https://github.com/cj1128">cj1128</a><span class="gt-comment-text">发表于</span><span class="gt-comment-date">11 个月前</span><a class="gt-comment-like" title="Like"><span class="gt-ico gt-ico-heart"><span class="gt-svg"><svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
  <path d="M527.061333 166.528A277.333333 277.333333 0 0 1 1000.618667 362.666667a277.333333 277.333333 0 0 1-81.28 196.138666l-377.173334 377.173334a42.666667 42.666667 0 0 1-60.330666 0l-377.173334-377.173334a277.376 277.376 0 0 1 392.277334-392.277333l15.061333 15.061333 15.061333-15.061333z m286.72 377.173333l45.226667-45.226666a192 192 0 0 0-135.808-327.893334 192 192 0 0 0-135.808 56.32l-45.226667 45.226667a42.666667 42.666667 0 0 1-60.330666 0l-45.226667-45.226667a192.042667 192.042667 0 0 0-271.616 271.573334L512 845.482667l301.781333-301.781334z"/>
</svg>
</span></span></a><a class="gt-comment-reply" title="Reply"><span class="gt-ico gt-ico-reply"><span class="gt-svg"><svg viewBox="0 0 1332 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <path d="M529.066665 273.066666 529.066665 0 51.2 477.866666 529.066665 955.733335 529.066665 675.84C870.4 675.84 1109.333335 785.066665 1280 1024 1211.733335 682.666665 1006.933335 341.333334 529.066665 273.066666"/>
</svg>
</span></span></a></div><div class="gt-comment-body markdown-body"><blockquote>
<p dir="auto"><a class="user-mention notranslate" data-hovercard-type="user" data-hovercard-url="/users/aguludunu/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/aguludunu">@aguludunu</a><br />
测量时间用RDTSC，记得关闭降频</p>
</blockquote>
<p dir="auto">好的我试试，这个 intrinsic 我记得 Casey 也提到过。</p></div></div></div><div class="gt-comment " style="transform-origin: center top;"><div class="gt-avatar gt-comment-avatar"><img src="https://avatars.githubusercontent.com/u/20399522?v=4" alt="@Simakeng" /></div><div class="gt-comment-content"><div class="gt-comment-header"><div class="gt-comment-block-1"></div><a class="gt-comment-username" href="https://github.com/Simakeng">Simakeng</a><span class="gt-comment-text">发表于</span><span class="gt-comment-date">8 个月前</span><a class="gt-comment-like" title="Like"><span class="gt-ico gt-ico-heart"><span class="gt-svg"><svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
  <path d="M527.061333 166.528A277.333333 277.333333 0 0 1 1000.618667 362.666667a277.333333 277.333333 0 0 1-81.28 196.138666l-377.173334 377.173334a42.666667 42.666667 0 0 1-60.330666 0l-377.173334-377.173334a277.376 277.376 0 0 1 392.277334-392.277333l15.061333 15.061333 15.061333-15.061333z m286.72 377.173333l45.226667-45.226666a192 192 0 0 0-135.808-327.893334 192 192 0 0 0-135.808 56.32l-45.226667 45.226667a42.666667 42.666667 0 0 1-60.330666 0l-45.226667-45.226667a192.042667 192.042667 0 0 0-271.616 271.573334L512 845.482667l301.781333-301.781334z"/>
</svg>
</span></span></a><a class="gt-comment-reply" title="Reply"><span class="gt-ico gt-ico-reply"><span class="gt-svg"><svg viewBox="0 0 1332 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <path d="M529.066665 273.066666 529.066665 0 51.2 477.866666 529.066665 955.733335 529.066665 675.84C870.4 675.84 1109.333335 785.066665 1280 1024 1211.733335 682.666665 1006.933335 341.333334 529.066665 273.066666"/>
</svg>
</span></span></a></div><div class="gt-comment-body markdown-body"><p dir="auto">感谢分享，最近在实现定点数快速运算，很多机器相关的细节不好找资料，讲的非常详细，受益匪浅。</p></div></div></div></div></div></div></div>
        </div>

        <div class="post__toc toc"><ol class="toc-list "><li class="toc-list-item is-active-li"><a href="#assembly-code" class="toc-link node-name--H2  is-active-link">Assembly Code</a></li><li class="toc-list-item"><a href="#validate" class="toc-link node-name--H2 ">Validate</a></li><li class="toc-list-item"><a href="#proof" class="toc-link node-name--H2 ">Proof</a></li><li class="toc-list-item"><a href="#why" class="toc-link node-name--H2 ">Why</a></li></ol></div>
      </div>
    </div>
  </div>


  <script src="https://cdn.jsdelivr.net/npm/zoom-vanilla.js@2.0.6/dist/zoom-vanilla.min.js"></script>
  <script src="/asset/main.js"></script><script src="/asset/pc.js"></script>

  
  <script>
    (function() {
      var _hmt = _hmt || [];
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?4f34ee3c85734c8235badd2b99b092a6";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>

  
  <div style="display: none">
    <script type="text/javascript" src="https://s23.cnzz.com/z_stat.php?id=1277776204&amp;web_id=1277776204"></script>
  </div>


<div class="notyf"></div><div class="notyf-announcer" aria-atomic="true" aria-live="polite" style="border: 0px; clip: rect(0px, 0px, 0px, 0px); height: 1px; margin: -1px; overflow: hidden; padding: 0px; position: absolute; width: 1px; outline: 0px;"></div></body></html>