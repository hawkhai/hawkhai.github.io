---
title : 自动快照存档
---

* TIME: 2022-11-18 23:03:32
* URL: <https://github.com/zchrissirhcz/awesome-ncnn/blob/master/FAQ.md>

-----

Skip to content Toggle navigation

[ ](https://github.com/)

[ Sign up
](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-
name%3E%2F%3Crepo-name%3E%2Fblob%2Fshow&source=header-repo)

  * Product 

    * [ Actions Automate any workflow  ](/features/actions)
    * [ Packages Host and manage packages  ](/features/packages)
    * [ Security Find and fix vulnerabilities  ](/features/security)
    * [ Codespaces Instant dev environments  ](/features/codespaces)
    * [ Copilot Write better code with AI  ](/features/copilot)
    * [ Code review Manage code changes  ](/features/code-review)
    * [ Issues Plan and track work  ](/features/issues)
    * [ Discussions Collaborate outside of code  ](/features/discussions)
    * Explore
    * [ All features ](/features)
    * [ Documentation  ](https://docs.github.com)
    * [ GitHub Skills  ](https://skills.github.com/)
    * [ Blog  ](https://github.blog)

  * Solutions 

    * By Plan
    * [ Enterprise ](/enterprise)
    * [ Teams ](/team)
    * [ Compare all ](/pricing#compare-features)
    * By Solution
    * [ CI/CD & Automation ](/solutions/ci-cd/)
    * [ DevOps  ](https://resources.github.com/devops/)
    * [ DevSecOps  ](https://resources.github.com/devops/fundamentals/devsecops/)
    * Case Studies
    * [ Customer Stories ](/customer-stories)
    * [ Resources  ](https://resources.github.com/)

  * Open Source 

    * [ GitHub Sponsors Fund open source developers  ](/sponsors)
    * [ The ReadME Project GitHub community articles  ](/readme)
    * Repositories
    * [ Topics ](/topics)
    * [ Trending ](/trending)
    * [ Collections ](/collections)

  * [Pricing](/pricing)

  * [ ![]() In this repository  All GitHub  ↵ Jump to ↵ ]()

  * No suggested jump to results

  * [ ![]() In this repository  All GitHub  ↵ Jump to ↵ ]()
  * [ ![]() In this user  All GitHub  ↵ Jump to ↵ ]()
  * [ ![]() In this repository  All GitHub  ↵ Jump to ↵ ]()

[ Sign in
](/login?return_to=https%3A%2F%2Fgithub.com%2Fzchrissirhcz%2Fawesome-
ncnn%2Fblob%2Fmaster%2FFAQ.md)

[ Sign up
](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-
name%3E%2F%3Crepo-name%3E%2Fblob%2Fshow&source=header-
repo&source_repo=zchrissirhcz%2Fawesome-ncnn)

{{ message }}

[zchrissirhcz](/zchrissirhcz) / **[awesome-ncnn](/zchrissirhcz/awesome-ncnn)
** Public

  * [ Notifications ](/login?return_to=%2Fzchrissirhcz%2Fawesome-ncnn)
  * [ Fork 90 ](/login?return_to=%2Fzchrissirhcz%2Fawesome-ncnn)
  * [ Star  541 ](/login?return_to=%2Fzchrissirhcz%2Fawesome-ncnn)

  * [ Code ](/zchrissirhcz/awesome-ncnn)
  * [ Issues 1 ](/zchrissirhcz/awesome-ncnn/issues)
  * [ Pull requests 0 ](/zchrissirhcz/awesome-ncnn/pulls)
  * [ Actions ](/zchrissirhcz/awesome-ncnn/actions)
  * [ Projects 0 ](/zchrissirhcz/awesome-ncnn/projects)
  * [ Security ](/zchrissirhcz/awesome-ncnn/security)
  * [ Insights ](/zchrissirhcz/awesome-ncnn/pulse)

More

  * [ Code ](/zchrissirhcz/awesome-ncnn)
  * [ Issues ](/zchrissirhcz/awesome-ncnn/issues)
  * [ Pull requests ](/zchrissirhcz/awesome-ncnn/pulls)
  * [ Actions ](/zchrissirhcz/awesome-ncnn/actions)
  * [ Projects ](/zchrissirhcz/awesome-ncnn/projects)
  * [ Security ](/zchrissirhcz/awesome-ncnn/security)
  * [ Insights ](/zchrissirhcz/awesome-ncnn/pulse)

[Permalink](/zchrissirhcz/awesome-
ncnn/blob/f22f28a00a2aeceabea9cb2ec45a3058f7454c23/FAQ.md)

master

Switch branches/tags

Branches Tags

Could not load branches

Nothing to show

[ {{ refName }} default ](https://github.com/zchrissirhcz/awesome-ncnn/blob/{{
urlEncodedRefName }}/FAQ.md) [View all branches](/zchrissirhcz/awesome-
ncnn/branches)

Could not load tags

Nothing to show

[ {{ refName }} default ](https://github.com/zchrissirhcz/awesome-ncnn/blob/{{
urlEncodedRefName }}/FAQ.md)

[View all tags](/zchrissirhcz/awesome-ncnn/tags)

# Name already in use

A tag already exists with the provided branch name. Many Git commands accept
both tag and branch names, so creating this branch may cause unexpected
behavior. Are you sure you want to create this branch?

Cancel  Create

##  [awesome-ncnn](/zchrissirhcz/awesome-ncnn)/ **FAQ.md**

[ Go to file ](/zchrissirhcz/awesome-ncnn/find/master)

  * [ Go to file T ](/zchrissirhcz/awesome-ncnn/find/master)
  * Go to line L
  *   * Copy path 
  * Copy permalink

This commit does not belong to any branch on this repository, and may belong
to a fork outside of the repository.

[![@zchrissirhcz](https://avatars.githubusercontent.com/u/3831847?s=48&v=4)](/zchrissirhcz)

[zchrissirhcz](/zchrissirhcz) [mention UP's common used
OS/Editor/etc](/zchrissirhcz/awesome-
ncnn/commit/02844782ef546cb5dd93dc84c8ce57292a6eb768 "mention UP's common used
OS/Editor/etc")

Latest commit [0284478](/zchrissirhcz/awesome-
ncnn/commit/02844782ef546cb5dd93dc84c8ce57292a6eb768) Apr 1, 2021 [
**History** ](/zchrissirhcz/awesome-ncnn/commits/master/FAQ.md)

**1** contributor

###  Users who have contributed to this file

ncnn 小白常见问题整理 常见问题1. rtti/exceptions冲突 常见问题2. 编ncnn时protobuf报错/版本错？ 常见问题3.
怎样添加ncnn库到项目中？cmake方式怎么用？ 常见问题4. 找不到OpenCV？OpenCV_DIR设成什么？ 常见问题5. 为啥自己编译的ncnn
android库特别大？ 常见问题6. undefined reference to `glslang::FinalizeProcess()' 常见问题7.
up主用的什么系统/编辑器？

149 lines (114 sloc)  8.13 KB

[ ](/zchrissirhcz/awesome-ncnn/blob/master/FAQ.md?plain=1) [
](/zchrissirhcz/awesome-ncnn/blob/master/FAQ.md)

[ Raw ](/zchrissirhcz/awesome-ncnn/raw/master/FAQ.md) [ Blame
](/zchrissirhcz/awesome-ncnn/blame/master/FAQ.md)

Edit this file

E

[ Open in GitHub Desktop ](https://desktop.github.com)

  * [ Open with Desktop ](https://desktop.github.com)
  * [ View raw ](/zchrissirhcz/awesome-ncnn/raw/master/FAQ.md)
  * Copy raw contents  Copy raw contents  Copy raw contents  Copy raw contents 
  * [ View blame ](/zchrissirhcz/awesome-ncnn/blame/master/FAQ.md)

# ncnn 小白常见问题整理

## 常见问题1. rtti/exceptions冲突

在Android NDK（JNI）代码中遇到报错`error: use of typeid requires -frtti`

原因：ncnn的android预编译包的编译选项中，禁用了`rtti`（同时还禁用了`exceptions`），而OpenCV的android预编译包开启了`rtti`和`exceptions`（这是在NDK的toolchains.cmake中默认开启的）；当两个（或多个）库的rtti、exceptions编译选项设定不同时，会导致冲突，需要统一。

P.S.为什么ncnn预编译包要关掉rtti和exceptions：大概是为了减小包的大小

P.S.怎样统一ncnn和opencv的android库里头的rtti和exceptions？提供几种方案，任选其一，难度从低到高：

**方法1：用opencv-mobile库替代opencv anroid库**

不用opencv官方的预编译android库，用 <https://github.com/nihui/opencv-mobile/releases>

**方法2：重编ncnn，编译时开启rtti、exceptions**

基于cmake和ninja，自行编译ncnn的android库，编译时注意：

  * 去掉`-g`参数以减小库体积：打开`$ANDROID_NDK/build/cmake/android.toolchain.cmake`

    
    
    # 删除 "-g" 这行
    list(APPEND ANDROID_COMPILER_FLAGS
      -g
      -DANDROID
    

  * 在命令行（或CMake-GUI）里，用cmake构建，构建时传入`-DNCNN_DISABLE_EXCEPTION=OFF -DNCNN_DISABLE_RTTI=OFF`；如果先前构建过，请清理build/CMakeCache.txt；不要在Android Studio里构建ncnn库，因为很可能你的rtti和exceptions还是弄错

  * 如果你不会cmake，请去学习，这非常基础

**方法3：不用opencv**

## 常见问题2. 编ncnn时protobuf报错/版本错？

当编译 ncnn 时，我们从 cmake 构建的角度去看，ncnn 这个开源项目有多个构建目标，包括：

  * ncnn 库本身；它不依赖protobuf，也不依赖opencv
  * ncnn 转换工具，例如 caffe2ncnn, mxnet2ncnn, darknet2ncnn, onnx2ncnn, keras2ncnn, mlir2ncnn等；其中 caffe2ncnn 和 onnx2ncnn 依赖 protobuf 库
  * ncnn 例子，包括 squeezenet，yolov5, nanodet 等，都依赖opencv

如果你遇到 protobuf 找不到或版本错误等问题，可以考虑跳过，因为 <https://convertmodel.com>
这个网站提供了一站式的各种常见CNN推理库的模型转换工具的本地在线版，直接使用即可。

简单解释下什么是“本地在线版”：它是基于WebAssembly（wasm）实现的一个网页，当你上传模型文件时，实际上是在本地执行的转换；或者说，当你访问
<https://convertmodel.com> 后，断网，然后用这个网页，依然是能转换的；因此不必担心模型被上传到外网的风险。

P.S. 如果用 <https://convertmodel.com> 这个网站转换，发现报错，请在 ncnn卷卷群里 @大缺弦 ，他是这个网站的作者；或
@nihui ，他是 ncnn 作者。

## 常见问题3. 怎样添加ncnn库到项目中？cmake方式怎么用？

基于cmake，在CMakeLists.txt里写这几句：

    
    
    set(ncnn_DIR "<ncnn_install_dir>/lib/cmake/ncnn" CACHE PATH "Directory that contains ncnnConfig.cmake")
    find_package(ncnn REQUIRED)
    target_link_libraries(my_target ncnn)

其中 `ncnn_DIR`是包含`ncnnConfig.cmake`的目录；如果你的ncnn是手动编译的，在Linux/Mac下请先执行make
install，`ncnn_install_dir`此时对应 `build/install` 目录。

## 常见问题4. 找不到OpenCV？OpenCV_DIR设成什么？

在自己的项目中使用到
opencv；或者是在ncnn的项目中希望跑通example例子，需要正确的找到opencv。cmake方式，是设定`OpenCV_DIR`，它的指，是包含`OpenCVConfig.cmake`的目录：注意请自行检查这个目录，而不是草率的设定为“OpenCV安装的根目录”，因为在Linux/Windows/Mac/Android下，这个目录不一样。

例如本人的常用设定模板：

    
    
    if (CMAKE_HOST_SYSTEM_NAME MATCHES "Linux")
        if (CMAKE_SYSTEM_NAME MATCHES "Linux")
            #set(OpenCV_DIR "/home/zz/soft/opencv-4.5.1/lib/cmake/opencv4" CACHE PATH "") # shared
            set(OpenCV_DIR "/home/zz/soft/opencv-4.5.1-static/lib/cmake/opencv4" CACHE PATH "") # static
        elseif (ANDROID)
            set(OpenCV_DIR "/home/zz/soft/opencv-4.5.1-android/sdk/native/jni" CACHE PATH "")
        endif()
    elseif (CMAKE_HOST_SYSTEM_NAME MATCHES "Windows")
        if (CMAKE_SYSTEM_NAME MATCHES "Windows")
            #set(OpenCV_DIR "E:/lib/opencv/4.5.0" CACHE PATH "")
            set(OpenCV_DIR "E:/lib/opencv/4.5.2-pre" CACHE PATH "")
        elseif (ANDROID)
            set(OpenCV_DIR "E:/soft/Android/opencv-4.5.0-android-sdk/sdk/native/jni" CACHE PATH "")
        endif()
    elseif (CMAKE_HOST_SYSTEM_NAME MATCHES "Darwin")
        if (CMAKE_SYSTEM_NAME MATCHES "Darwin")
            set(OpenCV_DIR "/usr/local/opencv-4.2/lib/cmake/opencv4" CACHE PATH "")
        elseif (ANDROID)
            set(OpenCV_DIR "/Users/chris/soft/opencv-4.5.0-android-sdk/sdk/native/jni" CACHE PATH "")
        endif()
    endif()
    find_package(OpenCV REQUIRED)
    target_link_libraries(testbed ${OpenCV_LIBS})

## 常见问题5. 为啥自己编译的ncnn android库特别大？

很可能是没有去掉`-g`导致的。

基于cmake和ninja，自行编译ncnn的android库，编译时注意：

  * 去掉`-g`参数以减小库体积：打开`$ANDROID_NDK/build/cmake/android.toolchain.cmake`

    
    
    # 删除 "-g" 这行
    list(APPEND ANDROID_COMPILER_FLAGS
      -g
      -DANDROID
    

## 常见问题6. undefined reference to `glslang::FinalizeProcess()'

使用ncnn vulkan库时遇到报错例如：

    
    
    /hone/inxsuno/inx-yocto-bsp/inx6qp/task/ncnn_inx8_build/install/lib/Libncnn.a(gpu.cpp.o): In function 'ncn::destroy
    _gpu_instance() ':
    gpu.cpp:(.text+0xfb8): undefined reference to 'glslang::FinalizeProcess() '
    /hone/inxsuno/inx-yocto-bsp/inx6qp/task/ncnn_imx8 butid/instal/ltb/l.tbncn .a(gpu.cpp.o): In function 'ncm:create gpu_instance() pu.cpp:(.text+0x39a0): undefined reference to 'glslang::InitializeProcess()'
    /hone/inxsuno/inx -ycto-bsp/in;oqp/task /ncm inmv8 buildjinstal/Lib/litncm.a(gpu.pp.o): In fucion ‘ncnm:comple spitv ole(char cost,in , nmn1 .oprto coste,cator<unsigned int> >&) ':
    gpu.cpp:(.text+Ox78b4): undefined reference to 'glslang::TShader : :TShader(EShLanguage)'
    gpu.cpp:(.text+×78c8): undefined reference to glslang::TShader:.setstringswithLengths(char const* const*,int const*,int)"
    Spu.cpp;(.text-+8x7B8dc): undefined reference to 'glslang Tshader :.dProcsses(std:.vectorsty:_co1:basic string chr ,tti.xchar_traitschar ,.sthallacatorcharpic_string<char, std::char_traits<char>, std::allocator<char> > > > const&)'
    gpu.cpp:(.text+0x78ec): undefined reference to 'glslang:: TShader ::setEntryPoint(char const*)'
    gpu.cpp:( . text+0x78f8): undefined reference to 'glslang::TShader::setSourceEntryPoint(char const*)'
    gpu.cpp:(.text+0x7a8c): undefined reference to ‘glslang::TShader ::.parse( TBuiltInResource const*，int，EProfile， boo
    , bool，EShMessages, glslang : : TShader : : Includer&)'
    gpu.cpp:(.text+0x7ad4): undefined reference to `glslang:: TShader ::getInfoLog()'
    pu.cpp:(.text+Ox7afc): undefined reference to 'glslang::TShader ::getInfoDebugLog()'gpu.cpp:(.text+0x7b20): undefined reference to `glslang::TShader::~TShader() '
    Jpu.gp:(.text+6x84f4): undefined reference to ‘glslang;clslangTosp(glslng.e TIntenediate cost& lstt.wecoransigned nt, stir:alloctoransigned int >, glslag:gpu.cpp:(.text+0x8500): undefined reference to 'glslang:: TShader :~TShader()'
    pu.cpp:(.text+0x9618): undefined reference to 'glslang::TShader : :~TShader()'collect2 : error : ld returned 1.exit status
    nake[2]:***[TEST_PIPLINE]错误1
    ake[1j:***[CMakeFiles /TEST_PIPLINE.dir/all]错误﹖
    

错误的写法：

    
    
    set(NCC_INCLUDE_DIRS /home/imxsumo/imx-yocto-bsp/imx6qp/task/ncnn_imx8_build/install/include/ncnn)
    
    target_link_libraries(TEST_PIPLINE glslang MachineIndependent SPIRV ncnn ${OpenCV_LIBS} ${FT_LIBS} pthread g2d gomp vulkan)

原因：CMakeLists.txt中，自行手动指定的ncnn静态库，以及vulkan相关的glslang库等，但顺序没弄对。

解决方法：`find_package(ncnn)`，它会自动设定正确的链接库及其顺序

    
    
    set(ncnn_DIR "<ncnn_install_dir>/lib/cmake/ncnn" CACHE PATH "Directory that contains ncnnConfig.cmake")
    find_package(ncnn REQUIRED)
    target_link_libraries(my_target ncnn)
    

## 常见问题7. up主用的什么系统/编辑器？

  * 系统：Fedora
  * 编辑器：Kate
  * 桌面：KDE
  * 画草图：kolourpaint
  * 画函数图像：kmplot

Go

## Footer

[ ](https://github.com "GitHub") © 2022 GitHub, Inc.

### Footer navigation

  * [Terms](https://docs.github.com/en/github/site-policy/github-terms-of-service)
  * [Privacy](https://docs.github.com/en/github/site-policy/github-privacy-statement)
  * [Security](https://github.com/security)
  * [Status](https://www.githubstatus.com/)
  * [Docs](https://docs.github.com)
  * [Contact GitHub](https://support.github.com?tags=dotcom-footer)
  * [Pricing](https://github.com/pricing)
  * [API](https://docs.github.com)
  * [Training](https://services.github.com)
  * [Blog](https://github.blog)
  * [About](https://github.com/about)

You can’t perform that action at this time.

You signed in with another tab or window. [Reload]() to refresh your session.
You signed out in another tab or window. [Reload]() to refresh your session.

