---
title : 自动快照存档
---

* TIME: 2022-04-09 12:08:34
* URL: <https://github.com/AzAgarampur/byeintegrity-uac>

-----

Skip to content

[ ](https://github.com/)

[ Sign up
](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-
name%3E%2F%3Crepo-name%3E&source=header-repo)

  * Product 

    * [ Features ](/features)
    * [ Mobile ](/mobile)
    * [ Actions ](/features/actions)
    * [ Codespaces ](/features/codespaces)
    * [ Packages ](/features/packages)
    * [ Security ](/features/security)
    * [ Code review ](/features/code-review)
    * [ Issues ](/features/issues)
    * [ Integrations ](/features/integrations)
    * [ GitHub Sponsors ](/sponsors)
    * [ Customer stories ](/customer-stories)

  * [Team](/team)
  * [Enterprise](/enterprise)
  * Explore 

    * [ Explore GitHub ](/explore)
    * Learn and contribute
    * [ Topics ](/topics)
    * [ Collections ](/collections)
    * [ Trending ](/trending)
    * [ Learning Lab ](https://lab.github.com/)
    * [ Open source guides ](https://opensource.guide)
    * Connect with others
    * [ The ReadME Project ](/readme)
    * [ Events ](/events)
    * [ Community forum ](https://github.community)
    * [ GitHub Education ](https://education.github.com)
    * [ GitHub Stars program ](https://stars.github.com)

  * [Marketplace](/marketplace)
  * Pricing 

    * [ Plans ](/pricing)
    * [ Compare plans ](/pricing#compare-features)
    * [ Contact Sales ](https://github.com/enterprise/contact)
    * [ Education ](https://education.github.com)

  * [ ![]() In this repository  All GitHub  ↵ Jump to ↵ ]()

  * No suggested jump to results

  * [ ![]() In this repository  All GitHub  ↵ Jump to ↵ ]()
  * [ ![]() In this user  All GitHub  ↵ Jump to ↵ ]()
  * [ ![]() In this repository  All GitHub  ↵ Jump to ↵ ]()

[ Sign in
](/login?return_to=https%3A%2F%2Fgithub.com%2FAzAgarampur%2Fbyeintegrity-uac)

[ Sign up
](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-
name%3E%2F%3Crepo-name%3E&source=header-
repo&source_repo=AzAgarampur%2Fbyeintegrity-uac)

{{ message }}

##  [AzAgarampur](/AzAgarampur) / **[byeintegrity-
uac](/AzAgarampur/byeintegrity-uac) ** Public

  * [ Notifications ](/login?return_to=%2FAzAgarampur%2Fbyeintegrity-uac)
  * [ Fork 45 ](/login?return_to=%2FAzAgarampur%2Fbyeintegrity-uac)
  * [ Star  178 ](/login?return_to=%2FAzAgarampur%2Fbyeintegrity-uac)

Bypass UAC by hijacking a DLL located in the Native Image Cache

[ 178 stars ](/AzAgarampur/byeintegrity-uac/stargazers) [ 45 forks
](/AzAgarampur/byeintegrity-uac/network/members)

[ Star  ](/login?return_to=%2FAzAgarampur%2Fbyeintegrity-uac)

[ Notifications ](/login?return_to=%2FAzAgarampur%2Fbyeintegrity-uac)

  * [ Code ](/AzAgarampur/byeintegrity-uac)
  * [ Issues 1 ](/AzAgarampur/byeintegrity-uac/issues)
  * [ Pull requests 0 ](/AzAgarampur/byeintegrity-uac/pulls)
  * [ Actions ](/AzAgarampur/byeintegrity-uac/actions)
  * [ Projects 0 ](/AzAgarampur/byeintegrity-uac/projects?type=beta)
  * [ Wiki ](/AzAgarampur/byeintegrity-uac/wiki)
  * [ Security ](/AzAgarampur/byeintegrity-uac/security)
  * [ Insights ](/AzAgarampur/byeintegrity-uac/pulse)

More

  * [ Code ](/AzAgarampur/byeintegrity-uac)
  * [ Issues ](/AzAgarampur/byeintegrity-uac/issues)
  * [ Pull requests ](/AzAgarampur/byeintegrity-uac/pulls)
  * [ Actions ](/AzAgarampur/byeintegrity-uac/actions)
  * [ Projects ](/AzAgarampur/byeintegrity-uac/projects?type=beta)
  * [ Wiki ](/AzAgarampur/byeintegrity-uac/wiki)
  * [ Security ](/AzAgarampur/byeintegrity-uac/security)
  * [ Insights ](/AzAgarampur/byeintegrity-uac/pulse)

This commit does not belong to any branch on this repository, and may belong
to a fork outside of the repository.

master

Switch branches/tags

Branches Tags

Could not load branches

Nothing to show

[ {{ refName }} default ](https://github.com/AzAgarampur/byeintegrity-
uac/tree/{{ urlEncodedRefName }}) [View all
branches](/AzAgarampur/byeintegrity-uac/branches)

Could not load tags

Nothing to show

[ {{ refName }} default ](https://github.com/AzAgarampur/byeintegrity-
uac/tree/{{ urlEncodedRefName }})

[View all tags](/AzAgarampur/byeintegrity-uac/tags)

[ **1** branch ](/AzAgarampur/byeintegrity-uac/branches) [ **0** tags
](/AzAgarampur/byeintegrity-uac/tags)

[ Go to file ](/AzAgarampur/byeintegrity-uac/find/master) Code

  * [ ](https://docs.github.com/articles/which-remote-url-should-i-use)

Clone

HTTPS  GitHub CLI

Use Git or checkout with SVN using the web URL.

Work fast with our official CLI. [Learn more](https://cli.github.com).

  * [ Open with GitHub Desktop ](https://desktop.github.com)
  * [ Download ZIP ](/AzAgarampur/byeintegrity-uac/archive/refs/heads/master.zip)

#### Launching GitHub Desktop

If nothing happens, [download GitHub Desktop](https://desktop.github.com/) and
try again.

#### Launching GitHub Desktop

If nothing happens, [download GitHub Desktop](https://desktop.github.com/) and
try again.

#### Launching Xcode

If nothing happens, [download Xcode](https://developer.apple.com/xcode/) and
try again.

#### Launching Visual Studio Code

Your codespace will open once ready.

There was a problem preparing your codespace, please try again.

## Latest commit

[ ![@AzAgarampur](https://avatars.githubusercontent.com/u/42058942?s=48&v=4)
](/AzAgarampur)

[AzAgarampur](/AzAgarampur/byeintegrity-uac/commits?author=AzAgarampur "View
all commits by AzAgarampur") [2021 Update.](/AzAgarampur/byeintegrity-
uac/commit/ad1e6acdd7d9d0277a634927fdfaf94253d9d49f "2021 Update.")

…

[ ad1e6ac ](/AzAgarampur/byeintegrity-
uac/commit/ad1e6acdd7d9d0277a634927fdfaf94253d9d49f) [ on 21 Nov 2021
](/AzAgarampur/byeintegrity-
uac/commit/ad1e6acdd7d9d0277a634927fdfaf94253d9d49f)

[2021 Update.](/AzAgarampur/byeintegrity-
uac/commit/ad1e6acdd7d9d0277a634927fdfaf94253d9d49f)

`ad1e6ac`

## Git stats

  * [ **22** commits  ](/AzAgarampur/byeintegrity-uac/commits/master)

## Files

[Permalink](/AzAgarampur/byeintegrity-
uac/tree/ad1e6acdd7d9d0277a634927fdfaf94253d9d49f)

Failed to load latest commit information.

Type

Name

Latest commit message

Commit time

[AUXGen](/AzAgarampur/byeintegrity-uac/tree/master/AUXGen "AUXGen")

[2021 Update.](/AzAgarampur/byeintegrity-
uac/commit/ad1e6acdd7d9d0277a634927fdfaf94253d9d49f "2021 Update.")

5 months ago

[ByeIntegrity2021](/AzAgarampur/byeintegrity-uac/tree/master/ByeIntegrity2021
"ByeIntegrity2021")

[2021 Update.](/AzAgarampur/byeintegrity-
uac/commit/ad1e6acdd7d9d0277a634927fdfaf94253d9d49f "2021 Update.")

5 months ago

[byeintegrity](/AzAgarampur/byeintegrity-uac/tree/master/byeintegrity
"byeintegrity")

[2021 Update.](/AzAgarampur/byeintegrity-
uac/commit/ad1e6acdd7d9d0277a634927fdfaf94253d9d49f "2021 Update.")

5 months ago

[payload](/AzAgarampur/byeintegrity-uac/tree/master/payload "payload")

[2021 Update.](/AzAgarampur/byeintegrity-
uac/commit/ad1e6acdd7d9d0277a634927fdfaf94253d9d49f "2021 Update.")

5 months ago

[.gitattributes](/AzAgarampur/byeintegrity-uac/blob/master/.gitattributes
".gitattributes")

[Add .gitignore and .gitattributes.](/AzAgarampur/byeintegrity-
uac/commit/492244205558bb0208ae0114c91e897033aa9ef4 "Add .gitignore and
.gitattributes.")

2 years ago

[.gitignore](/AzAgarampur/byeintegrity-uac/blob/master/.gitignore
".gitignore")

[Add .gitignore and .gitattributes.](/AzAgarampur/byeintegrity-
uac/commit/492244205558bb0208ae0114c91e897033aa9ef4 "Add .gitignore and
.gitattributes.")

2 years ago

[README.md](/AzAgarampur/byeintegrity-uac/blob/master/README.md "README.md")

[2021 Update.](/AzAgarampur/byeintegrity-
uac/commit/ad1e6acdd7d9d0277a634927fdfaf94253d9d49f "2021 Update.")

5 months ago

[byeintegrity.sln](/AzAgarampur/byeintegrity-uac/blob/master/byeintegrity.sln
"byeintegrity.sln")

[2021 Update.](/AzAgarampur/byeintegrity-
uac/commit/ad1e6acdd7d9d0277a634927fdfaf94253d9d49f "2021 Update.")

5 months ago

[example.gif](/AzAgarampur/byeintegrity-uac/blob/master/example.gif
"example.gif")

[Finished this repository.](/AzAgarampur/byeintegrity-
uac/commit/3f87e64c09c02d258069e9fa6b8832372277eeae "Finished this
repository.")

2 years ago

View code

ByeIntegrity — Windows UAC Bypass Requirements 2021 Update How it works UACMe
Using the code Supported Versions

##  README.md

# ByeIntegrity — Windows UAC Bypass

Bypass User Account Control (UAC) to gain elevated (Administrator) privileges
to run any program at a high integrity level. [![](/AzAgarampur/byeintegrity-
uac/raw/master/example.gif)](/AzAgarampur/byeintegrity-
uac/blob/master/example.gif)

## Requirements

  * Administrator account
  * UAC notification level set to default or lower

## 2021 Update

I have decided to update ByeIntegrity so that it's much faster, lightweight,
and reliable. This is a significant overhaul so I've created a new project in
the VS solution called "ByeIntegrity2021," which is the updated version of
this attack. Of course, the original version is still there. For more
information on the new version, expand the details below.

Update information

* * *

The new version now is able to hijack the NIC without depending on the
existing native images installed into the NIC. It does this by creating its
own native image descriptors and payloads, then moving them into the NIC,
eliminating the need for:

  * Existing `*.ni` images produced by `NGEN.exe`
  * Running the system maintenance tasks
  * NIC directory traversal
  * Long wait/run time
  * Limited number of runs (before hijacked DLL runs out of space)

The CLR loads native images from the NIC by doing a recursive directory scan
of each entry, and then reading its `*.aux` file. This file contains
information about the native image, and its dependencies. Based off the
information in the `AUX` file, the CLR will either load the image or reject
it, and then move on to the next candidate. If no viable candidates are found,
it loads the standard image and uses jit to compile it normally. No part of
the actual native image is read (it is only checked for its existence), so
ByeIntegrity simply places the payload DLL with the same name the native image
would have.

The updated version of ByeIntegrity comes with a tool called **AUXGen** ,
which takes in the name of an assembly from the GAC and then generates its
corresponding `AUX` file. The `AUX` file is generated so that it matches the
CLR's checks and the CLR will load the "native image" which is described by
the `AUX` file. Note: AUXGen does not handle dependencies when generating the
`AUX` file. It only does as much as it needs to so that the CLR will load the
image. I will post details of the `AUX` file format later.

ByeIntegrity now uses `ISecurityEditor`, just like UACMe does, which cuts down
on the needed code. It also requires that you have generated the `AUX` file
for the assembly `MMCEx`, and placed it in the same directory as ByeIntegrity.
`MMCEx` is now the targeted image because of its load order and shorter name.

## How it works

ByeIntegrity hijacks a DLL located in the Native Image Cache (NIC). The NIC is
used by the .NET Framework to store optimized .NET Assemblies that have been
generated from programs like Ngen, the .NET Framework Native Image Generator.
Because Ngen is usually run under the current user with Administrative
privileges through the Task Scheduler, the NIC grants modify access for
members of the Administrators group.

The Microsoft Management Console (MMC) Windows Firewall Snap-in uses the .NET
Framework, and upon initializing it, modules from the NIC are loaded into the
MMC process. The MMC executable uses AutoElevate, a mechanism Windows uses
that automatically elevates a process’s token without UAC prompting.

ByeIntegrity hijacks a specific DLL located in the NIC named
`Accessibility.ni.dll`. It writes some shellcode into an appropriately-sized
area of padding located in the `.text` section of the DLL. The entry point of
the DLL is then updated to point to the shellcode. Upon DLL load, the entry
point (which is actually the shellcode) is executed. The shellcode calculates
the address of `kernel32!CreateProcessW`, creates a new instance of `cmd.exe`
running as an Administrator, and then simply returns `TRUE`. This is only for
the `DLL_PROCESS_ATTACH` reason; all other reasons will immediately return
`TRUE`.

## UACMe

This attack is implemented in UACMe as method #63. If you want to try out this
attack, please, use UACMe first. The attack is the same, however, UACMe uses a
different method to modify the NIC. ByeIntegrity uses `IFileOperation` while
UACMe uses `ISecurityEditor`. In addition, UACMe chooses the correct
`Accessibility.ni.dll` for your system and preforms the system maintenance
tasks if necessary (to generate the NIC components). ByeIntegrity simply
chooses the first NIC entry that exists (which may/may not be the correct
entry that MMC is using) and does not run the system maintenance tasks.
ByeIntegrity contains **significantly** more code than UACMe, so reading the
UACMe implementation will be much easier to understand than reading the
ByeIntegrity code. Lastly, ByeIntegrity launches a child process during the
attack whereas UACMe does not.

**tl;dr: UACMe is simpler and more effective than ByeIntegrity, so use UACMe
first.**

## Using the code

If you’re reading this then you probably know how to compile the source. Just
note that this hasn’t been tested or designed with x86 in mind at all, and it
probably won’t work on x86 anyways.

Just like UACMe, **I will never upload compiled binaries to this repo.** There
are always people who want the world to crash and burn, and I'm not going to
provide an easy route for them to run this on somebody else's computer and
cause intentional damage. I also don't want script-kiddies to use this attack
without understanding what it does and the damage it can cause.

## Supported Versions

This attack works from Windows 7 (7600) up until the latest version of
Windows.

## About

Bypass UAC by hijacking a DLL located in the Native Image Cache

### Topics

[ windows ](/topics/windows "Topic: windows") [ attack ](/topics/attack
"Topic: attack") [ privilege-escalation ](/topics/privilege-escalation "Topic:
privilege-escalation") [ bypass-uac ](/topics/bypass-uac "Topic: bypass-uac")
[ privilege-escalation-exploits ](/topics/privilege-escalation-exploits
"Topic: privilege-escalation-exploits")

### Resources

Readme

### Stars

[ **178** stars ](/AzAgarampur/byeintegrity-uac/stargazers)

### Watchers

[ **8** watching ](/AzAgarampur/byeintegrity-uac/watchers)

### Forks

[ **45** forks ](/AzAgarampur/byeintegrity-uac/network/members)

##  [ Releases ](/AzAgarampur/byeintegrity-uac/releases)

No releases published

##  [ Packages 0 ](/users/AzAgarampur/packages?repo_name=byeintegrity-uac)

No packages published  

## Languages

  * [ C++ 100.0% ](/AzAgarampur/byeintegrity-uac/search?l=c%2B%2B)

  * [ ](https://github.com "GitHub") © 2022 GitHub, Inc. 

  * [Terms](https://docs.github.com/en/github/site-policy/github-terms-of-service)
  * [Privacy](https://docs.github.com/en/github/site-policy/github-privacy-statement)
  * [Security](https://github.com/security)
  * [Status](https://www.githubstatus.com/)
  * [Docs](https://docs.github.com)
  * [Contact GitHub](https://support.github.com?tags=dotcom-footer)
  * [Pricing](https://github.com/pricing)
  * [API](https://docs.github.com)
  * [Training](https://services.github.com)
  * [Blog](https://github.blog)
  * [About](https://github.com/about)

You can’t perform that action at this time.

You signed in with another tab or window. [Reload]() to refresh your session.
You signed out in another tab or window. [Reload]() to refresh your session.

