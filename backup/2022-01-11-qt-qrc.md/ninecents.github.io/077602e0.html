<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" class=" js borderradius boxshadow textshadow cssgradients fontface"><head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=640" />

    <link rel="stylesheet" href="/assets/css/style.css?v=4fea59aa8bd5d9fa91dc5adbe963f75b50d60787" media="screen" />
    <link rel="stylesheet" href="/assets/css/mobile.css" media="handheld, only screen and (max-device-width:640px)" />
    <link rel="stylesheet" href="/assets/css/non-screen.css" media="handheld, only screen and (max-device-width:640px)" />

    <script src="/assets/js/modernizr.js"></script>
    <script src="https://code.jquery.com/jquery-1.12.4.min.js" integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin="anonymous"></script>
    <script src="/assets/js/headsmart.min.js"></script>
    <script>
      $(document).ready(function () {
        $('#main_content').headsmart()
      })
    </script>

<!-- Begin Jekyll SEO tag v2.6.1 -->
<title>[Qt] 00_Qt资源解析 | ninecents.github.io</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="[Qt] 00_Qt资源解析" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="软件业的小学生" />
<meta property="og:description" content="软件业的小学生" />
<link rel="canonical" href="https://ninecents.github.io/course/Qt/00_Qt%E8%B5%84%E6%BA%90%E8%A7%A3%E6%9E%90.html" />
<meta property="og:url" content="https://ninecents.github.io/course/Qt/00_Qt%E8%B5%84%E6%BA%90%E8%A7%A3%E6%9E%90.html" />
<meta property="og:site_name" content="ninecents.github.io" />
<script type="application/ld+json">
{"@type":"WebPage","headline":"[Qt] 00_Qt资源解析","url":"https://ninecents.github.io/course/Qt/00_Qt%E8%B5%84%E6%BA%90%E8%A7%A3%E6%9E%90.html","description":"软件业的小学生","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

  </head>

  <body>
    <a id="forkme_banner" href="https://github.com/ninecents/ninecents.github.io">View on GitHub</a>
    <div class="shell">

      <header>
        <span class="ribbon-outer">
          <span class="ribbon-inner">
            <h1>ninecents.github.io</h1>
            <h2>软件业的小学生</h2>
          </span>
          <span class="left-tail"></span>
          <span class="right-tail"></span>
        </span>
      </header>

      
        <div id="no-downloads">
          <span class="inner">
          </span>
        </div>
      


      <span class="banner-fix"></span>


      <section id="main_content">
        <h1 id="qt-00_qt资源解析" class="header-level-1">[Qt] 00_Qt资源解析</h1>

<h2 id="前言" class="header-level-2">前言</h2>
<p>Qt是一个1991年由Qt Company开发的跨平台C++图形用户界面应用程序开发框架。</p>

<p>Qt使用还是很广泛的，为了大家有一个直观的概念，我用Everything搜索了下我电脑上的qt5core.dll，部分结果如下图所示：</p>

<p><img src="https://ninecents.github.io/course/Qt/00_Qt资源解析/Everything搜索qt5core.dll结果.png" alt="Everything搜索qt5core.dll结果" /></p>

<p>从图中可以看到，android模拟器、魔兽战网平台、Origin游戏平台、x64dbg都使用了qt框架，除此之外还有很多应用使用了Qt，市面上对Qt的逆向也很多，在这里我们将分析如何导出Qt中的图片资源，其他资源暂时未找到方法，有大神知道的不吝赐教。</p>

<h2 id="创建含有资源的qt程序示例" class="header-level-2">创建含有资源的Qt程序示例</h2>

<p>关于如何创建Qt工程，添加资源文件不详细介绍了。随便百度搜一下就行了，这里参考了教程<a href="https://blog.csdn.net/lbb2016/article/details/52675773">Qt中为工程添加资源文件、给按钮添加图片</a>。</p>

<p>下面我我的工程资源文件截图，包含了资源：</p>

<p><img src="https://ninecents.github.io/course/Qt/00_Qt资源解析/Qt工程资源文件结构.png" alt="Qt工程资源文件结构" /></p>

<p>我们的任务就是将logo.ico文件从生成的exe中导出来。</p>

<h2 id="分析思路" class="header-level-2">分析思路</h2>
<p>通过Qt官网文档可以知道，项目中的res.qrc文件，会被编译为qrc_res.cpp。我们通过Hex Workshop查看文件二进制内容；通过python查看文件大小；通过Qt Creator打开qrc_res.cpp。我们先看下下面截图内容：</p>

<p><img src="https://ninecents.github.io/course/Qt/00_Qt资源解析/资源文件编译分析.png" alt="资源文件编译分析" /></p>

<ul>
  <li>在文件qrc_res.cpp中的注释，我们可以知道，qt_resource_data数组保存了logo.ico文件内容；</li>
  <li>查看文件大小为67,646 字节，通过python查看文件大小为0x1083e；0x1083e也的确被保存在了qt_resource_data数组中，内容为<strong>0x0,0x1,0x8,0x3e,</strong>；</li>
  <li>比对Hex Workshop文件内容和qt_resource_data数组，可以发现内容是不一样的，显然内容被压缩了。</li>
</ul>

<p>分析到这里，可以确定文件不是简单的被保存的PE文件的资源段中的，而且有可能被压缩处理了。那就换个思路，通过调用资源文件的方式将文件调用到内存中。</p>

<p>Qt中加载文件是通过路径“:/new/prefix1/logo.ico”加载的，直接构造对象QPixmap，即可加载图片资源，调用QPixmap的save函数即可将文件保存起来，那么我们写个dll，直接执行这些函数是不是就可以了呢。</p>

<h2 id="编写功能" class="header-level-2">编写功能</h2>
<p>由于我使用的MingW的工程写的Demo，我们这里也使用MingW的编译器创建工程mydll，工程为dll工程。内容很简单，创建一个类Mydll，并创建个全局对象<strong>Mydll g_dll;</strong>，在构造函数中调用保存文件的逻辑，具体代码如下：</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Mydll g_dll;

Mydll::Mydll()
{
    char *res = ":/new/prefix1/logo.ico";
    QString localname = QString("D") + res;
    QPixmap icon(res);
    icon.save(localname);
    return;
}
</code></pre></div></div>

<p>使用流程如下图所示：</p>

<p><img src="https://ninecents.github.io/course/Qt/00_Qt资源解析/dll注入流程.png" alt="dll注入流程" /></p>

<h2 id="问答" class="header-level-2">问答</h2>
<h4 id="如果用其它的开发工具比如vs这种要怎么实现呢" class="header-level-3">如果用其它的开发工具,比如VS这种,要怎么实现呢?</h4>
<p>如果只有vs，不使用qt，需要构造相关的数据结构，比如QString等；或者直接调用Qt5Core.dll导出函数构造相关的数据结构。简单的包含一此头文件,编译会失败的。</p>

<h4 id="怎么知道一个资源的路径呢" class="header-level-3">怎么知道一个资源的路径呢</h4>
<ul>
  <li>CE搜索字符串“:/”</li>
  <li>OD、IDA字符串删选“:/”</li>
  <li>关注资源，对应的构造函数，下断点或者IDA查找一下，都能定位资源路径</li>
</ul>

<h2 id="结束语" class="header-level-2">结束语</h2>
<ul>
  <li>不要用中文路径，可能编译失败。</li>
  <li>debug和release调用的qt库是不一样的，需要特别注意。</li>
  <li>MingW的工程和VS的工程也是不一样的，需要特别注意。</li>
  <li>测试下一个Qt5.6的某exe，使用Qt5.8的dll，依然可以将文件导出。</li>
  <li>github源码：<a href="https://github.com/ninecents/MyOpen">https://github.com/ninecents/MyOpen</a>。</li>
</ul>

<h2 id="广而告之" class="header-level-2">广而告之</h2>
<p>九分出品，欢迎吐槽。更多精彩，可以前往<a href="https://ninecents.github.io">博客地址</a>。</p>

      </section>

      <footer>
        <span class="ribbon-outer">
          <span class="ribbon-inner">
            
            
              <p>Projects by <a href="https://github.com/ninecents">ninecents</a> can be found on <a href="https://github.com/ninecents/ninecents.github.io">GitHub</a></p>
            
          </span>
          <span class="left-tail"></span>
          <span class="right-tail"></span>
        </span>
        <p>Generated with <a href="https://pages.github.com">GitHub Pages</a> using Merlot</p>
        <span class="octocat"></span>
      </footer>

    </div>

    
  

</body></html>