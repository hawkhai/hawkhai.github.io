<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr"><head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<meta http-equiv="Content-Style-Type" content="text/css" />
		<meta name="generator" content="MediaWiki 1.15.5-7" />
		<meta name="keywords" content="SimpleGL example,OpenGL-ES" />
		<link rel="alternate" type="application/x-wiki" title="Edit" href="/index.php?title=SimpleGL_example&amp;action=edit" />
		<link rel="edit" title="Edit" href="/index.php?title=SimpleGL_example&amp;action=edit" />
		<link rel="shortcut icon" href="/favicon.ico" />
		<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="maemo.org wiki (en)" />
		<link rel="alternate" type="application/rss+xml" title="maemo.org wiki RSS feed" href="/index.php?title=Special:RecentChanges&amp;feed=rss" />
		<link rel="alternate" type="application/atom+xml" title="maemo.org wiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom" />
		<title>SimpleGL example - maemo.org wiki</title>
        <link rel="stylesheet" href="/skins/monobookmaemo2009/static/css/reset.css" type="text/css" media="screen" charset="utf-8" />
        <link rel="stylesheet" href="/skins/monobookmaemo2009/static/css/master.css" type="text/css" media="screen" charset="utf-8" />
        <!--[if lte IE 6]>
            <link rel="stylesheet" href="/skins/monobookmaemo2009/static/css/ie.css" type="text/css" media="screen">
        <![endif]-->


        <link rel="stylesheet" type="text/css" href="/skins/monobookmaemo2009/bz_main.css" media="screen" />
        <script type="text/javascript" src="/skins/monobookmaemo2009/jquery-1.2.6.min.js"></script>
		<style type="text/css" media="screen, projection">/*&lt;![CDATA[*/
			@import "/skins/common/shared.css?207";
			@import "/skins/monobookmaemo2009/main.css?207";
		/*]]&gt;*/</style>
		<link rel="stylesheet" type="text/css" media="print" href="/skins/common/commonPrint.css?207" />
		<meta http-equiv="imagetoolbar" content="no" /><!--[endif]---->
		
		<script type="text/javascript">/*&lt;![CDATA[*/
		var skin = "monobookmaemo2009";
		var stylepath = "/skins";
		var wgArticlePath = "/$1";
		var wgScriptPath = "";
		var wgScript = "/index.php";
		var wgVariantArticlePath = false;
		var wgActionPaths = {};
		var wgServer = "https://wiki.maemo.org";
		var wgCanonicalNamespace = "";
		var wgCanonicalSpecialPageName = false;
		var wgNamespaceNumber = 0;
		var wgPageName = "SimpleGL_example";
		var wgTitle = "SimpleGL example";
		var wgAction = "view";
		var wgArticleId = "3211";
		var wgIsArticle = true;
		var wgUserName = null;
		var wgUserGroups = null;
		var wgUserLanguage = "en";
		var wgContentLanguage = "en";
		var wgBreakFrames = false;
		var wgCurRevisionId = 54748;
		var wgVersion = "1.15.5-7";
		var wgEnableAPI = true;
		var wgEnableWriteAPI = true;
		var wgSeparatorTransformTable = ["", ""];
		var wgDigitTransformTable = ["", ""];
		var wgRestrictionEdit = [];
		var wgRestrictionMove = [];
		/*]]&gt;*/</script>
                
		<script type="text/javascript" src="/skins/common/wikibits.js?207">&lt;!-- wikibits js --&gt;</script>
		<!-- Head Scripts -->
		<script type="text/javascript" src="/skins/common/ajax.js?207"></script>
<style type="text/css">/*&lt;![CDATA[*/
.source-cpp {line-height: normal;}
.source-cpp li, .source-cpp pre {
	line-height: normal; border: 0px none white;
}
/**
 * GeSHi Dynamically Generated Stylesheet
 * --------------------------------------
 * Dynamically generated stylesheet for cpp
 * CSS class: source-cpp, CSS id: 
 * GeSHi (C) 2004 - 2007 Nigel McNie, 2007 - 2008 Benny Baumann
 * (http://qbnz.com/highlighter/ and http://geshi.org/)
 * --------------------------------------
 */
.cpp.source-cpp .de1, .cpp.source-cpp .de2 {font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;}
.cpp.source-cpp  {font-family:monospace;}
.cpp.source-cpp .imp {font-weight: bold; color: red;}
.cpp.source-cpp li, .cpp.source-cpp .li1 {font-weight: normal; vertical-align:top;}
.cpp.source-cpp .ln {width:1px;text-align:right;margin:0;padding:0 2px;vertical-align:top;}
.cpp.source-cpp .li2 {font-weight: bold; vertical-align:top;}
.cpp.source-cpp .kw1 {color: #0000ff;}
.cpp.source-cpp .kw2 {color: #0000ff;}
.cpp.source-cpp .kw3 {color: #0000dd;}
.cpp.source-cpp .kw4 {color: #0000ff;}
.cpp.source-cpp .co1 {color: #666666;}
.cpp.source-cpp .co2 {color: #339900;}
.cpp.source-cpp .coMULTI {color: #ff0000; font-style: italic;}
.cpp.source-cpp .es0 {color: #000099; font-weight: bold;}
.cpp.source-cpp .es1 {color: #000099; font-weight: bold;}
.cpp.source-cpp .es2 {color: #660099; font-weight: bold;}
.cpp.source-cpp .es3 {color: #660099; font-weight: bold;}
.cpp.source-cpp .es4 {color: #660099; font-weight: bold;}
.cpp.source-cpp .es5 {color: #006699; font-weight: bold;}
.cpp.source-cpp .br0 {color: #008000;}
.cpp.source-cpp .sy0 {color: #008000;}
.cpp.source-cpp .sy1 {color: #000080;}
.cpp.source-cpp .sy2 {color: #000040;}
.cpp.source-cpp .sy3 {color: #000040;}
.cpp.source-cpp .sy4 {color: #008080;}
.cpp.source-cpp .st0 {color: #FF0000;}
.cpp.source-cpp .nu0 {color: #0000dd;}
.cpp.source-cpp .nu6 {color: #208080;}
.cpp.source-cpp .nu8 {color: #208080;}
.cpp.source-cpp .nu12 {color: #208080;}
.cpp.source-cpp .nu16 {color:#800080;}
.cpp.source-cpp .nu17 {color:#800080;}
.cpp.source-cpp .nu18 {color:#800080;}
.cpp.source-cpp .nu19 {color:#800080;}
.cpp.source-cpp .me1 {color: #007788;}
.cpp.source-cpp .me2 {color: #007788;}
.cpp.source-cpp .ln-xtra, .cpp.source-cpp li.ln-xtra, .cpp.source-cpp div.ln-xtra {background-color: #ffc;}
.cpp.source-cpp span.xtra { display:block; }

/*]]&gt;*/
</style>
<style type="text/css">/*&lt;![CDATA[*/
@import "/index.php?title=MediaWiki:Geshi.css&amp;usemsgcache=yes&amp;action=raw&amp;ctype=text/css&amp;smaxage=18000";
/*]]&gt;*/
</style>		<script type="text/javascript" src="/index.php?title=-&amp;action=raw&amp;gen=js&amp;useskin=monobookmaemo2009">&lt;!-- site js --&gt;</script>
	</head>
<body class="mediawiki  ltr ns-0 ns-subject page-SimpleGL_example">


        <div id="container">


            <div id="header">
                <div id="logo">
                                        <a href="http://maemo.org/"><img src="/skins/monobookmaemo2009/static/img/logo.jpg" title="Maemo.org" alt="Maemo.org" /></a>
                </div><!-- logo -->

	<div class="portlet" id="p-personal">
		<h5>Personal tools</h5>
		<div class="pBody">
			<ul>
				<li id="pt-login"><a href="/index.php?title=Special:UserLogin&amp;returnto=SimpleGL_example" title="You are encouraged to log in; however, it is not mandatory [o]" accesskey="o">Log in</a></li>
			</ul>
		</div>
            </div>
        </div>
            <div id="navigation">
                <div id="navigation-left-wrapper">

                    <div id="navigation-right-wrapper">

                        <ul>
                            <li><a href="http://maemo.org/intro/">Intro</a></li>
                            <li><a href="http://maemo.org/downloads/">Downloads</a></li>
                            <li class="selected"><a href="http://maemo.org/community/">Community</a></li>
                            <li><a href="http://maemo.org/development/">Development</a></li>
                            <li><a href="http://maemo.org/news/">News</a></li>
                            <li><a href="http://talk.maemo.org">TALK</a></li>
                        </ul>


		<div id="search">
			<form action="/Special:Search" id="searchform">
				<input id="searchInput" name="search" type="text" title="Search maemo.org wiki [alt-f]" accesskey="f" value="" />
				<input type="submit" name="go" class="submit" id="searchGoButton" value="Go" title="Go to a page with this exact name if exists" /> 
<!--				<input type='submit' name="fulltext" class="submit" id="mw-searchButton" value="Go" title="Search the pages for this text" /> &nbsp; -->
			</form>
		</div>


                    </div>
                </div>
            </div><!-- /navigation -->
            <div id="breadcrumb"></div>

            <div id="content">
                        

<!--	<div id="globalWrapper">
		<div id="column-content">
	<div id="content2"> 


		<a name="top" id="top"></a>
				<h1 class="firstHeading">SimpleGL example</h1>
		<div id="bodyContent">
-->

      
<!-- sidebar --> 
                  <div id="sidebar">
		<div id="nav-sub">

		<div class="portlet" id="p-navigation">
		<h3>Navigation</h3>
			<ul>
				<li id="n-mainpage"><a href="/Main_Page" title="Visit the main page">Main Page</a></li>
				<li id="n-recentchanges"><a href="/Special:RecentChanges" title="The list of recent changes in the wiki [r]" accesskey="r">Recent changes</a></li>
				<li id="n-randompage"><a href="/Special:Random" title="Load a random page [x]" accesskey="x">Random page</a></li>
				<li id="n-help"><a href="/Help:Contents" title="The place to find out">Help</a></li>
				<li id="n-advancedsearch"><a href="/Special:Search">Advanced search</a></li>
			</ul>
	</div>
	


	<div id="p-cactions" class="portlet">
		<h3>Views</h3>
			<ul class="fi_protie_navigation">
					 <li id="ca-nstab-main" class="selected"><a href="/SimpleGL_example" title="View the content page [c]" accesskey="c">Page</a></li>
					 <li id="ca-talk" class="new"><a href="/index.php?title=Talk:SimpleGL_example&amp;action=edit&amp;redlink=1" title="Discussion about the content page [t]" accesskey="t">Discussion</a></li>
					 <li id="ca-edit"><a href="/index.php?title=SimpleGL_example&amp;action=edit" title="You can edit this page. Please use the preview button before saving [e]" accesskey="e">Edit</a></li>
					 <li id="ca-history"><a href="/index.php?title=SimpleGL_example&amp;action=history" title="Past revisions of this page [h]" accesskey="h">History</a></li>
				</ul>
	</div>


    
		</div>

               </div>
<!-- sidebar --> 
<div id="main">
<div id="main-wrapper">

			            <h1 class="firstHeading">SimpleGL example</h1>
			<!-- start content -->
			<p>This is a simple program demonstrating how to use <a href="/OpenGL-ES#OpenGL_variants" title="OpenGL-ES">OpenGL ES 2.0</a>. It will output this animated spiral, which can be moved around on the screen:
</p><p><a href="/File:Egl-example_output.png" class="image" title="Image:Egl-example_output.png"><img alt="Image:Egl-example_output.png" src="/images/8/8f/Egl-example_output.png" width="800" height="480" border="0" /></a>
</p>
<div dir="ltr" style="text-align: left;"><div class="cpp source-cpp" style="font-family:monospace;"><pre class="de1"><span class="coMULTI">/* Created by exoticorn ( http://talk.maemo.org/showthread.php?t=37356 )
 * edited and commented by André Bergner [endboss]
 *
 * libraries needed:   libx11-dev, libgles2-dev
 *
 * compile with:   g++  -lX11 -lEGL -lGLESv2  egl-example.cpp
 */</span>
 
<span class="co2">#include  &lt;iostream&gt;</span>
<span class="co2">#include  &lt;cstdlib&gt;</span>
<span class="co2">#include  &lt;cstring&gt;</span>
<span class="kw2">using</span> <span class="kw2">namespace</span> std<span class="sy4">;</span>
 
<span class="co2">#include  &lt;cmath&gt;</span>
<span class="co2">#include  &lt;sys/time.h&gt;</span>
 
<span class="co2">#include  &lt;X11/Xlib.h&gt;</span>
<span class="co2">#include  &lt;X11/Xatom.h&gt;</span>
<span class="co2">#include  &lt;X11/Xutil.h&gt;</span>
 
<span class="co2">#include  &lt;GLES2/gl2.h&gt;</span>
<span class="co2">#include  &lt;EGL/egl.h&gt;</span>
 
 
 
<span class="kw4">const</span> <span class="kw4">char</span> vertex_src <span class="br0">[</span><span class="br0">]</span> <span class="sy1">=</span>
<span class="st0">"                                        <span class="es1">\
</span>   attribute vec4        position;       <span class="es1">\
</span>   varying mediump vec2  pos;            <span class="es1">\
</span>   uniform vec4          offset;         <span class="es1">\
</span>                                         <span class="es1">\
</span>   void main()                           <span class="es1">\
</span>   {                                     <span class="es1">\
</span>      gl_Position = position + offset;   <span class="es1">\
</span>      pos = position.xy;                 <span class="es1">\
</span>   }                                     <span class="es1">\
</span>"</span><span class="sy4">;</span>
 
 
<span class="kw4">const</span> <span class="kw4">char</span> fragment_src <span class="br0">[</span><span class="br0">]</span> <span class="sy1">=</span>
<span class="st0">"                                                      <span class="es1">\
</span>   varying mediump vec2    pos;                        <span class="es1">\
</span>   uniform mediump float   phase;                      <span class="es1">\
</span>                                                       <span class="es1">\
</span>   void  main()                                        <span class="es1">\
</span>   {                                                   <span class="es1">\
</span>      gl_FragColor  =  vec4( 1., 0.9, 0.7, 1.0 ) *     <span class="es1">\
</span>        cos( 30.*sqrt(pos.x*pos.x + 1.5*pos.y*pos.y)   <span class="es1">\
</span>             + atan(pos.y,pos.x) - phase );            <span class="es1">\
</span>   }                                                   <span class="es1">\
</span>"</span><span class="sy4">;</span>
<span class="co1">//  some more formulas to play with...</span>
<span class="co1">//      cos( 20.*(pos.x*pos.x + pos.y*pos.y) - phase );</span>
<span class="co1">//      cos( 20.*sqrt(pos.x*pos.x + pos.y*pos.y) + atan(pos.y,pos.x) - phase );</span>
<span class="co1">//      cos( 30.*sqrt(pos.x*pos.x + 1.5*pos.y*pos.y - 1.8*pos.x*pos.y*pos.y)</span>
<span class="co1">//            + atan(pos.y,pos.x) - phase );</span>
 
 
<span class="kw4">void</span>
print_shader_info_log <span class="br0">(</span>
   GLuint  shader      <span class="co1">// handle to the shader</span>
<span class="br0">)</span>
<span class="br0">{</span>
   GLint  length<span class="sy4">;</span>
 
   glGetShaderiv <span class="br0">(</span> shader , GL_INFO_LOG_LENGTH , <span class="sy3">&amp;</span>length <span class="br0">)</span><span class="sy4">;</span>
 
   <span class="kw1">if</span> <span class="br0">(</span> length <span class="br0">)</span> <span class="br0">{</span>
      <span class="kw4">char</span><span class="sy2">*</span> buffer  <span class="sy1">=</span>  <span class="kw3">new</span> <span class="kw4">char</span> <span class="br0">[</span> length <span class="br0">]</span><span class="sy4">;</span>
      glGetShaderInfoLog <span class="br0">(</span> shader , length , <span class="kw2">NULL</span> , buffer <span class="br0">)</span><span class="sy4">;</span>
      <span class="kw3">cout</span> <span class="sy1">&lt;&lt;</span> <span class="st0">"shader info: "</span> <span class="sy1">&lt;&lt;</span>  buffer <span class="sy1">&lt;&lt;</span> flush<span class="sy4">;</span>
      <span class="kw3">delete</span> <span class="br0">[</span><span class="br0">]</span> buffer<span class="sy4">;</span>
 
      GLint success<span class="sy4">;</span>
      glGetShaderiv<span class="br0">(</span> shader, GL_COMPILE_STATUS, <span class="sy3">&amp;</span>success <span class="br0">)</span><span class="sy4">;</span>
      <span class="kw1">if</span> <span class="br0">(</span> success <span class="sy3">!</span><span class="sy1">=</span> GL_TRUE <span class="br0">)</span>   <span class="kw3">exit</span> <span class="br0">(</span> 1 <span class="br0">)</span><span class="sy4">;</span>
   <span class="br0">}</span>
<span class="br0">}</span>
 
 
GLuint
load_shader <span class="br0">(</span>
   <span class="kw4">const</span> <span class="kw4">char</span>  <span class="sy2">*</span>shader_source,
   GLenum       type
<span class="br0">)</span>
<span class="br0">{</span>
   GLuint  shader <span class="sy1">=</span> glCreateShader<span class="br0">(</span> type <span class="br0">)</span><span class="sy4">;</span>
 
   glShaderSource  <span class="br0">(</span> shader , 1 , <span class="sy3">&amp;</span>shader_source , <span class="kw2">NULL</span> <span class="br0">)</span><span class="sy4">;</span>
   glCompileShader <span class="br0">(</span> shader <span class="br0">)</span><span class="sy4">;</span>
 
   print_shader_info_log <span class="br0">(</span> shader <span class="br0">)</span><span class="sy4">;</span>
 
   <span class="kw1">return</span> shader<span class="sy4">;</span>
<span class="br0">}</span>
 
 
Display    <span class="sy2">*</span>x_display<span class="sy4">;</span>
Window      win<span class="sy4">;</span>
EGLDisplay  egl_display<span class="sy4">;</span>
EGLContext  egl_context<span class="sy4">;</span>
EGLSurface  egl_surface<span class="sy4">;</span>
 
GLfloat
   norm_x    <span class="sy1">=</span>  0.0,
   norm_y    <span class="sy1">=</span>  0.0,
   offset_x  <span class="sy1">=</span>  0.0,
   offset_y  <span class="sy1">=</span>  0.0,
   p1_pos_x  <span class="sy1">=</span>  0.0,
   p1_pos_y  <span class="sy1">=</span>  <span class="nu16">0.0</span><span class="sy4">;</span>
 
GLint
   phase_loc,
   offset_loc,
   position_loc<span class="sy4">;</span>
 
 
<span class="kw4">bool</span>        update_pos <span class="sy1">=</span> <span class="kw2">false</span><span class="sy4">;</span>
 
<span class="kw4">const</span> <span class="kw4">float</span> vertexArray<span class="br0">[</span><span class="br0">]</span> <span class="sy1">=</span> <span class="br0">{</span>
   0.0,  0.5,  0.0,
  <span class="sy2">-</span>0.5,  0.0,  0.0,
   0.0, <span class="sy2">-</span>0.5,  0.0,
   0.5,  0.0,  0.0,
   0.0,  0.5,  0.0 
<span class="br0">}</span><span class="sy4">;</span>
 
 
<span class="kw4">void</span>  render<span class="br0">(</span><span class="br0">)</span>
<span class="br0">{</span>
   <span class="kw4">static</span> <span class="kw4">float</span>  phase <span class="sy1">=</span> <span class="nu0">0</span><span class="sy4">;</span>
   <span class="kw4">static</span> <span class="kw4">int</span>    donesetup <span class="sy1">=</span> <span class="nu0">0</span><span class="sy4">;</span>
 
   <span class="kw4">static</span> XWindowAttributes gwa<span class="sy4">;</span>
 
   <span class="co1">//// draw</span>
 
   <span class="kw1">if</span> <span class="br0">(</span> <span class="sy3">!</span>donesetup <span class="br0">)</span> <span class="br0">{</span>
      XWindowAttributes  gwa<span class="sy4">;</span>
      XGetWindowAttributes <span class="br0">(</span> x_display , win , <span class="sy3">&amp;</span>gwa <span class="br0">)</span><span class="sy4">;</span>
      glViewport <span class="br0">(</span> 0 , 0 , gwa.<span class="me1">width</span> , gwa.<span class="me1">height</span> <span class="br0">)</span><span class="sy4">;</span>
      glClearColor <span class="br0">(</span> 0.08 , 0.06 , 0.07 , 1.<span class="br0">)</span><span class="sy4">;</span>    <span class="co1">// background color</span>
      donesetup <span class="sy1">=</span> <span class="nu0">1</span><span class="sy4">;</span>
   <span class="br0">}</span>
   glClear <span class="br0">(</span> GL_COLOR_BUFFER_BIT <span class="br0">)</span><span class="sy4">;</span>
 
   glUniform1f <span class="br0">(</span> phase_loc , phase <span class="br0">)</span><span class="sy4">;</span>  <span class="co1">// write the value of phase to the shaders phase</span>
   phase  <span class="sy1">=</span>  fmodf <span class="br0">(</span> phase <span class="sy2">+</span> 0.5f , 2.<span class="me1">f</span> <span class="sy2">*</span> 3.141f <span class="br0">)</span><span class="sy4">;</span>    <span class="co1">// and update the local variable</span>
 
   <span class="kw1">if</span> <span class="br0">(</span> update_pos <span class="br0">)</span> <span class="br0">{</span>  <span class="co1">// if the position of the texture has changed due to user action</span>
      GLfloat old_offset_x  <span class="sy1">=</span>  offset_x<span class="sy4">;</span>
      GLfloat old_offset_y  <span class="sy1">=</span>  offset_y<span class="sy4">;</span>
 
      offset_x  <span class="sy1">=</span>  norm_x <span class="sy2">-</span> p1_pos_x<span class="sy4">;</span>
      offset_y  <span class="sy1">=</span>  norm_y <span class="sy2">-</span> p1_pos_y<span class="sy4">;</span>
 
      p1_pos_x  <span class="sy1">=</span>  norm_x<span class="sy4">;</span>
      p1_pos_y  <span class="sy1">=</span>  norm_y<span class="sy4">;</span>
 
      offset_x  <span class="sy2">+</span><span class="sy1">=</span>  old_offset_x<span class="sy4">;</span>
      offset_y  <span class="sy2">+</span><span class="sy1">=</span>  old_offset_y<span class="sy4">;</span>
 
      update_pos <span class="sy1">=</span> <span class="kw2">false</span><span class="sy4">;</span>
   <span class="br0">}</span>
 
   glUniform4f <span class="br0">(</span> offset_loc  ,  offset_x , offset_y , 0.0 , 0.0 <span class="br0">)</span><span class="sy4">;</span>
 
   glVertexAttribPointer <span class="br0">(</span> position_loc, 3, GL_FLOAT, <span class="kw2">false</span>, 0, vertexArray <span class="br0">)</span><span class="sy4">;</span>
   glEnableVertexAttribArray <span class="br0">(</span> position_loc <span class="br0">)</span><span class="sy4">;</span>
   glDrawArrays <span class="br0">(</span> GL_TRIANGLE_STRIP, 0, 5 <span class="br0">)</span><span class="sy4">;</span>
 
   eglSwapBuffers <span class="br0">(</span> egl_display, egl_surface <span class="br0">)</span><span class="sy4">;</span>  <span class="co1">// get the rendered buffer to the screen</span>
<span class="br0">}</span>
 
 
<span class="co1">////////////////////////////////////////////////////////////////////////////////////////////</span>
 
 
<span class="kw4">int</span>  main<span class="br0">(</span><span class="br0">)</span>
<span class="br0">{</span>
   <span class="co1">///////  the X11 part  //////////////////////////////////////////////////////////////////</span>
   <span class="co1">// in the first part the program opens a connection to the X11 window manager</span>
   <span class="co1">//</span>
 
   x_display <span class="sy1">=</span> XOpenDisplay <span class="br0">(</span> <span class="kw2">NULL</span> <span class="br0">)</span><span class="sy4">;</span>   <span class="co1">// open the standard display (the primary screen)</span>
   <span class="kw1">if</span> <span class="br0">(</span> x_display <span class="sy1">==</span> <span class="kw2">NULL</span> <span class="br0">)</span> <span class="br0">{</span>
      <span class="kw3">cerr</span> <span class="sy1">&lt;&lt;</span> <span class="st0">"cannot connect to X server"</span> <span class="sy1">&lt;&lt;</span> endl<span class="sy4">;</span>
      <span class="kw1">return</span> <span class="nu0">1</span><span class="sy4">;</span>
   <span class="br0">}</span>
 
   Window root  <span class="sy1">=</span>  DefaultRootWindow<span class="br0">(</span> x_display <span class="br0">)</span><span class="sy4">;</span>   <span class="co1">// get the root window (usually the whole screen)</span>
 
   XSetWindowAttributes  swa<span class="sy4">;</span>
   swa.<span class="me1">event_mask</span>  <span class="sy1">=</span>  ExposureMask <span class="sy3">|</span> PointerMotionMask <span class="sy3">|</span> KeyPressMask<span class="sy4">;</span>
 
   win  <span class="sy1">=</span>  XCreateWindow <span class="br0">(</span>   <span class="co1">// create a window with the provided parameters</span>
              x_display, root,
              0, 0, 800, 480,   0,
              CopyFromParent, InputOutput,
              CopyFromParent, CWEventMask,
              <span class="sy3">&amp;</span>swa <span class="br0">)</span><span class="sy4">;</span>
 
   XSetWindowAttributes  xattr<span class="sy4">;</span>
   Atom  atom<span class="sy4">;</span>
   <span class="kw4">int</span>   one <span class="sy1">=</span> <span class="nu0">1</span><span class="sy4">;</span>
 
   xattr.<span class="me1">override_redirect</span> <span class="sy1">=</span> False<span class="sy4">;</span>
   XChangeWindowAttributes <span class="br0">(</span> x_display, win, CWOverrideRedirect, <span class="sy3">&amp;</span>xattr <span class="br0">)</span><span class="sy4">;</span>
 
   atom <span class="sy1">=</span> XInternAtom <span class="br0">(</span> x_display, <span class="st0">"_NET_WM_STATE_FULLSCREEN"</span>, True <span class="br0">)</span><span class="sy4">;</span>
   XChangeProperty <span class="br0">(</span>
      x_display, win,
      XInternAtom <span class="br0">(</span> x_display, <span class="st0">"_NET_WM_STATE"</span>, True <span class="br0">)</span>,
      XA_ATOM,  32,  PropModeReplace,
      <span class="br0">(</span><span class="kw4">unsigned</span> <span class="kw4">char</span><span class="sy2">*</span><span class="br0">)</span> <span class="sy3">&amp;</span>atom,  1 <span class="br0">)</span><span class="sy4">;</span>
 
   XChangeProperty <span class="br0">(</span>
      x_display, win,
      XInternAtom <span class="br0">(</span> x_display, <span class="st0">"_HILDON_NON_COMPOSITED_WINDOW"</span>, False <span class="br0">)</span>,
      XA_INTEGER,  32,  PropModeReplace,
      <span class="br0">(</span><span class="kw4">unsigned</span> <span class="kw4">char</span><span class="sy2">*</span><span class="br0">)</span> <span class="sy3">&amp;</span>one,  1<span class="br0">)</span><span class="sy4">;</span>
 
   XWMHints hints<span class="sy4">;</span>
   hints.<span class="me1">input</span> <span class="sy1">=</span> True<span class="sy4">;</span>
   hints.<span class="me1">flags</span> <span class="sy1">=</span> InputHint<span class="sy4">;</span>
   XSetWMHints<span class="br0">(</span>x_display, win, <span class="sy3">&amp;</span>hints<span class="br0">)</span><span class="sy4">;</span>
 
   XMapWindow <span class="br0">(</span> x_display , win <span class="br0">)</span><span class="sy4">;</span>             <span class="co1">// make the window visible on the screen</span>
   XStoreName <span class="br0">(</span> x_display , win , <span class="st0">"GL test"</span> <span class="br0">)</span><span class="sy4">;</span> <span class="co1">// give the window a name</span>
 
   <span class="co1">//// get identifiers for the provided atom name strings</span>
   Atom wm_state   <span class="sy1">=</span> XInternAtom <span class="br0">(</span> x_display, <span class="st0">"_NET_WM_STATE"</span>, False <span class="br0">)</span><span class="sy4">;</span>
   Atom fullscreen <span class="sy1">=</span> XInternAtom <span class="br0">(</span> x_display, <span class="st0">"_NET_WM_STATE_FULLSCREEN"</span>, False <span class="br0">)</span><span class="sy4">;</span>
 
   XEvent xev<span class="sy4">;</span>
   <span class="kw3">memset</span> <span class="br0">(</span> <span class="sy3">&amp;</span>xev, 0, <span class="kw3">sizeof</span><span class="br0">(</span>xev<span class="br0">)</span> <span class="br0">)</span><span class="sy4">;</span>
 
   xev.<span class="me1">type</span>                 <span class="sy1">=</span> ClientMessage<span class="sy4">;</span>
   xev.<span class="me1">xclient</span>.<span class="me1">window</span>       <span class="sy1">=</span> win<span class="sy4">;</span>
   xev.<span class="me1">xclient</span>.<span class="me1">message_type</span> <span class="sy1">=</span> wm_state<span class="sy4">;</span>
   xev.<span class="me1">xclient</span>.<span class="me1">format</span>       <span class="sy1">=</span> <span class="nu0">32</span><span class="sy4">;</span>
   xev.<span class="me1">xclient</span>.<span class="me1">data</span>.<span class="me1">l</span><span class="br0">[</span>0<span class="br0">]</span>    <span class="sy1">=</span> <span class="nu0">1</span><span class="sy4">;</span>
   xev.<span class="me1">xclient</span>.<span class="me1">data</span>.<span class="me1">l</span><span class="br0">[</span>1<span class="br0">]</span>    <span class="sy1">=</span> fullscreen<span class="sy4">;</span>
   XSendEvent <span class="br0">(</span>                <span class="co1">// send an event mask to the X-server</span>
      x_display,
      DefaultRootWindow <span class="br0">(</span> x_display <span class="br0">)</span>,
      False,
      SubstructureNotifyMask,
      <span class="sy3">&amp;</span>xev <span class="br0">)</span><span class="sy4">;</span>
 
 
   <span class="co1">///////  the egl part  //////////////////////////////////////////////////////////////////</span>
   <span class="co1">//  egl provides an interface to connect the graphics related functionality of openGL ES</span>
   <span class="co1">//  with the windowing interface and functionality of the native operation system (X11</span>
   <span class="co1">//  in our case.</span>
 
   egl_display  <span class="sy1">=</span>  eglGetDisplay<span class="br0">(</span> <span class="br0">(</span>EGLNativeDisplayType<span class="br0">)</span> x_display <span class="br0">)</span><span class="sy4">;</span>
   <span class="kw1">if</span> <span class="br0">(</span> egl_display <span class="sy1">==</span> EGL_NO_DISPLAY <span class="br0">)</span> <span class="br0">{</span>
      <span class="kw3">cerr</span> <span class="sy1">&lt;&lt;</span> <span class="st0">"Got no EGL display."</span> <span class="sy1">&lt;&lt;</span> endl<span class="sy4">;</span>
      <span class="kw1">return</span> <span class="nu0">1</span><span class="sy4">;</span>
   <span class="br0">}</span>
 
   <span class="kw1">if</span> <span class="br0">(</span> <span class="sy3">!</span>eglInitialize<span class="br0">(</span> egl_display, <span class="kw2">NULL</span>, <span class="kw2">NULL</span> <span class="br0">)</span> <span class="br0">)</span> <span class="br0">{</span>
      <span class="kw3">cerr</span> <span class="sy1">&lt;&lt;</span> <span class="st0">"Unable to initialize EGL"</span> <span class="sy1">&lt;&lt;</span> endl<span class="sy4">;</span>
      <span class="kw1">return</span> <span class="nu0">1</span><span class="sy4">;</span>
   <span class="br0">}</span>
 
   EGLint attr<span class="br0">[</span><span class="br0">]</span> <span class="sy1">=</span> <span class="br0">{</span>       <span class="co1">// some attributes to set up our egl-interface</span>
      EGL_BUFFER_SIZE, 16,
      EGL_RENDERABLE_TYPE,
      EGL_OPENGL_ES2_BIT,
      EGL_NONE
   <span class="br0">}</span><span class="sy4">;</span>
 
   EGLConfig  ecfg<span class="sy4">;</span>
   EGLint     num_config<span class="sy4">;</span>
   <span class="kw1">if</span> <span class="br0">(</span> <span class="sy3">!</span>eglChooseConfig<span class="br0">(</span> egl_display, attr, <span class="sy3">&amp;</span>ecfg, 1, <span class="sy3">&amp;</span>num_config <span class="br0">)</span> <span class="br0">)</span> <span class="br0">{</span>
      <span class="kw3">cerr</span> <span class="sy1">&lt;&lt;</span> <span class="st0">"Failed to choose config (eglError: "</span> <span class="sy1">&lt;&lt;</span> eglGetError<span class="br0">(</span><span class="br0">)</span> <span class="sy1">&lt;&lt;</span> <span class="st0">")"</span> <span class="sy1">&lt;&lt;</span> endl<span class="sy4">;</span>
      <span class="kw1">return</span> <span class="nu0">1</span><span class="sy4">;</span>
   <span class="br0">}</span>
 
   <span class="kw1">if</span> <span class="br0">(</span> num_config <span class="sy3">!</span><span class="sy1">=</span> 1 <span class="br0">)</span> <span class="br0">{</span>
      <span class="kw3">cerr</span> <span class="sy1">&lt;&lt;</span> <span class="st0">"Didn't get exactly one config, but "</span> <span class="sy1">&lt;&lt;</span> num_config <span class="sy1">&lt;&lt;</span> endl<span class="sy4">;</span>
      <span class="kw1">return</span> <span class="nu0">1</span><span class="sy4">;</span>
   <span class="br0">}</span>
 
   egl_surface <span class="sy1">=</span> eglCreateWindowSurface <span class="br0">(</span> egl_display, ecfg, win, <span class="kw2">NULL</span> <span class="br0">)</span><span class="sy4">;</span>
   <span class="kw1">if</span> <span class="br0">(</span> egl_surface <span class="sy1">==</span> EGL_NO_SURFACE <span class="br0">)</span> <span class="br0">{</span>
      <span class="kw3">cerr</span> <span class="sy1">&lt;&lt;</span> <span class="st0">"Unable to create EGL surface (eglError: "</span> <span class="sy1">&lt;&lt;</span> eglGetError<span class="br0">(</span><span class="br0">)</span> <span class="sy1">&lt;&lt;</span> <span class="st0">")"</span> <span class="sy1">&lt;&lt;</span> endl<span class="sy4">;</span>
      <span class="kw1">return</span> <span class="nu0">1</span><span class="sy4">;</span>
   <span class="br0">}</span>
 
   <span class="co1">//// egl-contexts collect all state descriptions needed required for operation</span>
   EGLint ctxattr<span class="br0">[</span><span class="br0">]</span> <span class="sy1">=</span> <span class="br0">{</span>
      EGL_CONTEXT_CLIENT_VERSION, 2,
      EGL_NONE
   <span class="br0">}</span><span class="sy4">;</span>
   egl_context <span class="sy1">=</span> eglCreateContext <span class="br0">(</span> egl_display, ecfg, EGL_NO_CONTEXT, ctxattr <span class="br0">)</span><span class="sy4">;</span>
   <span class="kw1">if</span> <span class="br0">(</span> egl_context <span class="sy1">==</span> EGL_NO_CONTEXT <span class="br0">)</span> <span class="br0">{</span>
      <span class="kw3">cerr</span> <span class="sy1">&lt;&lt;</span> <span class="st0">"Unable to create EGL context (eglError: "</span> <span class="sy1">&lt;&lt;</span> eglGetError<span class="br0">(</span><span class="br0">)</span> <span class="sy1">&lt;&lt;</span> <span class="st0">")"</span> <span class="sy1">&lt;&lt;</span> endl<span class="sy4">;</span>
      <span class="kw1">return</span> <span class="nu0">1</span><span class="sy4">;</span>
   <span class="br0">}</span>
 
   <span class="co1">//// associate the egl-context with the egl-surface</span>
   eglMakeCurrent<span class="br0">(</span> egl_display, egl_surface, egl_surface, egl_context <span class="br0">)</span><span class="sy4">;</span>
 
 
   <span class="co1">///////  the openGL part  ///////////////////////////////////////////////////////////////</span>
 
   GLuint vertexShader   <span class="sy1">=</span> load_shader <span class="br0">(</span> vertex_src , GL_VERTEX_SHADER  <span class="br0">)</span><span class="sy4">;</span>     <span class="co1">// load vertex shader</span>
   GLuint fragmentShader <span class="sy1">=</span> load_shader <span class="br0">(</span> fragment_src , GL_FRAGMENT_SHADER <span class="br0">)</span><span class="sy4">;</span>  <span class="co1">// load fragment shader</span>
 
   GLuint shaderProgram  <span class="sy1">=</span> glCreateProgram <span class="br0">(</span><span class="br0">)</span><span class="sy4">;</span>                 <span class="co1">// create program object</span>
   glAttachShader <span class="br0">(</span> shaderProgram, vertexShader <span class="br0">)</span><span class="sy4">;</span>             <span class="co1">// and attach both...</span>
   glAttachShader <span class="br0">(</span> shaderProgram, fragmentShader <span class="br0">)</span><span class="sy4">;</span>           <span class="co1">// ... shaders to it</span>
 
   glLinkProgram <span class="br0">(</span> shaderProgram <span class="br0">)</span><span class="sy4">;</span>    <span class="co1">// link the program</span>
   glUseProgram  <span class="br0">(</span> shaderProgram <span class="br0">)</span><span class="sy4">;</span>    <span class="co1">// and select it for usage</span>
 
   <span class="co1">//// now get the locations (kind of handle) of the shaders variables</span>
   position_loc  <span class="sy1">=</span> glGetAttribLocation  <span class="br0">(</span> shaderProgram , <span class="st0">"position"</span> <span class="br0">)</span><span class="sy4">;</span>
   phase_loc     <span class="sy1">=</span> glGetUniformLocation <span class="br0">(</span> shaderProgram , <span class="st0">"phase"</span>    <span class="br0">)</span><span class="sy4">;</span>
   offset_loc    <span class="sy1">=</span> glGetUniformLocation <span class="br0">(</span> shaderProgram , <span class="st0">"offset"</span>   <span class="br0">)</span><span class="sy4">;</span>
   <span class="kw1">if</span> <span class="br0">(</span> position_loc <span class="sy1">&lt;</span> 0  <span class="sy3">||</span>  phase_loc <span class="sy1">&lt;</span> 0  <span class="sy3">||</span>  offset_loc <span class="sy1">&lt;</span> 0 <span class="br0">)</span> <span class="br0">{</span>
      <span class="kw3">cerr</span> <span class="sy1">&lt;&lt;</span> <span class="st0">"Unable to get uniform location"</span> <span class="sy1">&lt;&lt;</span> endl<span class="sy4">;</span>
      <span class="kw1">return</span> <span class="nu0">1</span><span class="sy4">;</span>
   <span class="br0">}</span>
 
 
   <span class="kw4">const</span> <span class="kw4">float</span>
      window_width  <span class="sy1">=</span> 800.0,
      window_height <span class="sy1">=</span> <span class="nu16">480.0</span><span class="sy4">;</span>
 
   <span class="co1">//// this is needed for time measuring  --&gt;  frames per second</span>
   <span class="kw4">struct</span>  timezone  tz<span class="sy4">;</span>
   timeval  t1, t2<span class="sy4">;</span>
   gettimeofday <span class="br0">(</span> <span class="sy3">&amp;</span>t1 , <span class="sy3">&amp;</span>tz <span class="br0">)</span><span class="sy4">;</span>
   <span class="kw4">int</span>  num_frames <span class="sy1">=</span> <span class="nu0">0</span><span class="sy4">;</span>
 
   <span class="kw4">bool</span> quit <span class="sy1">=</span> <span class="kw2">false</span><span class="sy4">;</span>
   <span class="kw1">while</span> <span class="br0">(</span> <span class="sy3">!</span>quit <span class="br0">)</span> <span class="br0">{</span>    <span class="co1">// the main loop</span>
 
      <span class="kw1">while</span> <span class="br0">(</span> XPending <span class="br0">(</span> x_display <span class="br0">)</span> <span class="br0">)</span> <span class="br0">{</span>   <span class="co1">// check for events from the x-server</span>
 
         XEvent  xev<span class="sy4">;</span>
         XNextEvent<span class="br0">(</span> x_display, <span class="sy3">&amp;</span>xev <span class="br0">)</span><span class="sy4">;</span>
 
         <span class="kw1">if</span> <span class="br0">(</span> xev.<span class="me1">type</span> <span class="sy1">==</span> MotionNotify <span class="br0">)</span> <span class="br0">{</span>  <span class="co1">// if mouse has moved</span>
<span class="co1">//            cout &lt;&lt; "move to: &lt;&lt; xev.xmotion.x &lt;&lt; "," &lt;&lt; xev.xmotion.y &lt;&lt; endl;</span>
            GLfloat window_y  <span class="sy1">=</span>  <span class="br0">(</span>window_height <span class="sy2">-</span> xev.<span class="me1">xmotion</span>.<span class="me1">y</span><span class="br0">)</span> <span class="sy2">-</span> window_height <span class="sy2">/</span> <span class="nu16">2.0</span><span class="sy4">;</span>
            norm_y            <span class="sy1">=</span>  window_y <span class="sy2">/</span> <span class="br0">(</span>window_height <span class="sy2">/</span> 2.0<span class="br0">)</span><span class="sy4">;</span>
            GLfloat window_x  <span class="sy1">=</span>  xev.<span class="me1">xmotion</span>.<span class="me1">x</span> <span class="sy2">-</span> window_width <span class="sy2">/</span> <span class="nu16">2.0</span><span class="sy4">;</span>
            norm_x            <span class="sy1">=</span>  window_x <span class="sy2">/</span> <span class="br0">(</span>window_width <span class="sy2">/</span> 2.0<span class="br0">)</span><span class="sy4">;</span>
            update_pos <span class="sy1">=</span> <span class="kw2">true</span><span class="sy4">;</span>
         <span class="br0">}</span>
 
         <span class="kw1">if</span> <span class="br0">(</span> xev.<span class="me1">type</span> <span class="sy1">==</span> KeyPress <span class="br0">)</span>   quit <span class="sy1">=</span> <span class="kw2">true</span><span class="sy4">;</span>
      <span class="br0">}</span>
 
      render<span class="br0">(</span><span class="br0">)</span><span class="sy4">;</span>   <span class="co1">// now we finally put something on the screen</span>
 
      <span class="kw1">if</span> <span class="br0">(</span> <span class="sy2">++</span>num_frames <span class="sy2">%</span> 100 <span class="sy1">==</span> 0 <span class="br0">)</span> <span class="br0">{</span>
         gettimeofday<span class="br0">(</span> <span class="sy3">&amp;</span>t2, <span class="sy3">&amp;</span>tz <span class="br0">)</span><span class="sy4">;</span>
         <span class="kw4">float</span> dt  <span class="sy1">=</span>  t2.<span class="me1">tv_sec</span> <span class="sy2">-</span> t1.<span class="me1">tv_sec</span> <span class="sy2">+</span> <span class="br0">(</span>t2.<span class="me1">tv_usec</span> <span class="sy2">-</span> t1.<span class="me1">tv_usec</span><span class="br0">)</span> <span class="sy2">*</span> <span class="nu19">1e-6</span><span class="sy4">;</span>
         <span class="kw3">cout</span> <span class="sy1">&lt;&lt;</span> <span class="st0">"fps: "</span> <span class="sy1">&lt;&lt;</span> num_frames <span class="sy2">/</span> dt <span class="sy1">&lt;&lt;</span> endl<span class="sy4">;</span>
         num_frames <span class="sy1">=</span> <span class="nu0">0</span><span class="sy4">;</span>
         t1 <span class="sy1">=</span> t2<span class="sy4">;</span>
      <span class="br0">}</span>
<span class="co1">//      usleep( 1000*10 );</span>
   <span class="br0">}</span>
 
 
   <span class="co1">////  cleaning up...</span>
   eglDestroyContext <span class="br0">(</span> egl_display, egl_context <span class="br0">)</span><span class="sy4">;</span>
   eglDestroySurface <span class="br0">(</span> egl_display, egl_surface <span class="br0">)</span><span class="sy4">;</span>
   eglTerminate      <span class="br0">(</span> egl_display <span class="br0">)</span><span class="sy4">;</span>
   XDestroyWindow    <span class="br0">(</span> x_display, win <span class="br0">)</span><span class="sy4">;</span>
   XCloseDisplay     <span class="br0">(</span> x_display <span class="br0">)</span><span class="sy4">;</span>
 
   <span class="kw1">return</span> <span class="nu0">0</span><span class="sy4">;</span>
<span class="br0">}</span></pre></div></div>

<!-- 
NewPP limit report
Preprocessor node count: 4/1000000
Post-expand include size: 0/2097152 bytes
Template argument size: 0/2097152 bytes
Expensive parser function count: 0/100
-->

<!-- Saved in parser cache with key mediawiki-mw_:pcache:idhash:3211-0!1!0!!en!2 and timestamp 20201218053219 -->
<div class="printfooter">
Retrieved from "<a href="https://wiki.maemo.org/SimpleGL_example">https://wiki.maemo.org/SimpleGL_example</a>"</div>
			<div id="catlinks"><div id="catlinks" class="catlinks"><div id="mw-normal-catlinks"><a href="/Special:Categories" title="Special:Categories">Categories</a>: <span dir="ltr"><a href="/Category:Development" title="Category:Development">Development</a></span> | <span dir="ltr"><a href="/Category:Fremantle" title="Category:Fremantle">Fremantle</a></span></div></div></div>
			<!-- end content -->



                    </div><!-- /main-wrapper -->
                </div><!-- /main --><!-- content end -->

			<div class="visualClear"></div>

        <ul style="clear: left;float: left;display: inline;list-style-type: none;">
<li id="lastmod"> This page was last modified on 26 July 2017, at 02:51.</li><li id="viewcount">This page has been accessed 57,613 times.</li>      </ul>
			<div class="visualClear"></div>


			<div id="footer">
                <div id="footer-wrapper-left">
                    <div id="footer-wrapper-right">

			<ul>
                                <li class="first"><a rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/">All Content CC</a></li>
                <li><a href="http://maemo.org/legal/">Legal</a></li>
                				<li class="privacy"><a href="/maemo.org_wiki:Privacy_policy" title="maemo.org wiki:Privacy policy">Privacy policy</a></li>
				<li class="about"><a href="/maemo.org_wiki:About" title="maemo.org wiki:About">About maemo.org wiki</a></li>
                <li>Powered by <a href="http://www.mediawiki.org">MediaWiki</a></li>
			</ul>
                    </div>
                </div>
		</div>
		
	
		<script type="text/javascript">if (window.runOnloadHook) runOnloadHook();</script>
</div>
<!-- Served in 0.081 secs. -->

        </div><!-- container -->

    

</body></html>