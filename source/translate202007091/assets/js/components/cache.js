define(function(require){var e=require("./db");function c(e){for(var t=e.length,n=new ArrayBuffer(t),r=new Uint8Array(n),a=0;a<t;++a)r[a]=255&e.charCodeAt(a);return n}function s(e){return new Blob([e],{type:"application/octet-stream"})}function r(i,n,o,u){function f(){u&&u(null)}e.getDB(function(a){a.get(i,function(e){var t,r;e?u&&("raw"===o?u(e):(t=c(e),u("ab"===o?t:s(t)))):((r=new XMLHttpRequest).open("GET",n,!0),r.overrideMimeType("text/plain;charset=x-user-defined"),r.responseType="text",r.addEventListener("readystatechange",function e(){if(4===r.readyState)if(r.removeEventListener("readystatechange",e,!1),200===r.status){var t,n=r.responseText;if("<"===n.charAt(0))return void f();u&&("raw"===o?u(n):(t=c(n),u("ab"===o?t:s(t)))),a.put(i,n)}else f()},!1),r.send())},f)})}return{getBlob:function(e,t,n){r(e,t,"blob",n)},getArrayBuffer:function(e,t,n){r(e,t,"ab",n)},get:function(e,t,n){r(e,t,"raw",n)}}});