!function(){var m="chrome.lego.setInterval",v=Object.create(null),f=Object.create(null);function h(e,n){var r=new XMLHttpRequest;r.open("GET",e,!0),r.responseType="blob",r.addEventListener("readystatechange",function e(){var t;4===r.readyState&&(r.removeEventListener("readystatechange",e,!1),200===r.status?((t=new FileReader).readAsDataURL(r.response),t.addEventListener("loadend",function e(){t.removeEventListener("loadend",e,!1),n(t.result)},!1)):n(!1))},!1),r.send()}function b(e,n){var r=new XMLHttpRequest;r.open("GET",e,!0),r.responseType="text",r.addEventListener("readystatechange",function e(){var t;4===r.readyState&&(r.removeEventListener("readystatechange",e,!1),t=r.status,n(200===t&&r.responseText))},!1),r.send()}function x(e,n){var t,r=e.url,o=e.method||"GET",a=e.data,s="object"!=typeof(t=a)?"":Object.keys(t).map(function(e){return encodeURIComponent(e)+"="+encodeURIComponent(t[e])}).join("&");"GET"===o&&a&&(-1===r.indexOf("?")?r+="?"+s:r+="&"+s);var c=new XMLHttpRequest;if(c.open(o,r,!0),c.responseType="text",c.addEventListener("readystatechange",function e(){var t;4===c.readyState&&(c.removeEventListener("readystatechange",e,!1),t=c.status,n(200===t&&c.responseText))},!1),"POST"===o&&a)return c.setRequestHeader("Content-type","application/x-www-form-urlencoded"),void c.send(s);c.send()}var w={show:"1",fold:"2",hidden:"-1"},y={};Object.keys(w).forEach(function(e){y[w[e]]=e});var k=Object.create(null);chrome.runtime.onMessage.addListener(function(e,t,r){if(t.tab&&t.id===chrome.runtime.id){var n,o,a,s,c=e.path,i=e.token,l=e.interval,u=e.timeout,d=t.tab.id;switch(e.type){case"chrome.lego.getManifest":r(chrome.runtime.getManifest());break;case"chrome.lego.getFile":if(!(c in v))return h(c,function(e){v[c]=e,r(e)}),!0;r(v[c]);break;case"chrome.lego.getTextFile":if(!(c in f))return b(c,function(e){f[c]=e,r(e)}),!0;r(f[c]);break;case"chrome.lego.contentScriptReport":o=e.reportName,a=e.reportType,s=e.reportData,window.external&&external.lego&&(external.lego.Report?external.lego.Report(o,a,s):external.lego.Common.Report(o,a,s));break;case"chrome.lego.contentScriptGetBrowserVersion":return n=function(e){var t={};try{t=JSON.parse(e)}catch(e){}var n=t.version||"0.0.0.0";r(n)},external.lego&&(external.lego.GetVersion?n(external.lego.GetVersion('{"version":""}')):external.lego.Common.GetInfo('{"version":""}',n)),!0;case"chrome.lego.contentScriptGetBrowserActionVisibleState":!function(t){function n(e){e in y?t(y[e]):t("unkown")}var r="-999";if(window.external&&external.lego&&external.lego.browser){if(external.lego.browser.GetButtonVisibleEx)return external.lego.Browser.GetButtonVisibleEx(n);try{r=external.lego.browser.GetButtonVisible()}catch(e){return n(r)}n(r)}}(r);break;case"chrome.lego.contentScriptSetBrowserActionVisibleState":var g=e.state,p=!0;if(g in w)try{p=external.lego.browser.SetButtonVisible(w[g])}catch(e){p=!1}else p=!1;r(p);break;case"chrome.lego.setTimeout":return k[i]=setTimeout(function(){r(),delete k[i]},u),!0;case"chrome.lego.clearTimeout":delete k[i];break;case m:k[i]=setInterval(function(){chrome.tabs.sendMessage(d,{type:"chrome.lego.setInterval.callback",token:i})},l);break;case"chrome.lego.clearInterval":clearInterval(k[i]),delete k[i];break;case"chrome.lego.ajax":return x(e.option,r),!0}}})}();